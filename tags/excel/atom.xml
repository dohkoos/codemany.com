<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Excel | 乐者为王]]></title>
  <link href="http://codemany.com/tags/excel/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-11-17T22:14:06+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails中使用spreadsheet导入Excel文件]]></title>
    <link href="http://codemany.com/blog/using-spreadsheet-to-import-excel-file-in-rails/"/>
    <updated>2010-12-07T21:59:38+08:00</updated>
    <id>http://codemany.com/blog/using-spreadsheet-to-import-excel-file-in-rails</id>
    <content type="html"><![CDATA[<p><a href="http://spreadsheet.rubyforge.org/">spreadsheet</a>是设计来代替ParseExcel和Spreadsheet::Excel，该插件可以读取和生成Excel文件。</p>

<p>首先安装gem包</p>

<pre><code>gem install spreadsheet
</code></pre>

<p>导入Excel文件页面的代码：</p>

<pre><code>&lt;% form_for(@entry, :html =&gt; { :multipart =&gt; true }) do |f| %&gt;
  &lt;%= f.error_messages %&gt;

  &lt;p&gt;
    &lt;%= label_tag 'Select a EXECL File' %&gt;&lt;br /&gt;
    &lt;%= file_field 'file', 'xlsfile' %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= f.submit 'Import' %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>在相应的controller中添加以下代码：</p>

<pre><code>require 'spreadsheet'

xlsfile = upload_file(params[:file]['xlsfile'])
book = Spreadsheet.open("#{RAILS_ROOT}/public/uploads/#{xlsfile}")
sheet = book.worksheet(0)
sheet.each_with_index do |row, i|
  entry = Entry.new
  entry.save
end

protected
  def upload_file(file)
    if !file.original_filename.empty?
      @filename = get_file_name(file.original_filename)
      File.open("#{RAILS_ROOT}/public/uploads/#{@filename}", "wb") do |f|
        f.write(file.read)
      end
      return @filename
    end
  end

  def get_file_name(filename)
    if !filename.nil?
      # chinese filename not supported?
      Time.now.strftime("%Y%m%d%H%M%S") + '.xls'
    end
  end
end
</code></pre>
]]></content>
  </entry>
  
</feed>
