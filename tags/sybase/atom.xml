<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Sybase | 乐者为王]]></title>
  <link href="http://codemany.com/tags/sybase/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2016-09-22T09:43:46+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[com.sybase.jdbc2.jdbc.SybSQLException: SQL Anywhere Error -143: Column '@p3' not found]]></title>
    <link href="http://codemany.com/blog/comsybasejdbc2jdbcsybsqlexception-sql-anywhere-error-143-column-not-found/"/>
    <updated>2008-09-19T00:24:13+08:00</updated>
    <id>http://codemany.com/blog/comsybasejdbc2jdbcsybsqlexception-sql-anywhere-error-143-column-not-found</id>
    <content type="html"><![CDATA[<p>数据库：Sybase ASA 10</p>

<p>在移植PB程序到Java程序时，碰到了如下的嵌入式SQL语句：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">SELECT DISTINCT
    bhr_emp_job.emp_nbr,
    bhr_emp_job.cyr_nyr_flg,
    bhr_emp_job.pay_freq,
    bhr_emp_job.job_cd,
    bhr_emp_job.contr_non_std_flg,
    bhr_emp_job.pay_type
FROM bhr_emp_job
WHEN :as_cal_code &lt;&gt; &#39;&#39;
AND :as_cal_code = bhr_emp_job.cal_cd
</code></pre></div>
<p>转换后的SQL代码如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">SELECT DISTINCT
    bhr_emp_job.emp_nbr,
    bhr_emp_job.cyr_nyr_flg,
    bhr_emp_job.pay_freq,
    bhr_emp_job.job_cd,
    bhr_emp_job.contr_non_std_flg,
    bhr_emp_job.pay_type
FROM bhr_emp_job
WHEN ? &lt;&gt; &#39;&#39;
AND ? = bhr_emp_job.cal_cd
</code></pre></div>
<p>结果在执行的时候出现了下面的异常：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;ERROR&gt;openQuery in org.rsccc.dao.hrs4300.DHrs4300JobcopyDao when executing SELECT DISTINCT
    bhr_emp_job.emp_nbr,
    bhr_emp_job.cyr_nyr_flg,
    bhr_emp_job.pay_freq,
    bhr_emp_job.job_cd,
    bhr_emp_job.contr_non_std_flg,
    bhr_emp_job.pay_type
FROM bhr_emp_job
WHEN ? &lt;&gt; &#39;&#39;
AND ? = bhr_emp_job.cal_cd
com.sybase.jdbc2.jdbc.SybSQLException: SQL Anywhere Error -143: Column &#39;@p3&#39; not found
</code></pre></div>
<p>在Sybase站点上找到的相关资料是<a href="http://www.ianywhere.com/developer/product_manuals/sqlanywhere/1000/en/html/dberen10/er-errm143.html">Column &#39;%1&#39; not found</a></p>

<blockquote>
<p>Probable cause: You misspelled the name of a column, or the column you are looking for is in a different table.</p>
</blockquote>

<p>想到在PB中是在填充变量值后再将SQL语句扔到数据库中执行，而移植后的Java程序中采用的是PreparedStatement来执行SQL语句，所以会出现Column not found的错误。解决方法是将?移到赋值符号的右边：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">SELECT DISTINCT
    bhr_emp_job.emp_nbr,
    bhr_emp_job.cyr_nyr_flg,
    bhr_emp_job.pay_freq,
    bhr_emp_job.job_cd,
    bhr_emp_job.contr_non_std_flg,
    bhr_emp_job.pay_type
FROM bhr_emp_job
WHEN &#39;&#39; &lt;&gt; ?
AND bhr_emp_job.cal_cd = ?
</code></pre></div>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[com.sybase.jdbc.SybSQLException: The parameter '@user' in the procedure 'sp_adm_chk_lvl' was not declared as an OUTPUT parameter]]></title>
    <link href="http://codemany.com/blog/comsybasejdbcsybsqlexception-the-parameter-in-the-procedure-was-not-declared-as-an-output-parameter/"/>
    <updated>2007-06-01T17:33:13+08:00</updated>
    <id>http://codemany.com/blog/comsybasejdbcsybsqlexception-the-parameter-in-the-procedure-was-not-declared-as-an-output-parameter</id>
    <content type="html"><![CDATA[<p>运行环境：WebLogic 8.16 + Sybase ASE 12.5</p>

<p>问题：The New, Save from File menu are grayed out</p>

<p>分析打印出来的日志文件找到有以下异常出现：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">org.springframework.jdbc.UncategorizedSQLException: CallableStatementCallback
    ; uncategorized SQLException for SQL [{? = call sp_adm_chk_lvl(?, ?, ?, ?, ?, ?, ?)}]
    ; SQL state [ZZZZZ]; error code [276]
    ; The parameter &#39;@user&#39; in the procedure &#39;sp_adm_chk_lvl&#39; was not declared as an OUTPUT parameter.
    ; nested exception is com.sybase.jdbc.SybSQLException: The parameter &#39;@user&#39; in the procedure &#39;sp_adm_chk_lvl&#39; was not declared as an OUTPUT parameter.
</code></pre></div>
<p>搜索到一篇出现类似问题的文章 <a href="http://www.ibm.com/support/docview.wss?uid=swg21174150">http://www.ibm.com/support/docview.wss?uid=swg21174150</a> ，其中有这么一段文字：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">If you call CallableStatement.clearParameters() when the statement has a ?=rpc return value,
we forget that there is a return value and the next time the rpc is executed we send too many
input parameters, and they are all shifted to the right. This problem has been corrected,
and jConnect now has the expected behavior for the clearParameters() method.
</code></pre></div>
<p>因此猜测菜单变灰的问题是由于使用了不正确的JDBC Driver版本。在Weblogic Console发现Connection Pools中Driver Name是com.sybase.jdbc.SybDriver，而正确的设置应该是com.sybase.jdbc2.jdbc.SybDriver，修改Driver Name后New, Save菜单项果然可以正常使用了。</p>
]]></content>
  </entry>
  
</feed>
