<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: AXMLPrinter2 | 乐者为王]]></title>
  <link href="http://codemany.com/tags/axmlprinter2/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-08-13T19:23:22+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[反编译Android apk文件]]></title>
    <link href="http://codemany.com/blog/2011/07/01/decompile-android-apk-file/"/>
    <updated>2011-07-01T06:07:07+08:00</updated>
    <id>http://codemany.com/blog/2011/07/01/decompile-android-apk-file</id>
    <content type="html"><![CDATA[<p>classes.dex是Java源码编译后生成的字节码文件。由于Android使用的dalvik虚拟机与标准的Java虚拟机是不兼容的，dex文件与class文件相比，不论是文件结构还是opcode都不一样。</p>

<p>目前有下面这几种反编译的工具:<br />
dexdump
<a href="http://dedexer.sourceforge.net/">Dedexer</a>
<a href="http://code.google.com/p/android4me/">AXMLPrinter2</a>
<a href="http://code.google.com/p/android-apktool/">apktool</a>
<a href="http://code.google.com/p/dex2jar/">dex2jar</a> + <a href="http://java.decompiler.free.fr/?q=jdgui">JD-GUI</a>
<a href="http://code.google.com/p/smali/">smali</a></p>

<p>Android开发包提供了一个dex的反编译工具dexdump。用法为首先启动Android模拟器，把要反编译的dex文件用adb push上传到模拟器中，然后通过adb shell登录，找到该dex文件，执行dexdump xxx.dex。总的来说dexdump功能比较弱，且用起来麻烦，另外反编译的结果可读性也很差。</p>

<p>另一个dex文件的反编译工具是Dedexer，且反编译的效果比较好。它可以读取dex格式的文件，生成一种类似于汇编语言的输出。这种输出与Jasmin的输出相似，但包含的是Dalvik的字节码。Dedexer与dexdump相比至少有3个优点：<br />
1. 不需要在Android模拟器中运行；<br />
2. 反编译后的文件目录结构和源代码结构相近，每个class文件对应一个ddx文件。不像dexdump那样把所有的结果都放在一起；<br />
3. 可以作为反编译引擎。目前好多强大的反编译工具都是以Jasmin作为反编译引擎的。<br />
可以下载已经编译好的jar文件ddx1.11.jar，对应Java 1.6版本。用法：<br />
<code>
java -jar ddx1.11.jar -o -D -r -d src classes.dex //在src目录下生成ddx文件&lt;br /&gt;
</code></p>

<p>在apk中的资源是经过压缩的，用文本工具看都是乱码，可以通过AXMLPrinter2将其转换为可读的xml文件。具体命令为：<br />
<code>
java -jar AXMLPrinter2.jar xxx.xml output.xml&lt;br /&gt;
</code></p>

<p>目前最好的dex反编译工具是apktool。可以帮助我们把apk文件反编译，输出smali格式的代码和图片和资源等文件，还可以在修改后重新打包。将下载下来的apktool和apktool-install-windows解压到同一目录下，有三个文件：aapt.exe，apktool.bat和apktool.jar。使用方法：<br />
<code>
apktool d xxx.apk zzz //反编译xxx.apk到zzz目录，得到apk的图片和配置资源文件等&lt;br /&gt;
apktool b zzz //从文件夹zzz重建apk，输出到zzz/dist/out.apk&lt;br /&gt;
</code></p>

<p>dex2jar是一个将Dalvik虚拟机的dex文件转换回标准Java的class文件的工具：<br />
<code>
dex2jar xxx.apk //生成jar文件，可以用JD GUI工具直接打开查看&lt;br /&gt;
</code></p>

<p>smali可以反编译dex文件，也可以把你修改过的代码重新编译成dex：</p>

<p><code>
java -jar baksmali.jar classes.dex -o classes
java -jar smali.jar classes -o classes.dex
</code></p>
]]></content>
  </entry>
  
</feed>
