<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: spreadsheet | 乐者为王]]></title>
  <link href="http://codemany.com/tags/spreadsheet/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-08-11T23:42:49+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails中使用spreadsheet导入excel]]></title>
    <link href="http://codemany.com/blog/2010/12/07/import-excel-spreadsheet-to-using-rails/"/>
    <updated>2010-12-07T05:59:38+08:00</updated>
    <id>http://codemany.com/blog/2010/12/07/import-excel-spreadsheet-to-using-rails</id>
    <content type="html"><![CDATA[<p><a href="http://spreadsheet.rubyforge.org/">spreadsheet</a>是设计来代替ParseExcel和Spreadsheet::Excel，该插件可以读取和生成excel文件。</p>

<p>首先安装gem包：<br />
<code>
gem install spreadsheet&lt;br /&gt;
</code></p>

<p>导入页面代码：<br />
```
&lt;% form_for(@entry, :html => {:multipart => true}) do |f| %>
  &lt;%= f.error_messages %></p>

<p>  <p></p>

<pre><code>Select your file:&lt;br /&gt;
&lt;%= file_field 'file', 'xlsfile' %&gt;
</code></pre>

<p>  </p></p>

<p>  <p></p>

<pre><code>&lt;%= f.submit 'Import' %&gt;
</code></pre>

<p>  </p>
&lt;% end %>
```</p>

<p>在相应的controller中添加以下代码：<br />
```
require 'spreadsheet'</p>

<p>xlsfile = upload_file(params[:file]['xlsfile'])<br />
book = Spreadsheet.open("#{RAILS_ROOT}/public/uploads/#{xlsfile}")<br />
sheet = book.worksheet(0)<br />
sheet.each_with_index do |row, i|<br />
  entry = Entry.new<br />
  entry.save<br />
end</p>

<p>protected<br />
  def upload_file(file)<br /></p>

<pre><code>if !file.original_filename.empty?&lt;br /&gt;
  @filename = get_file_name(file.original_filename)&lt;br /&gt;
  File.open("#{RAILS_ROOT}/public/uploads/#{@filename}", "wb") do |f|&lt;br /&gt;
    f.write(file.read)&lt;br /&gt;
  end&lt;br /&gt;
  return @filename&lt;br /&gt;
end&lt;br /&gt;
</code></pre>

<p>  end</p>

<p>  def get_file_name(filename)<br /></p>

<pre><code>if !filename.nil?&lt;br /&gt;
  # chinese filename not supported?&lt;br /&gt;
  Time.now.strftime("%Y%m%d%H%M%S") + '.xls'&lt;br /&gt;
end&lt;br /&gt;
</code></pre>

<p>  end<br />
end<br />
[/code]
</p></p>
]]></content>
  </entry>
  
</feed>
