<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: apktool | 乐者为王]]></title>
  <link href="http://codemany.com/tags/apktool/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-11-18T19:50:27+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[反编译Android APK文件]]></title>
    <link href="http://codemany.com/blog/decompile-android-apk-file/"/>
    <updated>2011-07-01T06:07:07+08:00</updated>
    <id>http://codemany.com/blog/decompile-android-apk-file</id>
    <content type="html"><![CDATA[<p>classes.dex是Java源码编译后生成的字节码文件。由于Android使用的Dalvik虚拟机与标准的Java虚拟机是不兼容的，dex文件与class文件相比，不论是文件结构还是opcode都不一样。</p>

<p>目前有下面这几种反编译的工具:</p>

<ul>
<li>dexdump</li>
<li><a href="http://dedexer.sourceforge.net/">Dedexer</a></li>
<li><a href="http://code.google.com/p/android4me/">AXMLPrinter2</a></li>
<li><a href="http://code.google.com/p/android-apktool/">apktool</a></li>
<li><a href="http://code.google.com/p/dex2jar/">dex2jar</a> + <a href="http://java.decompiler.free.fr/?q=jdgui">JD-GUI</a></li>
<li><a href="http://code.google.com/p/smali/">smali</a></li>
</ul>


<p>dexdump是Android开发包提供的反编译工具。用法为首先启动Android模拟器，把要反编译的dex文件用adb push上传到模拟器中，然后通过adb shell登录，找到该dex文件，执行dexdump example.dex。总的来说dexdump功能比较弱，且用起来麻烦，另外反编译的结果的可读性也很差。</p>

<p>另一个反编译工具是Dedexer，反编译的效果比较好。它可以读取dex格式的文件，生成一种类似于汇编语言的输出。这种输出与Jasmin的输出相似，但包含的是Dalvik的字节码。与dexdump相比它至少有3个优点：</p>

<ol>
<li>不需要在Android模拟器中运行；</li>
<li>反编译后的文件目录结构和源代码结构相近，每个class文件对应一个ddx文件。不像dexdump那样把所有的结果都放在一起；</li>
<li>可以作为反编译引擎。目前好多强大的反编译工具都是以Jasmin作为反编译引擎的。</li>
</ol>


<p>可以下载已经编译好的ddx1.11.jar文件（对应Java 1.6版本）。用法：</p>

<pre><code>java -jar ddx1.11.jar -o -D -r -d src classes.dex  # 在src目录下生成ddx文件
</code></pre>

<p>APK中的资源是经过压缩的，用文本工具看都是乱码，可以通过AXMLPrinter2将其转换为可读的XML文件。具体命令为：</p>

<pre><code>java -jar AXMLPrinter2.jar example.xml output.xml
</code></pre>

<p>目前最好的反编译工具是apktool。可以帮助我们把APK文件反编译，输出smali格式的代码、图片和资源等文件，还可以在修改后重新打包。将下载下来的apktool和apktool-install-windows解压到同一目录，有三个文件：aapt.exe，apktool.bat和apktool.jar。使用方法：</p>

<pre><code>apktool d example.apk example  # 反编译example.apk到example目录，得到APK的图片和配置资源文件等
apktool b example  # 从example目录重建APK，输出到example/dist/out.apk
</code></pre>

<p>dex2jar是一个将Dalvik虚拟机的dex文件转换回标准Java的class文件的工具：</p>

<pre><code>dex2jar example.apk  # 生成jar文件，可以用JD GUI工具直接打开查看
</code></pre>

<p>smali可以反编译dex文件，也可以把你修改过的代码重新编译成dex：</p>

<pre><code>java -jar baksmali.jar classes.dex -o classes
java -jar smali.jar classes -o classes.dex
</code></pre>
]]></content>
  </entry>
  
</feed>
