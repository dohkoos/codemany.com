<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Inno Setup | 乐者为王]]></title>
  <link href="http://codemany.com/tags/inno-setup/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2015-10-19T08:58:54+00:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[完成了wxWidgets Wizard for Visual Studio 2005/2008的安装程序]]></title>
    <link href="http://codemany.com/blog/complete-wxwidgets-wizard-for-visual-studio-2005-and-2008-install-program/"/>
    <updated>2008-05-21T07:28:16+00:00</updated>
    <id>http://codemany.com/blog/complete-wxwidgets-wizard-for-visual-studio-2005-and-2008-install-program</id>
    <content type="html"><![CDATA[<p>两个晚上的时间，一边查资料一边学习，同时编写和测试安装脚本，最终完成了wxWidgets Wizard for Visual Studio 2005/2008的安装程序。现在不用配置就可以使用wxWidgets Wizard的代码框架生成功能了。安装制作程序采用的是Inno Setup，完整的安装脚本如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">#define SrcImgsDir &#39;..\VCWizards\images&#39;
#define SrcHtmlDir &#39;..\VCWizards\html\1033&#39;
#define SrcScptDir &#39;..\VCWizards\scripts\1033&#39;
#define SrcTempDir &#39;..\VCWizards\templates\1033&#39;
#define TgtImgsDir &#39;VCWizards\AppWiz\wxWidgets\Application\images&#39;
#define TgtHtmlDir &#39;VCWizards\AppWiz\wxWidgets\Application\html\1033&#39;
#define TgtScptDir &#39;VCWizards\AppWiz\wxWidgets\Application\scripts\1033&#39;
#define TgtTempDir &#39;VCWizards\AppWiz\wxWidgets\Application\templates\1033&#39;

[Setup]
AppName=wxWidgets Application Wizard
AppVerName=wxWidgets Wizard 1.0.0
AppPublisher=dohkoos
DefaultDirName={pf32}\Microsoft Visual Studio 9.0\VC
DirExistsWarning=no
;Uninstallable=no
UninstallFilesDir={app}\VCWizards\AppWiz\wxWidgets
UninstallDisplayIcon={app}\VCProjects\wxAppWiz.ico
Compression=lzma
SolidCompression=yes

[Files]
Source: ..\VCProjects\wxAppWiz.ico; DestDir: {app}\VCProjects
Source: ..\VCProjects\wxAppWiz.vsz; DestDir: {app}\VCProjects
Source: ..\VCProjects\wxWidgets\wxWidgets.vsdir; DestDir: {app}\VCProjects\wxWidgets
Source: {#SrcImgsDir}\*.gif; DestDir: {app}\{#TgtImgsDir}
Source: {#SrcHtmlDir}\*.htm; DestDir: {app}\{#TgtHtmlDir}
Source: {#SrcHtmlDir}\*.css; DestDir: {app}\{#TgtHtmlDir}
Source: {#SrcScptDir}\*.js; DestDir: {app}\{#TgtScptDir}
Source: {#SrcTempDir}\*.h; DestDir: {app}\{#TgtTempDir}
Source: {#SrcTempDir}\*.cpp; DestDir: {app}\{#TgtTempDir}
Source: {#SrcTempDir}\readme.txt; DestDir: {app}\{#TgtTempDir}
Source: {#SrcTempDir}\root.manifest; DestDir: {app}\{#TgtTempDir}
Source: {#SrcTempDir}\Templates.inf; DestDir: {app}\{#TgtTempDir}

[Code]
procedure CurStepChanged(CurStep: TSetupStep);
var
    i: Integer;
    Signature: String;
    ConfigLine: String;
    ConfigFile: String;
    ConfigFileLines: TArrayOfString;
begin
    if CurStep = ssPostInstall then begin
        Signature := &#39;wxWidgets&#39;;
        ConfigLine := &#39;wxWidgets|{1B027A40-8F43-11D0-8D11-00A0C91BC942}|#1043|70&#39; + #13#10;
        ConfigFile := ExpandConstant(&#39;{app}\VCProjects\vc.vsdir&#39;);
        LoadStringsFromFile(ConfigFile, ConfigFileLines);
        for i := 0 to GetArrayLength(ConfigFileLines) - 1 do begin
            if (Pos(Signature, ConfigFileLines[i]) &gt; 0) then abort;
        end;
        SaveStringToFile(ConfigFile, ConfigLine, True);
    end;
end;

procedure CurUninstallStepChanged(CurUninstallStep: TUninstallStep);
var
    i: Integer;
    j: Integer;
    Signature: String;
    ConfigFile: String;
    ConfigFileLines, NewConfigFileLines: TArrayOfString;
begin
    if CurUninstallStep = usUninstall then begin
        Signature := &#39;wxWidgets&#39;;
        ConfigFile := ExpandConstant(&#39;{app}\VCProjects\vc.vsdir&#39;);
        LoadStringsFromFile(ConfigFile, ConfigFileLines);
        SetArrayLength(NewConfigFileLines, GetArrayLength(ConfigFileLines) - 1);
        j := 0;
        for i := 0 to GetArrayLength(ConfigFileLines) - 1 do begin
            if (Pos(Signature, ConfigFileLines[i]) &gt; 0) then begin
                continue;
            end else begin
                NewConfigFileLines[j] := ConfigFileLines[i];
                j := j + 1;
            end;
        end;
        SaveStringsToFile(ConfigFile, NewConfigFileLines, False);
    end;
end;
</code></pre></div>
<p>代码下载：<a href="https://github.com/dohkoos/wxwizard">https://github.com/dohkoos/wxwizard</a></p>
]]></content>
  </entry>
  
</feed>
