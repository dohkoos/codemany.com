<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Log4j | 乐者为王]]></title>
  <link href="http://codemany.com/tags/log4j/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2017-10-31T10:31:58+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Servlet.init()中Log4j不能输出日志]]></title>
    <link href="http://codemany.com/blog/log4j-does-not-output-log-in-servlet-init-method/"/>
    <updated>2005-03-13T08:10:05+08:00</updated>
    <id>http://codemany.com/blog/log4j-does-not-output-log-in-servlet-init-method</id>
    <content type="html"><![CDATA[<p>web.xml配置文件：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;web-app&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;hello&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.example.learning.HelloServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;log4jConfig&lt;/param-name&gt;
            &lt;param-value&gt;/WEB-INF/log4j.properties&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;
&lt;/web-app&gt;
</code></pre></div>
<p>log4j.properties配置文件：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">log4j.rootLogger=ALL, Console
log4j.appender.Console=org.apache.log4j.ConsoleAppender
log4j.appender.Console.layout=org.apache.log4j.PatternLayout
log4j.appender.Console.layout.ConversionPattern=[%t] %37c %3x - %m%n
</code></pre></div>
<p>HelloServlet.java代码：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">import javax.servlet.ServletConfig;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;

import org.apache.log4j.BasicConfigurator;
import org.apache.log4j.Logger;
import org.apache.log4j.PropertyConfigurator;

public class HelloServlet extends HttpServlet {
    private Logger logger = Logger.getLogger(HelloServlet.class);

    public void init() throws ServletException {
        super.init();

        ServletConfig config = getServletConfig();
        ServletContext sc = getServletContext();

        String log4jConfig = config.getInitParameter(&quot;log4jConfig&quot;);
        System.out.println(log4jConfig);

        if (log4jConfig == null) {
            BasicConfigurator.configure();
        } else {
            PropertyConfigurator.configure(sc.getRealPath(log4jConfig));
        }

        logger.info(&quot;This is an info message!&quot;);
    }

    public void destroy() {
    }
}
</code></pre></div>
<p>程序运行没有问题，可就是不能在Console视图中输出日志信息，而且使用System.out.println()也不能输出，不过在把private Logger logger行注释掉后System.out.println()就可以输出了。查看TOMCAT_HOME/logs中的日志文件，发现有如下异常：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">----- Root Cause -----
java.lang.NoClassDefFoundError: org/apache/log4j/Logger
  at com.example.learning.HelloServlet.&lt;init&gt;(HelloServlet.java:15)
</code></pre></div>
<p>找不到Logger类？是不是WEB-INF/lib目录下没有log4j.jar呢？转到WEB-INF/lib目录，果然没有发现log4j.jar文件。把log4j.jar拷过去再试一下，真的OK了。</p>
]]></content>
  </entry>
  
</feed>
