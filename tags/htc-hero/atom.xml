<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: HTC Hero | 乐者为王]]></title>
  <link href="http://codemany.com/tags/htc-hero/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-08-25T12:59:46+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[将Nokia 6670的短信导入HTC Hero G3]]></title>
    <link href="http://codemany.com/blog/2011/06/21/transfer-sms-from-nokia6670-to-htc-hero-g3/"/>
    <updated>2011-06-21T08:43:10+08:00</updated>
    <id>http://codemany.com/blog/2011/06/21/transfer-sms-from-nokia6670-to-htc-hero-g3</id>
    <content type="html"><![CDATA[<p>这事本该N久前就该干了（09年末把手机从Nokia 6670换到HTC Hero G3），却一直拖着没有做，今天终于把这事作了一个了结。</p>

<p>Nokia下导出的短信是如Messages_Nokia 6670_20091215.xml这样的一个XML文件，文件内容的编码是unicode，格式就像下面这样：</p>

<p>```
&lt;?xml version="1.0" encoding="unicode"?>
<SMS PhoneModel="Nokia 6670">
  <Message DateTime="2011-06-21 10:10:10"></p>

<pre><code>&lt;Sender&gt;路人甲&lt;/Sender&gt;
&lt;PhoneNumber&gt;+8613988888888&lt;/PhoneNumber&gt;
&lt;Location&gt;Inbox&lt;/Location&gt;
&lt;Text&gt;我是路人甲&lt;/Text&gt;
</code></pre>

<p>  </Message></p>

<p>  <Message DateTime="2011-06-21 11:11:11"></p>

<pre><code>&lt;Sender&gt;路人乙&lt;/Sender&gt;
&lt;PhoneNumber&gt;+8613966666666&lt;/PhoneNumber&gt;
&lt;Location&gt;Outbox&lt;/Location&gt;
&lt;Text&gt;我是路人乙&lt;/Text&gt;
</code></pre>

<p>  </Message>
</SMS>
```</p>

<p>本来是想写个Android应用来直接导入这些备份短信的，不过在实现的过程中发现了SMS Backup&amp;Restore应用导出的备份文件和Nokia的备份文件类似，产生了做个将Nokia备份文件转换成SMS Backup&amp;Restore备份文件的念头，又在网上发现了nicholashan的教程<a href="http://bbs.hiapk.com/thread-140564-1-1.html">《将Nokia的短信导入Hero(可能适用所有Android机型)》</a>，坚定了我的这个想法。</p>

<p>分析了一下SMS Backup&amp;Restore备份文件的格式，文件内容的编码是utf-8的：</p>

<p>```
&lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?>
<smses count="3">
  &lt;sms protocol="0" address="10658658" date="1308629532000"</p>

<pre><code>type="1" subject="null" body="我是内容" toa="null"
sc_toa="null" service_center="null" read="1"
status="-1" locked="0" /&gt;
</code></pre>

<p>  &lt;sms protocol="0" address="13566666666" date="1308633733000"</p>

<pre><code>type="2" subject="null" body="我也是内容" toa="null"
sc_toa="null" service_center="null" read="1"
status="-1" locked="0" /&gt;
</code></pre>

<p>  &lt;sms protocol="0" address="+8613588888888" date="1308641377000"</p>

<pre><code>type="1" subject="null" body="我还是内容" toa="null"
sc_toa="null" service_center="null" read="1"
status="-1" locked="0" /&gt;
</code></pre>

<p></smses>
```</p>

<p>与转换相关的就address、date、type和body四个属性。address是发信人的号码；date是短信发送日期的timestamp。这点nicholashan的确说错了，后面不需要加什么0的（实际上nicholashan自己也怀疑自己的说法）；type等于1表示别人发给你的短信，如果是2的话就是你发给其他人的短信；body就是短信内容了。</p>

<p>将Nokia中的时间转换到SMS Backup&amp;Restore的时间可以使用下面的代码：</p>

<p>```
DateFormat dt = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
long value = 1355296332000L;    // 2012-12-12 12:12:12
Element e = (Element)iter.next();
Attribute attr = e.attribute("DateTime");
try {</p>

<pre><code>value = dt.parse(attr.getValue()).getTime();
</code></pre>

<p>} catch (ParseException ex) {
}
```</p>

<p>完整的代码如下（使用dom4j实现XML解析）：</p>

<p>```
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Iterator;
import java.util.List;</p>

<p>import org.dom4j.Attribute;
import org.dom4j.Document;
import org.dom4j.DocumentException;
import org.dom4j.DocumentHelper;
import org.dom4j.Element;
import org.dom4j.Node;
import org.dom4j.io.SAXReader;
import org.dom4j.io.XMLWriter;</p>

<p>public class Main {</p>

<pre><code>public static void main(String[] args) {
    try {
        SAXReader sr = new SAXReader();
        Document doc = sr.read(new File(args[0]));

        generateDocument(doc);
    } catch (DocumentException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    }
}

private static void generateDocument(Document doc) {
    List list = doc.selectNodes("//Message");

    Document document = DocumentHelper.createDocument();
    Element smses = document.addElement("smses");
    smses.addAttribute("count", String.valueOf(list.size()));

    DateFormat dt = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    long value = 1355296332000L;    // 2012-12-12 12:12:12
    Iterator iter = list.iterator();
    while (iter.hasNext()) {
        Element e = (Element)iter.next();
        Attribute attr = e.attribute("DateTime");
        try {
            value = dt.parse(attr.getValue()).getTime();
        } catch (ParseException e) {
            System.out.println(e.getMessage());
        }
        Node phone = e.selectSingleNode("PhoneNumber");
        Node location = e.selectSingleNode("Location");
        Node text = e.selectSingleNode("Text");

        Element sms = smses.addElement("sms");
        sms.addAttribute("protocol", "0");
        sms.addAttribute("address", phone.getText());
        sms.addAttribute("date", String.valueOf(value));
        if ("Inbox".equals(location.getText())) {
            sms.addAttribute("type", "1");
        } else if ("Outbox".equals(location.getText())) {
            sms.addAttribute("type", "2");
        }
        sms.addAttribute("subject", "null");
        sms.addAttribute("body", text.getText());
        sms.addAttribute("toa", "null");
        sms.addAttribute("sc_toa", "null");
        sms.addAttribute("service_center", "null");
        sms.addAttribute("read", "1");
        sms.addAttribute("status", "-1");
        sms.addAttribute("locked", "0");
    }

    File f = new File("output.xml");
    XMLWriter output = new XMLWriter(new FileWriter(f));
    output.write(document);
    output.close();
}
</code></pre>

<p>}
```</p>

<p>代码下载：<a href="https://github.com/dohkoos/N6670Conv">https://github.com/dohkoos/N6670Conv</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTC HERO G3刷机成2.2固件教程（本人的白色Hero亲测成功）]]></title>
    <link href="http://codemany.com/blog/2010/11/26/flash-android22-rom-to-htc-hero-g3/"/>
    <updated>2010-11-26T06:17:46+08:00</updated>
    <id>http://codemany.com/blog/2010/11/26/flash-android22-rom-to-htc-hero-g3</id>
    <content type="html"><![CDATA[<p>刷机前系统情况：<br />
型号：HTC Hero<br />
固件：1.5<br />
Baseband：53.18.55.06EU_6.35.06.18<br />
Kernel：2.6.27-8dd6deee htc-kernel@and18-2<br />
内部版本：1.79.482.3 146733 CL#49365 release-keys<br />
软件版本：www.HiAPK.com 1.1_g3_sense</p>

<p>G3的ROM目前分为两大类：官方原版RUU版ROM和国内外高手DIY版ROM。</p>

<p>官方版的ROM与高手DIY的有什么区别？</p>

<p>官方版ROM：必须要用HTC特定的RUU方式刷机，而且刷好后系统不带有ROOT权限，默认是英文（需手动设置中文语言）。</p>

<p>高手DIY版ROM：都是在官方原版ROM基础上进行原生编译的、而且刷机方式简单，基本都是ZIP方式的ROM直接放在SD卡上进行刷机的，而且刷好后系统自带中文语言以及ROOT权限，而且还都优化并配置好一些相应的基础设置。</p>

<p>G3简明刷机教程</p>

<ol>
<li>刷机前请备份好所有重要信息和数据；</li>
<li>下载刷机ROM安装包（根据个人喜欢下载，我使用的是“Hero ROM 春哥2.2 for G3 美化版”），将下载的ROM包重命名为update.zip（这里要注意系统隐藏扩展名的问题），复制到SD卡根目录下；</li>
<li>把recovery-RA-hero-v1.7.0.1.img放到SD卡根目录下；</li>
<li>将刷机更新程序flashrec-1.1.2.apk安装到G3手机中，安装成功后可以在程序列表中看到Recovery Flasher，点击运行Recovery Flasher（里面有个备份原来的recovery按钮，可以先备份），在文本框里输入/sdcard/recovery-RA-hero-v1.7.0.1.img，输入的文件名正确后，Flash Recovery Image这个按钮从灰色变成可选按，点击后，便会把这个recovery装入，运行完毕后程序会自动退出。现在部分新版手机已经屏蔽了1.1.2版本，导致无法直接刷写recovery，这时可以使用最新的1.1.3版本；</li>
<li>这时候再关机，长按HOME键（小房子）+ 电源键，直到进入刷机模式；</li>
<li>选择Wipe项清空数据，恢复初始状态（注：此操作会清除全部数据，请提前做好备份）；</li>
<li>选择flash项开始刷机；</li>
<li>等刷机过程全部结束，选reboot项，重新启动系统，至此刷机就大功告成了。</li>
</ol>


<p>在刷机过程中如果出现Can't find update script，那是因为recovery镜像要用1.6.2或以上版本。</p>

<p>还有就是经常说的getroot.apk实际上就是flashrec.apk，flashrec才是真正的项目名。</p>

<p>2011/5/9更新</p>

<p>今天又刷了个“Hero CM6.2官方原版2.2 ROM”，感觉非常不错，正在赏玩中...</p>

<p>刷机工具下载：<a href="https://github.com/dohkoos/htc-hero-flash-tools">https://github.com/dohkoos/htc-hero-flash-tools</a></p>

<p>参考资料：<br />
<a href="http://bbs.goapk.com/thread-21746-1-1.html">http://bbs.goapk.com/thread-21746-1-1.html</a><br />
<a href="http://bbs.goapk.com/thread-49109-1-1.html">http://bbs.goapk.com/thread-49109-1-1.html</a></p>
]]></content>
  </entry>
  
</feed>
