<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Mail | 乐者为王]]></title>
  <link href="http://codemany.com/tags/mail/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2017-09-16T22:15:06+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[PowerBuilder中如何调用默认的邮件客户端]]></title>
    <link href="http://codemany.com/blog/how-to-call-the-default-mail-client-in-powerbuilder/"/>
    <updated>2007-09-20T00:17:40+08:00</updated>
    <id>http://codemany.com/blog/how-to-call-the-default-mail-client-in-powerbuilder</id>
    <content type="html"><![CDATA[<p>在某个窗口上有一个文字超链接（StaticHyperLink控件），点击后就打开默认的邮件客户端，并且把指定收件人的邮件地址填写到收件人地址栏中。</p>

<p>如果在StaticHyperLink控件的URL中使用mailto协议，的确能够做到上述的要求。但是有个问题是在打开邮件客户端前总是先打开一个IE窗口，这样使得用户的体验非常差。而PowerBuilder自带的mailsession对象则只能调用Outlook Express，根本就不用考虑。</p>

<p>查找资料后发现可以通过调用外部函数ShellExecute来解决这个问题。首先在Global/Local External Functions中添加如下声明：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function ulong ShellExecuteA(ulong hwnd, &amp;
                            string lpOperation, &amp;
                            string lpFile, &amp;
                            string lpParameters, &amp;
                            string lpDirectory, &amp;
                            long nShowCmd) library &quot;shell32&quot;
</code></pre></div>
<p>然后在StaticHyperLink控件的Clicked事件中添加代码：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">string ls_null

SetNull(ls_null)
ShellExecuteA(Handle(parent), &amp;
            &quot;open&quot;, &amp;
            &quot;mailto:yourname@example.com&quot;, &amp;
            ls_null, &amp;
            ls_null, &amp;
            1)    // SW_SHOWNORMAL
</code></pre></div>
<p>还有要注意4个string类型的参数，一定是string xxx，千万不要使用下面这种声明方式：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function ulong ShellExecuteA(ulong hwnd, &amp;
                             ref string lpOperation, &amp;
                             ref string lpFile, &amp;
                             ref string lpParameters, &amp;
                             ref string lpDirectory, &amp;
                             long nShowCmd) library &quot;shell32&quot;
</code></pre></div>
<p>刚开始的时候我就使用了这种声明方式，结果每次程序执行到ShellExecuteA时都会弹出一个异常对话框，搞的我非常郁闷。</p>
]]></content>
  </entry>
  
</feed>
