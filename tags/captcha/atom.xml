<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: captcha | 乐者为王]]></title>
  <link href="http://codemany.com/tags/captcha/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-08-22T23:28:43+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[用simple_captcha轻松实现验证码]]></title>
    <link href="http://codemany.com/blog/2010/12/09/easy-to-using-simple-captcha-verification-code/"/>
    <updated>2010-12-09T02:42:26+08:00</updated>
    <id>http://codemany.com/blog/2010/12/09/easy-to-using-simple-captcha-verification-code</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/eshopworks/simple_captcha">simple_captcha</a>是一个可以帮我们在Rails中轻松实现验证码功能的插件，它使用简单，并且支持图片和数字验证。</p>

<p>安装插件</p>

<p><code>
script/plugin install git://github.com/eshopworks/simple_captcha.git&lt;br /&gt;
</code></p>

<p>rails >= 2.0</p>

<p><code>
rake simple_captcha:setup&lt;br /&gt;
</code></p>

<p>rails &lt; 2.0</p>

<p><code>
rake simple_captcha:setup_old&lt;br /&gt;
</code></p>

<p><code>
rake db:migrate&lt;br /&gt;
</code></p>

<p>在config/routes.rb中添加：</p>

<p><code>
map.simple_captcha '/simple_captcha/:action', :controller =&gt; 'simple_captcha'&lt;br /&gt;
</code></p>

<p>在app/controllers/application.rb中添加：</p>

<p><code>
ApplicationController &lt; ActionController::Base&lt;br /&gt;
  include SimpleCaptcha::ControllerHelpers&lt;br /&gt;
end&lt;br /&gt;
</code></p>

<p>在app/views/entries/new.html.erb的form中加上：</p>

<p><code>
&lt;%= show_simple_captcha(:ojbect =&gt; 'entry') %&gt;
</code></p>

<p>在app/models/entry.rb中添加：</p>

<p><code>
class Entry &lt; ActiveRecord::Base&lt;br /&gt;
  apply_simple_captcha&lt;br /&gt;
end&lt;br /&gt;
</code></p>

<p>将app/controllers/entries_controller.rb中的create中</p>

<p><code>
if @entry.save&lt;br /&gt;
  ...&lt;br /&gt;
end&lt;br /&gt;
</code></p>

<p>改为</p>

<p><code>
if @entry.save_with_captcha&lt;br /&gt;
  ...&lt;br /&gt;
end&lt;br /&gt;
</code></p>

<p>2011/2/17更新</p>

<p>当看不清楚，需要换一个验证码时稍麻烦，需要借助Ajax实现，simple_captcha没有提供这个功能，还好小日本写好了一段代码可以参考：<a href="http://d.hatena.ne.jp/kusakari/20080130/1201666383"><a href="http://d.hatena.ne.jp/kusakari/20080130/1201666383">http://d.hatena.ne.jp/kusakari/20080130/1201666383</a></a>。不过可惜使用的是Prototype库，因此花了点时间将之改成了jQuery代码。</p>

<p>```
<span id="captcha_image">
  &lt;%= show_simple_captcha(:object => "user", :label => 'Please type the text from the image.')) %>
</span>
<a href="javascript:void(0);" id="recognize_captcha">I cannot recognize.</a></p>

<script type="text/javascript">
//&lt;![CDATA[<br />
$("#recognize_captcha").click(function() {<br />
  $.ajax({<br />
    url: "<%= url_for(:action => 'update_captcha') %>",<br />
    success: function(response) {<br />
      $("#captcha_image").html(response);<br />
    }<br />
  });<br />
});<br />
//]]&gt;
</script>


<p>```</p>

<p>在controller中加上：</p>

<p><code>
def update_captcha&lt;br /&gt;
  render :layout =&gt; false&lt;br /&gt;
end&lt;br /&gt;
</code></p>

<p>创建update_captcha.html.erb，代码如下：</p>

<p><code>
&lt;%= show_simple_captcha(:object =&gt; "user", :label =&gt; 'Please type the text from the image.') %&gt;
</code></p>

<p>还有就是要在routes.rb中添加一条route，不然会找不到action：</p>

<p><code>
map.update_captcha '/user/update_captcha', :controller =&gt; 'user', :action =&gt; 'update_captcha'&lt;br /&gt;
</code></p>
]]></content>
  </entry>
  
</feed>
