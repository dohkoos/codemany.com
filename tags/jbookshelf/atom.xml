<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: JBookShelf | 乐者为王]]></title>
  <link href="http://codemany.com/tags/jbookshelf/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-08-03T22:17:08+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[使用SiteMesh做网页布局]]></title>
    <link href="http://codemany.com/blog/2013/04/09/page-layout-using-sitemesh/"/>
    <updated>2013-04-09T08:18:33+08:00</updated>
    <id>http://codemany.com/blog/2013/04/09/page-layout-using-sitemesh</id>
    <content type="html"><![CDATA[<p>SiteMesh是一个基于GoF的Decorator模式，用于页面布局的框架。能帮助我们在由大量页面构成的项目中创建一致的页面布局和外观。</p>

<p>这里我们将会把它整合到JBookShelf里去。要和Struts2整合，先在pom.xml添加以下插件，该插件会将依赖的SiteMesh也一并包含到项目中。
```
<dependency></p>

<pre><code>&lt;groupId&gt;org.apache.struts&lt;/groupId&gt;
&lt;artifactId&gt;struts2-sitemesh-plugin&lt;/artifactId&gt;
&lt;version&gt;2.3.12&lt;/version&gt;
</code></pre>

<p></dependency>
```</p>

<p>将web.xml配置中原来的
```
<filter></p>

<pre><code>&lt;filter-name&gt;struts2&lt;/filter-name&gt;
&lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter&lt;/filter-class&gt;
</code></pre>

<p></filter></p>

<p>&lt;filter-mapping></p>

<pre><code>&lt;filter-name&gt;struts2&lt;/filter-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</code></pre>

<p>&lt;/filter-mapping>
```</p>

<p>改成
```
<filter></p>

<pre><code>&lt;filter-name&gt;struts-prepare&lt;/filter-name&gt;
&lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareFilter&lt;/filter-class&gt;
</code></pre>

<p></filter></p>

<p><filter></p>

<pre><code>&lt;filter-name&gt;sitemesh&lt;/filter-name&gt;
&lt;filter-class&gt;com.opensymphony.sitemesh.webapp.SiteMeshFilter&lt;/filter-class&gt;
</code></pre>

<p></filter></p>

<p><filter></p>

<pre><code>&lt;filter-name&gt;struts-execute&lt;/filter-name&gt;
&lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsExecuteFilter&lt;/filter-class&gt;
</code></pre>

<p></filter></p>

<p>&lt;filter-mapping></p>

<pre><code>&lt;filter-name&gt;struts-prepare&lt;/filter-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</code></pre>

<p>&lt;/filter-mapping></p>

<p>&lt;filter-mapping></p>

<pre><code>&lt;filter-name&gt;sitemesh&lt;/filter-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</code></pre>

<p>&lt;/filter-mapping></p>

<p>&lt;filter-mapping></p>

<pre><code>&lt;filter-name&gt;struts-execute&lt;/filter-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</code></pre>

<p>&lt;/filter-mapping>
```</p>

<p>这里要注意过滤器的位置。SiteMesh过滤器必须在StrutsPrepareFilter之后和StrutsExecuteFilter之前，否则在SiteMesh的修饰器页面中将访问不到ActionContext。这是因为Struts2的所有值是保存在Stack Context或者ValueStack中的。默认情况下，某个过滤器一旦访问了该Stack Context或ValueStack，里面对应的值会被清洗掉。如果先使用Struts2的StrutsPrepareAndExecuteFilter来过滤用户请求，则SiteMesh的过滤器将无法取得Stack Context或者ValueStack中的数据。为了解决这个问题，Struts2提供了StrutsPrepareFilter和StrutsExecuteFilter类（在2.1.3版本前是ActionContextCleanUp和FilterDispatcher），通过它们协同来确保SiteMesh正常工作。</p>

<p>在WEB-INF下添加decorators.xml文档：
```
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;utf-8&rdquo;?>
<decorators defaultdir="/layouts"></p>

<pre><code>&lt;excludes&gt;
    &lt;pattern&gt;/stylesheets/*&lt;/pattern&gt;
    &lt;pattern&gt;/javascripts/*&lt;/pattern&gt;
    &lt;pattern&gt;/images/*&lt;/pattern&gt;
&lt;/excludes&gt;

&lt;decorator name="application" page="application.jsp"&gt;
    &lt;pattern&gt;/*&lt;/pattern&gt;
&lt;/decorator&gt;
</code></pre>

<p></decorators>
```</p>

<p>stylesheets、javascripts、images目录下的内容是不需要被修饰的，可以把它们放到execludes块中排除掉。</p>

<p>新建/layouts/application.jsp模版页：
```
&lt;%@ taglib uri=&ldquo;/struts-tags&rdquo; prefix=&ldquo;s&rdquo; %>
&lt;%@ taglib uri=&ldquo;<a href="http://www.opensymphony.com/sitemesh/decorator">http://www.opensymphony.com/sitemesh/decorator</a>&rdquo; prefix=&ldquo;decorator&rdquo; %></p>

<p>&lt;!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>&lt;decorator:title default=&ldquo;JBookShelf&rdquo; /></title>
&lt;decorator:head />
</head></p>

<p><body></p>

<pre><code>&lt;div&gt;
    &lt;s:if test="#session.user_session_key != null"&gt;
    &lt;s:a action="listBook"&gt;All Books&lt;/s:a&gt;
    Welcome, you have logined.
    &lt;s:a action="logout"&gt;Logout&lt;/s:a&gt;
    &lt;/s:if&gt;
    &lt;s:else&gt;
    &lt;s:a action="login!input"&gt;Login&lt;/s:a&gt; |
    &lt;s:a action="register!input"&gt;Register&lt;/s:a&gt;
    &lt;/s:else&gt;
&lt;/div&gt;
&lt;hr /&gt;
&lt;div&gt;Navigation&lt;/div&gt;
&lt;hr /&gt;
&lt;decorator:body /&gt;
&lt;hr /&gt;
&lt;div&gt;Footer&lt;/div&gt;
</code></pre>

<p></body>
</html>
```</p>

<p>代码下载：<a href="https://github.com/dohkoos/JBookShelf">https://github.com/dohkoos/JBookShelf</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Interceptor禁止用户访问未授权的图书信息]]></title>
    <link href="http://codemany.com/blog/2013/02/01/interceptor-prohibit-users-from-accessing-unauthorized-books/"/>
    <updated>2013-02-01T02:50:02+08:00</updated>
    <id>http://codemany.com/blog/2013/02/01/interceptor-prohibit-users-from-accessing-unauthorized-books</id>
    <content type="html"><![CDATA[<p><p>现在的JBookShelf有两个问题：<br />
1. 未登录的用户可以访问图书信息；<br />
2. 登录后的用户可以访问其他用户的图书信息。</p>

<p><p>第一个问题可以使用Struts 2的Interceptor来解决：<br />
1. 创建一个实现了Interceptor接口的类；<br />
2. 在struts.xml配置中定义这个拦截器；<br />
3. 在struts.xml中定义一个使用了上面拦截器的拦截栈；<br />
4. 在struts.xml中定义一个全局转向配置。</p>

<p><p>实现自己的拦截器有点要注意的是，拦截器必须是无状态的，不要使用在API提供的ActionInvocation之外的任何东西。要求拦截器是无状态的原因是Struts 2不能保证为每一个请求或者action创建一个实例，所以如果拦截器带有状态，会引发并发问题。</p>

<p><p>创建AuthorizationInterceptor类，继承类AbstractInterceptor。为什么继承它呢？而不是直接实现接口Interceptor。这是因为AbstractInterceptor已经实现了Interceptor接口，并且实现了接口中的init和destroy方法。而在这个拦截器中，我们并不需要使用这两个方法。下面上代码：<br />
```
package com.codemany.account.interceptor;</p>

<p><p>import java.util.Collections;<br />
import java.util.Set;</p>

<p><p>import com.codemany.account.model.User;</p>

<p><p>import com.opensymphony.xwork2.Action;<br />
import com.opensymphony.xwork2.ActionInvocation;<br />
import com.opensymphony.xwork2.interceptor.AbstractInterceptor;<br />
import com.opensymphony.xwork2.util.TextParseUtil;</p>

<p><p>public class AuthorizationInterceptor extends AbstractInterceptor {<br /></p>

<pre><code>private static final long serialVersionUID = -5140884040684756043L;
</code></pre>

<p><p>    protected Set<String> skipActions = Collections.emptySet();</p>

<p><p>    public void setSkipActions(String skipActions) {<br /></p>

<pre><code>    this.skipActions = TextParseUtil.commaDelimitedStringToSet(skipActions);&lt;br /&gt;
}
</code></pre>

<p><p>    @Override<br /></p>

<pre><code>public String intercept(ActionInvocation invocation) throws Exception {&lt;br /&gt;
    User user = (User)invocation.getInvocationContext()&lt;br /&gt;
            .getSession().get(User.SESSION_KEY);
</code></pre>

<p><p>        boolean isLogined = user != null;<br /></p>

<pre><code>    String action = invocation.getProxy().getActionName();&lt;br /&gt;
    // 如果用户未登录，并且访问的是需要登录权限的Action，就跳转到全局转向配置login上&lt;br /&gt;
    if (isLogined || skipActions.contains(action)) {&lt;br /&gt;
        return invocation.invoke();&lt;br /&gt;
    } else {&lt;br /&gt;
        return Action.LOGIN;&lt;br /&gt;
    }&lt;br /&gt;
}&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>这里的skipActions目的是为了跳过一些不需要拦截的Action。因为默认情况下，拦截器会拦截Action中的所有的方法。像login，register这类Action是任何用户在任何状态下都可以访问的，所以不需要拦截，这里就可以将这些Action放到skipActions中来跳过拦截。</p>

<p><p>实现了拦截类后还要在struts.xml进行配置使它起作用，以下是struts.xml的完整代码：<br />
[code lang=&ldquo;xml&rdquo;]
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;utf-8&rdquo;?>
&lt;!DOCTYPE struts PUBLIC<br /></p>

<pre><code>"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"&lt;br /&gt;
"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;
</code></pre>

<p><p><struts></p>

<pre><code>&lt;constant name="struts.enable.DynamicMethodInvocation" value="true" /&gt;
&lt;constant name="struts.devMode" value="true" /&gt;
</code></pre>

<p><p>    <package name="default" extends="struts-default"></p>

<pre><code>    &lt;interceptors&gt;
        &lt;interceptor name="authorization"&lt;br /&gt;
            class="com.codemany.account.interceptor.AuthorizationInterceptor" /&gt;
</code></pre>

<p><p>            &lt;interceptor-stack name=&ldquo;authorizationStack&rdquo;></p>

<pre><code>            &lt;interceptor-ref name="authorization"&gt;
                &lt;param name="skipActions"&gt;login, logout, register&lt;/param&gt;
            &lt;/interceptor-ref&gt;
            &lt;interceptor-ref name="defaultStack" /&gt;
        &lt;/interceptor-stack&gt;
    &lt;/interceptors&gt;
</code></pre>

<p><p>        &lt;default-interceptor-ref name=&ldquo;authorizationStack&rdquo; /></p>

<p><p>        <!-- 全局转向配置 --></p>

<pre><code>    &lt;!-- 还记得拦截器里面的return Action.LOGIN这句吧，当程序执行完这一行后，--&gt;
    &lt;!-- 就会到struts.xml文件的global-results中找name为login的全局转向配置。--&gt;
    &lt;global-results&gt;
        &lt;result name="login" type="redirectAction"&gt;login!input&lt;/result&gt;
    &lt;/global-results&gt;
&lt;/package&gt;
</code></pre>

<p><p>    <include file="account.xml" /></p>

<pre><code>&lt;include file="book.xml" /&gt;
</code></pre>

<p></struts>
```</p>

<p><p>然后将account.xml和book.xml中package继承的父包改成struts.xml配置中的default包：<br />
[code lang=&ldquo;xml&rdquo;]
<package name="xxx" extends="default">
```</p>

<p><p>第二个问题的解决就是重写BookAction.java的代码，不再从数据库中读取Book数据，而是从当前登录用户的books属性中查找Book信息。<br />
```
package com.codemany.book.action;</p>

<p><p>import java.util.ArrayList;<br />
import java.util.List;</p>

<p><p>import com.codemany.account.model.User;<br />
import com.codemany.book.model.Book;<br />
import com.codemany.book.service.BookService;</p>

<p><p>import com.opensymphony.xwork2.ActionContext;<br />
import com.opensymphony.xwork2.ActionSupport;</p>

<p><p>public class BookAction extends ActionSupport {<br /></p>

<pre><code>private static final long serialVersionUID = 2538923417705852774L;
</code></pre>

<p><p>    private Long bookId;<br /></p>

<pre><code>private Book book;&lt;br /&gt;
private List&lt;Book&gt; bookList;
</code></pre>

<p><p>    private BookService bookService;</p>

<p><p>    public String list() throws Exception {<br /></p>

<pre><code>    if (bookList == null) {&lt;br /&gt;
        bookList = new ArrayList&lt;Book&gt;();&lt;br /&gt;
    }&lt;br /&gt;
    bookList.addAll(getCurrentUser().getBooks());&lt;br /&gt;
    return "list";&lt;br /&gt;
}
</code></pre>

<p><p>    public String show() throws Exception {<br /></p>

<pre><code>    book = getCurrentUser().getBook(bookId);&lt;br /&gt;
    return "show";&lt;br /&gt;
}
</code></pre>

<p><p>    public String input() throws Exception {<br /></p>

<pre><code>    if (bookId != null) {&lt;br /&gt;
        book = getCurrentUser().getBook(bookId);&lt;br /&gt;
    }&lt;br /&gt;
    return INPUT;&lt;br /&gt;
}
</code></pre>

<p><p>    public String saveOrUpdate() throws Exception {<br /></p>

<pre><code>    book.setUser(getCurrentUser());&lt;br /&gt;
    bookService.saveOrUpdateBook(book);&lt;br /&gt;
    return SUCCESS;&lt;br /&gt;
}
</code></pre>

<p><p>    public String delete() throws Exception {<br /></p>

<pre><code>    Book book = getCurrentUser().getBook(bookId);&lt;br /&gt;
    if (book != null) {&lt;br /&gt;
        bookService.deleteBook(bookId);&lt;br /&gt;
        getCurrentUser().getBooks().remove(book);&lt;br /&gt;
    }&lt;br /&gt;
    return SUCCESS;&lt;br /&gt;
}
</code></pre>

<p><p>    public List<Book> getBookList() {<br /></p>

<pre><code>    return bookList;&lt;br /&gt;
}
</code></pre>

<p><p>    public Book getBook() {<br /></p>

<pre><code>    return book;&lt;br /&gt;
}
</code></pre>

<p><p>    public void setBook(Book book) {<br /></p>

<pre><code>    this.book = book;&lt;br /&gt;
}
</code></pre>

<p><p>    public void setBookId(Long bookId) {<br /></p>

<pre><code>    this.bookId = bookId;&lt;br /&gt;
}
</code></pre>

<p><p>    public void setBookService(BookService bookService) {<br /></p>

<pre><code>    this.bookService = bookService;&lt;br /&gt;
}
</code></pre>

<p><p>    private User getCurrentUser() {<br /></p>

<pre><code>    return (User)ActionContext.getContext()&lt;br /&gt;
            .getSession().get(User.SESSION_KEY);&lt;br /&gt;
}&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>上面的代码会产生异常，提示取出的Book数据为空，所以要在User.hbm.xml中set标签后添加属性lazy=“false”，这样Hibernate从数据库中读取User数据时会连带取出对应的Book数据：<br />
[code lang=&ldquo;xml&rdquo;]
<set name="books" inverse="true" lazy="false">
```</p>

<p><p>下面是BookAction类中用到的User.getBook(bookId)代码：<br />
```
public class User {<br /></p>

<pre><code>...&lt;br /&gt;
public Book getBook(Long bookId) {&lt;br /&gt;
    for (Book book : books) {&lt;br /&gt;
        if (bookId != null &amp;&amp; bookId.equals(book.getId())) {&lt;br /&gt;
            return book;&lt;br /&gt;
        }&lt;br /&gt;
    }&lt;br /&gt;
    return null;&lt;br /&gt;
}&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>代码下载：<a href="https://github.com/dohkoos/JBookShelf"><a href="https://github.com/dohkoos/JBookShelf">https://github.com/dohkoos/JBookShelf</a></a>
</p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[实现图书的增删查改（CRUD）]]></title>
    <link href="http://codemany.com/blog/2012/12/22/book-additions-and-deletions-investigation-changed-crud/"/>
    <updated>2012-12-22T14:25:20+08:00</updated>
    <id>http://codemany.com/blog/2012/12/22/book-additions-and-deletions-investigation-changed-crud</id>
    <content type="html"><![CDATA[<p><p>图书的MySQL数据库创建脚本：<br />
<code>
CREATE TABLE books (&lt;br /&gt;
  id int NOT NULL AUTO_INCREMENT,&lt;br /&gt;
  title varchar(255) NOT NULL,&lt;br /&gt;
  description text,&lt;br /&gt;
  image_url varchar(255),&lt;br /&gt;
  price decimal(8, 2) NOT NULL,&lt;br /&gt;
  author varchar(255) NOT NULL,&lt;br /&gt;
  isbn varchar(255) NOT NULL,&lt;br /&gt;
  publisher varchar(255) NOT NULL,&lt;br /&gt;
  user_id int NOT NULL,&lt;br /&gt;
  PRIMARY KEY (id)&lt;br /&gt;
) ENGINE=InnoDB DEFAULT CHARSET=utf-8;&lt;br /&gt;
</code></p>

<p><p>图书实体类文件Book.java主要代码：<br />
```
public class Book {<br /></p>

<pre><code>private Long id;&lt;br /&gt;
private String title;&lt;br /&gt;
private String description;&lt;br /&gt;
private String image_url;&lt;br /&gt;
private double price;&lt;br /&gt;
private String author;&lt;br /&gt;
private String isbn;&lt;br /&gt;
private String publisher;&lt;br /&gt;
private User user;&lt;br /&gt;
...&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>在User类中添加集合变量books：<br />
```
public class User {<br /></p>

<pre><code>...&lt;br /&gt;
private Set&lt;Book&gt; books = new HashSet&lt;Book&gt;();&lt;br /&gt;
...&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>在User.hbm.xml中配置和图书的一对多关联：<br />
[code lang=&ldquo;xml&rdquo;]
<!-- Bidirectional one-to-many association to Book -->
<set name="books" inverse="true"></p>

<pre><code>&lt;key column="user_id" not-null="true" /&gt;
&lt;one-to-many class="com.codemany.book.model.Book" /&gt;
</code></pre>

<p></set>
```</p>

<p><p>图书的表映射文件Book.hbm.xml代码：<br />
[code lang=&ldquo;xml&rdquo;]
&lt;hibernate-mapping></p>

<pre><code>&lt;class name="com.codemany.book.model.Book" table="books"&gt;
    &lt;id name="id"&gt;
        &lt;generator class="increment" /&gt;
    &lt;/id&gt;
</code></pre>

<p><p>        <property name="title" not-null="true" /></p>

<pre><code>    &lt;property name="description" /&gt;
    &lt;property name="image_url" /&gt;
    &lt;property name="price" not-null="true" /&gt;
    &lt;property name="author" not-null="true" /&gt;
    &lt;property name="isbn" not-null="true" /&gt;
    &lt;property name="publisher" not-null="true" /&gt;
</code></pre>

<p><p>        &lt;many-to-one name=&ldquo;user&rdquo; column=&ldquo;user_id&rdquo; not-null=&ldquo;true&rdquo; /></p>

<pre><code>&lt;/class&gt;
</code></pre>

<p>&lt;/hibernate-mapping>
```</p>

<p><p>BookService.java中的代码相对简单，因为没什么复杂的业务逻辑，只是负责把Action和Dao这两层连接起来。</p>

<p><p>BookDao.java中的代码主要实现图书的读取，更新和删除：<br />
```
package com.codemany.book.dao;</p>

<p><p>import java.util.List;</p>

<p><p>import org.hibernate.Query;<br />
import org.hibernate.Session;<br />
import org.hibernate.SessionFactory;<br />
import org.hibernate.Transaction;</p>

<p><p>import com.codemany.book.model.Book;</p>

<p><p>public class BookDao {<br /></p>

<pre><code>private SessionFactory sessionFactory;
</code></pre>

<p><p>    public void setSessionFactory(SessionFactory sessionFactory) {<br /></p>

<pre><code>    this.sessionFactory = sessionFactory;&lt;br /&gt;
}
</code></pre>

<p><p>    public List<Book> getBookList() {<br /></p>

<pre><code>    Session session = sessionFactory.openSession();&lt;br /&gt;
    try {&lt;br /&gt;
        Query query = session.createQuery("from Book b");&lt;br /&gt;
        List&lt;Book&gt; bookList = query.list();&lt;br /&gt;
        return bookList;&lt;br /&gt;
    } finally {&lt;br /&gt;
        session.close();&lt;br /&gt;
    }&lt;br /&gt;
}
</code></pre>

<p><p>    public Book getBook(Long bookId) {<br /></p>

<pre><code>    Session session = sessionFactory.openSession();&lt;br /&gt;
    try {&lt;br /&gt;
        Query query = session.createQuery("from Book b where b.id = :id");&lt;br /&gt;
        query.setLong("id", bookId);&lt;br /&gt;
        query.setMaxResults(1);&lt;br /&gt;
        return (Book)query.uniqueResult();&lt;br /&gt;
    } finally {&lt;br /&gt;
        session.close();&lt;br /&gt;
    }&lt;br /&gt;
}
</code></pre>

<p><p>    public void saveOrUpdateBook(Book book) {<br /></p>

<pre><code>    Session session = sessionFactory.openSession();&lt;br /&gt;
    Transaction ts = null;&lt;br /&gt;
    try {&lt;br /&gt;
        ts = session.beginTransaction();&lt;br /&gt;
        session.saveOrUpdate(book);&lt;br /&gt;
        ts.commit();&lt;br /&gt;
    } finally {&lt;br /&gt;
        session.close();&lt;br /&gt;
    }&lt;br /&gt;
}
</code></pre>

<p><p>    public void deleteBook(Long bookId) {<br /></p>

<pre><code>    Session session = sessionFactory.openSession();&lt;br /&gt;
    Transaction ts = null;&lt;br /&gt;
    try {&lt;br /&gt;
        ts = session.beginTransaction();&lt;br /&gt;
        Book book = (Book)session.get(Book.class, bookId);&lt;br /&gt;
        session.delete(book);&lt;br /&gt;
        ts.commit();&lt;br /&gt;
    } finally {&lt;br /&gt;
        session.close();&lt;br /&gt;
    }&lt;br /&gt;
}&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>BookAction.java负责协调图书应用程序间的运转。接收访问请求，与模型进行交互，将合适的视图展示给用户：<br />
```
package com.codemany.book.action;</p>

<p><p>import java.util.List;</p>

<p><p>import com.codemany.account.model.User;<br />
import com.codemany.book.model.Book;<br />
import com.codemany.book.service.BookService;</p>

<p><p>import com.opensymphony.xwork2.ActionContext;<br />
import com.opensymphony.xwork2.ActionSupport;</p>

<p><p>public class BookAction extends ActionSupport {<br /></p>

<pre><code>private static final long serialVersionUID = 2538923417705852774L;
</code></pre>

<p><p>    private Long bookId;<br /></p>

<pre><code>private Book book;&lt;br /&gt;
private List&lt;Book&gt; bookList;&lt;br /&gt;
private BookService bookService;
</code></pre>

<p><p>    public String list() throws Exception {<br /></p>

<pre><code>    bookList = bookService.getBookList();&lt;br /&gt;
    return "list";&lt;br /&gt;
}
</code></pre>

<p><p>    public String show() throws Exception {<br /></p>

<pre><code>    book = bookService.getBook(bookId);&lt;br /&gt;
    return "show";&lt;br /&gt;
}
</code></pre>

<p><p>    public String input() throws Exception {<br /></p>

<pre><code>    if (bookId != null) {&lt;br /&gt;
        book = bookService.getBook(bookId);&lt;br /&gt;
    }&lt;br /&gt;
    return INPUT;&lt;br /&gt;
}
</code></pre>

<p><p>    public String saveOrUpdate() throws Exception {<br /></p>

<pre><code>    User user = (User)ActionContext.getContext().getSession().get("user");&lt;br /&gt;
    book.setUser(user);&lt;br /&gt;
    bookService.saveOrUpdateBook(book);&lt;br /&gt;
    return SUCCESS;&lt;br /&gt;
}
</code></pre>

<p><p>    public String delete() throws Exception {<br /></p>

<pre><code>    bookService.deleteBook(bookId);&lt;br /&gt;
    return SUCCESS;&lt;br /&gt;
}&lt;br /&gt;
...&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>在applicationContext.xml中添加Book的相关配置，如下面代码所示：<br />
[code lang=&ldquo;xml&rdquo;]
<bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean"></p>

<pre><code>...&lt;br /&gt;
&lt;property name="mappingResources"&gt;
    &lt;list&gt;
        ...&lt;br /&gt;
        &lt;value&gt;com/codemany/book/model/Book.hbm.xml&lt;/value&gt;
    &lt;/list&gt;
&lt;/property&gt;
</code></pre>

<p></bean>
&hellip;</p>

<p><p><!-- book -->
<bean id="bookDao" class="com.codemany.book.dao.BookDao"></p>

<pre><code>&lt;property name="sessionFactory" ref="sessionFactory" /&gt;
</code></pre>

<p></bean></p>

<p><p><bean id="bookService" class="com.codemany.book.service.BookService"></p>

<pre><code>&lt;property name="bookDao" ref="bookDao" /&gt;
</code></pre>

<p></bean></p>

<p><p><bean id="bookAction" class="com.codemany.book.action.BookAction" scope="prototype"></p>

<pre><code>&lt;property name="bookService" ref="bookService" /&gt;
</code></pre>

<p></bean>
```</p>

<p><p>在Struts 2配置文件struts.xml中include文件book.xml。以下是book.xml文件的内容：<br />
[code lang=&ldquo;xml&rdquo;]
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;utf-8&rdquo;?>
&lt;!DOCTYPE struts PUBLIC<br /></p>

<pre><code>"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"&lt;br /&gt;
"http://struts.apache.org/dtds/struts-2.0.dtd"&gt;
</code></pre>

<p><p><struts></p>

<pre><code>&lt;package name="book" extends="struts-default"&gt;
    &lt;action name="*Book" method="{1}" class="bookAction"&gt;
        &lt;result name="list"&gt;/books/list.jsp&lt;/result&gt;
        &lt;result name="show"&gt;/books/show.jsp&lt;/result&gt;
        &lt;result name="input"&gt;/books/form.jsp&lt;/result&gt;
        &lt;result type="redirectAction"&gt;listBook&lt;/result&gt;
    &lt;/action&gt;
&lt;/package&gt;
</code></pre>

<p></struts>
```</p>

<p><p>视图文件show.jsp作为显示单本图书的信息，代码很简单，就不放出来了，只把list.jsp和form.jsp的代码列出来。</p>

<p><p>list.jsp用来显示所有的图书：<br />
[code lang=&ldquo;java&rdquo;]
<body>
<h1>Listing books</h1></p>

<p><p><table></p>

<pre><code>&lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Description&lt;/th&gt;
    &lt;th&gt;Image url&lt;/th&gt;
    &lt;th&gt;Price&lt;/th&gt;
    &lt;th&gt;Author&lt;/th&gt;
    &lt;th&gt;ISBN&lt;/th&gt;
    &lt;th&gt;Publisher&lt;/th&gt;
    &lt;th&gt;Action&lt;/th&gt;
&lt;/tr&gt;
</code></pre>

<p><p>    &lt;s:iterator value=&ldquo;bookList&rdquo;></p>

<pre><code>&lt;tr&gt;
    &lt;td&gt;&lt;s:property value="title" /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;s:property value="description" /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;s:property value="image_url" /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;s:property value="price" /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;s:property value="author" /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;s:property value="isbn" /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;s:property value="publisher" /&gt;&lt;/td&gt;
    &lt;td&gt;
        &lt;s:a href="showBook.action?bookId=%{id}"&gt;Show&lt;/s:a&gt;
        &lt;s:a href="inputBook.action?bookId=%{id}"&gt;Edit&lt;/s:a&gt;
        &lt;s:a href="deleteBook.action?bookId=%{id}" method="delete"&gt;Destroy&lt;/s:a&gt;
    &lt;/td&gt;
&lt;/tr&gt;
&lt;/s:iterator&gt;
</code></pre>

<p></table></p>

<p><p>&lt;s:a action=&ldquo;inputBook&rdquo;>Add&lt;/s:a>
</body>
```</p>

<p><p>当用户新建或者更新图书时，视图form.jsp就上场了。因为被两个逻辑使用，显示的标题等信息也不相同，所以需要判断图书的id是否存在，如果不存在的话即是新建业务，否则就是更新操作。<br />
[code lang=&ldquo;java&rdquo;]
<body>
&lt;s:if test=&ldquo;book.id != null&rdquo;></p>

<pre><code>&lt;h1&gt;Editing book&lt;/h1&gt;
</code></pre>

<p>&lt;/s:if>
&lt;s:else></p>

<pre><code>&lt;h1&gt;Add book&lt;/h1&gt;
</code></pre>

<p>&lt;/s:else></p>

<p><p>&lt;s:form action=&ldquo;saveOrUpdateBook&rdquo; method=&ldquo;post&rdquo;></p>

<pre><code>&lt;div class="field"&gt;
    &lt;s:hidden name="book.id" value="%{book.id}" /&gt;
&lt;/div&gt;
&lt;div class="field"&gt;
    &lt;s:textfield name="book.title" label="Title" /&gt;
&lt;/div&gt;
&lt;div class="field"&gt;
    &lt;s:textarea name="book.description" label="Description" rows="5" cols="25" /&gt;
&lt;/div&gt;
&lt;div class="field"&gt;
    &lt;s:textfield name="book.image_url" label="Image URL" /&gt;
&lt;/div&gt;
&lt;div class="field"&gt;
    &lt;s:textfield name="book.price" label="Price" /&gt;
&lt;/div&gt;
&lt;div class="field"&gt;
    &lt;s:textfield name="book.author" label="Author" /&gt;
&lt;/div&gt;
&lt;div class="field"&gt;
    &lt;s:textfield name="book.isbn" label="ISBN" /&gt;
&lt;/div&gt;
&lt;div class="field"&gt;
    &lt;s:textfield name="book.publisher" label="Publisher" /&gt;
&lt;/div&gt;
&lt;div class="actions"&gt;
    &lt;s:if test="book.id != null"&gt;
    &lt;s:submit value="Update" /&gt;
    &lt;/s:if&gt;
    &lt;s:else&gt;
    &lt;s:submit value="Save" /&gt;
    &lt;/s:else&gt;
</code></pre>

<p>  </div>
&lt;/s:form></p>

<p><p>&lt;s:if test=&ldquo;book.id != null&rdquo;>
&lt;s:a href=&ldquo;showBook.action?bookId=%{book.id}&rdquo;>Show&lt;/s:a> |
&lt;/s:if>
&lt;s:a action=&ldquo;listBook&rdquo;>Back&lt;/s:a>
</body>
```</p>

<p><p>最后还要完成图书模型的服务端校验。Struts 2的校验文件有两种格式：ActionName-validation.xml和ActionName-alias-validation.xml。第一种会对该Action中的每个方法进行校验，不符合只对saveOrUpdate校验的要求。在BookAction.java同目录下创建BookAction-saveOrUpdateBook-validation.xml文件：<br />
[code lang=&ldquo;xml&rdquo;]
<validators></p>

<pre><code>&lt;field name="book"&gt;
    &lt;field-validator type="visitor"&gt;
        &lt;param name="appendPrefix"&gt;true&lt;/param&gt;
        &lt;message /&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
</code></pre>

<p></validators>
```</p>

<p><p>当然，还要在Book.java所在的位置创建Book-validation.xml文件：<br />
[code lang=&ldquo;xml&rdquo;]
<validators></p>

<pre><code>&lt;field name="title"&gt;
    &lt;field-validator type="required"&gt;
        &lt;message&gt;Price is required&lt;/message&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
...&lt;br /&gt;
&lt;field name="price"&gt;
    &lt;field-validator type="required"&gt;
        &lt;message&gt;Price is required&lt;/message&gt;
    &lt;/field-validator&gt;
    &lt;field-validator type="double"&gt;
        &lt;param name="minInclusive"&gt;0.01&lt;/param&gt;
        &lt;message&gt;Price should be at least 0.01&lt;/message&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
</code></pre>

<p></validators>
```</p>

<p><p>看着BookAction-saveOrUpdateBook-validation.xml这么长的文件名是不是有点无语:)没关系，BookAction-validation.xml配置文件还是可以用的，只要在BookAction.java中那些不需要进行校验的方法上添加@SkipValidation；也可以在action配置中启用validation.excludeMethods参数：<br />
[code lang=&ldquo;xml&rdquo;]
<action name="*Book" method="{1}" class="bookAction"></p>

<pre><code>&lt;interceptor-ref name="defaultStack"&gt;
    &lt;param name="validation.excludeMethods"&gt;list,show,input,delete&lt;/param&gt;
&lt;/interceptor-ref&gt;
...
</code></pre>

<p></action>
```</p>

<p><p>代码下载：<a href="https://github.com/dohkoos/JBookShelf"><a href="https://github.com/dohkoos/JBookShelf">https://github.com/dohkoos/JBookShelf</a></a>
</p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[实现用户注册的功能]]></title>
    <link href="http://codemany.com/blog/2012/09/22/register-functions/"/>
    <updated>2012-09-22T11:11:25+08:00</updated>
    <id>http://codemany.com/blog/2012/09/22/register-functions</id>
    <content type="html"><![CDATA[<p><p>已经两个星期没有更新代码了，这次来给加上用户注册的功能。</p>

<p><p>先在User.java中添加confirmPassword字段。然后在UserDao.java中添加保存用户的代码：<br />
```
public void addUser(User user) {<br /></p>

<pre><code>Session session = sessionFactory.openSession();&lt;br /&gt;
Transaction ts = null;&lt;br /&gt;
try {&lt;br /&gt;
    ts = session.beginTransaction();&lt;br /&gt;
    session.save(user);&lt;br /&gt;
    ts.commit();&lt;br /&gt;
} finally {&lt;br /&gt;
    session.close();&lt;br /&gt;
}&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>在UserService.java中添加以下代码：<br />
```
public void addUser(User user) throws UserAlreadyExistsException {<br /></p>

<pre><code>User u = getUser(user.getUsername());&lt;br /&gt;
if (u != null) {&lt;br /&gt;
    //register.user.already.exists&lt;br /&gt;
    throw new UserAlreadyExistsException();&lt;br /&gt;
}&lt;br /&gt;
userDao.addUser(user);&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>其中UserAlreadyExistsException.java代码如下：<br />
```
package com.codemany.account.service;</p>

<p><p>public class UserAlreadyExistsException extends Exception {<br /></p>

<pre><code>private static final long serialVersionUID = -7518737598462419360L;
</code></pre>

<p><p>    public UserAlreadyExistsException() {<br /></p>

<pre><code>    super();&lt;br /&gt;
}
</code></pre>

<p><p>    public UserAlreadyExistsException(String message) {<br /></p>

<pre><code>    super(message);&lt;br /&gt;
}
</code></pre>

<p><p>    public UserAlreadyExistsException(String message, Throwable cause) {<br /></p>

<pre><code>    super(message, cause);&lt;br /&gt;
}
</code></pre>

<p><p>    public UserAlreadyExistsException(Throwable cause) {<br /></p>

<pre><code>    super(cause);&lt;br /&gt;
}&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>在applicationContext.xml中加上一个bean：<br />
[code lang=&ldquo;xml&rdquo;]
<bean id="registerAction" scope="prototype"<br /></p>

<pre><code>    class="com.codemany.account.action.RegisterAction"&gt;
&lt;property name="userService" ref="userService" /&gt;
</code></pre>

<p></bean>
```</p>

<p><p>然后在account.xml中添加register动作，并修改login动作相应的页面：<br />
[code lang=&ldquo;xml&rdquo;]
<action name="login" class="loginAction"></p>

<pre><code>&lt;result name="success"&gt;/index.jsp&lt;/result&gt;
&lt;result name="input"&gt;/login.jsp&lt;/result&gt;
</code></pre>

<p></action></p>

<p><p><action name="register" class="registerAction"></p>

<pre><code>&lt;result name="success"&gt;/index.jsp&lt;/result&gt;
&lt;result name="input"&gt;/register.jsp&lt;/result&gt;
</code></pre>

<p></action>
```</p>

<p><p>建立RegisterAction.java类：<br />
```
package com.codemany.account.action;</p>

<p><p>import com.codemany.account.model.User;<br />
import com.codemany.account.service.UserAlreadyExistsException;<br />
import com.codemany.account.service.UserService;</p>

<p><p>import com.opensymphony.xwork2.ActionSupport;</p>

<p><p>public class RegisterAction extends ActionSupport {<br /></p>

<pre><code>private static final long serialVersionUID = 7021982816578678150L;
</code></pre>

<p><p>    private User user;</p>

<p><p>    private UserService userService;</p>

<p><p>    public String execute() throws Exception {<br /></p>

<pre><code>    try {&lt;br /&gt;
        userService.addUser(user);&lt;br /&gt;
    } catch (UserAlreadyExistsException e) {&lt;br /&gt;
        return INPUT;&lt;br /&gt;
    }&lt;br /&gt;
    return SUCCESS;&lt;br /&gt;
}
</code></pre>

<p><p>    public User getUser() {<br /></p>

<pre><code>    return user;&lt;br /&gt;
}
</code></pre>

<p><p>    public void setUser(User user) {<br /></p>

<pre><code>    this.user = user;&lt;br /&gt;
}
</code></pre>

<p><p>    public void setUserService(UserService userService) {<br /></p>

<pre><code>    this.userService = userService;&lt;br /&gt;
}&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>新建校验配置文件。先是对应RegisterAction类的RegisterAction-validation.xml配置：<br />
[code lang=&ldquo;xml&rdquo;]
&lt;!DOCTYPE validators PUBLIC<br /></p>

<pre><code>"-//OpenSymphony Group//XWork Validator 1.0.2//EN"&lt;br /&gt;
"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd"&gt;
</code></pre>

<p><p><validators></p>

<pre><code>&lt;field name="user"&gt;
    &lt;field-validator type="visitor"&gt;
        &lt;param name="appendPrefix"&gt;true&lt;/param&gt;
        &lt;message /&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
</code></pre>

<p></validators>
```</p>

<p><p>这里的校验使用了visitor类型，它是用于检测action里的复合属性的。这里的复合属性是User，所以要在User.java同一个目录下建立校验配置文件User-validation.xml，内容如下：<br />
[code lang=&ldquo;xml&rdquo;]
&lt;!DOCTYPE validators PUBLIC<br /></p>

<pre><code>"-//OpenSymphony Group//XWork Validator 1.0.2//EN"&lt;br /&gt;
"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd"&gt;
</code></pre>

<p><p><validators></p>

<pre><code>&lt;field name="username"&gt;
    &lt;field-validator type="requiredstring"&gt;
        &lt;message&gt;Username is required&lt;/message&gt;
    &lt;/field-validator&gt;
    &lt;field-validator type="stringlength"&gt;
        &lt;param name="minLength"&gt;2&lt;/param&gt;
        &lt;param name="maxLength"&gt;20&lt;/param&gt;
        &lt;message&gt;Username must be between ${minLength} and ${maxLength} characters&lt;/message&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
</code></pre>

<p><p>    <field name="password"></p>

<pre><code>    &lt;field-validator type="requiredstring"&gt;
        &lt;message&gt;Password is required&lt;/message&gt;
    &lt;/field-validator&gt;
    &lt;field-validator type="stringlength"&gt;
        &lt;param name="minLength"&gt;6&lt;/param&gt;
        &lt;param name="maxLength"&gt;50&lt;/param&gt;
        &lt;message&gt;Password must be between ${minLength} and ${maxLength} characters&lt;/message&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
</code></pre>

<p><p>    <field name="confirmPassword"></p>

<pre><code>    &lt;field-validator type="fieldexpression"&gt;
        &lt;param name="expression"&gt;confirmPassword.equals(password)&lt;/param&gt;
        &lt;message&gt;Password does not match the confirm password&lt;/message&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
</code></pre>

<p></validators>
```</p>

<p><p>修改index.jsp，将登录表单移到单独的login.jsp页面中:<br />
[code lang=&ldquo;java&rdquo;]
&lt;%@ page contentType=&ldquo;text/html; charset=utf-8&rdquo; pageEncoding=&ldquo;utf-8&rdquo; %></p>

<p><p>&lt;%@ taglib uri=&ldquo;/struts-tags&rdquo; prefix=&ldquo;s&rdquo; %></p>

<p><p>&lt;!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>JBookShelf</title>
</head></p>

<p><p><body></p>

<pre><code>&lt;s:if test="#session.logined"&gt;
    Welcome, you have logined.&lt;br /&gt;
    &lt;a href="&lt;%= request.getContextPath() %&gt;/logout.action"&gt;Logout&lt;/a&gt;
&lt;/s:if&gt;
&lt;s:else&gt;
    &lt;a href="&lt;%= request.getContextPath() %&gt;/login!input.action"&gt;Login&lt;/a&gt; |&lt;br /&gt;
    &lt;a href="&lt;%= request.getContextPath() %&gt;/register!input.action"&gt;Register&lt;/a&gt;
&lt;/s:else&gt;
</code></pre>

<p></body>
</html>
```</p>

<p><p>这里是登录页面login.jsp，首页index.jsp中的登录表单就是被移到这个文件中：<br />
[code lang=&ldquo;java&rdquo;]
&lt;%@ page contentType=&ldquo;text/html; charset=utf-8&rdquo; pageEncoding=&ldquo;utf-8&rdquo; %></p>

<p><p>&lt;%@ taglib uri=&ldquo;/struts-tags&rdquo; prefix=&ldquo;s&rdquo; %></p>

<p><p>&lt;!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Login</title>
</head></p>

<p><p><body></p>

<pre><code>&lt;p&gt;User: test/test&lt;/p&gt;
&lt;s:form action="login"&gt;
    &lt;s:textfield key="username" label="Username" /&gt;
    &lt;s:password key="password" label="Password" /&gt;
    &lt;s:submit value="Login" /&gt;
&lt;/s:form&gt;
</code></pre>

<p></body>
</html>
```</p>

<p><p>注册页面register.jsp，负责生成注册时的表单：<br />
[code lang=&ldquo;java&rdquo;]
&lt;%@ page contentType=&ldquo;text/html; charset=utf-8&rdquo; pageEncoding=&ldquo;utf-8&rdquo; %></p>

<p><p>&lt;%@ taglib uri=&ldquo;/struts-tags&rdquo; prefix=&ldquo;s&rdquo; %></p>

<p><p>&lt;!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Register</title>
</head></p>

<p><p><body></p>

<pre><code>&lt;s:form action="register"&gt;
    &lt;s:textfield key="user.username" label="Username" /&gt;
    &lt;s:password key="user.password" label="Password" /&gt;
    &lt;s:password key="user.confirmPassword" label="Password Confirmation" /&gt;
    &lt;s:submit value="Register" /&gt;
&lt;/s:form&gt;
</code></pre>

<p></body>
</html>
```</p>

<p><p>代码下载：<a href="https://github.com/dohkoos/JBookShelf"><a href="https://github.com/dohkoos/JBookShelf">https://github.com/dohkoos/JBookShelf</a></a>
</p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Struts 2 Validation框架校验登录信息]]></title>
    <link href="http://codemany.com/blog/2012/09/08/struts-2-validation-framework-checksum-login-information/"/>
    <updated>2012-09-08T14:42:17+08:00</updated>
    <id>http://codemany.com/blog/2012/09/08/struts-2-validation-framework-checksum-login-information</id>
    <content type="html"><![CDATA[<p><p>Struts 2有三种校验方式：<br />
1. 使用Annotation进行校验<br />
2. 使用XML配置校验<br />
3. 使用覆盖validate方法校验</p>

<p><p>使用XML配置时validation.xml的命名规则和放置路径：
<ActionClassName>-validation.xml</p>

<p><p><ActionClassName>就是要验证的Action类的名字，将此文件放于与Action类文件相同的目录下。</p>

<p><p>如果该Action类在struts.xml配置中有多个action实例，那么对应某个action实例的验证文件名规则如下：
<ActionClassName>&ndash;<aliasName>-validation.xml</p>

<p><p>例如：UserAction-login-validation.xml。注意，这里的<aliasName>并不是方法名，而是struts.xml中配置的action实例的名字。</p>

<p><p>既然用框架来校验了，那么在LoginAction.java中判断用户名和密码是否为空的代码就可以删除了。还要记得加上username和passowrd的getter方法，不然校验器（validator）会因为取不到field而报错。<br />
```
public String execute() throws Exception {<br /></p>

<pre><code>User u = userService.getUser(username);&lt;br /&gt;
if (u == null || !password.equals(u.getPassword())) {&lt;br /&gt;
    return INPUT;&lt;br /&gt;
}
</code></pre>

<p><p>    ActionContext.getContext().getSession().put(&ldquo;logined&rdquo;, true);<br /></p>

<pre><code>return SUCCESS;&lt;br /&gt;
</code></pre>

<p>}</p>

<p><p>public String getUsername() {<br /></p>

<pre><code>return username;&lt;br /&gt;
</code></pre>

<p>}</p>

<p><p>public String getPassword() {<br /></p>

<pre><code>return password;&lt;br /&gt;
</code></pre>

<p>}
```</p>

<p><p>同时在LoginAction.java相同目录下创建LoginAction-validation.xml，内容如下：<br />
[code lang=&ldquo;xml&rdquo;]
&lt;!DOCTYPE validators PUBLIC<br /></p>

<pre><code>"-//OpenSymphony Group//XWork Validator 1.0.2//EN"&lt;br /&gt;
"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd"&gt;
</code></pre>

<p><p><validators></p>

<pre><code>&lt;field name="username"&gt;
    &lt;field-validator type="requiredstring"&gt;
        &lt;message&gt;Username is required&lt;/message&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
&lt;field name="password"&gt;
    &lt;field-validator type="requiredstring"&gt;
        &lt;message&gt;Password is required&lt;/message&gt;
    &lt;/field-validator&gt;
&lt;/field&gt;
</code></pre>

<p></validators>
```</p>

<p><p>message提供了校验出错的信息，消息中可以使用${}来引用被校验的对象。如果未出现异常，则转入用户请求的处理方法，如果出现异常，则转入input所指定的视图。所以，对于验证的action实例，必须要在配置文件中为其指定input视图。</p>

<p><p>代码下载：<a href="https://github.com/dohkoos/JBookShelf"><a href="https://github.com/dohkoos/JBookShelf">https://github.com/dohkoos/JBookShelf</a></a>
</p></p>
]]></content>
  </entry>
  
</feed>
