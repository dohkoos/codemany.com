
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>乐者为王</title>
  <meta name="author" content="dohkoos">

  
  <meta name="description" content="一个乡下来的小伙子去应聘城里“世界最大”的“应有尽有”百货公司的销售员。老板问他：“你以前做过销售员吗？”他回答说：“我以前是村里挨家挨户推销的小贩子。”老板喜欢他的机灵：“你明天可以来上班了。等下班的时候，我会来看一下。” 一天的光阴对这个乡下来的穷小子来说太长了，而且还有些难熬。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codemany.com/posts/22/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="乐者为王" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46570161-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">乐者为王</a></h1>
  
    <h2>Do one thing, and do it well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="codemany.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/the-story-about-the-best-salesman-in-the-world/">世界上最好的推销员的故事</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-12-18T18:01:12+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>6:01 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>一个乡下来的小伙子去应聘城里“世界最大”的“应有尽有”百货公司的销售员。老板问他：“你以前做过销售员吗？”他回答说：“我以前是村里挨家挨户推销的小贩子。”老板喜欢他的机灵：“你明天可以来上班了。等下班的时候，我会来看一下。”</p>

<p>一天的光阴对这个乡下来的穷小子来说太长了，而且还有些难熬。但是年轻人还是熬到了5点，差不多该下班了。老板真的来了，问他说：“你今天做了几单买卖”</p>

<p>“一单。”年轻人回答说。</p>

<p>“只有一单？”老板很吃惊地说：“我们这儿的售货员一天基本上可以完成20到30单生意呢。你卖了多少钱?”</p>

<p>“300,000美元，”年轻人回答道。</p>

<p>“你怎么卖到那么多钱的？”目瞪口呆，半晌才回过神来的老板问道。</p>

<p>“是这样的，”乡下来的年轻人说，“一个男士进来买东西，我先卖给他一个小号的鱼钩，然后中号的鱼钩，最后大号的鱼钩。接着，我卖给他小号的鱼线，中号的鱼线，最后是大号的鱼线。我问他上哪儿钓鱼，他说海边。我建议他买条船，所以我带他到卖船的专柜，卖给他长20英尺有两个发动机的纵帆船。然后他说他的大众牌汽车可能拖不动这么大的船。我于是带他去汽车销售区，卖给他一辆丰田新款豪华型‘巡洋舰’。”</p>

<p>老板后退两步，几乎难以置信地问道：“一个顾客仅仅来买个鱼钩，你就能卖给他这么多东西？”</p>

<p>“不是的，”乡下来的年轻售货员回答道，“他是来给他妻子买卫生棉的。我就告诉他‘你的周末算是毁了，干吗不去钓鱼呢？’”</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/powerscript-identifier/">PowerScript标识符</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-12-13T12:47:45+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>12:47 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在使用减号（-）、负号（-）、减1（--）运算符时，必须在这些符号的前面加上空格，原因在于PowerScript会把这些符号当成标识符的一部分。</p>

<p>PowerScript标识符规则：</p>

<ol>
<li>必须以字母或下划线（_）开头；</li>
<li>其余字符可以是字母、数字、下划线（_）、美元符号（$）、短横线（-）、号码符号（#），百分号（%）；</li>
<li>最长40个字符（实际最大长度可达99个），中间不能有空格；</li>
<li>不区分大小写。</li>
</ol>

<p>在PB.INI的[pb]节中将DashesInIdentifiers=1修改为DashesInIdentifiers=0可以禁止在标志符中使用短横线（-）。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/the-story-about-hunter-and-hound/">猎狗与猎人的故事</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-12-08T14:34:47+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>2:34 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>目标</p>

<p>一条猎狗将兔子赶出了窝，一直追赶他，追了很久仍没有捉到。牧羊看到此种情景，讥笑猎狗说，“你们两个当中小的反而跑得快得多。”猎狗回答说：“你不知道我们两个的跑是完全不同的！我仅仅为了一顿饭而跑，他却是为了性命而跑呀！”</p>

<p>动力</p>

<p>这话被猎人听到了，猎人想：猎狗说的对啊，那我要想得到更多的猎物，得想个好法子。于是，猎人又买来几条猎狗，凡是能够在打猎中捉到兔子的，就可以得到几根骨头，捉不到的就没有饭吃。这一招果然有用，猎狗们纷纷去努力追兔子，因为谁都不愿意看着别人有骨头吃，自己没吃的。就这样过了一段时间，问题又出现了。大兔子非常难捉到，小兔子好捉。但捉到大兔子得到的奖赏和捉到小兔子得到的骨头差不多，猎狗们善于观察，发现了这个窍门，专门去捉小兔子。慢慢地，大家都发现了这个窍门。猎人对猎狗说：最近你们捉的兔子越来越小了，为什么？猎狗们说：反正结果没有什么大的区别，为什么费那么大的劲去捉那些大的呢？</p>

<p>保障</p>

<p>猎人经过思考后，决定不将分得骨头的数量与是否捉到兔子挂钩，而是每过一段时间就统计一次猎狗捉到兔子的总重量，按照重量来评价猎狗，从而决定它们一段时间内的待遇。于是，猎狗们捉到兔子的数量和重量都增加了。猎人很开心。但是，过了一段时间，猎人发现猎狗们捉兔子的数量又少了，而且越有经验的猎狗捉兔子的数量下降得越利害。于是，猎人又去问猎狗是怎么回事。猎狗说，“我们把最好的时间都奉献给了您，主人，随着时间的推移我们会慢慢变老，当我们捉不到兔子的时候，您还会给我们骨头吃吗？”</p>

<p>回报</p>

<p>猎人做出了论功行赏的决定，分析与汇总了所有猎狗捉到兔子的数量与重量，规定如果捉到的兔子超过一定的数量后，即使捉不到兔子，每顿饭也可以得到一定数量的骨头。猎狗们都很高兴，大家都努力去争取达到猎人规定的数量。一段时间过后，终于有一些猎狗达到了猎人规定的数量。这时，其中一只猎狗说：“我们这么努力，只得到几根骨头，而我们捉的猎物远远超过了这几根骨头。我们为什么不能给自己捉兔子呢？”于是，有些猎狗离开了猎人，自己捉兔子去了。</p>

<p>归宿</p>

<p>猎人意识到猎狗正在流失，并且那些流失的猎狗像野狗一般与自己的猎狗抢兔子。情况变得越来越糟，猎人不得已引诱了一条野狗，问他到底野狗比猎狗强在那里。野狗说：“猎狗吃的是骨头，吐出来的是肉啊！”接着又道：“也不是所有的野狗都顿顿有肉吃，大部分最后骨头都没的舔！不然也不至于被你诱惑。”于是，猎人又进行了改革，使得每条猎狗除基本骨头外，可获得其所猎兔肉总量的n%，而且随着服务时间加长，贡献加大，该比例还可递增，并有权分享猎人所拥有兔肉总量的m%。就这样，猎狗们与猎人一起努力，将野狗们逼得叫苦连天，纷纷要求重归猎狗队伍。</p>

<p>故事还在继续……</p>

<p>只有永远的利益，没有永远的朋友</p>

<p>日子一天一天地过去，冬天到了，兔子越来越少，猎人们的收成也一天不如一天。那些服务时间长的老猎狗们已老得捉不到兔子，但却仍然无忧无虑地享受着他们自以为应得的大份食物。终于有一天，猎人再也不能忍受，把他们扫地出门了，因为猎人更需要身强力壮的猎狗……</p>

<p>Birth of MicroBone Co.</p>

<p>被扫地出门的老猎狗们得到一笔不菲的赔偿金，于是，他们成立了MicroBone公司。他们采用连锁加盟的方式招募野狗，向野狗们传授猎兔的技巧，他们从猎得的兔子中抽取一部分作为管理费。当赔偿金几乎全部用于广告后，他们终于有了足够多的野狗加盟，公司开始盈利了。一年后，他们收购了猎人的家当……</p>

<p>Development of MicroBone Co.</p>

<p>MicroBone公司许诺，加盟的野狗可以得到公司n%的股份。这实在是太有诱惑力了。那些自认为怀才不遇的野狗们都以为找到了知音：终于可以做公司的主人了，不用再忍受猎人呼来唤去的不快，不用再为捉到足够多的兔子而累死累活，也不用眼巴巴地乞求猎人多给两根骨头。这一切对野狗们来说，比多得到两根骨头更加受用。于是，野狗们拖家带口地加入了MicroBone。一些在猎人门下服务的年轻猎狗也蠢蠢欲动，甚至很多自以为聪明、实际上愚蠢的猎人也想加入。好多同类型的公司雨后春笋般地成立了，BoneEase、Bone.com、ChinaBone……一时间，森林里热闹非凡。</p>

<p>干活的总是拿得少的，拿得多的都是不干活的</p>

<p>猎人凭借出售公司的钱走上了老猎狗走过的路，历经千辛万苦重新发达起来，最后又来与MicroBone公司谈判收购事宜，老猎狗出人意料地把MicroBone公司卖给了猎人。老猎狗们从此不再经营公司，转而开始靠写作赚钱，写完自传《老猎狗的一生》，又写了《如何成为出色的猎狗》、《成功猎狗500条法则》、《猎狗成功秘诀》、《如何成为一只进入管理层的猎狗》、《穷猎狗，富猎狗》等一系列成功自助读物，并且将老猎狗的故事搬上了屏幕，取名《猎狗花园》——从此，老猎狗成为家喻户晓的名人，坐收版权费，既没有风险，利润又可观，轻轻松松地过上了富人闲人的日子。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ajax-new-approach-web-applications/">Ajax：Web应用的一种新方法</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-06-22T09:17:30+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2006</span></span> <span class='time'>9:17 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>英文原文：<a href="http://adaptivepath.org/ideas/ajax-new-approach-web-applications/">http://adaptivepath.org/ideas/ajax-new-approach-web-applications/</a></p>

<p>If anything about current interaction design can be called “glamorous”, it’s creating Web applications. After all, when was the last time you heard someone rave about the interaction design of a product that wasn’t on the Web? (Okay, besides the iPod.) All the cool, innovative new projects are online.</p>

<p>Despite this, Web interaction designers can’t help but feel a little envious of our colleagues who create desktop software. Desktop applications have a richness and responsiveness that has seemed out of reach on the Web. The same simplicity that enabled the Web’s rapid proliferation also creates a gap between the experiences we can provide and the experiences users can get from a desktop application.</p>

<p>That gap is closing. Take a look at <a href="http://www.google.com/webhp?complete=1&hl=en">Google Suggest</a>. Watch the way the suggested terms update as you type, almost instantly. Now look at <a href="http://maps.google.com/">Google Maps</a>. Zoom in. Use your cursor to grab the map and scroll around a bit. Again, everything happens almost instantly, with no waiting for pages to reload.</p>

<p>Google Suggest and Google Maps are two examples of a new approach to web applications that we at Adaptive Path have been calling Ajax. The name is shorthand for Asynchronous JavaScript + XML, and it represents a fundamental shift in what’s possible on the Web.</p>

<h3 id="定义ajax">定义Ajax</h3>

<p>Ajax不是一种技术。它事实上是几种技术，每种技术都在它自身正确的地方蓬勃发展，以强大的新方式聚合在一起。Ajax包括：</p>

<ul>
<li>使用XHTML和CSS的<a href="http://adaptivepath.org/publications/essays/archives/000266.php">standards-based presentation</a>；</li>
<li>使用<a href="http://www.scottandrew.com/weblog/articles/dom_1">Document Object Model</a>的动态显示和交互；</li>
<li>使用<a href="http://www-106.ibm.com/developerworks/xml/library/x-xslt/?article=xr">XML and XSLT</a>的数据交换和操控；</li>
<li>使用<a href="http://www.xml.com/pub/a/2005/02/09/xml-http-request.html">XMLHttpRequest</a>的异步数据检索；</li>
<li>和<a href="http://www.crockford.com/javascript/javascript.html">JavaScript</a>将所有这些绑定在一起。</li>
</ul>

<p>经典的Web应用模型是这么工作的：在界面上的大多数用户操作触发一个HTTP请求回Web服务器。服务器做一些处理——检索数据，精密计算，与各种遗留系统对话——然后返回一个HTML页面到客户端。它是改编自Web作为超文本媒介的原定用途的一个模型，但是如同<a href="http://www.jjg.net/elements/">The Elements of User Experience</a>的爱好者所知，该模型让Web很好地适合超文本不一定能让它很好地适合软件应用。</p>

<p><img src="/uploads/ajax-fig1.png"></p>

<p><em>图1：Web应用的传统模型（左）与Ajax模型（右）的比较。</em></p>

<p>This approach makes a lot of technical sense, but it doesn’t make for a great user experience. While the server is doing its thing, what’s the user doing? That’s right, waiting. And at every step in a task, the user waits some more.</p>

<p>Obviously, if we were designing the Web from scratch for applications, we wouldn’t make users wait around. Once an interface is loaded, why should the user interaction come to a halt every time the application needs something from the server? In fact, why should the user see the application go to the server at all?</p>

<h3 id="ajax有何不同">Ajax有何不同</h3>

<p>An Ajax application eliminates the start-stop-start-stop nature of interaction on the Web by introducing an intermediary — an Ajax engine — between the user and the server. It seems like adding a layer to the application would make it less responsive, but the opposite is true.</p>

<p>Instead of loading a webpage, at the start of the session, the browser loads an Ajax engine — written in JavaScript and usually tucked away in a hidden frame. This engine is responsible for both rendering the interface the user sees and communicating with the server on the user’s behalf. The Ajax engine allows the user’s interaction with the application to happen asynchronously — independent of communication with the server. So the user is never staring at a blank browser window and an hourglass icon, waiting around for the server to do something.</p>

<p><img src="/uploads/ajax-fig2.png"></p>

<p><em>图2：传统Web应用的同步交互模式（上）与Ajax应用的异步模式（下）的比较</em></p>

<p>Every user action that normally would generate an HTTP request takes the form of a JavaScript call to the Ajax engine instead. Any response to a user action that doesn’t require a trip back to the server — such as simple data validation, editing data in memory, and even some navigation — the engine handles on its own. If the engine needs something from the server in order to respond — if it’s submitting data for processing, loading additional interface code, or retrieving new data — the engine makes those requests asynchronously, usually using XML, without stalling a user’s interaction with the application.</p>

<h3 id="谁在使用ajax">谁在使用Ajax</h3>

<p>Google is making a huge investment in developing the Ajax approach. All of the major products Google has introduced over the last year — <a href="http://www.orkut.com/">Orkut</a>, <a href="http://www.gmail.com/">Gmail</a>, the latest beta version of <a href="http://groups-beta.google.com/">Google Groups</a>, <a href="http://www.google.com/webhp?complete=1&hl=en">Google Suggest</a>, and <a href="http://maps.google.com/">Google Maps</a> — are Ajax applications. (For more on the technical nuts and bolts of these Ajax implementations, check out these excellent analyses of <a href="http://johnvey.com/features/gmailapi/">Gmail</a>, <a href="http://serversideguy.blogspot.com/2004/12/google-suggest-dissected.html">Google Suggest</a>, and <a href="http://web.archive.org/web/20050331002145/jgwebber.blogspot.com/2005/02/mapping-google.html">Google Maps</a>.) Others are following suit: many of the features that people love in <a href="http://www.flickr.com/">Flickr</a> depend on Ajax, and Amazon’s <a href="http://www.a9.com/">A9.com</a> search engine applies similar techniques.</p>

<p>These projects demonstrate that Ajax is not only technically sound, but also practical for real-world applications. This isn’t another technology that only works in a laboratory. And Ajax applications can be any size, from the very simple, single-function Google Suggest to the very complex and sophisticated Google Maps.</p>

<p>At Adaptive Path, we’ve been doing our own work with Ajax over the last several months, and we’re realizing we’ve only scratched the surface of the rich interaction and responsiveness that Ajax applications can provide. Ajax is an important development for Web applications, and its importance is only going to grow. And because there are so many developers out there who already know how to use these technologies, we expect to see many more organizations following Google’s lead in reaping the competitive advantage Ajax provides.</p>

<h3 id="继续前行">继续前行</h3>

<p>在创建Ajax应用中最大的挑战不是技术。核心Ajax技术是成熟的、稳定的、并且容易理解的。相反，挑战来自于这些应用的设计人员：忘记我们所认为我们知道的关于Web的限制，并且开始想象一个更广泛、更丰富的可能性的范围。</p>

<p>那一定会很有趣。</p>

<h3 id="ajax-q-amp-a">Ajax Q&amp;A</h3>

<p><strong>2005年3月13日：</strong> 自我们第一次发布Jesse的论文以来，我们收到了大量读者关于Ajax问题的信件。在这个Q&amp;A中，Jesse回答了一些最常见的问题。</p>

<p><strong>Q.</strong> 是Adaptive Path发明的Ajax吗？还是Google？是不是Adaptive Path帮助构建了Google的Ajax应用？</p>

<p><strong>A.</strong> 既不是Adaptive Path也不是Google发明的Ajax。Google最近的产品仅仅是最知名的Ajax应用例子。Adaptive Path没有参与Google的Ajax应用的开发，但我们一直在为我们其它的一些客户做Ajax的工作。</p>

<p><strong>Q.</strong> Adaptive Path正在出售Ajax组件或注册这个名字的商标吗？我从哪里可以下载它？</p>

<p><strong>A.</strong> Ajax不是你能下载的东西。它是一种方法——思考使用某种技术的Web应用架构的一种方式。Ajax这个名字和方法均不是Adaptive Path专有的。</p>

<p>Q. Is Ajax just another name for XMLHttpRequest?</p>

<p>A. No. XMLHttpRequest is only part of the Ajax equation. XMLHttpRequest is the technical component that makes the asynchronous server communication possible; Ajax is our name for the overall approach described in the article, which relies not only on XMLHttpRequest, but on CSS, DOM, and other technologies.</p>

<p>Q. Why did you feel the need to give this a name?</p>

<p>A. I needed something shorter than “Asynchronous JavaScript+CSS+DOM+XMLHttpRequest” to use when discussing this approach with clients.</p>

<p>Q. Techniques for asynchronous server communication have been around for years. What makes Ajax a “new” approach?</p>

<p>A. What’s new is the prominent use of these techniques in real-world applications to change the fundamental interaction model of the Web. Ajax is taking hold now because these technologies and the industry’s understanding of how to deploy them most effectively have taken time to develop.</p>

<p><strong>Q.</strong> Ajax是一个技术平台或一种架构风格吗？</p>

<p><strong>A.</strong> 都是。Ajax是以某种特殊方式同时使用的一组技术。</p>

<p><strong>Q.</strong> Ajax最适合什么类型的应用？</p>

<p><strong>A.</strong> 目前我们还不知道。因为它是一种相对较新的方法，我们对Ajax最适用在哪些地方的理解仍处于初级阶段。有时候传统的Web应用模型是某个问题的最合适的解决方案。</p>

<p><strong>Q.</strong> 这意味着Adaptive Path是反Flash的吗？</p>

<p><strong>A.</strong> 一点也不。Macromedia是Adaptive Path的一个客户，而且我们是Flash技术长期以来的支持者。随着Ajax的成熟，我们希望有时候Ajax是特定问题的最好的解决方案，而有时候Flash 是最好的解决方案。我们也有兴趣探索技术可以混合的方式（正如Flickr的案例，它使用了两者）。</p>

<p>Q. Does Ajax have significant accessibility or browser compatibility limitations? Do Ajax applications break the back button? Is Ajax compatible with REST? Are there security considerations with Ajax development? Can Ajax applications be made to work for users who have JavaScript turned off?</p>

<p>A. The answer to all of these questions is “maybe”. Many developers are already working on ways to address these concerns. We think there’s more work to be done to determine all the limitations of Ajax, and we expect the Ajax development community to uncover more issues like these along the way.</p>

<p>Q. Some of the Google examples you cite don’t use XML at all. Do I have to use XML and/or XSLT in an Ajax application?</p>

<p>A. No. XML is the most fully-developed means of getting data in and out of an Ajax client, but there’s no reason you couldn’t accomplish the same effects using a technology like <a href="http://www.crockford.com/JSON/">JavaScript Object Notation</a> or any similar means of structuring data for interchange.</p>

<p>Q. Are Ajax applications easier to develop than traditional web applications?</p>

<p>A. Not necessarily. Ajax applications inevitably involve running complex JavaScript code on the client. Making that complex code efficient and bug-free is not a task to be taken lightly, and better development tools and frameworks will be needed to help us meet that challenge.</p>

<p>Q. Do Ajax applications always deliver a better experience than traditional web applications?</p>

<p>A. Not necessarily. Ajax gives interaction designers more flexibility. However, the more power we have, the more caution we must use in exercising it. We must be careful to use Ajax to enhance the user experience of our applications, not degrade it.</p>

<p>这篇文章被来自<a href="http://webhostinggeeks.com/">Webhostinggeeks.com</a>的Jovana Milutinovich翻译成了<a href="http://science.webhostinggeeks.com/ajaxnovi-pristup">Serbo-Croatian</a>语言。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/how-to-map-javabean-boolean-value-into-database-char-value-in-ibatis/">在iBatis中如何将JavaBean的boolean值映射成数据库的CHAR（Y或N）值</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-05-29T12:15:40+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>12:15 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Spring 1.2.8 + iBatis 2.1.5</p>

<p>JavaBean的boolean值映射到数据库的默认值是0和1，不是非常直观，现在希望能将boolean值映射成为Y和N。iBatis 2.0.5以后的版本提供了TypeHandlerCallback，可以用来解决这个问题。</p>

<p>首先定义数据表：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE TABLE users (
</span><span class='line'>    username varchar(40),
</span><span class='line'>    password varchar(255),
</span><span class='line'>    enabled char(1),
</span><span class='line'>    PRIMARY KEY (username)
</span><span class='line'>) ENGINE=InnoDB DEFAULT CHARSET=utf-8;</span></code></pre></td></tr></table></div></figure>

<p>YesNoTypeHandlerCallback实现代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class YesNoTypeHandlerCallback implements TypeHandlerCallback {
</span><span class='line'>
</span><span class='line'>    public void setParameter(ParameterSetter setter, Object parameter) throws SQLException {
</span><span class='line'>        if (parameter == null) {
</span><span class='line'>            setter.setString("");
</span><span class='line'>        } else {
</span><span class='line'>            Boolean b = (Boolean)parameter;
</span><span class='line'>            if (b.booleanValue()) {
</span><span class='line'>                setter.setString("Y");
</span><span class='line'>            } else {
</span><span class='line'>                setter.setString("N");
</span><span class='line'>            }
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    public Object getResult(ResultGetter getter) throws SQLException {
</span><span class='line'>        String string = getter.getString();
</span><span class='line'>        if (string == null) {
</span><span class='line'>            return null;
</span><span class='line'>        } else if ("Y".equalsIgnoreCase(string)) {
</span><span class='line'>            return new Boolean(true);
</span><span class='line'>        } else {
</span><span class='line'>            return new Boolean(false);
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    public Object valueOf(String s) {
</span><span class='line'>        return s;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>配置文件sql-map-config.xml中的内容如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;sqlMapConfig&gt;
</span><span class='line'>    &lt;typeHandler jdbcType="CHAR" javaType="boolean"
</span><span class='line'>                 callback="com.codemany.netlink.dao.support.YesNoTypeHandlerCallback" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;sqlMap resource="com/codemany/netlink/dao/impl/User.xml" /&gt;
</span><span class='line'>&lt;/sqlMapConfig&gt;</span></code></pre></td></tr></table></div></figure>

<p>jdbcType=&quot;CHAR&quot; javaType=&quot;boolean&quot;必须有，否则YesNoTypeHandlerCallback.setParameter()不会被调用。</p>

<p>SqlMap映射文件User.xml部分代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;typeAlias alias="user" type="com.codemany.netlink.model.User" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;resultMap id="userResult" class="user"&gt;
</span><span class='line'>    &lt;result property="username" column="username" /&gt;
</span><span class='line'>    &lt;result property="password" column="password" /&gt;
</span><span class='line'>    &lt;result property="enabled" column="enabled" jdbcType="CHAR" javaType="boolean" /&gt;
</span><span class='line'>&lt;/resultMap&gt;
</span><span class='line'>
</span><span class='line'>&lt;select id="getUser" parameterClass="string" resultMap="userResult"&gt;
</span><span class='line'>&lt;![CDATA[
</span><span class='line'>    SELECT username, password, enabled
</span><span class='line'>    FROM user WHERE username = #username#
</span><span class='line'>]]&gt;
</span><span class='line'>&lt;/select&gt;
</span><span class='line'>
</span><span class='line'>&lt;insert id="addUser" parameterClass="user"&gt;
</span><span class='line'>&lt;![CDATA[
</span><span class='line'>    INSERT INTO user (username, password, enabled)
</span><span class='line'>    VALUES (#username#, #password#, #enabled,jdbcType=CHAR,javaType=boolean#)
</span><span class='line'>]]&gt;
</span><span class='line'>&lt;/insert&gt;</span></code></pre></td></tr></table></div></figure>

<p>jdbcType=&quot;CHAR&quot; javaType=&quot;boolean&quot;必须有，否则YesNoTypeHandlerCallback.getResult()不会被调用；#enabled,jdbcType=CHAR,javaType=boolean#也必须这样写，否则YesNoTypeHandlerCallback.setParameter()也不会被调用，写成#enabled:CHAR#或#enabled#都不起作用。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/sqlmap-unit-testing-with-spring-and-dbunit/">DbUnit结合Spring进行SqlMap的单元测试</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-04-11T20:39:04+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>8:39 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>使用DbUnit，开发人员可以控制测试数据库的状态。进行一个DAO单元测试之前，DbUnit为数据库准备好初始化数据；而在测试结束时，DbUnit会把数据库状态恢复到测试前的状态。下面的例子使用DbUnit为SqlMap编写单元测试。</p>

<p>SqlMap映射文件User.xml的内容如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;select id="getUser" parameterClass="String" resultClass="User"&gt;
</span><span class='line'>    SELECT username, password, first_name, last_name
</span><span class='line'>    FROM user WHERE username = #username#
</span><span class='line'>&lt;/select&gt;
</span><span class='line'>
</span><span class='line'>&lt;delete id="removeUser" parameterClass="String"&gt;
</span><span class='line'>    DELETE FROM user WHERE username = #username#
</span><span class='line'>&lt;/delete&gt;
</span><span class='line'>
</span><span class='line'>&lt;update id="updateUser" parameterClass="User"&gt;
</span><span class='line'>    UPDATE user SET
</span><span class='line'>        password = #password#,
</span><span class='line'>        first_name = #firstName#,
</span><span class='line'>        last_name = #lastName#
</span><span class='line'>    WHERE username =#username#
</span><span class='line'>&lt;/update&gt;
</span><span class='line'>
</span><span class='line'>&lt;insert id="insertUser" parameterClass="User"&gt;
</span><span class='line'>    INSERT INTO user (username, password, first_name, last_name)
</span><span class='line'>    VALUES (#username#, #password#, #firstName#, #lastName#)
</span><span class='line'>&lt;/insert&gt;</span></code></pre></td></tr></table></div></figure>

<p>配置文件sql-map-config.xml中的内容如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;sqlMapConfig&gt;
</span><span class='line'>    &lt;settings lazyLoadingEnabled="true"
</span><span class='line'>              cacheModelsEnabled="true"
</span><span class='line'>              enhancementEnabled="true"
</span><span class='line'>              maxSessions="64"
</span><span class='line'>              maxTransactions="8"
</span><span class='line'>              maxRequests="128" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;sqlMap resource="com/codemany/netlink/dao/impl/User.xml" /&gt;
</span><span class='line'>&lt;/sqlMapConfig&gt;</span></code></pre></td></tr></table></div></figure>

<p>首先，要为单元测试准备测试数据。我们可以用DbUnit的Flat XML格式来准备测试数据集。下面的XML文件称为目标数据库的Seed File，它为测试准备了两条数据。其中元素名user对应数据库的表名，属性username，password，first_name和last_name是表user的列名，属性值就是记录值。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;dataset&gt;
</span><span class='line'>    &lt;user username="ford"
</span><span class='line'>        password="ford"
</span><span class='line'>        first_name="Henry"
</span><span class='line'>        last_name="Ford" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;user username="twain"
</span><span class='line'>        password="twain"
</span><span class='line'>        first_name="Mark"
</span><span class='line'>        last_name="twain" /&gt;
</span><span class='line'>&lt;/dataset&gt;</span></code></pre></td></tr></table></div></figure>

<p>缺省情况下，DbUnit在单元测试开始之前执行CLEAN_INSERT操作，删除Seed File中所有表的数据，并导入Seed File的测试数据。我们可以通过覆盖getSetUpOperation()和getTearDownOperation()方法来控制单元测试前和测试后的数据库状态。一种高效的实施方案就是让getSetUpOperation()方法执行REFRESH操作，通过执行这个操作，我们可以用Seed File中的数据去更新目标数据库里的数据。接下来，就是getTearDownOperation()，让他执行一个NONE操作，也就是什么也不执行。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>protected DatabaseOperation getSetUpOperation() throws Exception {
</span><span class='line'>    return DatabaseOperation.REFRESH;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>protected DatabaseOperation getTearDownOperation() throws Exception {
</span><span class='line'>    return DatabaseOperation.NONE;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>为了方便测试，我们为SqlMap的单元测试编写一个抽象的测试基类，代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public abstract class SqlMapTestCase extends DatabaseTestCase {
</span><span class='line'>    protected SqlMapClient sqlMapClient = null;
</span><span class='line'>    protected Properties props = new Properties();
</span><span class='line'>
</span><span class='line'>    protected IDatabaseConnection getConnection() throws Exception {
</span><span class='line'>        props.load(Resources.getResourceAsStream("properties/database.properties"));
</span><span class='line'>
</span><span class='line'>        Class.forName(props.getProperty("driver"));
</span><span class='line'>        Connection conn = DriverManager.getConnection(props.getProperty("url"),
</span><span class='line'>                props.getProperty("username"), props.getProperty("password"));
</span><span class='line'>        return new DatabaseConnection(conn);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    protected IDataSet getDataSet() throws Exception {
</span><span class='line'>        String resource = "com/codemany/netlink/dao/impl/dataset.xml";
</span><span class='line'>        return new FlatXmlDataSet(Resources.getResourceAsStream(resource));
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    protected void setUp() throws Exception {
</span><span class='line'>        super.setUp();
</span><span class='line'>
</span><span class='line'>        // Build the SqlMapClient
</span><span class='line'>        Reader reader = Resources.getResourceAsReader("sql-map-config.xml");
</span><span class='line'>        sqlMapClient = SqlMapClientBuilder.buildSqlMapClient(reader);
</span><span class='line'>
</span><span class='line'>        // Tell the SqlMapClient to use the given DataSource
</span><span class='line'>        DataSource dataSource = getDataSource();
</span><span class='line'>        TransactionConfig transactionConfig = getTransactionConfig(dataSource);
</span><span class='line'>        // Apply the given TransactionConfig to the SqlMapClient
</span><span class='line'>        applyTransactionConfig(sqlMapClient, transactionConfig);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    protected void tearDown() throws Exception {
</span><span class='line'>        super.tearDown();
</span><span class='line'>
</span><span class='line'>        if (sqlMapClient != null) {
</span><span class='line'>            DataSource ds = sqlMapClient.getDataSource();
</span><span class='line'>            Connection conn = ds.getConnection();
</span><span class='line'>            conn.close();
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    private DataSource getDataSource() throws Exception {
</span><span class='line'>        DriverManagerDataSource dataSource = new DriverManagerDataSource();
</span><span class='line'>        dataSource.setDriverClassName(props.getProperty("driver"));
</span><span class='line'>        dataSource.setUrl(props.getProperty("url"));
</span><span class='line'>        dataSource.setUsername(props.getProperty("username"));
</span><span class='line'>        dataSource.setPassword(props.getProperty("password"));
</span><span class='line'>        return dataSource;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    private TransactionConfig getTransactionConfig(DataSource dataSource) throws Exception {
</span><span class='line'>        Properties transactionConfigProperties = new Properties();
</span><span class='line'>        transactionConfigProperties.setProperty("SetAutoCommitAllowed", "false");
</span><span class='line'>
</span><span class='line'>        TransactionConfig transactionConfig = (TransactionConfig)ExternalTransactionConfig.class.newInstance();
</span><span class='line'>        transactionConfig.setDataSource(dataSource);
</span><span class='line'>        transactionConfig.initialize(transactionConfigProperties);
</span><span class='line'>        return transactionConfig;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    private void applyTransactionConfig(SqlMapClient sqlMapClient, TransactionConfig transactionConfig) {
</span><span class='line'>        if (!(sqlMapClient instanceof ExtendedSqlMapClient)) {
</span><span class='line'>            throw new IllegalArgumentException("Cannot set TransactionConfig with DataSource"
</span><span class='line'>                    + "for SqlMapClient if not of type ExtendedSqlMapClient: " + sqlMapClient);
</span><span class='line'>        }
</span><span class='line'>        ExtendedSqlMapClient extendedClient = (ExtendedSqlMapClient)sqlMapClient;
</span><span class='line'>        transactionConfig.setMaximumConcurrentTransactions(extendedClient.getDelegate().getMaxTransactions());
</span><span class='line'>        extendedClient.getDelegate().setTxManager(new TransactionManager(transactionConfig));
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>然后为每个SqlMap映射文件编写一个测试类，继承上面的抽象类：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class UserSqlMapTest extends SqlMapTestCase {
</span><span class='line'>
</span><span class='line'>    public void testGetUser() throws Exception {
</span><span class='line'>        User user = (User)sqlMapClient.queryForObject("getUser", "ford");
</span><span class='line'>        assertNotNull(user);
</span><span class='line'>        assertEquals("ford", user.getName());
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>如此就可以进行单元测试了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/how-to-obtain-verification-field-value-in-resource-file-of-webwork/">如何在WebWork的资源文件中获取验证字段的值</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-03-30T14:56:37+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>2:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>WebWork是一个非常不错的MVC框架，有着众多的优点，也有着细微的缺陷。在实现一个用户注册验证的例子时，发现在资源文件中不能获取验证字段的值，只能每个字段一个message。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class User {
</span><span class='line'>    private String username;
</span><span class='line'>    private String password;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;field name="username"&gt;
</span><span class='line'>    &lt;field-validator type="stringlength" short-circuit="true"&gt;
</span><span class='line'>        &lt;param name="minLength"&gt;5&lt;/param&gt;
</span><span class='line'>        &lt;param name="maxLength"&gt;15&lt;/param&gt;
</span><span class='line'>        &lt;message key="errors.username.range" /&gt;
</span><span class='line'>    &lt;/field-validator&gt;
</span><span class='line'>&lt;/field&gt;
</span><span class='line'>
</span><span class='line'>&lt;field name="password"&gt;
</span><span class='line'>    &lt;field-validator type="stringlength" short-circuit="true"&gt;
</span><span class='line'>        &lt;param name="minLength"&gt;5&lt;/param&gt;
</span><span class='line'>        &lt;param name="maxLength"&gt;15&lt;/param&gt;
</span><span class='line'>        &lt;message key="errors.password.range" /&gt;
</span><span class='line'>    &lt;/field-validator&gt;
</span><span class='line'>&lt;/field&gt;</span></code></pre></td></tr></table></div></figure>

<p>资源文件中的消息内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>errors.username.range=${username} is not in the range ${minLength} through ${maxLength}.
</span><span class='line'>errors.password.range=${password} is not in the range ${minLength} through ${maxLength}.</span></code></pre></td></tr></table></div></figure>

<p>到xwork的站点上去查找解决方法，在Issue Tracker里看到有人提交了一个<a href="http://jira.opensymphony.com/browse/XW-184">Feature</a>，采用的办法是给message传递参数，看了xwork的代码后，发现这样子的做法要修改的代码量非常大，所以只能另外想办法解决。</p>

<p>在资源文件中可以用${fieldName}来获取要验证的字段变量名，那是否可以用${fieldValue}来得到验证字段的值呢？查看代码后发现这种办法行不通。那么是否可以用${${fieldName}}来获得字段变量的值呢？查看代码发现验证失败后会调用Validator.getMessage()方法，追踪代码来到TextParseUtil.translateVariables()方法中，找到代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>while (start != -1 && x &lt; length && count != 0) {    // 该部分代码负责查找变量，即${}包围的字符串
</span><span class='line'>    c = expression.charAt(x++);
</span><span class='line'>    if (c == '{') {
</span><span class='line'>        count++;
</span><span class='line'>    } else if (c == '}') {
</span><span class='line'>        count--;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>end = x - 1;
</span><span class='line'>
</span><span class='line'>if ((start != -1) && (end != -1) && (count == 0)) {
</span><span class='line'>    String var = expression.substring(start + 2, end);
</span><span class='line'>
</span><span class='line'>    Object o = stack.findValue(var, asType);    // 此处就是获取变量值的地方
</span><span class='line'>
</span><span class='line'>    String left = expression.substring(0, start);
</span><span class='line'>    String right = expression.substring(end + 1);</span></code></pre></td></tr></table></div></figure>

<p>由上面的代码可以看出WebWork只处理了最外围的${}，所以要让它处理像${${}}这样的格式就需要在获取变量前再次处理变量。修改后的代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if ((start != -1) && (end != -1) && (count == 0)) {
</span><span class='line'>    String nestedExpression = expression.substring(start + 2, end);
</span><span class='line'>    String var = translateVariables(nestedExpression, stack);
</span><span class='line'>    //String var = expression.substring(start + 2, end);
</span><span class='line'>
</span><span class='line'>    Object o = stack.findValue(var, asType);
</span><span class='line'>
</span><span class='line'>    String left = expression.substring(0, start);
</span><span class='line'>    String right = expression.substring(end + 1);</span></code></pre></td></tr></table></div></figure>

<p>现在就可以处理资源文件中的多重嵌套变量了。接着把修改验证文件和资源文件修改一下就可以了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;field name="username"&gt;
</span><span class='line'>    &lt;field-validator type="stringlength" short-circuit="true"&gt;
</span><span class='line'>        &lt;param name="minLength"&gt;5&lt;/param&gt;
</span><span class='line'>        &lt;param name="maxLength"&gt;15&lt;/param&gt;
</span><span class='line'>        &lt;message key="errors.range" /&gt;
</span><span class='line'>    &lt;/field-validator&gt;
</span><span class='line'>&lt;/field&gt;
</span><span class='line'>
</span><span class='line'>&lt;field name="password"&gt;
</span><span class='line'>    &lt;field-validator type="stringlength" short-circuit="true"&gt;
</span><span class='line'>        &lt;param name="minLength"&gt;5&lt;/param&gt;
</span><span class='line'>        &lt;param name="maxLength"&gt;15&lt;/param&gt;
</span><span class='line'>        &lt;message key="errors.range" /&gt;
</span><span class='line'>    &lt;/field-validator&gt;
</span><span class='line'>&lt;/field&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>errors.range=${${fieldName}} is not in the range ${minLength} through ${maxLength}.</span></code></pre></td></tr></table></div></figure>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/how-to-remove-registration-prompt-for-winrar-330/">如何去除WinRAR 3.30的注册提示框</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-03-23T22:50:59+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2006</span></span> <span class='time'>10:50 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>WinRAR在使用到期后，每次打开都会弹出如下图所示的对话框窗口，十分烦人。</p>

<p><img src="/uploads/winrar-nag.png" title="winrar-nag" ></p>

<p>去除Nag窗口常用的几种方法是：</p>

<ol>
<li>使用资源修改工具将可执行文件中的Nag窗口的属性改成透明、不可见，可以变相的去除Nag窗口；</li>
<li>找到创建和显示Nag窗口的代码，跳过即可。显示窗口的常用函数有MessageBox、MessageBoxEx、DialogBoxParam、CreateWindowEx、CreateWindowEx、ShowWindow等；</li>
<li>找到创建和显示Nag窗口的函数，更改其参数，让其调用失败就可以了；</li>
<li>在Nag窗口弹出来后，给可以关闭它的BUTTON 送一个WM_COMMAND消息；</li>
<li>通过静态和动态分析找到注册码。</li>
</ol>

<p>由于WinRAR未注册版本没有功能限制，用不着去找注册码注册。所以在这里可以用2和3两种方法去掉WinRAR的注册提示窗口。</p>

<p>使用Resource Hacker打开WinRAR.exe，显示Nag窗口的资源如图所示：</p>

<p><img src="/uploads/winrar-reminder.png" title="winrar-reminder" ></p>

<p>Nag窗口的ID号是1049，换算成16进制是0x419。用W32dsm打开WinRAR.exe，打开Dialog References查找Dialog: DialogID_0419，结果没找到。由上图可知Nag窗口的资源名是REMINDER，打开String Data References查找REMINDER字符串试试，果然找到了，双击该项就可以来到相关代码处。</p>

<p><img src="/uploads/winrar-w32dsm.png" title="winrar-w32dsm" ></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>* Referenced by a (U)nconditional or (C)onditional Jump at Address:
</span><span class='line'>|:0043FE89(C)
</span><span class='line'>|
</span><span class='line'>:0043FE8F C6055037490001          mov byte ptr [00493750], 01
</span><span class='line'>:0043FE96 6A00                    push 00000000
</span><span class='line'>:0043FE98 68143F4400              push 00443F14
</span><span class='line'>:0043FE9D FF3588EC4A00            push dword ptr [004AEC88]
</span><span class='line'>
</span><span class='line'>* Possible StringData Ref from Data Obj -&gt;"REMINDER"
</span><span class='line'>|
</span><span class='line'>:0043FEA3 68C93C4900              push 00493CC9
</span><span class='line'>:0043FEA8 FF3560D04900            push dword ptr [0049D060]
</span><span class='line'>
</span><span class='line'>* Reference To: USER32.DialogBoxParamA, Ord:0000h
</span><span class='line'>|
</span><span class='line'>:0043FEAE E837E30400              Call 0048E1EA
</span><span class='line'>
</span><span class='line'>* Referenced by a (U)nconditional or (C)onditional Jump at Addresses:
</span><span class='line'>|:0043FE64(C), :0043FE6D(C), :0043FE76(C), :0043FE7F(C), :0043FE8D(C)
</span><span class='line'>|
</span><span class='line'>:0043FEB3 833DF8104B0000          cmp dword ptr [004B10F8], 00000000
</span><span class='line'>:0043FEBA 752D                    jne 0043FEE9
</span><span class='line'>:0043FEBC 833DF0104B0000          cmp dword ptr [004B10F0], 00000000
</span><span class='line'>:0043FEC3 7524                    jne 0043FEE9
</span><span class='line'>:0043FEC5 833D08114B00FF          cmp dword ptr [004B1108], FFFFFFFF
</span><span class='line'>:0043FECC 741B                    je 0043FEE9
</span><span class='line'>:0043FECE 6A0A                    push 0000000A
</span><span class='line'>:0043FED0 FF3508114B00            push dword ptr [004B1108]</span></code></pre></td></tr></table></div></figure>

<p>可以看到，REMINDER字符串地址是作为参数传给了DialogBoxParamA函数，而DialogBoxParamA函数正是创建对话框的API函数。这时只需将0043FEA3处的push 00493CC9改为push 0，将一个NULL传入DialogBoxParamA函数，这个函数就会调用失败。当然之后它也就不能正常显示了，就达到了去除的目的。</p>

<p>现在再打开WinRAR，呵呵，大功告成，再也不会有Nag窗口出来Nag我了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/allow-struts-menu-to-access-resourcebundle-of-webwork/">让Struts-Menu能访问WebWork的ResourceBundle</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-03-12T07:01:48+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>7:01 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Struts-Menu默认是通过JSTL或者Struts来读取ResourceBundle的，这就需要在web.xml中配置要读取的properties文件（JSTL方式）或在struts-config.xml中配置（Struts方式）。
WebWork也有自己的ResourceBundle配置方式，而且Struts-Menu也不支持访问WebWork的ResourceBundle的功能。所以参考着DisplayTag的实现对Struts-Menu进行了一番手术，实现了可访问WebWork的ResourceBundle的功能。</p>

<p>下面是修改步骤：</p>

<ul>
<li>在Struts-Menu项目中增加net/sf/navigator/localization目录，将org.displaytag.localization中的*.java移到该目录中；</li>
<li>将org.displaytag下的Message.java和messages.properties移到net/sf/navigator目录下；</li>
<li>给MenuDisplayerMapping添加两个属性localeResover和ResourceProvider；</li>
<li>在struts-menu.xml的Displayer标签下添加：</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;setProperty property="localeResover" value="net.sf.navigator.localization.I18nWebworkAdapter" /&gt;
</span><span class='line'>&lt;setProperty property="resourceProvider" value="net.sf.navigator.localization.I18nWebworkAdapter" /&gt;</span></code></pre></td></tr></table></div></figure>

<ul>
<li>在MenuDisplayer中添加以下四个接口方法，并在AbstractMenuDisplayer里实现它们：</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public LocaleResolver getLocaleResolver();
</span><span class='line'>public void setLocaleResolver(LocaleResolver localeResolver);
</span><span class='line'>public I18nResourceProvider getResourceProvider();
</span><span class='line'>public void setResourceProvider(I18nResourceProvider resourceProvider);</span></code></pre></td></tr></table></div></figure>

<ul>
<li>在AbstractMenuDisplayer里添加protected的PageContext对象，并在init方法里初始化它；</li>
<li>覆写MessageResourcesMenuDisplayer.getMessage方法，代码如下：</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public String getMessage(String key) {
</span><span class='line'>    String message = null;
</span><span class='line'>
</span><span class='line'>    if (resourceProvider != null) {
</span><span class='line'>        message = resourceProvider.getResource(key, "???", null, pageContext);
</span><span class='line'>    }
</span><span class='line'>    if (message == null) {
</span><span class='line'>        message = key;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    return message;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<ul>
<li>在UseMenuDisplayerTag文件里添加代码（+后的代码是增加的）：</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  // get an instance of the menu displayer
</span><span class='line'>  MenuDisplayer displayerInstance = null;
</span><span class='line'>+ LocaleResolver localeResolver = null;
</span><span class='line'>+ I18nResourceProvider resourceProvider = null;
</span><span class='line'>
</span><span class='line'>  // default to use the config on the mapping
</span><span class='line'>  if (displayerMapping.getConfig() != null) {
</span><span class='line'>      // this value (config) is set on the displayer below
</span><span class='line'>      setConfig(displayerMapping.getConfig());
</span><span class='line'>  }
</span><span class='line'>+ localeResolver =
</span><span class='line'>+         (LocaleResolver) Class.forName(displayerMapping.getLocaleResover()).newInstance();
</span><span class='line'>+ resourceProvider =
</span><span class='line'>+         (I18nResourceProvider) Class.forName(displayerMapping.getLocaleProvider()).newInstance();
</span><span class='line'>
</span><span class='line'>  displayerInstance.setConfig(config);
</span><span class='line'>+ displayerInstance.setResourceProvider(resourceProvider);
</span><span class='line'>+ displayerInstance.setLocaleResolver(localeResolver);</span></code></pre></td></tr></table></div></figure>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ant-series-problem-using-emma-measure-test-coverage/">Ant系列之用EMMA测量测试覆盖率的问题</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2006-01-16T09:12:26+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2006</span></span> <span class='time'>9:12 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>EMMA是一个coverage工具，有on-the-fly和offline两种使用方式，在Ant里通常采用offline方式。</p>

<p>到sourceforge下载了2.0版本的EMMA下来，由于将EMMA的生成文件做了重定向，因此遇到了些问题，比如出现以下错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nothing to do: no runtime coverage data found in any of the data files</span></code></pre></td></tr></table></div></figure>

<p>查找EMMA的FAQ 3.7节，只是告诉你可能少了metadata和runtime coverate date（对Ant用户来说一般是少了runtime coveraget date，它的后缀名默认是ec）。</p>

<p>由FAQ 3.15节可以知道runtime coverage data文件默认是生成在user.dir目录下的（即build.xml中的basedir目录下），而由instr指令生成的metadata文件（后缀名默认为em）则已经被重定向到另外的目录（用来生成coverage report的地方），所以必须重新设置coverage.out.file的值，用来重定向生成的runtime coverage data。因为runtime coverage data是在junit任务执行时产生的，所以我们可以在junit任务中添加一行代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;sysproperty key="emma.coverage.out.file" value="${coverage.dir}/coverage.emma" /&gt;</span></code></pre></td></tr></table></div></figure>

<p>注意：</p>

<ol>
<li>metadata和runtime文件的后缀名最好设置相同；</li>
<li>一定要将junit任务的fork属性设置为true，这是因为EMMA 2.0的runtime coverage data是在JVM退出后生成的；</li>
<li>instrumented classes必须是第一个被JVM执行的，所以instrumented classes目录必须处在junit任务的classpath的第一行，具体原因不明，如果谁知道还请告知下。</li>
</ol>

<p>其实EMMA附带的examples目录下的build-offline.xml里已经说明的很详细了，只不过下载后没有仔细看，才遇到了一些问题。下面是build.xml的部分代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;path id="classpath"&gt;
</span><span class='line'>  &lt;pathelement location="${instrumentedclasses}" /&gt;
</span><span class='line'>  &lt;pathelement location="${classes}" /&gt;
</span><span class='line'>  &lt;pathelement location="${testclasses}" /&gt;
</span><span class='line'>  &lt;fileset dir="${lib}" includes="**/*.jar" /&gt;
</span><span class='line'>&lt;/path&gt;
</span><span class='line'>
</span><span class='line'>&lt;target name="compile" depends="prepare"&gt;
</span><span class='line'>  &lt;javac srcdir="${src}" destdir="${classes}" debug="on"&gt;
</span><span class='line'>    &lt;classpath refid="classpath" /&gt;
</span><span class='line'>  &lt;/javac&gt;
</span><span class='line'>  &lt;javac srcdir="${test}" destdir="${testclasses}" debug="on"&gt;
</span><span class='line'>    &lt;classpath refid="classpath" /&gt;
</span><span class='line'>  &lt;/javac&gt;
</span><span class='line'>&lt;/target&gt;
</span><span class='line'>
</span><span class='line'>&lt;target name="coverage.instrument" depends="compile"&gt;
</span><span class='line'>  &lt;emma enabled="yes"&gt;
</span><span class='line'>    &lt;instr instrpath="${classes}" destdir="${instrumentedclasses}"
</span><span class='line'>        metadatafile="{coveragereports}/metadata.emma" merge="true"&gt;
</span><span class='line'>    &lt;/instr&gt;
</span><span class='line'>  &lt;/emma&gt;
</span><span class='line'>&lt;/target&gt;
</span><span class='line'>
</span><span class='line'>&lt;target name="junit" depends="coverage.instrument"&gt;
</span><span class='line'>  &lt;junit printsummary="yes" haltonfailure="no" fork="true"&gt;
</span><span class='line'>    &lt;sysproperty key="emma.coverage.out.file" value="${coveragereports}/coverage.emma" /&gt;
</span><span class='line'>    &lt;classpath refid="classpath" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;formatter type="xml" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;batchtest fork="yes" todir="${junitreports}"&gt;
</span><span class='line'>      &lt;fileset dir="${test}"&gt;
</span><span class='line'>        &lt;include name="**/*Test*.java" /&gt;
</span><span class='line'>      &lt;/fileset&gt;
</span><span class='line'>    &lt;/batchtest&gt;
</span><span class='line'>  &lt;/junit&gt;
</span><span class='line'>&lt;/target&gt;
</span><span class='line'>
</span><span class='line'>&lt;target name="coverage.report" depends="test"&gt;
</span><span class='line'>  &lt;emma enabled="yes"&gt;
</span><span class='line'>    &lt;report sourcepath="${src}"&gt;
</span><span class='line'>      &lt;fileset dir="${coveragereports}"&gt;
</span><span class='line'>        &lt;include name="*.emma" /&gt;
</span><span class='line'>      &lt;/fileset&gt;
</span><span class='line'>
</span><span class='line'>      &lt;html outfile="${coveragereports}/coverage.html" depth="method" /&gt;
</span><span class='line'>    &lt;/report&gt;
</span><span class='line'>  &lt;/emma&gt;
</span><span class='line'>&lt;/target&gt;</span></code></pre></td></tr></table></div></figure>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/23">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/21">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/economic-inequality-the-short-version/">贫富差距精简版</a>
      </li>
    
      <li class="post">
        <a href="/blog/how-to-detect-and-prevent-spam-traffic-in-ga/">Google Analytics中如何检测并防止垃圾流量</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part6/">ANTLR 4权威参考读书笔记（6）</a>
      </li>
    
      <li class="post">
        <a href="/blog/overnight-success-it-takes-years/">一夜成名：这需要好几年时间</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part5/">ANTLR 4权威参考读书笔记（5）</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Recent Comments</h1>
  <div class="dsq-widget">
    <script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"></script>
  </div>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 118%" href="/tags/antlr/">ANTLR</a>
<a style="font-size: 105%" href="/tags/algorithm/">Algorithm</a>
<a style="font-size: 133%" href="/tags/android/">Android</a>
<a style="font-size: 93%" href="/tags/ant/">Ant</a>
<a style="font-size: 87%" href="/tags/css/">CSS</a>
<a style="font-size: 111%" href="/tags/crack/">Crack</a>
<a style="font-size: 105%" href="/tags/database/">Database</a>
<a style="font-size: 97%" href="/tags/eclipse/">Eclipse</a>
<a style="font-size: 113%" href="/tags/git/">Git</a>
<a style="font-size: 105%" href="/tags/jbookshelf/">JBookShelf</a>
<a style="font-size: 142%" href="/tags/java/">Java</a>
<a style="font-size: 93%" href="/tags/javascript/">JavaScript</a>
<a style="font-size: 97%" href="/tags/listview/">ListView</a>
<a style="font-size: 105%" href="/tags/mysql/">MySQL</a>
<a style="font-size: 97%" href="/tags/other/">Other</a>
<a style="font-size: 97%" href="/tags/paperclip/">Paperclip</a>
<a style="font-size: 120%" href="/tags/powerbuilder/">PowerBuilder</a>
<a style="font-size: 101%" href="/tags/powerscript/">PowerScript</a>
<a style="font-size: 118%" href="/tags/qianbao/">Qianbao</a>
<a style="font-size: 150%" href="/tags/rails/">Rails</a>
<a style="font-size: 111%" href="/tags/ruby/">Ruby</a>
<a style="font-size: 93%" href="/tags/spring/">Spring</a>
<a style="font-size: 101%" href="/tags/struts/">Struts</a>
<a style="font-size: 113%" href="/tags/translation/">Translation</a>
<a style="font-size: 97%" href="/tags/ubuntu/">Ubuntu</a>
<a style="font-size: 108%" href="/tags/windows-server-2008/">Windows Server 2008</a>
<a style="font-size: 108%" href="/tags/wxwidgets/">wxWidgets</a>

  </ul>
</section>
<section>
  <h1>Blogroll</h1>
  <ul>
    <li><a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a></li>
    <li><a href="http://www.importnew.com/">ImportNew</a></li>
    <li><a href="http://ifeve.com/">并发编程网</a></li>
    <li><a href="http://codingnow.com/">云风的 BLOG</a></li>
    <li><a href="http://dbanotes.net/">DBA Notes</a></li>
    <li><a href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a></li>
    <li><a href="http://advdbg.org/">高端调试</a></li>
    <li><a href="http://www.cs.usfca.edu/~galles/visualization/Algorithms.html">Data Structure Visualization</a></li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/dohkoos">@dohkoos</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dohkoos',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - dohkoos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codemany';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
