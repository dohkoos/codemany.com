
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>乐者为王</title>
  <meta name="author" content="dohkoos">

  
  <meta name="description" content="记账应用的基本功能都已经实现了，现在来给它加上个首页。 1
script/generate controller home index 上面的命令生成了控制器home，它有个动作index，并且在views目录下还生成了home/index.html.erb文件。打开它加入下面的内容： 1
2
& &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codemany.com/posts/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="乐者为王" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script-->
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->
<!--link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">乐者为王</a></h1>
  
    <h2>Do one thing, and do it well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:codemany.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/07/using-rails23-to-create-a-simple-accounting-app-part2/">用Rails 2.3打造简单记账软件（2）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-07T05:13:04+08:00" pubdate data-updated="true">Nov 7<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>记账应用的基本功能都已经实现了，现在来给它加上个首页。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate controller home index</span></code></pre></td></tr></table></div></figure>


<p>上面的命令生成了控制器home，它有个动作index，并且在views目录下还生成了home/index.html.erb文件。打开它加入下面的内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;h1&gt;Welcom to Qianbao!&lt;/h1&gt;
</span><span class='line'>&lt; %= link_to "All Entries", entries_path %&gt;</span></code></pre></td></tr></table></div></figure>


<p>在浏览器里面输入<code>http://localhost:3000/</code>，怎么出现了这个页面？</p>

<p><img src="/uploads/rails-welcome.png" title="rails-welcome" ></p>

<p>这并不是我们想要的结果。Rails要求URL需以<code>http://example.com/controller/action</code>的形式出现，因此要指向应用自己的首页需要修改config/routes.rb文件。在routes.rb中加入：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>map.connect '/', :controller =&gt; "controller_name", :action =&gt; "action_name"</span></code></pre></td></tr></table></div></figure>


<p>或者：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>map.root :controller =&gt; 'controller_name'</span></code></pre></td></tr></table></div></figure>


<p>这里采用第二种方法，在routes.rb中去掉map.root行的注释，修改控制器名称welcome为home。</p>

<p>为了防止默认首页public/index.html与上面设定的页面产生互竞，可以选择将它删除。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/06/using-rails23-to-create-a-simple-accounting-app-part1/">用Rails 2.3打造简单记账软件（1）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-06T16:13:45+08:00" pubdate data-updated="true">Nov 6<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>我们先来定义一下什么是最简单的记账应用：</p>

<ol>
<li>可以输入花钱的记录；</li>
<li>可以修改输入了的记录；</li>
<li>可以删除输入了的记录；</li>
<li>可以显示所有的记录。</li>
</ol>


<p>下面我们就开始动手吧！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails -d mysql qianbao
</span><span class='line'>cd qianbao
</span><span class='line'>rake db:create:all  # 在这之前要把数据库用户名和密码填写到config/database.yml</span></code></pre></td></tr></table></div></figure>


<p>从Rails 2.0开始，scaffold就从核心中移除了，不过可以直接作为script/generate对象来使用，所以现在scaffold的语法是这样子的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate scaffold model_name [field:type field:type]</span></code></pre></td></tr></table></div></figure>


<p>而不是以前使用的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate scaffold model_name [controller_name] [action, ...]</span></code></pre></td></tr></table></div></figure>


<p>具体细节可以使用script/generate scaffold命令查看。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate scaffold entry amount:decimal tags:string comment:text
</span><span class='line'>rake db:migrate
</span><span class='line'>script/server</span></code></pre></td></tr></table></div></figure>


<p>打开浏览器输入并访问<code>http://localhost:3000/entries</code>。</p>

<p>怎么样，一个简单的记账应用是不是已经做好了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/14/10-tips-for-how-to-name-your-project/">如何命名你的项目的10个技巧</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-14T14:45:32+08:00" pubdate data-updated="true">May 14<sup>th</sup>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>英文原文：<a href="http://www.wynia.org/wordpress/2006/06/22/10-tips-for-how-to-name-your-project/">http://www.wynia.org/wordpress/2006/06/22/10-tips-for-how-to-name-your-project/</a></p>

<p>这是我在几年前写的一系列东西中的另一篇，但是我想再分享一下。给那些开始产品和服务的人们，他们需要一些说明以便于理解，发音或正确拼写产品和服务的名字，我想该文章的价值就如同我第一次写它的时候一样。</p>

<p>如何（和避免那样）命名你的项目</p>

<p>1、如果你考虑的名字是直接取自科幻或奇幻作品，不必费心了。这些名字在软件中作为命名源的比例非常大。不仅是你想出有独创性名字的机会相当小，而且大部分作品中的角色和地方的名字都被商标化了，你要冒着被起诉的危险</p>

<p>2、如果你考虑的名字来自于希腊，罗马或北欧神话，再试一次。我们已经有了足够多的被称为“Mercury”变体的邮件相关软件</p>

<p>3、在Google上搜索被提议的名字。你得到的结果越少越好。如果没有结果，那么就是它</p>

<p>4、不要试图通过轻微拼错某事得到一个唯一名字。叫你的新窗口文件系统程序为Phat32只会以用户沮丧的看着“fat32”在搜索引擎中的结果而告终</p>

<p>5、如果你的产品名称不能在电视上用50s或60s说完，你或许走在了错误的道路上。这是尤其适用的如果你希望任何人在工作环境使用你的产品。没有人会去推荐一个产品给他们的工友，如果他们会遭到性骚扰起诉只是为了说出产品的名称</p>

<p>6、如果你的产品名称根本不能被发音，你就完全得不到口碑的好处。同样，如果没人知道如何去发音它，他们就非常有可能不会试着大声的说着它去询问关于它的问题，等等。你怎么说MySQL? PostgreSQL? GNU? 在地球上的几乎所有口语都是基于某类辅音/元音音节。在辅音和元音之间交替是一个相当好的方式保证别人能够发音它</p>

<p>7、越短越好</p>

<p>8、查看.com域名是否有效。如果不是，那就证明有人比你先想到了这个名称，并且正在使用它或接近使用它。即使你不打算使用域名也要做这一步</p>

<p>9、不要让你产品中固有的局限性成为名称的一部分。把你的产品名称叫做LinProduct或WinProduct预先的就永远阻止你发布任一类的跨平台版本</p>

<p>10、不要使用你自己的名字来命名开源产品。如果项目在你不再参与开发后仍然活着，项目要么是重命名，要么就是你的名字可能会被使用在你意想不到的地方。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/04/26/using-antlr-to-build-powerscript-grammar-parser-part4/">使用ANTLR构建PowerScript语法分析器（4）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-04-26T22:17:05+08:00" pubdate data-updated="true">Apr 26<sup>th</sup>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>什么是表达式</p>

<p>简单的来说，表达式就是操作数和操作符根据语法规则结合后的结果，它通常被用来执行在变量或值上的操作处理。</p>

<p>主表达式（Primary Expression）</p>

<p>到现在PowerScript的词法分析已经写的差不多了，接下来就要开始写语法分析。语法分析的主要组成部分是表达式（expression），而表达式的主要组成部分则是主表达式。主表达式包含了大部分简单的表达式，如字面量（literals），字段存取，方法调用和数组存取等。带圆括号的表达式通常也被认为是主表达式。其常见形式如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(x)
</span><span class='line'>x.y
</span><span class='line'>f(x)
</span><span class='line'>a[x]
</span><span class='line'>x++
</span><span class='line'>x--
</span><span class='line'>new</span></code></pre></td></tr></table></div></figure>


<p>当直接子类存有和父类相同签名的事件或函数时，可以通过super调用父类的事件或函数，但是：</p>

<ol>
<li>它不能调用父类中控件的脚本（猜测super后只能跟随“::”符号）；</li>
<li>它只能在直接子类的函数或事件中调用父类的事件或函数。</li>
</ol>


<p>在哪些脚本中可以使用parent：</p>

<ol>
<li>窗口中的控件，此时parent指代包含该控件的窗口；</li>
<li>定制的用户对象中的控件，这时parent指代定制的用户对象；</li>
<li>菜单，这时候parent指代该菜单的上一级菜单。</li>
</ol>


<p>收集的一些语句：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>this.ls_array[1]
</span><span class='line'>this.event pfc_addrow()
</span><span class='line'>this.event rowfocuschanged(ll_row)
</span><span class='line'>this.uo_1.function hallo()
</span><span class='line'>post function column_order_update_from_grid()
</span><span class='line'>event ue_process()
</span><span class='line'>
</span><span class='line'>close(parent)
</span><span class='line'>parent.enabled
</span><span class='line'>parent.hide()
</span><span class='line'>parent.event ue_postconstructor()
</span><span class='line'>parent.function static trigger wf_process( )
</span><span class='line'>
</span><span class='line'>super::create
</span><span class='line'>super::clicked;
</span><span class='line'>super::event clicked()
</span><span class='line'>super::event clicked(xpos, ypos, row, dwo)
</span><span class='line'>super::of_remove_tail(anv_tailnode)
</span><span class='line'>super::event trigger selectionchanging(oldindex, newindex)
</span><span class='line'>
</span><span class='line'>iu_tab_postings.post of_enable_sort(dw_main, dw_detail, false)
</span><span class='line'>w_main.event doubleclicked(flags, xpos, ypos)
</span><span class='line'>dw_main.event pfc_retrieve()
</span><span class='line'>cb_ok.event trigger clicked()
</span><span class='line'>cb_ok.triggerevent(clicked!)</span></code></pre></td></tr></table></div></figure>


<p>主表达式语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>primary_expression
</span><span class='line'>    : '(' expression ')'
</span><span class='line'>    | IDENTIFIER '!'?                   // build-in constant
</span><span class='line'>    | literal
</span><span class='line'>    | '::' IDENTIFIER                   // global variables
</span><span class='line'>    | call_type IDENTIFIER arguments    // example: post function to_string()
</span><span class='line'>    | 'create' 'using'? (STRING_LITERAL|IDENTIFIER)
</span><span class='line'>    | 'destroy' IDENTIFIER
</span><span class='line'>    | 'super' '::' call_type? IDENTIFIER arguments?
</span><span class='line'>    | object_name ('.' IDENTIFIER)* identifier_suffix?
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>object_name
</span><span class='line'>    : 'this'
</span><span class='line'>    | 'parent'
</span><span class='line'>    | IDENTIFIER
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>call_type
</span><span class='line'>    : ( 'function'
</span><span class='line'>      | 'event'
</span><span class='line'>      | 'static'
</span><span class='line'>      | 'dynamic'
</span><span class='line'>      | 'trigger'
</span><span class='line'>      | 'post'
</span><span class='line'>      )+
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>identifier_suffix
</span><span class='line'>    : arguments ('.' IDENTIFIER arguments)*    // cascaded calling
</span><span class='line'>    | '[' expression_list? ']'
</span><span class='line'>    | call_type IDENTIFIER arguments
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>arguments
</span><span class='line'>    : '(' expression_list? ')'
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>literal
</span><span class='line'>    : STRING_LITERAL
</span><span class='line'>    | INTEGER_LITERAL
</span><span class='line'>    | FLOAT_LITERAL
</span><span class='line'>    | BOOLEAN_LITERAL
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/04/25/cannot-launch-the-remote-parser-because-port-49153-is-already-in-use/">Cannot Launch the Remote Parser Because Port 49153 Is Already in Use</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-04-25T16:03:53+08:00" pubdate data-updated="true">Apr 25<sup>th</sup>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在Windows Server 2008使用ANTLRWorks调试语法文件时，总是提示说什么端口49153已被占用。使用netstat -an发现这个端口正在被别的进程监听着，虽然知道问题原因，但是不知道如何去解决。后来从<a href="http://www.cnblogs.com/zhoujg/archive/2008/03/29/1129281.html">如果AntlrWorks的Debug报错“当前端口已被占用”，可能是防火墙的原因</a>得到了启示：AntlrWorks是可以修改远程调试端口的。不过我没有像该文作者介绍的那样将调试端口改成49253，因为那样可能需要设置防火墙。而是直接将之设置到了一个不再使用的端口49151上。</p>

<p>设置调试端口的路径如下：</p>

<p>File -> Preferences -> Debugger -> Default local port</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/04/13/backup-foxmail-mail-using-win32/">使用Win32备份Foxmail的邮件</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-04-13T07:38:52+08:00" pubdate data-updated="true">Apr 13<sup>th</sup>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Foxmail是一个非常不错的邮件客户端，可惜在对邮箱内邮件的备份上做的不是很好，只能手工一封一封地将邮件导出，在邮件比较少时这样处理还可以应付，但假如有成百上千封邮件时还要这样处理显然是相当郁闷的。因此写了一个可以自动将某个邮箱中所有邮件导出为独立的eml格式邮件文件（该格式可以被OutLook邮件程序识别并打开）的小程序。</p>

<p>在Foxmail的安装目录下有一个mail文件夹，该文件夹中的每个子目录分别对应着一个邮件账号。进入某个帐号对应的文件夹，可以发现文件夹中有以in.BOX、out.BOX、send.BOX、spam.BOX和trash.BOX等文件，它们分别对应于收件箱、发件箱、已发送邮件箱、垃圾邮件箱和废件箱。根据<a href="http://www.yesky.com/72/1663572.shtml">VC++实现Foxmail邮件的批量导出</a>一文可以知道每个邮件头以下面的16个字符开始：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0x10 0x10 0x10 0x10 0x10 0x10 0x10
</span><span class='line'>0x11 0x11 0x11 0x11 0x11 0x11
</span><span class='line'>0x53 0x0D 0x0A</span></code></pre></td></tr></table></div></figure>


<p>知道了邮箱所对应存储文件的格式后，以下的事情就变的简单了。</p>

<ol>
<li>获取要备份的文件夹路径；</li>
<li>遍历该文件夹，找出以BOX为后缀名的邮箱存储文件；</li>
<li>分析存储文件，将邮件导出为eml格式的邮件文本。</li>
</ol>


<p>下面是需要用到的一些Win32 API函数：</p>

<p>创建非模态对话框</p>

<ul>
<li>CreateDialog</li>
</ul>


<p>获取目录信息</p>

<ul>
<li>BROWSEINFO</li>
<li>LPITEMIDLIST</li>
<li>SHBrowseForFolder</li>
<li>SHGetPathFromIDList</li>
</ul>


<p>遍历某个目录下的文件</p>

<ul>
<li>SetCurrentDirectory</li>
<li>FindFileFirst</li>
<li>FindNextFile</li>
<li>FindClose</li>
</ul>


<p>备份邮件</p>

<ul>
<li>CreateDirectory</li>
<li>CreateFile</li>
<li>ReadFile</li>
<li>WriteFile</li>
<li>CloseHandle</li>
</ul>


<p>还有，如果在对话框模版里用到了不一般的控件(比如说进度条)，那么还需要</p>

<ol>
<li>引用头文件commctrl.h；</li>
<li>并链接comctl32.lib；</li>
<li>在WinMain中创建对话框前调用InitCommonControls()方法。</li>
</ol>


<p><a href="/uploads/box2eml.zip" title="box2eml.zip">代码下载</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/02/13/how-to-debug-win32-program/">如何调试Win32程序</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-02-13T01:00:53+08:00" pubdate data-updated="true">Feb 13<sup>th</sup>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>方法一：使用OutputDebugString函数</p>

<p>函数的原型如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>void OutputDebugString(LPCTSTR lpOutputString);</span></code></pre></td></tr></table></div></figure>


<p>该函数会输出信息到系统的DEBUGER，输出结果可以使用工具<a href="http://www.microsoft.com/technet/sysinternals/Miscellaneous/DebugView.mspx">DebugView</a>观察。因为OutputDebugString的参数是字符串，而我们在实际使用过程中通常希望能像printf一样支持变参。下面的方法实现了这个效果：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>void DebugString(LPCTSTR lpszFormat, ...)
</span><span class='line'>{
</span><span class='line'>    va_list args;
</span><span class='line'>    TCHAR szText[1024];
</span><span class='line'>
</span><span class='line'>    va_start(args, lpszFormat);
</span><span class='line'>    wvsprintf(szText, lpszFormat, args);
</span><span class='line'>    OutputDebugString(szText);
</span><span class='line'>    va_end(args);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>方法二：输出调试信息到Console上</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FILE *stream;
</span><span class='line'>AllocConsole();
</span><span class='line'>freopen_s(&stream, "CONOUT$", "w", stdout);
</span><span class='line'>printf("Hello, world!\n");</span></code></pre></td></tr></table></div></figure>


<p>这里AllocConsole()用来打开Console，而freopen_s则把标准输出和Cosole关联。“CONOUT$”这个很关键。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/11/22/sms-split-algorithm/">短信分拆算法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-11-22T21:34:47+08:00" pubdate data-updated="true">Nov 22<sup>nd</sup>, 2007</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天，突然心血来潮，写了一段分拆短信的代码。代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class SMSHelper {
</span><span class='line'>    private static final int SMS_MAX_LENGTH = 70;
</span><span class='line'>
</span><span class='line'>    public static List split(String msg) {
</span><span class='line'>        if (msg.length() &lt;= SMS_MAX_LENGTH) {
</span><span class='line'>            throw new IllegalArgumentException("被分拆的短信长度必须大于70个字符");
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        List&lt;String&gt; list = new ArrayList&lt;String&gt;();
</span><span class='line'>        int i = 0, start = 0;
</span><span class='line'>        while (true) {
</span><span class='line'>            i++;
</span><span class='line'>            String prompt = "(第" + i + "条)";
</span><span class='line'>            int remain = SMS_MAX_LENGTH - prompt.length();
</span><span class='line'>            if (start + remain &gt; msg.length()) {
</span><span class='line'>                list.add(prompt + msg.substring(start));
</span><span class='line'>                break;
</span><span class='line'>            }
</span><span class='line'>            list.add(prompt + msg.substring(start, start + remain));
</span><span class='line'>            start += remain;
</span><span class='line'>        }
</span><span class='line'>        return list;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/09/25/hello-wxwidgets/">Hello wxWidgets!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-09-25T11:31:56+08:00" pubdate data-updated="true">Sep 25<sup>th</sup>, 2007</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>MainApp.h</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#ifndef __MAINAPP_H__
</span><span class='line'>#define __MAINAPP_H__
</span><span class='line'>
</span><span class='line'>#include &lt;wx/wx.h&gt;
</span><span class='line'>
</span><span class='line'>class MainApp : public wxApp
</span><span class='line'>{
</span><span class='line'>public:
</span><span class='line'>    virtual bool OnInit();
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>#endif</span></code></pre></td></tr></table></div></figure>


<p>MainApp.cpp</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include "MainApp.h"
</span><span class='line'>#include "MainFrame.h"
</span><span class='line'>
</span><span class='line'>IMPLEMENT_APP(MainApp)
</span><span class='line'>
</span><span class='line'>bool MainApp::OnInit()
</span><span class='line'>{
</span><span class='line'>    MainFrame* frame = new MainFrame("Hello wxWidgets!");
</span><span class='line'>    SetTopWindow(frame);
</span><span class='line'>    frame-&gt;Show();
</span><span class='line'>    return true;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>MainFrame.h</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#ifndef __MAINFRAME_H__
</span><span class='line'>#define __MAINFRAME_H__
</span><span class='line'>
</span><span class='line'>#include &lt;wx/frame.h&gt;
</span><span class='line'>
</span><span class='line'>class MainFrame : public wxFrame
</span><span class='line'>{
</span><span class='line'>public:
</span><span class='line'>    MainFrame(const wxString& title);
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>#endif</span></code></pre></td></tr></table></div></figure>


<p>MainFrame.cpp</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include "MainFrame.h"
</span><span class='line'>
</span><span class='line'>MainFrame::MainFrame(const wxString& title) : wxFrame(NULL, wxID_ANY, title)
</span><span class='line'>{
</span><span class='line'>    // TODO: add member initialization code here
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/09/07/using-antlr-to-build-powerscript-grammar-parser-part3/">使用ANTLR构建PowerScript语法分析器（3）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-09-07T00:40:49+08:00" pubdate data-updated="true">Sep 7<sup>th</sup>, 2007</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>转义字符（Special ASCII Characters）</p>

<p>PowerScript中转义字符是以波浪号（~）开头。下图是PowerScript支持的完整的转义字符，#字符表示数字。Decimal由三个十进制数组成，范围是000-255；Hexadecimal由两个十六进制数组成，范围是00-FF；Octal由三个八进制数组成，范围是000-377。</p>

<p><img src="/uploads/pb-spefial-ascii-char.png" title="pb-spefial-ascii-char" ></p>

<p>注意：#表示数字是必须的。譬如，必须用~007这种样式来表示转义字符，而不能是~7这种样式。</p>

<p>这里是转义字符的词法代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ESCAPE
</span><span class='line'>    : '~' ('n'|'t'|'v'|'r'|'f'|'b'|'\"'|'\''|'~')
</span><span class='line'>    | DecimalEscape
</span><span class='line'>    | HexEscape
</span><span class='line'>    | OctalEscape
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>DecimalEscape
</span><span class='line'>    : '~' ('0'..'1') ('0'..'9') ('0'..'9')    // 000 - 199
</span><span class='line'>    | '~' '2' ('0'..'5') ('0'..'5')           // 200 - 255
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>HexEscape
</span><span class='line'>    : '~h' ('0'..'9'|'a'..'f'|'A'..'F') ('0'..'9'|'a'..'f'|'A'..'F')    // 00 - FF
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>OctalEscape
</span><span class='line'>    : '~o' ('0'..'3') ('0'..'7') ('0'..'7')   // 000 - 377
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>


<p>续行（Statement Continuation）</p>

<p>通常情况下，PowerScript的一条语句书写在一行上，语句书写完毕后，按Enter键转到下一行，开始下一条语句。有时候，为了阅读方便等原因，需要把一条语句书写在几行上，这时就需要使用续行符了。PowerScript的续行符是“&amp;”字符，它放在一行的末尾指示下一行是当前行的继续，并且续行符必须是一行的最后一个字符。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CONTINUEDLINE
</span><span class='line'>    : '&' NEWLINE
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>


<p>字符和字符串字面量（Character and String Literal）</p>

<p>PowerScript程序中字符和字符串字面量没有明显的区别。字符是指由单引号（&#8217;）或双引号（&#8221;）括起来的一个ASCII字符，例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>char c
</span><span class='line'>c = 'T'
</span><span class='line'>c = "T"</span></code></pre></td></tr></table></div></figure>


<p>字符串字面量则是指由单引号或双引号括起来的不多于1024个的ASCII字符串，例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>string s
</span><span class='line'>s = 'This is a string'
</span><span class='line'>s = "This is a string"</span></code></pre></td></tr></table></div></figure>


<p>由于两者没有明显区别，因此在词法分析阶段只能将两者都作为字符串字面量来处理。至于到底是字符还是字符串，只有到了语意分析阶段才能作出判断（字符串字面量支持续行符）。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STRING_LITERAL
</span><span class='line'>    : ( '\'' (ESCAPE|CONTINUEDLINE|~('~'|'r'|'n'|'\''))* '\''
</span><span class='line'>      | '\"' (ESCAPE|CONTINUEDLINE|~('~'|'r'|'n'|'\"'))* '\"'
</span><span class='line'>      )
</span><span class='line'>      {
</span><span class='line'>          System.out.println("string&gt;" + getText());
</span><span class='line'>      }
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>


<p>数字和布尔字面量（Numeric and Boolean Literal）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>INTEGER_LITERAL
</span><span class='line'>    : ('0'|'1'..'9' ('0'..'9')*)
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>FLOAT_LITERAL
</span><span class='line'>    : ('0'..'9')+ '.' ('0'..'9')* Exponent?
</span><span class='line'>    | '.' ('0'..'9')+ Exponent?
</span><span class='line'>    | ('0'..'9')+ Exponent?
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>BOOLEAN_LITERAL
</span><span class='line'>    : ('true'|'false')
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>Exponent
</span><span class='line'>    : ('e'|'E') ('+'|'-')? ('0'..'9')+
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>


<p>标识符（Identifier）</p>

<p>标识符规则可以参看<a href="/blog/2006/12/13/powerscript-identifier/">PowerScript标识符</a>一文，以下是标识符的词法代码。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>IDENTIFIER
</span><span class='line'>    : Letter (Letter|'0'..'9'|'$'|'#'|'%')*    // 暂时不支持短横线（-）
</span><span class='line'>      {
</span><span class='line'>          System.out.println("identifier&gt;" + getText());
</span><span class='line'>      }
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>Letter
</span><span class='line'>    : ('A'..'Z'|'a'..'z'|'_')
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>


<p>PowerScript是否支持变量名的续行？</p>

<blockquote><p>Do not split a line by inserting the continuation character within a variable name. This causes an error and the statement fails.</p></blockquote>

<p>经过实际测试V9.0 Build 5507、V9.0.1 Build 7171和V8.0.3 Build 9704都不支持变量名的续行。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/6">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/17/problem-with-nokogiri-when-url-containing-chinese-character/">Nokogiri抓取页面URL含有中文参数的问题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/09/logic-problems-how-many-sick-dogs/">逻辑题-几条病狗</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/07/debugging-rails-with-pry/">使用Pry调试Rails项目</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/19/agile-decline/">敏捷开发走下坡路了吗？</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/11/the-proper-way-to-draw-rounded-corners/">绘制圆角的正确方法</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Recent Comments</h1>
  <div class="dsq-widget">
    <script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"></script>
  </div>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 106%" href="/tags/antlr/">ANTLR</a>
<a style="font-size: 106%" href="/tags/algorithm/">Algorithm</a>
<a style="font-size: 126%" href="/tags/android/">Android</a>
<a style="font-size: 117%" href="/tags/crack/">Crack</a>
<a style="font-size: 98%" href="/tags/database/">Database</a>
<a style="font-size: 98%" href="/tags/eclipse/">Eclipse</a>
<a style="font-size: 139%" href="/tags/java/">Java</a>
<a style="font-size: 112%" href="/tags/listview/">ListView</a>
<a style="font-size: 106%" href="/tags/powerbuilder/">PowerBuilder</a>
<a style="font-size: 106%" href="/tags/powerscript/">PowerScript</a>
<a style="font-size: 139%" href="/tags/qianbao/">Qianbao</a>
<a style="font-size: 150%" href="/tags/rails/">Rails</a>
<a style="font-size: 106%" href="/tags/ruby/">Ruby</a>
<a style="font-size: 112%" href="/tags/translation/">Translation</a>
<a style="font-size: 98%" href="/tags/w32dasm/">W32Dasm</a>

  </ul>
</section>
<section>
  <h1>Blogroll</h1>
  <ul>
    <li><a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a></li>
    <li><a href="http://quake.iteye.com/">写程序的70后</a></li>
    <li><a href="http://codingnow.com/">云风的 BLOG</a></li>
    <li><a href="http://dbanotes.net/">DBA Notes</a></li>
    <li><a href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a></li>
    <li><a href="http://www.cs.usfca.edu/~galles/visualization/Algorithms.html">Data Structure Visualization</a></li>
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - dohkoos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codemany';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
