
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>乐者为王</title>
  <meta name="author" content="dohkoos">

  
  <meta name="description" content="这次要给应用加上一个认证系统（注册、激活、登录、登出）。当用户输入注册信息时，必须输入有效的邮箱地址，注册成功后，用户并不能立即登录系统，而是要登录注册时输入的邮箱，通过该邮箱内的激活邮件来激活账户。通过这种方式可以防止用户的恶意注册。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codemany.com/posts/12">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="乐者为王" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script-->
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->
<!--link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">乐者为王</a></h1>
  
    <h2>Do one thing, and do it well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:codemany.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/15/using-the-rails23-to-create-a-simple-accounting-app-3/">用Rails 2.3打造简单记账软件(3)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-15T16:21:33+08:00" pubdate data-updated="true">Nov 15<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这次要给应用加上一个认证系统（注册、激活、登录、登出）。当用户输入注册信息时，必须输入有效的邮箱地址，注册成功后，用户并不能立即登录系统，而是要登录注册时输入的邮箱，通过该邮箱内的激活邮件来激活账户。通过这种方式可以防止用户的恶意注册。</p>

<p><a href="http://github.com/technoweenie/restful-authentication">restful_authentication</a>是一个支持Rails 2.0的认证系统插件，它为你生成REST风格的认证系统模板，除了提供最基本的用户注册登录登出功能外，还有一个可选的邮件激活功能。只要一个命令，它就为你生成了User model、管理注册和登录的controller、相应的页面、mailer等等。</p>

<p>安装插件和生成框架代码<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/plugin install http://svn.techno-weenie.net/projects/plugins/restful_authentication&lt;br /&gt;
</span><span class='line'>script/generate authenticated user sessions --include-activation&lt;br /&gt;
</span><span class='line'>rake db:migrate&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>&#8211;include-activation参数决定是否生成向新注册用户发送激活码邮件的代码</p>

<p>这一步是可选的，如果你想你的URL看起来更符合惯例一些，那么可以在config/routes.rb中添加：<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>map.signup '/signup', :controller =&gt; 'users', :action =&gt; 'new'&lt;br /&gt;
</span><span class='line'>map.login '/login', :controller =&gt; 'sessions', :action =&gt; 'new'&lt;br /&gt;
</span><span class='line'>map.logout '/logout', :controller =&gt; 'sessions', :action =&gt; 'destroy'&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>因为使用了&#8211;include-activation参数，所以还要在config/routes.rb中增加：<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>map.activate '/activate/:activation_code', :controller =&gt; 'users', :action =&gt; 'activate', :activation_code =&gt; nil</span></code></pre></td></tr></table></div></figure>


<p>最后，还需要添加一个observer到config/environment.rb的Rails::Initializer块中：<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.active_record.observers = :user_observer&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>设置ActionMailer，在config/environments/development.rb中添加：<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Don't care if the mailer can't send&lt;br /&gt;
</span><span class='line'>config.action_mailer.raise_delivery_errors = true&lt;br /&gt;
</span><span class='line'>config.action_mailer.perform_deliveries = true&lt;br /&gt;
</span><span class='line'>config.action_mailer.delivery_method = :smtp&lt;br /&gt;
</span><span class='line'>config.action_mailer.smtp_settings = {&lt;br /&gt;
</span><span class='line'>  :address =&gt; "smtp.example.com",&lt;br /&gt;
</span><span class='line'>  :port =&gt; 25,&lt;br /&gt;
</span><span class='line'>  :domain =&gt; "codemany.com",&lt;br /&gt;
</span><span class='line'>  :authentication =&gt; :login,&lt;br /&gt;
</span><span class='line'>  :user_name =&gt; "username@example.com",&lt;br /&gt;
</span><span class='line'>  :password =&gt; "secret"&lt;br /&gt;
</span><span class='line'>}
</span><span class='line'>config.action_mailer.default_charset = "utf-8"
</span><span class='line'>
</span><span class='line'>SITE_URL = "localhost:3000"&lt;br /&gt;
</span><span class='line'>ADMINEMAIL = "username@example.com"&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>打开app/models/user_mailer.rb，修改<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@body[:url]  = "http://YOURSITE/activate/#{user.activation_code}"&lt;br /&gt;
</span><span class='line'>@body[:url]  = "http://YOURSITE/"&lt;br /&gt;
</span><span class='line'>@subject     = "[YOURSITE] "&lt;br /&gt;
</span><span class='line'>@from        = "ADMINEMAIL"&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>为</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@body[:url]  = "http://#{SITE_URL}/activate/#{user.activation_code}"&lt;br /&gt;
</span><span class='line'>@body[:url]  = "http://#{SITE_URL}/"&lt;br /&gt;
</span><span class='line'>@subject     = "[#{SITE_URL}] "&lt;br /&gt;
</span><span class='line'>@from        = "#{ADMINEMAIL}"&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>注意：<br />
smtp_settings中的domain必须填写，否则会出现以下警告<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Net::SMTPSyntaxError (500 Error: bad syntax):&lt;br /&gt;
</span><span class='line'>  RAILS_HOME/lib/ruby/1.8/net/smtp.rb:679:in 'check_response'&lt;br /&gt;
</span><span class='line'>  RAILS_HOME/lib/ruby/1.8/net/smtp.rb:652:in 'getok'&lt;br /&gt;
</span><span class='line'>  RAILS_HOME/lib/ruby/1.8/net/smtp.rb:622:in 'helo'&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>user_mailer.rb中的ADMINEMAIL必须是一个有效的163邮件账号，否则会出现<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Net::SMTPFatalError (550 Invalid User):&lt;br /&gt;
</span><span class='line'>  RAILS_HOME/lib/ruby/1.8/net/smtp.rb:679:in 'check_response'&lt;br /&gt;
</span><span class='line'>  RAILS_HOME/lib/ruby/1.8/net/smtp.rb:652:in 'getok'&lt;br /&gt;
</span><span class='line'>  RAILS_HOME/lib/ruby/1.8/net/smtp.rb:630:in 'mailfrom'&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/07/using-the-rails23-to-create-a-simple-accounting-app-2/">用Rails 2.3打造简单记账软件(2)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-07T05:13:04+08:00" pubdate data-updated="true">Nov 7<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>记账应用的基本功能都已经实现了，现在来给它加上个首页。<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate controller home index&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>上面的命令生成了控制器home，它有个动作index，并且在views目录下还生成了home/index.html.erb文件。打开它加入下面的内容：<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;h1&gt;Welcom to Money App!&lt;/h1&gt;
</span><span class='line'>&lt; %= link_to "All Entries", entries_path %&gt;</span></code></pre></td></tr></table></div></figure>


<p>在浏览器里面输入<a href="http://localhost:3000/%EF%BC%8C%E5%87%BA%E7%8E%B0%E4%BA%86%E6%88%91%E4%BB%AC%E7%86%9F%E6%82%89%E7%9A%84%E9%9D%A2%E5%AD%94%EF%BC%9A">http://localhost:3000/%EF%BC%8C%E5%87%BA%E7%8E%B0%E4%BA%86%E6%88%91%E4%BB%AC%E7%86%9F%E6%82%89%E7%9A%84%E9%9D%A2%E5%AD%94%EF%BC%9A</a>
<img src="/uploads/rails-welcome.png" title="rails-welcome" ></p>

<p>这并不是我们想要的结果。Rails要求URL需以<a href="http://site/controller/action%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%87%BA%E7%8E%B0%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%A6%81%E6%8C%87%E5%90%91%E5%BA%94%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A6%96%E9%A1%B5%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9config/routes.rb%E6%96%87%E4%BB%B6%EF%BC%9A">http://site/controller/action%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%87%BA%E7%8E%B0%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%A6%81%E6%8C%87%E5%90%91%E5%BA%94%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A6%96%E9%A1%B5%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9config/routes.rb%E6%96%87%E4%BB%B6%EF%BC%9A</a></p>

<p>在routes.rb中加入<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>map.connect '/', :controller =&gt; "controllername", :action =&gt; "actionname"&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>或者<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>map.root :controller =&gt; 'controllername'&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>这里采用第二种方法，在routes.rb中去掉map.root行的注释，修改控制器名称welcome为home。</p>

<p>为了防止原默认首页public/index.html与上面设定的信息产生互竞，可以将它删除或改名。</p>

<p><img src="/uploads/money-index.png" title="money-index" ></p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/06/using-the-rails23-to-create-a-simple-accounting-app-1/">用Rails 2.3打造简单记账软件(1)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-06T16:13:45+08:00" pubdate data-updated="true">Nov 6<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>我们先来定义一下什么是最简单的记账应用：<br />
1. 可以输入花钱的记录<br />
2. 可以修改输入了的记录<br />
3. 可以删除输入了的记录<br />
4. 可以显示所有的记录</p>

<p>下面我们就开始动手吧！<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails -d mysql money&lt;br /&gt;
</span><span class='line'>cd money&lt;br /&gt;
</span><span class='line'>rake db:create:all # 在这之前要把数据库用户名和密码填写到config/database.yml中&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>从Rails 2.0开始，scaffold就从核心中移除了，不过可以直接作为script/generate对象来使用，所以现在scaffold的语法是这样子的：<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate scaffold ModelName [field:type field:type]&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>而不是以前使用的：<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate scaffold ModelName [ControllerName] [action, ...]&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>具体细节可以使用script/generate scaffold命令查看。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/generate scaffold Entry amount:decimal tags:string comment:text&lt;br /&gt;
</span><span class='line'>rake db:migrate&lt;br /&gt;
</span><span class='line'>script/server&lt;br /&gt;</span></code></pre></td></tr></table></div></figure>


<p>打开浏览器输入并访问<a href="http://localhost:3000/entries%E3%80%82">http://localhost:3000/entries%E3%80%82</a></p>

<p>怎么样，一个简单的记账应用是不是已经做好了。</p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/04/install-android-sdk-20-on-windows-server-2008/">在Windows Server 2008下安装Android SDK 2.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-04T05:33:04+08:00" pubdate data-updated="true">Nov 4<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>SDK Setup.exe在Windows Server 2008上是无法执行的，看Readme文档知道可以用命令行的方式更新。不过不带参数执行时抛出了下面的错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Starting Android SDK Updater
</span><span class='line'>SWT folder 'lib\x86_64' does not exist.
</span><span class='line'>Please set ANDROID_SWT to point to the folder containing swt.jar for your platform.</span></code></pre></td></tr></table></div></figure>


<p>查看tools/android.bat代码后发现有个bug，在copy代码时没有考虑x86_64平台的问题。找到如下代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xcopy lib\x86 %tmpdir%\lib\x86 /I /E /C /G /R /Y /Q &gt; nul</span></code></pre></td></tr></table></div></figure>


<p>把它改成</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xcopy %swt_path% %tmpdir%\%swt_path% /I /E /C /G /R /Y /Q &gt; nul</span></code></pre></td></tr></table></div></figure>


<p>或者也可以在环境变量中添加ANDROID_SWT，使它指向lib\x86_64\swt.jar文件的位置。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/31/fingerprint-recognition-technology-break/">10块钱破解指纹考勤机</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-31T06:22:48+08:00" pubdate data-updated="true">Oct 31<sup>st</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前段时间报名参加了驾驶员培训，结果发现了一个破解指纹识别的好办法。现在什么都讲高科技，驾驶员训练当然也不例外，在训练中就采用指纹考勤机来记录学员上车的时间，达不到规定时间的学员就不能参加考试。参加培训的都知道，经常会有学员因故缺席训练。那怎么能让学员不在也可以计算时间呢？这不，教练们只花了不到10元钱就解决了这个问题。</p>

<p>材料：<br />
玻璃胶（硅酮密封胶）一瓶<br />
橡皮泥一盒</p>

<p>将橡皮泥搓到有点发硬的时候压平，然后在光滑的一面按上手指印，将玻璃胶挤入到手指印中，抹平，然后放置在阴凉处一段时间就行了。</p>

<p>就这么简单，不到10块钱就搞定了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/21/how-to-activate-over-the-60-days-after-windows-server-2008/">如何在过了60天后再激活Windows Server 2008</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-21T05:51:06+08:00" pubdate data-updated="true">Oct 21<sup>st</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>登录系统后，会出现一个激活窗口，告诉你激活已过期，要接着使用的话就必须先激活。并提供几种激活的方式。选择第二项即Buy a new product key online，会弹出如下窗口：
<img src="/uploads/go-microsoft-fwlink.png" title="go-microsoft-fwlink" ></p>

<p>点击确定，这时就会打开浏览器。在浏览器中选择打开文件菜单，找到command命令，右键点击Run as administrator，然后执行slmgr.vbs -rearm指令，接着重启计算机就可以了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/15/datawindows-data-buffer/">DataWindow的数据缓冲区</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-15T09:03:29+08:00" pubdate data-updated="true">Oct 15<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在PowerBuilder中，DataWindow是用来存储和操纵数据的对象。在每个DataWindow对象中都有4个二维表作为数据缓冲区来存储数据。用户在DataWindow中对数据的操作实际上都是将数据在这几个缓冲区中进行修改和移动，最后在用户提交数据库时，系统根据这四个缓冲区中的信息形成SQL的INSERT、UPDATE、DELETE等语句。这四个缓冲区是：</p>

<p>Primary Buffer<br />
这个缓冲区是存放填充窗口中DataWindow控件的数据的，调用DataWindow控件的Retrieve()函数和InsertRow()函数可以将数据填入这个缓冲区中。当使用有关DataWindow删除和过滤函数时，相应记录将从这一缓冲区中删除。而在执行DataWindow的Update()函数时，PowerBuilder将查看这一缓冲区中的记录以形成INSERT和UPDATE语句。</p>

<p>Delete Buffer<br />
这个缓冲区保存的是用DeleteRow()函数从Primary Buffer中删除的记录，执行Update()函数时，系统根据这一缓冲区的记录形成DELETE语句。</p>

<p>Filter Buffer<br />
这个缓冲区存储的是从Original Buffer使用Filter()函数过滤到Primary Buffer中后剩余的记录。</p>

<p>Original Buffer<br />
这一缓冲区存储的是DataWindow最初执行Retrieve()函数时得到的全部记录。当提交数据库时，根据Primary Buffer生成的UPDATE语句和根据Delete Buffer生成的DELETE语句都要依据这一缓冲区来构造这些SQL语句中的WHERE子句。</p>

<p>Original Buffer由PowerBuilder内部维护，PowerBuilder所提供的任何函数都无法改变它的值，不过通过PowerBuilder所提供的GetItem系列函数可以读出DataWindow最初从数据库中查到的原始值。通过这些函数我们可以编程实现所谓的Undo功能，并且得到在使用乐观锁时形成提交数据库的WHERE子句。如果您当前使用的DataWindow没有设置修改的权力，您将不能对Delete Buffer和Original Buffer进行操作，而且当调用Update()时也将引起系统错误。</p>

<p>Primary Buffer和Delete Buffer都有行级和列级的状态值，这个状态值是一个枚举类型。在提交时由该行的状态值来决定是否要产生SQL语句，其中Primary Buffer产生的是INSERT和UPDATE语句，而Delete Buffer产生的是DELETE语句。我们用GetItemStatus()函数和SetItemStatus()函数可以对这一状态值进行操纵。这一枚举状态有以下四种：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NotModified! ——— 指定单元的数据和原始数据相同，没有发生改变。
</span><span class='line'>DataModified! ——— 指定单元的数据和原始数据不同，发生了改变。
</span><span class='line'>New! ——— 该数据行是新增加的，但数据没有发生改变（数据为空或缺省值）。
</span><span class='line'>NewModified! ——— 该数据行是新增加的，且数据已发生改变（用户键盘输入或调用SetItem()函数）。</span></code></pre></td></tr></table></div></figure>


<p>在上面的这四个值中，NotModifed!和DataModified!可以表示行和列的状态，而New!和NewModified!只可以表示行的状态。</p>

<p>让我们来看一个实例。有这样一张表，表中有3个字段，其中item是主键。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>item CHAR(5)
</span><span class='line'>name CHAR(20)
</span><span class='line'>quantity INT</span></code></pre></td></tr></table></div></figure>


<p>在代码中我们查询这张表的记录，得到以下的这些信息，它们被存储在Primary Buffer和Origianal Buffer中。
<img src="/uploads/dwbuffer-1.png" title="dwbuffer-1" ></p>

<p>在窗口中，我们过滤掉数量为0的行，并且加上一个空行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dw_1.SetFilter("quantity=0")
</span><span class='line'>dw_1.Filter()
</span><span class='line'>dw_1.InsertRow()</span></code></pre></td></tr></table></div></figure>


<p>这时Primary Buffer的状态为：
<img src="/uploads/dwbuffer-2.png" title="dwbuffer-2" ></p>

<p>在Filter Buffer中的记录为：
<img src="/uploads/dwbuffer-3.png" title="dwbuffer-3" ></p>

<p>用户在新插入行中输入数据，删除了第3行数据，并修改了第2行数据。当他离开这个DataWindow时，Primary Buffer和Delete Buffer的状态如下：
<img src="/uploads/dwbuffer-4.png" title="dwbuffer-4" ></p>

<p><img src="/uploads/dwbuffer-5.png" title="dwbuffer-5" ></p>

<p>这时执行dw_1.Update()函数，系统将基于这两个缓冲区生成SQL语句。
<img src="/uploads/dwbuffer-6.png" title="dwbuffer-6" ></p>

<p>在Primary Buffer中，状态为NotModified!和New!的行将被忽略而不产生SQL语句。状态为DataModified!的行将产生UPDATE语句，状态为NewModified!的行将产生INSERT语句，在Delete Buffer中的行将产生DELETE语句。使用DataWindow的Reset()函数和Retrieve()函数以及改变DataObject属性时，系统将重置这几个缓冲区。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/16/the-using-of-whois-domain-name-information-query-protocols/">利用WHOIS协议查询域名信息</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-16T06:15:04+08:00" pubdate data-updated="true">Sep 16<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>域名信息的查询原理非常简单，主要是基于RFC 954（RFC 812已被废弃）提供的WHOIS协议。WHOIS服务器是一个基于“查询/响应”的TCP事务服务器，用户程序通过访问WHOIS服务器，从WHOIS数据库中查询得到我们所需要的内容。其主要过程有以下三步：</p>

<ol>
<li>在TCP服务端口43连接WHOIS服务主机；</li>
<li>发送一个命令，以回车换行符结尾；</li>
<li>接受相应命令的返回信息，一旦输出结束，服务器将关闭连接。</li>
</ol>


<p>命令的格式非常简单。可以直接输入域名（例如example.com）查询相关域名信息；也可以使用help得到详细的帮助信息。以下是查询的代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wxString Whois::Lookup(wxString& host, wxString& szAddress)
</span><span class='line'>{
</span><span class='line'>    char szQuery[512];
</span><span class='line'>    char szBuffer[512];
</span><span class='line'>    wxString szResult;
</span><span class='line'>
</span><span class='line'>    strcpy(szQuery, szAddress);
</span><span class='line'>    strcat(szQuery, "\r\n");
</span><span class='line'>
</span><span class='line'>    wxIPV4address addr;
</span><span class='line'>    addr.Hostname(host);
</span><span class='line'>    addr.Service(43);
</span><span class='line'>
</span><span class='line'>    wxSocketClient socket;
</span><span class='line'>    socket.Connect(addr, false);
</span><span class='line'>    socket.WaitOnConnect(30);
</span><span class='line'>
</span><span class='line'>    if (socket.IsConnected())
</span><span class='line'>    {
</span><span class='line'>        socket.Write(szQuery, strlen(szQuery));
</span><span class='line'>        szResult = "";
</span><span class='line'>        while (true)
</span><span class='line'>        {
</span><span class='line'>            // Clear buffer before each iteration
</span><span class='line'>            memset(szBuffer, 0, 512);
</span><span class='line'>
</span><span class='line'>            // Try to receive some data
</span><span class='line'>            socket.Read(szBuffer, 500);
</span><span class='line'>            if (socket.LastCount() &lt;= 0)
</span><span class='line'>            {
</span><span class='line'>                break;
</span><span class='line'>            }
</span><span class='line'>            szResult += szBuffer;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    else
</span><span class='line'>    {
</span><span class='line'>        szResult = wxT("Failed! Unable to connect\n");
</span><span class='line'>    }
</span><span class='line'>    socket.Close();
</span><span class='line'>
</span><span class='line'>    return wxString::FromUTF8(szResult);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>常用的WHOIS服务器：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.cn=whois.cnnic.net.cn
</span><span class='line'>.com=whois.internic.com
</span><span class='line'>.net=whois.internic.com
</span><span class='line'>.name=www.whois.name
</span><span class='line'>.cc=whois.nic.cc</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/18/freemind-solution-in-windows-server-2008-can-not-run-the-problem-of/">解决FreeMind在Windows Server 2008中不能运行的问题</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-18T05:26:37+08:00" pubdate data-updated="true">Aug 18<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在Windows Server 2008下安装FreeMind后不能运行（0.8.1和0.9.0-RC4均是如此），使用的JRE是1.6.0_13。网上有的解决方法是在系统变量的Path中添加jre\bin的路径。但是我不想这样做，想试试别的方法。</p>

<p>后来，从FreeMind的<a href="http://sourceforge.net/tracker/index.php?func=detail&aid=2750047&group_id=7118&atid=107118">bug2750047</a>中得到了启示，将javaw.exe拷贝到FreeMind的安装目录下就可以打开了。不过导致这个问题的原因目前还不清楚，因为在System32目录下确实有javaw.exe这个文件存在。不知道是不是因为安装的是64位版本的缘故。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/29/local-apache-virtual-host-configuration/">Apache本地虚拟主机配置</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-29T09:54:07+08:00" pubdate data-updated="true">Jul 29<sup>th</sup>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>一般我们开发一个网站，都是先在本地部署和调试，再上传到网上。假如Root目录是C:\www，当有两个或多个网站需要部署时，那么就会有<br />
C:\www\site1<br />
C:\www\site2<br />
&#8230;</p>

<p>它们可以通过如下方式来访问。<br />
<a href="http://localhost/site1">http://localhost/site1</a><br />
<a href="http://localhost/site2">http://localhost/site2</a><br />
&#8230;</p>

<p>这样当然没有问题，不过如果能在本地实现用域名访问，不是更方便，像这样：<br />
<a href="http://www.site1.com">http://www.site1.com</a><br />
<a href="http://www.site2.com">http://www.site2.com</a></p>

<p>首先在C:\Windows\System32\drivers\etc\hosts文件中加上一下内容：<br />
127.0.0.1   site1.com<br />
127.0.0.1   www.site1.com<br />
127.0.0.1   site2.com<br />
127.0.0.1   www.site2.com</p>

<p>然后打开Apache的配置文件httpd.conf，找到<br /></p>

<h1>Virtual hosts<br /></h1>

<h1>Include conf/extra/httpd-vhosts.conf</h1>

<p>把第二行前面的注释去掉，这样就可以通过修改httpd-vhosts.conf文件来达到配置虚拟主机的目的。当然也可以直接在httpd.conf文件下配置。</p>

<p>httpd-vhosts.conf文件内容：<br />
NameVirtualHost *:80</p>

<p><Directory "C:/www/site1">
Options FollowSymLinks<br />
AllowOverride None<br />
Order allow,deny<br />
Allow from all
</Directory></p>

<p><VirtualHost *:80>
ServerName site1.com<br />
Serveralias www.site1.com<br />
ServerAdmin <a href="&#109;&#97;&#x69;&#x6c;&#116;&#111;&#58;&#x77;&#101;&#98;&#x6d;&#97;&#115;&#x74;&#101;&#x72;&#64;&#115;&#x69;&#116;&#x65;&#x31;&#46;&#99;&#111;&#x6d;">&#x77;&#101;&#x62;&#109;&#97;&#x73;&#116;&#x65;&#114;&#x40;&#115;&#105;&#116;&#x65;&#x31;&#46;&#99;&#x6f;&#x6d;</a><br />
DocumentRoot &#8220;C:/www/site1&#8221;<br />
ErrorLog &#8220;logs/site1.com-error.log&#8221;<br />
CustomLog &#8220;logs/site1.com-access.log&#8221; common
</VirtualHost></p>

<p><Directory "C:/www/site2">
Options FollowSymLinks<br />
AllowOverride None<br />
Order allow,deny<br />
Allow from all
</Directory></p>

<p><VirtualHost *:80>
ServerName site2.com<br />
Serveralias www.site2.com<br />
ServerAdmin <a href="&#x6d;&#97;&#105;&#108;&#116;&#111;&#x3a;&#119;&#x65;&#98;&#x6d;&#97;&#x73;&#x74;&#101;&#114;&#x40;&#115;&#105;&#116;&#101;&#50;&#46;&#99;&#x6f;&#109;">&#119;&#101;&#x62;&#x6d;&#x61;&#115;&#116;&#x65;&#x72;&#64;&#x73;&#x69;&#116;&#x65;&#50;&#46;&#x63;&#111;&#x6d;</a><br />
DocumentRoot &#8220;C:/www/site2&#8221;<br />
ErrorLog &#8220;logs/site2.com-error.log&#8221;<br />
CustomLog &#8220;logs/site2.com-access.log&#8221; common
</VirtualHost></p>

<p>这是最基本的配置，*号代表任何ip，也可以指定为本地ip：127.0.0.1。最好配置两个或两个以上，如果只有一个的话，那么其中的DocumentRoot就会覆盖httpd.conf文件里的DocumentRoot。</p>

<p>重启Apache就大功告成了，以后访问www.site1.com或site1.com就会访问本地的C:\www\site1文件夹。</p></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/13">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/11">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/08/05/migrating-wordpress-to-octopress/">Wordpress迁移到Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/17/problem-with-nokogiri-when-url-containing-chinese-character/">Nokogiri抓取页面URL含有中文参数的问题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/09/logic-problems-how-many-sick-dogs/">逻辑题-几条病狗</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/07/debugging-rails-with-pry/">使用Pry调试Rails项目</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/06/raspberry-pi-wifi-with-static-ip-address/">Raspberry Pi使用无线网卡</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Recent Comments</h1>
  <div class="dsq-widget">
    <script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"></script>
  </div>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 97%" href="/tags/algorithm/">Algorithm</a>
<a style="font-size: 133%" href="/tags/android/">Android</a>
<a style="font-size: 111%" href="/tags/crack/">Crack</a>
<a style="font-size: 108%" href="/tags/database/">Database</a>
<a style="font-size: 97%" href="/tags/eclipse/">Eclipse</a>
<a style="font-size: 105%" href="/tags/jbookshelf/">JBookShelf</a>
<a style="font-size: 134%" href="/tags/java/">Java</a>
<a style="font-size: 108%" href="/tags/mysql/">MySQL</a>
<a style="font-size: 116%" href="/tags/powerbuilder/">PowerBuilder</a>
<a style="font-size: 120%" href="/tags/qianbao/">Qianbao</a>
<a style="font-size: 150%" href="/tags/rails/">Rails</a>
<a style="font-size: 101%" href="/tags/ruby/">Ruby</a>
<a style="font-size: 101%" href="/tags/struts/">Struts</a>
<a style="font-size: 105%" href="/tags/windows-server-2008/">Windows Server 2008</a>
<a style="font-size: 108%" href="/tags/wxwidgets/">wxWidgets</a>

  </ul>
</section>
<section>
  <h1>Blogroll</h1>
  <ul>
    <li><a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a></li>
    <li><a href="http://quake.iteye.com/">写程序的70后</a></li>
    <li><a href="http://codingnow.com/">云风的 BLOG</a></li>
    <li><a href="http://dbanotes.net/">DBA Notes</a></li>
    <li><a href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a></li>
    <li><a href="http://www.cs.usfca.edu/~galles/visualization/Algorithms.html">Data Structure Visualization</a></li>
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - dohkoos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codemany';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
