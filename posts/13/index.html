
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>乐者为王</title>
  <meta name="author" content="dohkoos">

  
  <meta name="description" content="Rails已经到3.2版本了，和以前的2.3版本有了很大的不同，决定把原来老版本的记账应用重新写一遍，更新部分插件。 首先是创建项目： 1
2
3
4
rails new qianbao
cd qianbao
rails g scaffold entry amount:decimal tags: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codemany.com/posts/13/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="乐者为王" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46570161-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">乐者为王</a></h1>
  
    <h2>Do one thing, and do it well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="codemany.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/using-rails-32-to-create-a-simple-accounting-application/">用Rails 3.2打造简单记账应用</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-04-18T07:49:27+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>7:49 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rails已经到3.2版本了，和以前的2.3版本有了很大的不同，决定把原来老版本的记账应用重新写一遍，更新部分插件。</p>

<p>首先是创建项目：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails new qianbao
</span><span class='line'>cd qianbao
</span><span class='line'>rails g scaffold entry amount:decimal tags:string comment:text effective_date:date
</span><span class='line'>rails g controller home index</span></code></pre></td></tr></table></div></figure>

<p>删除public/index.html，在config/routes.rb中添加根路由：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root :to =&gt; 'home#index'</span></code></pre></td></tr></table></div></figure>

<p>现在要给应用加上一个认证系统（注册、激活、登录、登出），这次使用<a href="https://github.com/plataformatec/devise">devise</a>插件实现。</p>

<p>在Gemfile中添加：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'devise'</span></code></pre></td></tr></table></div></figure>

<p>然后执行下列命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install
</span><span class='line'>rails g devise:install
</span><span class='line'>rails g devise user
</span><span class='line'>rails g devise:views</span></code></pre></td></tr></table></div></figure>

<p>创建一个迁移任务，把User和Entry模型关联起来：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class AddUserIdToEntries &lt; ActiveRecord::Migration
</span><span class='line'>  def change
</span><span class='line'>    add_column :entries, :user_id, :integer
</span><span class='line'>
</span><span class='line'>    add_index :entries, :user_id
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>

<p>修改Entry和User模型：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Entry &lt; ActiveRecord::Base
</span><span class='line'>  validates :effective_date, :presence =&gt; true
</span><span class='line'>  validates :amount,         :presence =&gt; true,
</span><span class='line'>                             :numericality =&gt; { :greater_than =&gt; 0.0 },
</span><span class='line'>                             :format =&gt; { :with =&gt; /^\d+??(?:\.\d{0,2})?$/ }
</span><span class='line'>  validates :tags,           :presence =&gt; true,
</span><span class='line'>                             :length =&gt; { :within =&gt; 1..255 }
</span><span class='line'>
</span><span class='line'>  belongs_to :user</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class User &lt; ActiveRecord::Base
</span><span class='line'>  has_many :entries</span></code></pre></td></tr></table></div></figure>

<p>修改app/views/layouts/application.html.erb文件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;body&gt;
</span><span class='line'>  &lt;% if user_signed_in? %&gt;
</span><span class='line'>    &lt;p&gt;
</span><span class='line'>      &lt;strong&gt;&lt;%= link_to current_user.email, edit_user_registration_path %&gt;&lt;/strong&gt;
</span><span class='line'>      &lt;%= link_to 'Logout', destroy_user_session_path, :method =&gt; :delete %&gt;
</span><span class='line'>    &lt;/p&gt;
</span><span class='line'>    &lt;%= link_to "All Entries", entries_path %&gt;
</span><span class='line'>  &lt;% else %&gt;
</span><span class='line'>    &lt;p&gt;
</span><span class='line'>      &lt;strong&gt;You are currently not logged in.&lt;/strong&gt;
</span><span class='line'>      &lt;%= link_to 'Sign in', new_user_session_path %&gt; or
</span><span class='line'>      &lt;%= link_to 'Sign up', new_user_registration_path %&gt;
</span><span class='line'>    &lt;/p&gt;
</span><span class='line'>  &lt;% end %&gt;
</span><span class='line'>
</span><span class='line'>  &lt;%= yield %&gt;
</span><span class='line'>&lt;/body&gt;</span></code></pre></td></tr></table></div></figure>

<p>修改app/controller/entries_controller.rb：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class EntriesController &lt; ApplicationController
</span><span class='line'>  before_filter :authenticate_user!
</span><span class='line'>
</span><span class='line'>  # GET /entries
</span><span class='line'>  # GET /entries.json
</span><span class='line'>  def index
</span><span class='line'>    @entries = current_user.entries
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html # index.html.erb
</span><span class='line'>      format.json { render json: @entries }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # GET /entries/1
</span><span class='line'>  # GET /entries/1.json
</span><span class='line'>  def show
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html # show.html.erb
</span><span class='line'>      format.json { render json: @entry }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # GET /entries/new
</span><span class='line'>  # GET /entries/new.json
</span><span class='line'>  def new
</span><span class='line'>    @entry = Entry.new
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html # new.html.erb
</span><span class='line'>      format.json { render json: @entry }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # GET /entries/1/edit
</span><span class='line'>  def edit
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # POST /entries
</span><span class='line'>  # POST /entries.json
</span><span class='line'>  def create
</span><span class='line'>    @entry = Entry.new(params[:entry])
</span><span class='line'>    @entry.user = current_user
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      if @entry.save
</span><span class='line'>        format.html { redirect_to @entry, notice: 'Entry was successfully created.' }
</span><span class='line'>        format.json { render json: @entry, status: :created, location: @entry }
</span><span class='line'>      else
</span><span class='line'>        format.html { render action: "new" }
</span><span class='line'>        format.json { render json: @entry.errors, status: :unprocessable_entity }
</span><span class='line'>      end
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # PUT /entries/1
</span><span class='line'>  # PUT /entries/1.json
</span><span class='line'>  def update
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      if @entry.update_attributes(params[:entry])
</span><span class='line'>        format.html { redirect_to @entry, notice: 'Entry was successfully updated.' }
</span><span class='line'>        format.json { head :no_content }
</span><span class='line'>      else
</span><span class='line'>        format.html { render action: "edit" }
</span><span class='line'>        format.json { render json: @entry.errors, status: :unprocessable_entity }
</span><span class='line'>      end
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # DELETE /entries/1
</span><span class='line'>  # DELETE /entries/1.json
</span><span class='line'>  def destroy
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>    @entry.destroy
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html { redirect_to entries_url }
</span><span class='line'>      format.json { head :no_content }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>

<p>执行以下命令启动应用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake db:migrate
</span><span class='line'>rails s</span></code></pre></td></tr></table></div></figure>

<p>以前的版本用的CSS框架是<a href="http://blueprintcss.org/">Blueprint</a>，这次使用比它更方便快捷的<a href="https://github.com/twitter/bootstrap">Bootstrap</a>。Bootstrap建立在Less上，有个<a href="https://github.com/metaskills/less-rails-bootstrap">less-rails-bootstrap</a>，不过在安装libv8时竟然要提示缺少Python，拜托！我用的是Ruby，要我装Python，啥意思啊！还是找个Sass版的Bootstrap吧。</p>

<p>下载<a href="https://github.com/jlong/sass-twitter-bootstrap">sass-twitter-bootstrap</a>：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/jlong/sass-twitter-bootstrap.git</span></code></pre></td></tr></table></div></figure>

<p>将sass-twitter-bootstrap/lib中的文件拷贝到app/assets/stylesheets/twitter目录下。然后将app/assets/stylesheets/application.css中的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*= require_tree .</span></code></pre></td></tr></table></div></figure>

<p>修改为</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*= require twitter/bootstrap</span></code></pre></td></tr></table></div></figure>

<p>再在文件末尾添加：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>body { padding-top: 60px; }</span></code></pre></td></tr></table></div></figure>

<p>现在就可以使用Bootstrap来布局美化应用了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/progress-bar-does-not-work-when-reopen-progressdialog-using-showdialog/">使用showDialog()创建的ProgressDialog再次打开时进度条不变化</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-04-15T13:15:24+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>1:15 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>先来看段代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:layout_width="fill_parent"
</span><span class='line'>    android:layout_height="fill_parent"
</span><span class='line'>    android:orientation="vertical"&gt;
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="fill_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="Copy Contacts"
</span><span class='line'>        android:onClick="copyContacts" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import android.app.Activity;
</span><span class='line'>import android.app.Dialog;
</span><span class='line'>import android.app.ProgressDialog;
</span><span class='line'>import android.os.AsyncTask;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class DialogActivity extends Activity {
</span><span class='line'>    private static final int COPY_CONTACTS = 0;
</span><span class='line'>
</span><span class='line'>    private ProgressDialog mProgressDialog;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.main);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    public void copyContacts(View target) {
</span><span class='line'>        showDialog(COPY_CONTACTS);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected Dialog onCreateDialog(int id) {
</span><span class='line'>        switch (id) {
</span><span class='line'>        case COPY_CONTACTS:
</span><span class='line'>            mProgressDialog = new ProgressDialog(this);
</span><span class='line'>            mProgressDialog.setTitle("Copy contacts");
</span><span class='line'>            mProgressDialog.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
</span><span class='line'>            mProgressDialog.setMax(100);
</span><span class='line'>            new AsyncCopyContactsTask().execute();
</span><span class='line'>            break;
</span><span class='line'>        }
</span><span class='line'>        return mProgressDialog;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    private class AsyncCopyContactsTask extends AsyncTask&lt;Void, Void, Integer&gt; {
</span><span class='line'>        @Override
</span><span class='line'>        protected Integer doInBackground(Void... params) {
</span><span class='line'>            for (int i = 0; i &lt; 100; i++) {
</span><span class='line'>                try {
</span><span class='line'>                    Thread.sleep(100);
</span><span class='line'>                } catch (InterruptedException e) {
</span><span class='line'>                }
</span><span class='line'>                publishProgress();
</span><span class='line'>            }
</span><span class='line'>            return 0;
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        protected void onProgressUpdate(Void... progress) {
</span><span class='line'>            mProgressDialog.incrementProgressBy(1);
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        protected void onPostExecute(Integer result) {
</span><span class='line'>            mProgressDialog.dismiss();
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>第一次点击按钮会显示一个进度条，上面的数字处于变动当中，到达最大值后进度条会消失不见；再次点击按钮后，就会发现进度条上的数值和消失前相同，并且不再变化，而且进度条也不会消失。这是为什么呢？</p>

<p>Activity中有三个和对话框显示有关的方法：showDialog()，dismissDialog()和removeDialog()。其中showDialog()用于显示一个对话框；dismissDialog()使对话框消失，但仍然处于内存中，只是不显示而已，如果再次调用showDialog()方法，则缓存在内存中的对话框会重新显示，而不需要重新创建。removeDialog()使对话框消失，并从内存中将对话框清除，如果再次调用showDialog()来显示它，则在显示之前需要重新创建对话框。</p>

<p>在一个对话框的声明周期内，onCreateDialog()仅被调用一次，但onPrepareDialog()方法会每次被调用。比如，第一次调用 showDialog()方法显示某个对话框时，会先触发onCreateDialog()的执行，然后再触发onPrepareDialog()方法；如果将某个对话框 removeDialog()后再showDialog()，也会先触发onCreateDialog()，接着触发onPrepareDialog()方法；如果某个对话框是被dismiss()掉的，再调用 showDialog()方法来显示它时就不会触发onCreateDialog()方法的执行，只会触发onPrepareDialog()方法。</p>

<p>这是因为第一次调用showDialog()时，Android从你的Activity中调用onCreateDialog()方法，得到返回的Dialog对象。把当前Activity设置为该对话框的所有者，从而把对话框挂靠到Activity上，让Activity自动管理该对话框的状态。这样，下次调用showDialog()时就不用重新创建Dialog对象，而是复用旧的。</p>

<p>所以，解决再次打开ProgressDialog时进度条不变化的最好方法就是将mProgressDialog.dismiss()改成removeDialog(COPY_CONTACTS)。</p>

<p>注意：如果你决定在onCreateDialog()方法之外创建一个对话框，它将不会被附着到活动上。不过，你可以通过setOwnerActivity()把它附着到一个Activity上。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/steve-jobs-resignation-letter-to-apple/">史蒂夫·乔布斯的辞职信</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-03-13T12:20:03+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:20 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>英文原文：<a href="http://www.apple.com/pr/library/2011/08/24Letter-from-Steve-Jobs.html">http://www.apple.com/pr/library/2011/08/24Letter-from-Steve-Jobs.html</a></p>

<p>致苹果董事会和苹果社区：</p>

<p>我一直说，如果有一天我不能履行作为苹果CEO的职责和期望，我会第一个让你们知道。遗憾的是，这一天已经来临。</p>

<p>我在此辞去苹果CEO的职务。如果董事会同意，我将愿意担任董事长、董事或者苹果员工。</p>

<p>就我的继任者而言，我强烈建议执行我们的接班计划，任命Tim Cook为苹果的CEO。</p>

<p>我相信，苹果最辉煌和最具创新的日子就在前方。我期望在新的岗位看到它的成功，并为此做出自己的贡献。</p>

<p>在苹果，我结交了一些我一生中最好的朋友。谢谢你们大家，多年来能和你们一起工作。</p>

<p>史蒂夫</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/how-currency-wars-confuse-reader-opnion/">《货币战争》是如何混淆读者视听的</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-03-01T07:19:25+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2012</span></span> <span class='time'>7:19 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这是早就写好了的。《货币战争》刚发行就买过来读，结果看到三分之一的时候就看不下去，准备写篇文章驳斥书中的观点。下面是列出的提纲，不过因为文笔太差的缘故，一直没能把内容扩充起来，到现在也没了这个心思。这里把已经写的贴出来给大家看看吧。</p>

<ol>
<li>读者们喜欢阴谋论；</li>
<li>美联储是私有的从来就不是什么秘密。因为金融机构和公有还是私有无关，而是和财力及信用有关；</li>
<li>偷换概念，将金融家们的被动行为说成是主动行为，造成一种金融家们无所不能的环境；</li>
<li>放大作者想写的，缩小作者不想说的。只要是美国总统遇刺身亡就说是不符合金融家们的利益导致，那为什么不说别的国家呢？不要忘记军队掌握在谁的手中，给你个叛国罪啊什么的就能叫金融家们玩完，况且国家还有那么多秘密机构呢！想想希特勒时期的罗斯柴尔德家族吧。</li>
</ol>

<p>货币战争真实存在，亚洲金融风暴、索罗斯狙击英镑这些都是货币战争。金融家们能调动数亿万计的财富，确实也很强大，但是不应该把他们的能力无限放大。</p>

<p>对美联储性质感兴趣的可以到它的<a href="http://federalreserve.gov/">官方网站</a>看看。这里还有篇评论宋鸿兵和他书的文章：<a href="http://wenyidaobk.blog.163.com/blog/static/1243789052009712928966/">http://wenyidaobk.blog.163.com/blog/static/1243789052009712928966/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/daily-report-from-rejection-to-acceptance-then-love/">工作日志：从拒绝到接受再到喜欢</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-02-11T07:04:08+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>7:04 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>刚毕业，在苏州一家公司工作，需要写工作日志，心里不喜欢，但不得不写，每天应付了事。现在想来大概是因为不知道写什么，怎么写的缘故（自觉语言贫乏，感觉好多话要说，但写出来却是干巴巴的几句，所以对一切需要动笔的如思想汇报、工作小结、年终总结等都特别不乐意，更别提上学时候的写作文了）。</p>

<p>到第二家公司，刚开始不要写，后来公司作了调整就要写了，这时是不再拒绝，以一种无所谓的态度接受了。</p>

<p>在第三家后，也是开始不要写，后来调整要写，不过由于有具体的日志格式，所以对这个还是非常接受的。</p>

<p>今天凌晨醒来后睡不着，在床上胡思乱想，突然想到工作日志的事。从管理人员的角度思考了工作日志的问题，有了一些新的想法，发现工作日志其实是管理人员了解工作进度的这么一个东西。在一个项目组里，项目经理可以通过你每天的工作日志对你今天的工作有一个大致的了解，综合所有小组成员的工作日志就可以对项目所处的状态有个大约的概念。否则，每天只见你上班下班，坐在那里做事，但不知道你做了什么，做的怎么样，对项目状态不了解，项目就非常容易失控。</p>

<p>工作日志格式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[main content]
</span><span class='line'>今天做了什么，完成度怎么样？有哪些问题？
</span><span class='line'>明天的计划是什么？
</span><span class='line'>
</span><span class='line'>[questions]
</span><span class='line'>
</span><span class='line'>[suggestions]</span></code></pre></td></tr></table></div></figure>

<p>我觉得明天的计划这一项非常重要，通过明天的计划以及当天工作完成的情况我们就可以了解我们制定的计划是否合理有效。如果每天制定的计划都不能按时完成，那么说明自己对自己的能力估计过高，需要降低期望值。而项目经理可以通过某个组员一段时间内工作计划的完成度来了解组员的工作状态，如果组员一直处于计划不能按时完成状态，那么就要考虑是否要与组员沟通这个情况，帮助组员解决情况。</p>

<h3 id="为什么要有个工作日志系统，而不是采用邮件的方式？">为什么要有个工作日志系统，而不是采用邮件的方式？</h3>

<ol>
<li>有文字记录（这个邮件也可以做到）；</li>
<li>日志集中放置（这个邮件无法做到）；</li>
<li>可以通过分析日志得出一些有用的统计（这个邮件无法做到）。</li>
</ol>

<p>2014/12/23更新</p>

<p>其实把日志格式中的“今天”改成“昨天”，“明天”改成“今天”就是每日例会的模板了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/how-to-crack-huawei-hg526-telecom-cat/">如何破解华为HG526电信猫</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-01-15T12:56:43+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>把家里的电信从旧的4M套餐改为新的4M套餐，每月费用省了40多块，还送了个华为的HG526电信猫和iTV。拿到HG526后发现它带有无线路由功能，想着是不是可以让它自动拨号，以替换原来的ADSL猫和无线路由器。网上搜索一下，发现有很多教程，参考着资料一番实践，终于把设备给换了下来。这里做个笔记，把实践中碰到的问题和疑惑记录下来，分享给大家。</p>

<p>破解HG526的关键是获得超级用户telecomadmin的密码，通过以下步骤实现：</p>

<ol>
<li>准备U盘，在根目录下建立一个文件夹e8_Config_backup，插入华为HG526；</li>
<li>使用HG526的默认帐号（用户名useradmin）登录路由器192.168.1.1；</li>
<li>在浏览器地址栏里输入<code>http://192.168.1.1/html/ehomeclient/cfgUSBRestore.cgi?coverusbpath=usb1_1</code>回车（注意大小写），提示备份成功；</li>
<li>把U盘插入电脑，e8_Config_backup文件夹下多了一个文件ctce8_HG526.cfg；</li>
<li>用附件中的工具把配置文件解密，找到telecomadmin帐号的密码；</li>
<li>用超级用户telecomadmin登录，把远程管理关闭（不然密码就会被电信更改的）。</li>
</ol>

<p>路由拨号配置</p>

<p>登录后，进入“网络” -&gt; “宽带设置”，在“连接名称”右边，选择“INTERNET_R_8_35”，按照下图配置，修改自己的上网账号和密码。</p>

<p><img src="/uploads/hg526.png" alt="hg526"></p>

<p>这里有个问题，某些地方的VPI/VCI值是不一样的，本人所在区域值是0/100，所以上面应该选“INTERNET_B_0_100”。其它地方如果刷了不能用建议咨询下电信维护人员。</p>

<p>将破解的配置文件恢复到HG526中</p>

<p>在U盘的e8_Config_backup文件夹里放入破解修改后的ctce8_HG526.cfg文件，插入HG526。用超级用户登录，在“管理” -&gt; “设备管理”页面中，在“启用USB自动恢复配置文件”后面打上钩。然后点击“设备重启”。注意观察HG526以及U盘的指示灯，等HG526上所有的灯稳定了，配置也就刷进去了。</p>

<p>删除TR069协议，修改远程管理网址和域名</p>

<p>正常情况下“TR069_R_8_46”连接项在配置页面中无法删除，但我们可以使用Web Developer插件来做到。在安装了Web Developer插件的Firefox中访问路由器，用telecomadmin登录，进入“网络” -&gt; “宽带设置”，在页面中点击右键，在Web Developer工具栏中选择“表单” -&gt; “开启 被禁用的表单”。然后你就可以删除TR069协议了。远程管理的修改与之类似。</p>

<p>关于TR069的解释：TR-069是由DSL论坛所开发的技术规范之一，其全称为“CPE广域网管理协议”。它提供了对下一代网络中家庭网络设备进行管理配置的通用框架和协议，用于从网络侧对家庭网络中的网关、路由器、机顶盒等设备进行远程集中管理。电信通过TR069协议修改我们的无线猫的配置，比如超级用户名密码，用户权限等，所以我们的配置文件里要关闭TR069，大家注意不要自己打开，否则一旦被改了超级用户名密码就惨了！</p>

<p>HG526配置文件加/解密工具下载：<a href="https://github.com/dohkoos/hw-hg526">https://github.com/dohkoos/hw-hg526</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/7-ways-to-grow-the-action-habit/">7个方法养成立即行动的习惯</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-12-02T21:10:11+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2011</span></span> <span class='time'>9:10 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>英文原文：<a href="http://www.pickthebrain.com/blog/grow-the-action-habit/">http://www.pickthebrain.com/blog/grow-the-action-habit/</a></p>

<p>所有顶级成功人士都有一个共同的品质——那就是立即行动。这种品质可以取代智商、天赋和人际关系，来决定你的薪资范围和晋升速度。</p>

<p>尽管这个观念很简单，但是真正掌握它的人却是极少数。行动的习惯——把想法转换成立即行动的习惯——是完成任务必不可少的习惯。这里有7个方法让你养成立即行动的习惯：</p>

<h3 id="1-不要等到条件都完美了才行动">1. 不要等到条件都完美了才行动</h3>

<p>如果你想等条件都完美了才开始行动，你可能永远都不会开始。因为总是会有些事情不是那么好。或是错过时机，行情不好，或是竞争太激烈。现实世界中没有完美的开始时间。你必须立即行动，等问题出现时再去解决它。<a href="http://sethgodin.typepad.com/seths_blog/2006/11/when_to_start.html">开始行动的最佳时间是去年，其次便是现在。</a></p>

<h3 id="2-做个实干家">2. 做个实干家</h3>

<p>行动胜于空想。你想开始实践吗？你有没有好的创意要告诉老板？今天就行动起来吧。想法停留在你脑子里的时间越长，它就会变得越弱。几天之后，细节就会变得模糊。一周过去，你已经完全忘记它了。要想成为一名实干家，你需要做更多的事情，并且在此过程中激发新的想法。</p>

<h3 id="3-记住，想法本身并不能带来成功">3. 记住，想法本身并不能带来成功</h3>

<p>想法是很重要，但是它只有在被执行后才有价值。一个被付诸行动的平凡想法，比许多“某一天”或者“正确时机”再去实施的卓越创意更有价值。如果你有一个觉得真的很不错的想法，那么就去实现它。如果你不行动起来，那么这个想法永远不会被实现。</p>

<h3 id="4-用行动去克服恐惧">4. 用行动去克服恐惧</h3>

<p>你有没有注意到，在公众演讲中最恐惧的时刻是轮到你上场前那段等待的时刻？即使是专业的演讲者和演员也经历过表演前的焦虑。他们一旦开始，恐惧就会消失。行动是治疗恐惧的最佳方法。万事开头难。一旦行动起来，你将建立起自信，事情也会变得简单。通过行动来克服恐惧，通过行动来建立自信。</p>

<h3 id="5-机械地开启你的创造力">5. 机械地开启你的创造力</h3>

<p>人们对创造性工作的一大误解就是认为它只会在有灵感的时候产生。如果你一直等待灵感来敲门，那么你的作品就会很少。与其等待，不如机械地开启你的创造马达。如果你需要写些东西，那么强制自己坐下来后再写。笔尖在纸上滑动，思绪展开，开始写作，用你的笔激起你的伟大想法吧。</p>

<h3 id="6-先顾眼前">6. 先顾眼前</h3>

<p>把注意力集中在你当下可以做的事情上。不要去烦恼上周本该完成的事，也不要担心明天要完成的任务。你唯一能左右的时间就是现在。如果你过于考虑从前或者将来，你不会完成任何事情。明天或下周的事经常永远都不会发生。</p>

<h3 id="7-立即切入正题">7. 立即切入正题</h3>

<p>人们在开会前一般都会做些社交活动或着聊聊天。对于个体工作者也是如此。你在开始真正工作前多久会查看一次Email或RSS feeds呢？如果你不去绕过它们直接开始工作的话，这些分心的事情将会耗费你大量的时间。如果你做到了这点，你就会成为一个高效的人，别人也会把你当作领导者来看待。</p>

<p>没有上级的指示就采取行动，这需要勇气。或许这就是为何主动性是如此稀缺的才能，以至于大多数经理都在寻找这种人才。争取主动，当你有一个好的想法的时候，立即去实现它，不要等别人来告诉你。一旦人们看到你在很认真地完成事情，他们就会想要加入你。成功人士不需要别人告诉他们该做什么。如果你想成为这样的人，那就应该习惯独立行动。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/implement-bottom-toolbar-in-android/">实现Android底部工具栏</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-11-16T17:08:52+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>5:08 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在网上的大部分教程中，底部工具栏通常由TabHost和RadioGroup结合完成，每个工具栏项对应一个Activity。不过，我们要实现的是多个工具栏项在单独的一个Activity上起作用。</p>

<p><a href="http://www.cnblogs.com/figoyu/archive/2010/11/20/1882691.html">简单实现Android顶部工具栏和底部工具栏</a>就是这样的。不过该实现对每个工具栏项设置了固定宽度80dip，导致工具栏项或屏幕大小不定时代码布局会有问题。</p>

<p>这里对它做了些改进，使之能做到适应不定大小的工具栏项或屏幕。改进后的布局代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    android:layout_width="fill_parent"
</span><span class='line'>    android:layout_height="fill_parent"&gt;
</span><span class='line'>    &lt;LinearLayout
</span><span class='line'>        android:layout_width="fill_parent"
</span><span class='line'>        android:layout_height="0dip"
</span><span class='line'>        android:layout_weight="1.0"&gt;
</span><span class='line'>        &lt;ScrollView
</span><span class='line'>            android:layout_width="fill_parent"
</span><span class='line'>            android:layout_height="fill_parent"
</span><span class='line'>            android:scrollbars="vertical"
</span><span class='line'>            android:fadingEdge="vertical"&gt;
</span><span class='line'>            &lt;TextView
</span><span class='line'>                android:id="@+id/content"
</span><span class='line'>                android:layout_width="fill_parent"
</span><span class='line'>                android:layout_height="wrap_content"
</span><span class='line'>                android:textSize="17dip" /&gt;
</span><span class='line'>        &lt;/ScrollView&gt;
</span><span class='line'>    &lt;/LinearLayout&gt;
</span><span class='line'>
</span><span class='line'>    &lt;include layout="@layout/toolbar" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

<p>以下是工具栏toolbar.xml的布局代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:orientation="horizontal"
</span><span class='line'>    android:layout_width="fill_parent"
</span><span class='line'>    android:layout_height="wrap_content"
</span><span class='line'>    android:background="@drawable/toolbar_bg"&gt;
</span><span class='line'>    &lt;ImageButton
</span><span class='line'>        android:id="@+id/btn_index"
</span><span class='line'>        android:src="@drawable/index"
</span><span class='line'>        android:text="@string/index"
</span><span class='line'>        style="@style/toolbar" /&gt;
</span><span class='line'>    &lt;ImageButton
</span><span class='line'>        android:id="@+id/btn_prev"
</span><span class='line'>        android:src="@drawable/btn_prev_bg"
</span><span class='line'>        android:text="@string/prev"
</span><span class='line'>        style="@style/toolbar" /&gt;
</span><span class='line'>    &lt;ImageButton
</span><span class='line'>        android:id="@+id/btn_next"
</span><span class='line'>        android:src="@drawable/btn_next_bg"
</span><span class='line'>        android:text="@string/next"
</span><span class='line'>        style="@style/toolbar" /&gt;
</span><span class='line'>    &lt;ImageButton
</span><span class='line'>        android:id="@+id/btn_zoomin"
</span><span class='line'>        android:src="@drawable/zoomin"
</span><span class='line'>        android:text="@string/zoomin"
</span><span class='line'>        style="@style/toolbar" /&gt;
</span><span class='line'>    &lt;ImageButton
</span><span class='line'>        android:id="@+id/btn_zoomout"
</span><span class='line'>        android:src="@drawable/zoomout"
</span><span class='line'>        android:text="@string/zoomout"
</span><span class='line'>        style="@style/toolbar" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/create-maven-archetype-from-existing-project/">从已有项目创建Maven archetype</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-10-12T16:19:04+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>4:19 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>手里有这样的一个项目，其它项目都基于该项目创建，只是对包名做些修改，还有就是替换部分图片和文本内容。每次手工重复类似的修改工作很是繁琐，简直让人发指，需要寻找自动化的解决方案。</p>

<p>Maven界有这么一句话：遇到重复的Maven项目初始配置，就创建自己的archetype。其实不光是Maven项目，其它也是如此。《测试驱动开发》中有个Triangulation法则，《重构》中也有Rule of three，都是用来指导如何解决类似重复问题的。第一次是特殊解决，第二次还是特殊解决，第三次就要抽象解决了。</p>

<p>Maven Archetype Plugin允许从当前存在的项目创建archetype，这样以后用户就可以基于该archetype创建项目了。</p>

<p><img src="/uploads/archetype-overview.png" alt="archetype-overview"></p>

<p>那么如何通过现有的项目创建archetype呢？首先清理项目中那些不必要的文件和目录，然后在根目录下执行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn archetype:create-from-project
</span><span class='line'>cd target/generated-sources/archetype
</span><span class='line'>mvn clean install  # 本地安装</span></code></pre></td></tr></table></div></figure>

<p>现在就可以使用上面创建的archetype来建立新项目了。在新的目录中执行以下命令即可：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn archetype:generate                          \
</span><span class='line'>  -DarchetypeCatalog=local                      \
</span><span class='line'>  -DarchetypeGroupId=&lt;archetype-groupId&gt;        \
</span><span class='line'>  -DarchetypeArtifactId=&lt;archetype-artifactId&gt;  \
</span><span class='line'>  -DgroupId=&lt;your-groupId&gt;                      \
</span><span class='line'>  -DartifactId=&lt;your-artifactId&gt;                \
</span><span class='line'>  -Dpackage=&lt;your-package&gt;                      \
</span><span class='line'>  -Dversion=1.0</span></code></pre></td></tr></table></div></figure>

<p>这里要注意的是，不要在target/generated-sources/archetype目录下运行上述命令，否则会生成失败，报如下错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[ERROR] Failed to execute goal archetype:generate:
</span><span class='line'>  org.apache.maven.archetype.exception.InvalidPackaging:
</span><span class='line'>  Unable to add module to the current project as it is not of packaging type 'pom'</span></code></pre></td></tr></table></div></figure>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/using-open-flash-chart-ii-in-rails/">在Rails中使用Open Flash Chart II</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-09-23T15:08:12+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2011</span></span> <span class='time'>3:08 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天我们讲如何用Rails结合Open Flash Chart II（以下简称OFC2）实现如下的图表：</p>

<p><img src="/uploads/ofc2-glassbar.png" alt="ofc2-glassbar"></p>

<p>在项目中安装OFC2插件，生成相关控制器：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>script/plugin install git://github.com/pullmonkey/open_flash_chart.git
</span><span class='line'>script/generate controller stats index</span></code></pre></td></tr></table></div></figure>

<p>在生成的app/controllers/stats_controller.rb中添加以下代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class StatsController &lt; ApplicationController
</span><span class='line'>  def index
</span><span class='line'>    @graph = open_flash_chart_object(500, 300, "/stats/graph_code")
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  def graph_code
</span><span class='line'>    title = Title.new("Glass Bar")
</span><span class='line'>
</span><span class='line'>    bar = BarGlass.new
</span><span class='line'>    bar.set_values([-1,2,3,7,8,-7.3])
</span><span class='line'>
</span><span class='line'>    y = YAxis.new
</span><span class='line'>    y.set_range(-10, 10, 5)
</span><span class='line'>
</span><span class='line'>    chart = OpenFlashChart.new
</span><span class='line'>    chart.y_axis = y
</span><span class='line'>    chart.set_title(title)
</span><span class='line'>    chart.add_element(bar)
</span><span class='line'>    render :text =&gt; chart.to_s
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>

<p>在config/routes.rb中添加路由：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>match 'stats/graph_code' =&gt; 'stats#graph_code'</span></code></pre></td></tr></table></div></figure>

<p>将插件中的assets/javascripts/swfobject.js拷贝到public/javascripts目录下（可以看到该目录下已经有两个open-flash-chart开头的swf文件，如果没有的话，需要从插件中拷过来）。在相应的app/views/stats/index.html中添加如下代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script src="/javascripts/swfobject.js" type="text/javascript"&gt;&lt;/script&gt;
</span><span class='line'>
</span><span class='line'>&lt;%= @graph %&gt;</span></code></pre></td></tr></table></div></figure>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/14">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/12">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/rnn-effectiveness/">循环神经网络不可思议的效用</a>
      </li>
    
      <li class="post">
        <a href="/blog/how-to-verify-mailbox-exist/">如何验证邮箱是否存在？</a>
      </li>
    
      <li class="post">
        <a href="/blog/crawl-novel-with-scrapy-part6/">使用Scrapy爬取小说（6）</a>
      </li>
    
      <li class="post">
        <a href="/blog/crawl-novel-with-scrapy-part5/">使用Scrapy爬取小说（5）</a>
      </li>
    
      <li class="post">
        <a href="/blog/crawl-novel-with-scrapy-part4/">使用Scrapy爬取小说（4）</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Recent Comments</h1>
  <div class="dsq-widget">
    <script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"></script>
  </div>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 138%" href="/tags/antlr/">ANTLR</a>
<a style="font-size: 106%" href="/tags/algorithm/">Algorithm</a>
<a style="font-size: 131%" href="/tags/android/">Android</a>
<a style="font-size: 96%" href="/tags/c-plus-plus/">C++</a>
<a style="font-size: 106%" href="/tags/css/">CSS</a>
<a style="font-size: 91%" href="/tags/crack/">Crack</a>
<a style="font-size: 96%" href="/tags/crawler/">Crawler</a>
<a style="font-size: 96%" href="/tags/database/">Database</a>
<a style="font-size: 114%" href="/tags/git/">Git</a>
<a style="font-size: 100%" href="/tags/html/">HTML</a>
<a style="font-size: 103%" href="/tags/jbookshelf/">JBookShelf</a>
<a style="font-size: 137%" href="/tags/java/">Java</a>
<a style="font-size: 100%" href="/tags/javascript/">JavaScript</a>
<a style="font-size: 96%" href="/tags/listview/">ListView</a>
<a style="font-size: 96%" href="/tags/mysql/">MySQL</a>
<a style="font-size: 103%" href="/tags/paperclip/">Paperclip</a>
<a style="font-size: 96%" href="/tags/python/">Python</a>
<a style="font-size: 116%" href="/tags/qianbao/">Qianbao</a>
<a style="font-size: 150%" href="/tags/rails/">Rails</a>
<a style="font-size: 117%" href="/tags/ruby/">Ruby</a>
<a style="font-size: 96%" href="/tags/scrapy/">Scrapy</a>
<a style="font-size: 91%" href="/tags/spring/">Spring</a>
<a style="font-size: 100%" href="/tags/struts/">Struts</a>
<a style="font-size: 146%" href="/tags/translation/">Translation</a>
<a style="font-size: 96%" href="/tags/ubuntu/">Ubuntu</a>
<a style="font-size: 103%" href="/tags/windows-server-2008/">Windows Server 2008</a>
<a style="font-size: 106%" href="/tags/wxwidgets/">wxWidgets</a>

  </ul>
</section>
<section>
  <h1>Blogroll</h1>
  <ul>
    <li><a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a></li>
    <li><a href="http://www.importnew.com/">ImportNew</a></li>
    <li><a href="http://ifeve.com/">并发编程网</a></li>
    <li><a href="http://codingnow.com/">云风的 BLOG</a></li>
    <li><a href="http://dbanotes.net/">DBA Notes</a></li>
    <li><a href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a></li>
    <li><a href="http://advdbg.org/">高端调试</a></li>
    <li><a href="http://www.cs.usfca.edu/~galles/visualization/Algorithms.html">Data Structure Visualization</a></li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/dohkoos">@dohkoos</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dohkoos',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  <div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</div>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - dohkoos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codemany';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
