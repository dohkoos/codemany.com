<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[乐者为王]]></title>
  <link href="http://codemany.com/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-08-24T18:55:48+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Nokogiri抓取页面URL含有中文参数的问题]]></title>
    <link href="http://codemany.com/blog/2014/07/17/problem-with-nokogiri-when-url-containing-chinese-character/"/>
    <updated>2014-07-17T22:48:00+08:00</updated>
    <id>http://codemany.com/blog/2014/07/17/problem-with-nokogiri-when-url-containing-chinese-character</id>
    <content type="html"><![CDATA[<p>使用Nokogiri抓取某网站的长江现货数据，被抓取页面的URL中含有中文参数，使用以下的代码抓取数据失败：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url = 'http://example.com/search.asp?type=长江有色&sort=asc'
</span><span class='line'>doc = Nokogiri::HTML(open(url))</span></code></pre></td></tr></table></div></figure>


<p>据 <a href="http://dingr.iteye.com/blog/647244">http://dingr.iteye.com/blog/647244</a> 讲是因为浏览器给服务器发送参数的时候是经过编码的，按照该文的意思试着也给URL里的中文编了下码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url = 'http://example.com/search.asp?type=长江有色&sort=asc'
</span><span class='line'>url = URI.escape(url)
</span><span class='line'>doc = Nokogiri::HTML(open(url))</span></code></pre></td></tr></table></div></figure>


<p>结果还是抓取失败。查看URL的编码信息：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>puts url.encoding  # 输出utf-8</span></code></pre></td></tr></table></div></figure>


<p>网站页面采用的是GB2132编码，猜测网站后台处理数据时很有可能也是采用的GB2132。做个实验就清楚了，将URL转成GB2132后再编码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url = 'http://example.com/search.asp?type=长江有色&sort=asc'
</span><span class='line'>url = url.encode('gbk', 'utf-8')
</span><span class='line'>url = URI.escape(url)
</span><span class='line'>doc = Nokogiri::HTML(open(url))</span></code></pre></td></tr></table></div></figure>


<p>发现果然OK了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[逻辑题-几条病狗]]></title>
    <link href="http://codemany.com/blog/2014/07/09/logic-problems-how-many-sick-dogs/"/>
    <updated>2014-07-09T19:35:00+08:00</updated>
    <id>http://codemany.com/blog/2014/07/09/logic-problems-how-many-sick-dogs</id>
    <content type="html"><![CDATA[<p>村子中有50个人，每人有一条狗，在这50条狗中有病狗（这种病不会传染），于是人们就要找出病狗，每个人可以观察其他49条狗，以判断它们是否生病，只有自己的狗不能看。观察后得到的结果不得交流，也不能通知病狗的主人。主人一旦推算出自己家的是病狗就要枪毙自己的狗，而且每个人只有权利枪毙自己的狗，没有权利打死其他人的狗。第一天，第二天都没有枪响，到了第三天传来一阵枪响，问有几条病狗？</p>

<p>推论：</p>

<p>A、假设有1条病狗，病狗的主人会看到其他狗都没有病，那么就知道自己的狗有病，所以第一天晚上就会有枪响。因为没有枪响，说明病狗数大于1。</p>

<p>B、假设有2条病狗，病狗的主人会看到有1条病狗，因为第一天没有听到枪响，是病狗数大于1，所以病狗的主人会知道自己的狗是病狗，因而第二天会有枪响。既然第二天也没有枪响，说明病狗数大于2。</p>

<p>由此推理，如果第三天枪响，则有3条病狗，第n天枪响，则有n条病狗。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Pry调试Rails项目]]></title>
    <link href="http://codemany.com/blog/2014/07/07/debugging-rails-with-pry/"/>
    <updated>2014-07-07T23:26:08+08:00</updated>
    <id>http://codemany.com/blog/2014/07/07/debugging-rails-with-pry</id>
    <content type="html"><![CDATA[<p>调试Rails程序的工具有ruby-debug、irb、rails-console等，不过现在这些工具都可以歇着了，因为有了Pry。</p>

<p>首先，在Gemfile中申明gem包：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'pry', group: :development</span></code></pre></td></tr></table></div></figure>


<p>然后执行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install</span></code></pre></td></tr></table></div></figure>


<p>用Pry代替irb，直接运行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pry</span></code></pre></td></tr></table></div></figure>


<p>用Pry代替rails console，运行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pry -r ./config/environment.rb</span></code></pre></td></tr></table></div></figure>


<p>调试Rails项目时，在需要调试的地方添加binding.pry，当rails server运行到这行代码时会自动调出一个pry终端，可以在这里进行交互，退出调试用exit-all。例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def index
</span><span class='line'>  @articles = Article.all
</span><span class='line'>  binding.pry
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>可以使用exit-program命令无条件地退出循环。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(1..100).each do |i|
</span><span class='line'>  binding.pry
</span><span class='line'>  puts i
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Pry默认没有调试中经常用到的上一步，下一步等命令，可以安装pry-nav，然后就可以使用step, next, continue跳来跳去了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[敏捷开发走下坡路了吗？]]></title>
    <link href="http://codemany.com/blog/2013/05/19/agile-decline/"/>
    <updated>2013-05-19T12:36:14+08:00</updated>
    <id>http://codemany.com/blog/2013/05/19/agile-decline</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://thatextramile.be/blog/2008/11/agile-development-going-downhill">http://thatextramile.be/blog/2008/11/agile-development-going-downhill</a></p>

<p>James Shore（非常精彩的书《<a href="http://thatextramile.be/blog/2008/05/the-art-of-agile-development/">The Art Of Agile Development</a>》的作者）在他的博客上写了一篇很有趣的帖子：<a href="http://jamesshore.com/Blog/The-Decline-and-Fall-of-Agile.html">The Decline And Fall Of Agile</a>。你绝对应该读读它。</p>

<p>我想我同意James的观点。在过去的几年里，我已经听到了很多的人说他们在做敏捷开发，实际上，他们几乎都不是。引用James的话：</p>

<blockquote><p>But guess which part people adopt? That&#8217;s right&#8211;Sprints and Scrums. Rapid cycles, but none of the good stuff that makes rapid cycles sustainable.</p></blockquote>

<p>不幸的是，这是非常真实的。现在许多团队都在进行短迭代工作，很多团队也在做每日例会，或Scrum，或站立会议。但是，有多少人事实上致力于使敏捷开发成功的技术实践和原则呢？老实说，我一个也没见过。</p>

<p>我是一个真正的敏捷开发的铁杆迷，但即使在我现在的工作中，我最近的两个团队也没有完全正确地实现它。我们的研究结果虽然还不错，但我认为我们仍然可以做得更好。我逐渐尝试引入更多的原则和实践，但它确实需要一些时间。但是，所有这些关于敏捷开发的误解，所以很多人（开发人员，项目经理等）有没有真正帮助。在我当前的工作中，这些误解是非常小的，他们并不真正有不良影响。以前在客户那里，我确实注意到这些误解是如何导致异常低效的情况。其实这是非常伤心的，因为迟早经理可能会对敏捷方法持怀疑态度。如果这导致人们放弃一些技术实践和原则，对这个事业来说将会是一个相当大的损失。</p>

<p>我觉得有更多的理由去读James的那本出色的书。如果我可以合法地迫使人们去阅读这本书，我会的:)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[绘制圆角的正确方法]]></title>
    <link href="http://codemany.com/blog/2013/04/11/the-proper-way-to-draw-rounded-corners/"/>
    <updated>2013-04-11T14:59:45+08:00</updated>
    <id>http://codemany.com/blog/2013/04/11/the-proper-way-to-draw-rounded-corners</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://www.usabilitypost.com/2009/01/26/the-proper-way-to-draw-rounded-corners/">http://www.usabilitypost.com/2009/01/26/the-proper-way-to-draw-rounded-corners/</a></p>

<p>在网络上，我已经注意到当人们在他们的设计中实现圆角时犯了很多同样的错误。因为某些原因，当有另外一个圆角在它里面的时候，这个圆角会带来一个问题—无论是有一个围绕周围的边界，还是另一个圆角形状坐落在一个圆角形状内。</p>

<p>这里是我要说的：</p>

<p><img src="http://codemany.com/uploads/bad-corner.png" title="bad-corner" ></p>

<p>我看到了很多这种类型的圆角。您可以看到圆角的半径和内圆角的是相同的。这是错误的，因为如果你保持相同半径，两个拐角之间的空间量不会自始至终相等。</p>

<p>下面是相等间距看起来的样子：</p>

<p><img src="http://codemany.com/uploads/good-corner.png" title="good-corner" ></p>

<p>这是正确的做法。有什么不同？内角的半径被减小了。好吧，但你怎么知道半径应该有多大？这很简单—如果你把外面的圆角想象成一个圆形，你可以看到它的圆心在哪里。</p>

<p><img src="http://codemany.com/uploads/corner-center.png" title="corner-center" ></p>

<p>把这个圆心同样地作为内角的圆心，你就会得到内角的半径。使用这种方法将确保两个形状之间的完美契合。</p>

<p><img src="http://codemany.com/uploads/good-corner-ruler.png" title="good-corner-ruler" ></p>

<p>现在你知道了吧？这是做多个圆角彼此包含的正确办法。当然，不需要你使用精确的圆心—有时为了设计良好还需要你移动一点点。但请不要仅仅把相同的圆角向内移动—这是绝对错误的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[逻辑题-老师的生日]]></title>
    <link href="http://codemany.com/blog/2013/03/13/logic-problems-the-teachers-birthday/"/>
    <updated>2013-03-13T10:01:28+08:00</updated>
    <id>http://codemany.com/blog/2013/03/13/logic-problems-the-teachers-birthday</id>
    <content type="html"><![CDATA[<p>小明和小强都是某老师的学生，老师的生日是M月N日，他们都知道老师的生日是以下十组中的一个。老师把M告诉了小明，把N告诉了小强，然后问他们是否知道自己的生日。小明说“如果我不知道小强也不知道”，小强说“本来我不知道，你说了这话我就知道了”，小明说“那我也知道了 ”。问老师的生日是以下的哪个？</p>

<p>3/4, 3/5, 3/8, 6/4, 6/7, 9/1, 9/5, 12/1, 12/2, 12/8</p>

<p>按M排：<br />
3/4, 3/5, 3/8<br />
6/4, 6/7<br />
9/1, 9/5<br />
12/1, 12/2, 12/8</p>

<p>按N排：<br />
9/1, 12/1<br />
12/2<br />
3/4, 6/4<br />
3/5, 9/5<br />
6/7<br />
3/8, 12/8</p>

<p>条件一：小明说“如果我不知道小强也不知道”<br />
分析：因为M都是重复的，所以小明一定不知道。小明知道M以后肯定小强不知道，说明N肯定也是重复，可以剔除12/2和6/7这两个日期。另外，还可以排队N为2与7所对应的月份，因为当老师生日的M为6或12时，小强是有可能知道的，与已知条件相违背。<br />
结果：3/4, 3/5, 3/8, 9/1, 9/5</p>

<p>按M排：<br />
3/4, 3/5, 3/8<br />
9/1, 9/5</p>

<p>按N排：<br />
3/4<br />
3/5, 9/5<br />
3/8<br />
9/1</p>

<p>条件二：小强说“本来我不知道，你说了这话我就知道了”<br />
分析：根据上面的结果和条件二可以知道，现在N一定不能是重复的，可以把3/5和9/5排除。<br />
结果：3/4, 3/8, 9/1</p>

<p>按M排：<br />
3/4, 3/8<br />
9/1</p>

<p>按N排：<br />
3/4<br />
3/8<br />
9/1</p>

<p>条件三：小明说“那我也知道了”<br />
分析：综合条件二的结果和条件三可以判定现在M应该是单一的，所以只能是9。<br />
结果：9/1</p>

<p>老师的生日为9/1。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我们真的需要接口命名规范吗？]]></title>
    <link href="http://codemany.com/blog/2013/02/24/do-we-really-need-naming-conventions-for-interfaces/"/>
    <updated>2013-02-24T13:34:04+08:00</updated>
    <id>http://codemany.com/blog/2013/02/24/do-we-really-need-naming-conventions-for-interfaces</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://www.adam-bien.com/roller/abien/entry/in_the_age_of_dryness">http://www.adam-bien.com/roller/abien/entry/in_the_age_of_dryness</a></p>

<p>译者：感觉这篇文章讲的不错，也不算太长，就翻译了过来。</p>

<p>在过去的项目/审查中我发现了如下的接口及其实现的命名规范：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>IService service = new Service();
</span><span class='line'>
</span><span class='line'>Service service = new ServiceImpl();
</span><span class='line'>
</span><span class='line'>ServiceIF service = new Service();</span></code></pre></td></tr></table></div></figure>


<p>每一条都含有多余信息。无论是强调接口或其实现，相关信息都已经包含在代码中，所以都是多余的。这种命名规范仅当你真的不知道如何命名实现的时候才需要，作为去思考一个名称的替代，它更容易依靠现有的模板。</p>

<p>实现名称的缺乏可能也是作为它的非充分责任的一个指标（an indicator for it&#8217;s unsufficient responsibilities）。因此，如果你找不到一个适当的实现名称，考虑移除接口直接暴露实现可能是个好主意－没有奇怪的规范。实际上JDK中没有这样的规范，接口及其实现也经常称为不同（are often even called differently）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Runnable r = new Thread();
</span><span class='line'>
</span><span class='line'>RootPaneContainer c = new JFrame();
</span><span class='line'>
</span><span class='line'>TableModel t = new DefaultTableModel();
</span><span class='line'>
</span><span class='line'>Remote remote = new UnicastRemoteObject();</span></code></pre></td></tr></table></div></figure>


<p>接口的目的是抽象或从几个实现解耦。一个单一的实现并不需要通过接口来解耦。也有一些例外的规则，如需要使用动态代理等。</p>

<p>通过单个的，有着奇怪命名规范的实现（implementation）来实现（realize）一个接口不应该被认为是一般的最佳实践&#8230;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[逻辑题-100盏电灯]]></title>
    <link href="http://codemany.com/blog/2013/02/24/logic-problems-100-lamps/"/>
    <updated>2013-02-24T08:56:21+08:00</updated>
    <id>http://codemany.com/blog/2013/02/24/logic-problems-100-lamps</id>
    <content type="html"><![CDATA[<p>房间里有100盏电灯，编号为1，2，3&#8230;100，每盏灯上有一个按钮，初始时灯全都是关的。</p>

<p>编好号的100位同学由房间外依次走进去，将自己编号的倍数的灯的按钮全部按一次，例如第一位同学把编号是1的倍数的灯的按钮按一下（此时100盏灯全亮），第二位同学把编号是2的倍数的灯的按钮按一下（此时只有50盏灯亮着，50盏被这个人按灭了）&#8230;第100位同学把编号是100的倍数的灯（即编号为100的灯）的按钮按一下，请问依次走完后，还有多少盏灯亮着？</p>

<p>解题思路：<br />
被按过奇数次的灯亮着，偶数次的灯关了。<br />
因为每个同学会把自己编号的倍数的灯全部按一次，所以：<br />
1号灯会被1号同学按下；<br />
2号灯会被1，2号同学按下；<br />
3号灯会被1，3号同学按下；<br />
4号灯会被1，2，4号同学按下；<br />
&#8230;<br />
10号灯会被1，2，5，10号同学按下；<br />
&#8230;</p>

<p>从上面可以总结出n号灯会被以它所有约数为编号的同学按下。</p>

<p>这样，问题就变成了求每盏灯的编号有多少个约数的数学问题。如果约数个数为奇数，灯亮着；反之，灯关着。</p>

<p>Ruby代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Light state: ON/OFF = true/false
</span><span class='line'>lamps = Array.new(100, false)
</span><span class='line'>
</span><span class='line'>1.upto(lamps.length) do |lno|
</span><span class='line'>  1.upto(lno) do |fno|
</span><span class='line'>    lamps[lno - 1] = !lamps[lno - 1] if lno % fno == 0
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>lamps.each_index do |i|
</span><span class='line'>  print "Light #{i + 1} is "
</span><span class='line'>  puts lamps[i] ? "ON" : "OFF"
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>最后，我们会发现编号1，4，9，16，25&#8230;100的灯是亮着的，其它都是灭的。即编号值可以开出整数平方根的灯是亮的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何从数组中抽取随机不重复的数字]]></title>
    <link href="http://codemany.com/blog/2012/12/06/how-to-extract-random-digit-without-replacement-from-array/"/>
    <updated>2012-12-06T05:49:29+08:00</updated>
    <id>http://codemany.com/blog/2012/12/06/how-to-extract-random-digit-without-replacement-from-array</id>
    <content type="html"><![CDATA[<p>今天浏览订阅的博客时发现了一个巧妙的从数组中抽取随机不重复数字的算法。譬如，在100个不重复的数字中选择10个不相同的数字，通过这个算法就不需要修改数组长度和删除数组元素等。具体算法如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int[] numbers = new int[100];
</span><span class='line'>int[] selected = new int[10];
</span><span class='line'>
</span><span class='line'>for (int i = 0, n = numbers.length; i &lt; selected.length; i++) {
</span><span class='line'>    int idx = (int)(Math.random() * n);    // 随机产生一个从0 - (n-1)的数字
</span><span class='line'>    selected[i] = numbers[idx];
</span><span class='line'>    numbers[idx] = numbers[n - 1];
</span><span class='line'>    n--;    // 减1，从而在下次循环时产生的随机的numbers数组下标的范围从0 - (n-1)-1，
</span><span class='line'>            // 保证了上一步中已经赋值给数组中其它数的numbers[n-1]不会在下次循环中给
</span><span class='line'>            // 取得，确保了产生的数组selected中的数为不重复的。
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CSS命名规范]]></title>
    <link href="http://codemany.com/blog/2012/07/28/css-naming-conventions/"/>
    <updated>2012-07-28T02:27:06+08:00</updated>
    <id>http://codemany.com/blog/2012/07/28/css-naming-conventions</id>
    <content type="html"><![CDATA[<p>收集了网上的一些CSS命名规范，根据自己的理解和需求整理了一遍。</p>

<p>1、布局（layout）</p>

<ul>
<li>container 就是将页面中的所有元素包在一起的部分</li>
<li>header 页面的头部区域，包含站点的logo和一些其他元素</li>
<li>navbar 横向导航栏，最典型的网页元素</li>
<li>breadcrumbs 即页面所处位置的导航提示</li>
<li>content 是站点的主要区域</li>
<li>sidebar</li>
<li>footer</li>
</ul>


<p>2、头部（header）</p>

<ul>
<li>logo</li>
<li>tagline</li>
</ul>


<p>3、导航栏（navbar）</p>

<ul>
<li>mainnav</li>
<li>subnav</li>
<li>topnav</li>
</ul>


<p>4、侧边栏（sidebar）</p>

<ul>
<li>menu 包含一般的链接。sidebar中可以包含多个menu</li>
</ul>


<p>5、常用</p>

<ul>
<li>userbar 登录注册条</li>
<li>copyright</li>
<li>banner</li>
<li>feature</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SQL连接的总结]]></title>
    <link href="http://codemany.com/blog/2012/07/02/summary-of-the-sql-joins/"/>
    <updated>2012-07-02T09:44:51+08:00</updated>
    <id>http://codemany.com/blog/2012/07/02/summary-of-the-sql-joins</id>
    <content type="html"><![CDATA[<p>连接（join）可以在SELECT语句的FROM子句或WHERE子句中建立，在FROM子句中指出连接时有助于将连接操作与WHERE子句中的搜索条件区分开来。连接可以对同一个表操作，也可以对多个表操作，对同一个表操作的连接称为自连接（self join）。</p>

<p>连接类型（join type）分为三种：内连接、外连接和交叉连接。</p>

<ul>
<li>内连接（inner join）：使用比较运算符进行表间某（些）列数据的比较操作，并列出这些表中与连接条件相匹配的数据行。</li>
<li>外连接（outer join）：与内连接不同的是外连接不只列出与连接条件相匹配的行，而且列出左表（左外连接时）、右表（右外连接时）或两个表（全外连接时）中所有符合条件的数据行。</li>
<li>交叉连接（cross join）：返回连接表中所有数据行的笛卡尔积。</li>
</ul>


<p>内链接分为等值连接和不等连接：</p>

<ul>
<li>等值连接（equijoin）：在连接条件中使用等于（=）运算符比较被连接列的列值，其查询结果中列出被连接表中的所有列，包括其中的重复列。</li>
<li>不等连接（non-equijoin）：在连接条件使用除等于运算符以外的其它比较运算符比较被连接的列的列值。</li>
</ul>


<p>注意：自然连接（natural join）是一种特殊的等值连接。它使用选择列表指出查询结果中所包括的列，由此删除连接表中的重复列。</p>

<p>books数据表：</p>

<p><img src="http://codemany.com/uploads/books.png" title="books" ></p>

<p>publishers数据表：</p>

<p><img src="http://codemany.com/uploads/publishers.png" title="publishers" ></p>

<p>自连接查询：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from books b1 [inner] join books b2 on b1.price = b2.price</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/self-join.png" title="self-join" ></p>

<p>内连接（简称连接）查询：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from books b [inner] join publishers p on b.publisher_id = p.publisher_id</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/inner-join.png" title="inner-join" ></p>

<p>自然连接查询：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select b.*, p.name from books b [inner] join publishers p on b.publisher_id = p.publisher_id</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/natural-join.png" title="natural-join" ></p>

<p>左外连接（简称左连接）查询：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from books b left [outer] join publishers p on b.publisher_id = p.publisher_id</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/left-outer-join.png" title="left-outer-join" ></p>

<p>右外连接（简称右连接）查询：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from books b right [outer] join publishers p on b.publisher_id = p.publisher_id</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/right-outer-join.png" title="right-outer-join" ></p>

<p>全外连接（简称全连接）查询：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from books b full [outer] join publishers p on b.publisher_id = p.publisher_id</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/full-outer-join.png" title="full-outer-join" ></p>

<p>交叉连接查询：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>select * from books cross join publishers</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/cross-join.png" title="cross-join" ></p>

<p>下图是由Moffatt在2008年制作的连接集合表示：</p>

<p><img src="http://codemany.com/uploads/sql-joins.jpg" title="sql-joins" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[用Rails 3.2打造简单记账应用]]></title>
    <link href="http://codemany.com/blog/2012/04/18/using-rails32-to-create-a-simple-accounting-application/"/>
    <updated>2012-04-18T07:49:27+08:00</updated>
    <id>http://codemany.com/blog/2012/04/18/using-rails32-to-create-a-simple-accounting-application</id>
    <content type="html"><![CDATA[<p>Rails已经到3.2版本了，和以前的2.3版本有了很大的不同，决定把原来老版本的记账应用重新写一遍，更新部分插件。</p>

<p>记账应用的核心功能：</p>

<ol>
<li>可以输入花钱的记录；</li>
<li>可以修改输入了的记录；</li>
<li>可以删除输入了的记录；</li>
<li>可以显示所有的记录。</li>
</ol>


<p>创建项目</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails new qianbao
</span><span class='line'>cd qianbao
</span><span class='line'>rails g scaffold entry amount:decimal tags:string effective_date:date
</span><span class='line'>rails g controller home index</span></code></pre></td></tr></table></div></figure>


<p>删除public/index.html，在config/routes.rb中添加根路由：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root :to =&gt; 'home#index'</span></code></pre></td></tr></table></div></figure>


<p>现在要给应用加上一个认证系统（注册、激活、登录、登出），这次使用devise（<a href="https://github.com/plataformatec/devise%EF%BC%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0%E3%80%82">https://github.com/plataformatec/devise%EF%BC%89%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0%E3%80%82</a></p>

<p>在Gemfile中添加：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'devise'</span></code></pre></td></tr></table></div></figure>


<p>然后执行下列命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install
</span><span class='line'>rails g devise:install
</span><span class='line'>rails g devise user
</span><span class='line'>rails g devise:views</span></code></pre></td></tr></table></div></figure>


<p>创建一个migration，把User和Entry关联起来：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class AddUserToEntry &lt; ActiveRecord::Migration
</span><span class='line'>  def change
</span><span class='line'>    add_column :entries, :user_id, :integer
</span><span class='line'>
</span><span class='line'>    add_index :entries, :user_id
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>修改Entry和User模型：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Entry &lt; ActiveRecord::Base
</span><span class='line'>  validates :effective_date, :presence =&gt; true
</span><span class='line'>  validates :amount,         :presence =&gt; true,
</span><span class='line'>                             :numericality =&gt; {:greater_than =&gt; 0.0},
</span><span class='line'>                             :format =&gt; {:with =&gt; /^\d+??(?:\.\d{0,2})?$/}
</span><span class='line'>  validates :tags,           :presence =&gt; true,
</span><span class='line'>                             :length =&gt; { :within =&gt; 1..255 }
</span><span class='line'>                             
</span><span class='line'>  belongs_to :user</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class User &lt; ActiveRecord::Base
</span><span class='line'>  has_many :users</span></code></pre></td></tr></table></div></figure>


<p>修改app/views/home/index.html.erb为如下内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;h1&gt;Welcom to Qianbao!&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;% if user_signed_in? %&gt;
</span><span class='line'>  &lt;p&gt;
</span><span class='line'>    &lt;strong&gt;&lt;%=link_to current_user.email, edit_user_registration_path %&gt;&lt;/strong&gt;
</span><span class='line'>    &lt;%= link_to 'Logout', destroy_user_session_path, :method =&gt; :delete %&gt;
</span><span class='line'>  &lt;/p&gt;
</span><span class='line'>  &lt;%= link_to "All Entries", entries_path %&gt;
</span><span class='line'>&lt;% else %&gt;
</span><span class='line'>  &lt;p&gt;
</span><span class='line'>    &lt;strong&gt;You are currently not logged in.&lt;/strong&gt;
</span><span class='line'>    &lt;%= link_to 'Login', new_user_session_path %&gt; or
</span><span class='line'>    &lt;%= link_to 'Sign up', new_user_registration_path %&gt;
</span><span class='line'>  &lt;/p&gt;
</span><span class='line'>&lt;% end %&gt;</span></code></pre></td></tr></table></div></figure>


<p>修改app/controller/entries_controller.rb：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class EntriesController &lt; ApplicationController
</span><span class='line'>  before_filter :authenticate_user!
</span><span class='line'>
</span><span class='line'>  # GET /entries
</span><span class='line'>  # GET /entries.json
</span><span class='line'>  def index
</span><span class='line'>    @entries = current_user.entries
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html # index.html.erb
</span><span class='line'>      format.json { render json: @entries }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # GET /entries/1
</span><span class='line'>  # GET /entries/1.json
</span><span class='line'>  def show
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html # show.html.erb
</span><span class='line'>      format.json { render json: @entry }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # GET /entries/new
</span><span class='line'>  # GET /entries/new.json
</span><span class='line'>  def new
</span><span class='line'>    @entry = current_user.entries.new
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html # new.html.erb
</span><span class='line'>      format.json { render json: @entry }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # GET /entries/1/edit
</span><span class='line'>  def edit
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # POST /entries
</span><span class='line'>  # POST /entries.json
</span><span class='line'>  def create
</span><span class='line'>    @entry = current_user.entries.new(params[:entry])
</span><span class='line'>    @entry.user = current_user
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      if @entry.save
</span><span class='line'>        format.html { redirect_to @entry, notice: 'Entry was successfully created.' }
</span><span class='line'>        format.json { render json: @entry, status: :created, location: @entry }
</span><span class='line'>      else
</span><span class='line'>        format.html { render action: "new" }
</span><span class='line'>        format.json { render json: @entry.errors, status: :unprocessable_entity }
</span><span class='line'>      end
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # PUT /entries/1
</span><span class='line'>  # PUT /entries/1.json
</span><span class='line'>  def update
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      if @entry.update_attributes(params[:entry])
</span><span class='line'>        format.html { redirect_to @entry, notice: 'Entry was successfully updated.' }
</span><span class='line'>        format.json { head :no_content }
</span><span class='line'>      else
</span><span class='line'>        format.html { render action: "edit" }
</span><span class='line'>        format.json { render json: @entry.errors, status: :unprocessable_entity }
</span><span class='line'>      end
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # DELETE /entries/1
</span><span class='line'>  # DELETE /entries/1.json
</span><span class='line'>  def destroy
</span><span class='line'>    @entry = current_user.entries.find(params[:id])
</span><span class='line'>    @entry.destroy
</span><span class='line'>
</span><span class='line'>    respond_to do |format|
</span><span class='line'>      format.html { redirect_to entries_url }
</span><span class='line'>      format.json { head :no_content }
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>执行以下命令启动应用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake db:migrate
</span><span class='line'>rails s</span></code></pre></td></tr></table></div></figure>


<p>以前的版本用的CSS框架是<a href="http://blueprintcss.org/">Blueprint</a>，这次使用比它更方便快捷的<a href="https://github.com/twitter/bootstrap">Bootstrap</a>。Bootstrap建立在Less上，有个<a href="https://github.com/metaskills/less-rails-bootstrap">less-rails-bootstrap</a>，不过在安装libv8时竟然要提示缺少Python，拜托！我用的是Ruby，要我装Python，啥意思啊！还是找个Sass版的Bootstrap吧。</p>

<p>下载<a href="https://github.com/jlong/sass-twitter-bootstrap">sass-twitter-bootstrap</a>：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/jlong/sass-twitter-bootstrap.git</span></code></pre></td></tr></table></div></figure>


<p>将sass-twitter-bootstrap/lib中的文件拷贝到app/assets/stylesheets/twitter目录下。然后将app/assets/stylesheets/application.css中的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*= require_tree .</span></code></pre></td></tr></table></div></figure>


<p>修改为</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*= require twitter/bootstrap</span></code></pre></td></tr></table></div></figure>


<p>再在文件末尾添加：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>body { padding-top: 60px; }</span></code></pre></td></tr></table></div></figure>


<p>现在就可以使用Bootstrap来布局美化应用了。</p>

<p>代码下载：<a href="https://github.com/dohkoos/qianbao">https://github.com/dohkoos/qianbao</a></p>

<p>演示地址：<a href="http://qianbao.herokuapp.com/">http://qianbao.herokuapp.com/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[7个方法养成立即行动的习惯]]></title>
    <link href="http://codemany.com/blog/2011/12/02/7-ways-to-grow-the-action-habit/"/>
    <updated>2011-12-02T05:10:11+08:00</updated>
    <id>http://codemany.com/blog/2011/12/02/7-ways-to-grow-the-action-habit</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://www.pickthebrain.com/blog/grow-the-action-habit/">7 Ways to Grow the Action Habit</a></p>

<p>所有顶级成功人士都有一个共同的品质——那就是立即行动。这种品质可以取代智商，天赋和人际关系，来决定你的薪资范围和晋升速度。</p>

<p>尽管这个观念很简单，但是真正掌握它的人却是极少数。行动的习惯——把想法转换成立即行动的习惯——是完成任务必不可少的习惯。这里有7个方法让你养成立即行动的习惯：</p>

<p>1、不要等到条件都完美了才行动</p>

<p>如果你想等条件都完美了才开始行动，你可能永远都不会开始。因为总是会有些事情不是那么好。或是错过时机，行情不好，或是竞争太激烈。现实世界中没有完美的开始时间。你必须立即行动，等问题出现时再去解决它。开始行动的最佳时间是去年，其实便是现在。</p>

<p>2、做个实干家</p>

<p>行动胜于空想。你想开始实践吗？你有没有好的创意要告诉老板？今天就行动起来吧。想法停留在你脑子里时间越长，它就会变得越弱。几天之后，细节就会变得模糊。一周过去，你已经完全忘记它了。要想成为一个实干家，你需要做得更多，并在做的过程中产生更多新的想法。</p>

<p>3、记住，想法本身并不能带来成功</p>

<p>想法是很重要，但是它只有在被执行后才有价值。一个被付诸行动的平凡想法，比许多“某一天”或者“正确时机”再去实施的卓越创意更有价值。如果你有一个觉得真的很不错的想法，那么就去实现它。如果你不行动起来，那么这个想法永远不会被实现。</p>

<p>4、用行动去克服恐惧</p>

<p>你有没有注意到，在公众演讲中最恐惧的时刻是轮到你上场前那段等待的时刻？即使是专业的演讲者和演员也经历过表演前的焦虑。他们一旦开始，恐惧就会消失。行动是治疗恐惧的最佳方法。万事开头难。一旦行动起来，你将建立起自信，事情也会变得简单。通过行动来克服恐惧，通过行动来建立自信。</p>

<p>5、机械地开启你的创造力</p>

<p>人们对创造性工作的一大误解就是认为它只会在有灵感的时候产生。如果你一直等待灵感来敲门，那么你的作品就会很少。与其等待，不如机械地开启你的创造马达。如果你需要写些东西，那么强制自己坐下来后再写。笔尖在纸上滑动，思绪展开，开始写作，用你的笔激起你的伟大想法吧。</p>

<p>6、先顾眼前</p>

<p>把注意力集中在你当下可以做的事情上。不要去烦恼上周本该完成的事，也不要担心明天要完成的任务。你唯一能左右的时间就是现在。如果你过于考虑从前或者将来，你不会完成任何事情。明天或下周的事经常永远都不会发生。</p>

<p>7、立即切入正题</p>

<p>人们在开会前一般都会做些社交活动或着聊聊天。对于个体工作者也是如此。你在开始真正工作前多久会查看一次Email或RSS feeds呢？如果你不去绕过它们直接开始工作的话，这些分心的事情将会耗费你大量的时间。如果你做到了这点，你就会成为一个高效的人，别人也会把你当作领导者来看待。</p>

<p>没有上级的指示就采取行动，这需要勇气。或许这就是为何主动性是如此稀缺的才能，以至于大多经理都在寻找这种人才。争取主动，当你有一个好的想法的时候，立即去实现它，不要等别人来告诉你。一旦人们看到你在很认真地完成事情，他们就会想要加入你。成功人士不需要别人告诉他们该做什么。如果你想成为这样的人，那就应该习惯独立行动。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何创建Android应用启动界面]]></title>
    <link href="http://codemany.com/blog/2011/08/01/how-to-create-splash-screen-for-android-app/"/>
    <updated>2011-08-01T15:47:50+08:00</updated>
    <id>http://codemany.com/blog/2011/08/01/how-to-create-splash-screen-for-android-app</id>
    <content type="html"><![CDATA[<p>1、制作一张启动图片splash.jpg，放在res/drawable文件夹中。</p>

<p>2、新建布局文件splash.xml：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    android:layout_width="fill_parent"
</span><span class='line'>    android:layout_height="fill_parent"&gt;
</span><span class='line'>    &lt;ImageView
</span><span class='line'>        android:layout_width="fill_parent"
</span><span class='line'>        android:layout_height="fill_parent"
</span><span class='line'>        android:scaleType="fitXY"
</span><span class='line'>        android:src="@drawable/splash" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<p>3、建立SplashActivity，代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package com.codemany.splash;
</span><span class='line'>
</span><span class='line'>import android.app.Activity;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.MotionEvent;
</span><span class='line'>
</span><span class='line'>public class SplashActivity extends Activity {
</span><span class='line'>    private boolean active = true;
</span><span class='line'>    private int splashTime = 5000;    // time to display the splash screen in ms
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.splash);
</span><span class='line'>
</span><span class='line'>        new Thread() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                try {
</span><span class='line'>                    int waited = 0;
</span><span class='line'>                    while (active && (waited &lt; splashTime)) {
</span><span class='line'>                        sleep(100);
</span><span class='line'>                        if (active) {
</span><span class='line'>                            waited += 100;
</span><span class='line'>                        }
</span><span class='line'>                    }
</span><span class='line'>                } catch(InterruptedException e) {
</span><span class='line'>                } finally {
</span><span class='line'>                    finish();
</span><span class='line'>
</span><span class='line'>                    // Run next activity
</span><span class='line'>                    Intent intent = new Intent(SplashActivity.this, MainActivity.class);
</span><span class='line'>                    startActivity(intent);
</span><span class='line'>                    //stop();
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public boolean onTouchEvent(MotionEvent event) {
</span><span class='line'>        if (event.getAction() == MotionEvent.ACTION_DOWN) {
</span><span class='line'>            active = false;
</span><span class='line'>        }
</span><span class='line'>        return true;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>4、修改AndroidManifest.xml文件，将启动界面Activity改为默认启动，并且设置标题栏不可见。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="com.codemany.splash"
</span><span class='line'>    android:versionCode="1"
</span><span class='line'>    android:versionName="1.0"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;application android:icon="@drawable/icon" android:label="@string/app_name"&gt;
</span><span class='line'>        &lt;activity android:name=".SplashActivity"
</span><span class='line'>                  android:theme="@android:style/Theme.NoTitleBar"&gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>
</span><span class='line'>        &lt;activity android:name=".MainActivity"
</span><span class='line'>                  android:label="@string/app_name"&gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.DEFAULT" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;    
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>
</span><span class='line'>    &lt;uses-sdk android:minSdkVersion="4" /&gt;
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[导入UC Browser书签到Firefox中]]></title>
    <link href="http://codemany.com/blog/2011/07/02/import-uc-browser-bookmarks-into-firefox/"/>
    <updated>2011-07-02T16:03:41+08:00</updated>
    <id>http://codemany.com/blog/2011/07/02/import-uc-browser-bookmarks-into-firefox</id>
    <content type="html"><![CDATA[<p>UC Browser保存的书签后缀名是aucf，不能直接导入到Firefox中，必须要把aucf格式转成Firefox支持的格式才行。</p>

<p>先把UC Browser和Firefox的书签格式都分析了一下。Firefox的格式非常简单，就是个HTML文件。UC的是二进制格式，文件以字符串android开头，接着是n个byte的信息，没有分析出来是啥。然后4个byte是书签的数目，再接着的n个byte没去分析，再下来就是每个书签的信息了。书签信息分两部分：名称和地址。都是第1个byte说明后面字符串的长度，字符串以00结尾。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>android    &lt;- 文件头
</span><span class='line'>xxx...     &lt;- n个byte
</span><span class='line'>xxxx       &lt;- 保存的书签数目
</span><span class='line'>xxx...     &lt;- n个byte
</span><span class='line'>xx         &lt;- 书签名称长度
</span><span class='line'>xxx...     &lt;- 书签名称
</span><span class='line'>xx         &lt;- 书签地址长度
</span><span class='line'>xxx...     &lt;- 书签地址</span></code></pre></td></tr></table></div></figure>


<p>用文本文件打开时可以查看英文字符。书签的地址通常由英文字母组成，所以我们不需要再去分析整个aucf文件的格式，只要把所有书签地址提取出来就行了。下面就是完整的Ruby代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># aucf2ff.rb
</span><span class='line'>if ARGV.length != 1 then
</span><span class='line'>  puts "USAGE: ruby aucf2ff.rb ucfavorite"
</span><span class='line'>  exit
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>ucfavorite = ARGV[0]
</span><span class='line'>if !FileTest.exist?(ucfavorite) then
</span><span class='line'>  puts "File #{ucfavorite} was not found"
</span><span class='line'>  exit
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>ff = File.new(ucfavorite.gsub(".aucf", "_ff.html"), "w")
</span><span class='line'>ff.puts '&lt;!DOCTYPE NETSCAPE-Bookmark-file-1&gt;'
</span><span class='line'>ff.puts '&lt;!-- This is an automatically generated file.'
</span><span class='line'>ff.puts '     It will be read and overwritten.'
</span><span class='line'>ff.puts '     DO NOT EDIT! --&gt;'
</span><span class='line'>ff.puts '&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"&gt;'
</span><span class='line'>ff.puts '&lt;TITLE&gt;Bookmarks&lt;/TITLE&gt;'
</span><span class='line'>ff.puts '&lt;H1&gt;Bookmarks Menu&lt;/H1&gt;'
</span><span class='line'>ff.puts
</span><span class='line'>ff.puts '&lt;DL&gt;&lt;p&gt;'
</span><span class='line'>ff.puts '    &lt;DT&gt;&lt;H3&gt;UC Bookmarks&lt;/H3&gt;'
</span><span class='line'>ff.puts '    &lt;DL&gt;&lt;p&gt;'
</span><span class='line'>
</span><span class='line'>buffer = IO.read(ucfavorite)
</span><span class='line'>index = buffer.index("http://")
</span><span class='line'>favorites = buffer.slice(index, buffer.length - index)
</span><span class='line'>favorites.split("http://").each do |fav|
</span><span class='line'>  uri = ''
</span><span class='line'>  fav.each_byte do |c|
</span><span class='line'>    break if c == 00
</span><span class='line'>    uri += c.chr
</span><span class='line'>  end
</span><span class='line'>  if (!uri.empty?) then
</span><span class='line'>    ff.puts '&lt;DT&gt;&lt;A HREF="http://' + uri + '" LAST_CHARSET="utf-8"&gt;' + uri + '&lt;/A&gt;'
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>ff.puts '    &lt;/DL&gt;&lt;p&gt;'
</span><span class='line'>ff.puts '&lt;/DL&gt;&lt;p&gt;'
</span><span class='line'>ff.close</span></code></pre></td></tr></table></div></figure>


<p>通过上面的程序就可以将UC Browser的书签转成Firefox格式，然后在Firefox中导入就可以了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[反编译Android APK文件]]></title>
    <link href="http://codemany.com/blog/2011/07/01/decompile-android-apk-file/"/>
    <updated>2011-07-01T06:07:07+08:00</updated>
    <id>http://codemany.com/blog/2011/07/01/decompile-android-apk-file</id>
    <content type="html"><![CDATA[<p>classes.dex是Java源码编译后生成的字节码文件。由于Android使用的Dalvik虚拟机与标准的Java虚拟机是不兼容的，dex文件与class文件相比，不论是文件结构还是opcode都不一样。</p>

<p>目前有下面这几种反编译的工具:</p>

<ul>
<li>dexdump</li>
<li><a href="http://dedexer.sourceforge.net/">Dedexer</a></li>
<li><a href="http://code.google.com/p/android4me/">AXMLPrinter2</a></li>
<li><a href="http://code.google.com/p/android-apktool/">apktool</a></li>
<li><a href="http://code.google.com/p/dex2jar/">dex2jar</a> + <a href="http://java.decompiler.free.fr/?q=jdgui">JD-GUI</a></li>
<li><a href="http://code.google.com/p/smali/">smali</a></li>
</ul>


<p>dexdump是Android开发包提供的反编译工具。用法为首先启动Android模拟器，把要反编译的dex文件用adb push上传到模拟器中，然后通过adb shell登录，找到该dex文件，执行dexdump xxx.dex。总的来说dexdump功能比较弱，且用起来麻烦，另外反编译的结果的可读性也很差。</p>

<p>另一个反编译工具是Dedexer，反编译的效果比较好。它可以读取dex格式的文件，生成一种类似于汇编语言的输出。这种输出与Jasmin的输出相似，但包含的是Dalvik的字节码。与dexdump相比它至少有3个优点：</p>

<ol>
<li>不需要在Android模拟器中运行；</li>
<li>反编译后的文件目录结构和源代码结构相近，每个class文件对应一个ddx文件。不像dexdump那样把所有的结果都放在一起；</li>
<li>可以作为反编译引擎。目前好多强大的反编译工具都是以Jasmin作为反编译引擎的。</li>
</ol>


<p>可以下载已经编译好的ddx1.11.jar文件（对应Java 1.6版本）。用法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java -jar ddx1.11.jar -o -D -r -d src classes.dex  # 在src目录下生成ddx文件</span></code></pre></td></tr></table></div></figure>


<p>APK中的资源是经过压缩的，用文本工具看都是乱码，可以通过AXMLPrinter2将其转换为可读的XML文件。具体命令为：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java -jar AXMLPrinter2.jar xxx.xml output.xml</span></code></pre></td></tr></table></div></figure>


<p>目前最好的反编译工具是apktool。可以帮助我们把APK文件反编译，输出smali格式的代码、图片和资源等文件，还可以在修改后重新打包。将下载下来的apktool和apktool-install-windows解压到同一目录，有三个文件：aapt.exe，apktool.bat和apktool.jar。使用方法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apktool d xxx.apk zzz  # 反编译xxx.apk到zzz目录，得到APK的图片和配置资源文件等
</span><span class='line'>apktool b zzz  # 从文件夹zzz重建APK，输出到zzz/dist/out.apk</span></code></pre></td></tr></table></div></figure>


<p>dex2jar是一个将Dalvik虚拟机的dex文件转换回标准Java的class文件的工具：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dex2jar xxx.apk  # 生成jar文件，可以用JD GUI工具直接打开查看</span></code></pre></td></tr></table></div></figure>


<p>smali可以反编译dex文件，也可以把你修改过的代码重新编译成dex：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java -jar baksmali.jar classes.dex -o classes
</span><span class='line'>java -jar smali.jar classes -o classes.dex</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[将Nokia 6670的短信导入HTC Hero G3]]></title>
    <link href="http://codemany.com/blog/2011/06/21/transfer-sms-from-nokia6670-to-htc-hero-g3/"/>
    <updated>2011-06-21T08:43:10+08:00</updated>
    <id>http://codemany.com/blog/2011/06/21/transfer-sms-from-nokia6670-to-htc-hero-g3</id>
    <content type="html"><![CDATA[<p>这事本该N久前就该干了（09年末把手机从Nokia 6670换到HTC Hero G3），却一直拖着没有做，今天终于把这事作了一个了结。</p>

<p>Nokia下导出的短信是如Messages_Nokia 6670_20091215.xml这样的一个XML文件，文件内容的编码是unicode，格式就像下面这样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="unicode"?&gt;
</span><span class='line'>&lt;SMS PhoneModel="Nokia 6670"&gt;
</span><span class='line'>  &lt;Message DateTime="2011-06-21 10:10:10"&gt;
</span><span class='line'>    &lt;Sender&gt;路人甲&lt;/Sender&gt;
</span><span class='line'>    &lt;PhoneNumber&gt;+8613988888888&lt;/PhoneNumber&gt;
</span><span class='line'>    &lt;Location&gt;Inbox&lt;/Location&gt;
</span><span class='line'>    &lt;Text&gt;我是路人甲&lt;/Text&gt;
</span><span class='line'>  &lt;/Message&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Message DateTime="2011-06-21 11:11:11"&gt;
</span><span class='line'>    &lt;Sender&gt;路人乙&lt;/Sender&gt;
</span><span class='line'>    &lt;PhoneNumber&gt;+8613966666666&lt;/PhoneNumber&gt;
</span><span class='line'>    &lt;Location&gt;Outbox&lt;/Location&gt;
</span><span class='line'>    &lt;Text&gt;我是路人乙&lt;/Text&gt;
</span><span class='line'>  &lt;/Message&gt;
</span><span class='line'>&lt;/SMS&gt;</span></code></pre></td></tr></table></div></figure>


<p>本来是想写个Android应用来直接导入这些备份短信的，不过在实现的过程中发现了SMS Backup&amp;Restore应用导出的备份文件和Nokia的备份文件类似，产生了做个将Nokia备份文件转换成SMS Backup&amp;Restore备份文件的念头，又在网上发现了nicholashan的教程<a href="http://bbs.hiapk.com/thread-140564-1-1.html">《将Nokia的短信导入Hero(可能适用所有Android机型)》</a>，坚定了我的这个想法。</p>

<p>分析了一下SMS Backup&amp;Restore备份文件的格式，文件内容的编码是utf-8的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?&gt;
</span><span class='line'>&lt;smses count="3"&gt;
</span><span class='line'>  &lt;sms protocol="0" address="10658658" date="1308629532000"
</span><span class='line'>    type="1" subject="null" body="我是内容" toa="null"
</span><span class='line'>    sc_toa="null" service_center="null" read="1"
</span><span class='line'>    status="-1" locked="0" /&gt;
</span><span class='line'>  &lt;sms protocol="0" address="13566666666" date="1308633733000"
</span><span class='line'>    type="2" subject="null" body="我也是内容" toa="null"
</span><span class='line'>    sc_toa="null" service_center="null" read="1"
</span><span class='line'>    status="-1" locked="0" /&gt;
</span><span class='line'>  &lt;sms protocol="0" address="+8613588888888" date="1308641377000"
</span><span class='line'>    type="1" subject="null" body="我还是内容" toa="null"
</span><span class='line'>    sc_toa="null" service_center="null" read="1"
</span><span class='line'>    status="-1" locked="0" /&gt;
</span><span class='line'>&lt;/smses&gt;</span></code></pre></td></tr></table></div></figure>


<p>与转换相关的就address、date、type和body四个属性。address是发信人的号码；date是短信发送日期的timestamp。这点nicholashan的确说错了，后面不需要加什么0的（实际上nicholashan自己也怀疑自己的说法）；type等于1表示别人发给你的短信，如果是2的话就是你发给其他人的短信；body就是短信内容了。</p>

<p>将Nokia中的时间转换到SMS Backup&amp;Restore的时间可以使用下面的代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DateFormat dt = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
</span><span class='line'>long value = 1355296332000L;    // 2012-12-12 12:12:12
</span><span class='line'>Element e = (Element)iter.next();
</span><span class='line'>Attribute attr = e.attribute("DateTime");
</span><span class='line'>try {
</span><span class='line'>    value = dt.parse(attr.getValue()).getTime();
</span><span class='line'>} catch (ParseException ex) {
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>完整的代码如下（使用dom4j实现XML解析）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import java.io.File;
</span><span class='line'>import java.io.FileWriter;
</span><span class='line'>import java.io.IOException;
</span><span class='line'>import java.text.DateFormat;
</span><span class='line'>import java.text.ParseException;
</span><span class='line'>import java.text.SimpleDateFormat;
</span><span class='line'>import java.util.Iterator;
</span><span class='line'>import java.util.List;
</span><span class='line'>
</span><span class='line'>import org.dom4j.Attribute;
</span><span class='line'>import org.dom4j.Document;
</span><span class='line'>import org.dom4j.DocumentException;
</span><span class='line'>import org.dom4j.DocumentHelper;
</span><span class='line'>import org.dom4j.Element;
</span><span class='line'>import org.dom4j.Node;
</span><span class='line'>import org.dom4j.io.SAXReader;
</span><span class='line'>import org.dom4j.io.XMLWriter;
</span><span class='line'>
</span><span class='line'>public class Main {
</span><span class='line'>
</span><span class='line'>    public static void main(String[] args) {
</span><span class='line'>        try {
</span><span class='line'>            SAXReader sr = new SAXReader();
</span><span class='line'>            Document doc = sr.read(new File(args[0]));
</span><span class='line'>
</span><span class='line'>            generateDocument(doc);
</span><span class='line'>        } catch (DocumentException e) {
</span><span class='line'>            e.printStackTrace();
</span><span class='line'>        } catch (IOException e) {
</span><span class='line'>            e.printStackTrace();
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    private static void generateDocument(Document doc) {
</span><span class='line'>        List list = doc.selectNodes("//Message");
</span><span class='line'>
</span><span class='line'>        Document document = DocumentHelper.createDocument();
</span><span class='line'>        Element smses = document.addElement("smses");
</span><span class='line'>        smses.addAttribute("count", String.valueOf(list.size()));
</span><span class='line'>
</span><span class='line'>        DateFormat dt = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
</span><span class='line'>        long value = 1355296332000L;    // 2012-12-12 12:12:12
</span><span class='line'>        Iterator iter = list.iterator();
</span><span class='line'>        while (iter.hasNext()) {
</span><span class='line'>            Element e = (Element)iter.next();
</span><span class='line'>            Attribute attr = e.attribute("DateTime");
</span><span class='line'>            try {
</span><span class='line'>                value = dt.parse(attr.getValue()).getTime();
</span><span class='line'>            } catch (ParseException e) {
</span><span class='line'>                System.out.println(e.getMessage());
</span><span class='line'>            }
</span><span class='line'>            Node phone = e.selectSingleNode("PhoneNumber");
</span><span class='line'>            Node location = e.selectSingleNode("Location");
</span><span class='line'>            Node text = e.selectSingleNode("Text");
</span><span class='line'>
</span><span class='line'>            Element sms = smses.addElement("sms");
</span><span class='line'>            sms.addAttribute("protocol", "0");
</span><span class='line'>            sms.addAttribute("address", phone.getText());
</span><span class='line'>            sms.addAttribute("date", String.valueOf(value));
</span><span class='line'>            if ("Inbox".equals(location.getText())) {
</span><span class='line'>                sms.addAttribute("type", "1");
</span><span class='line'>            } else if ("Outbox".equals(location.getText())) {
</span><span class='line'>                sms.addAttribute("type", "2");
</span><span class='line'>            }
</span><span class='line'>            sms.addAttribute("subject", "null");
</span><span class='line'>            sms.addAttribute("body", text.getText());
</span><span class='line'>            sms.addAttribute("toa", "null");
</span><span class='line'>            sms.addAttribute("sc_toa", "null");
</span><span class='line'>            sms.addAttribute("service_center", "null");
</span><span class='line'>            sms.addAttribute("read", "1");
</span><span class='line'>            sms.addAttribute("status", "-1");
</span><span class='line'>            sms.addAttribute("locked", "0");
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        File f = new File("output.xml");
</span><span class='line'>        XMLWriter output = new XMLWriter(new FileWriter(f));
</span><span class='line'>        output.write(document);
</span><span class='line'>        output.close();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>代码下载：<a href="https://github.com/dohkoos/N6670Conv">https://github.com/dohkoos/N6670Conv</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[给ListView添加卸载功能的Button]]></title>
    <link href="http://codemany.com/blog/2011/06/06/adding-uninstall-button-to-the-listview/"/>
    <updated>2011-06-06T09:25:43+08:00</updated>
    <id>http://codemany.com/blog/2011/06/06/adding-uninstall-button-to-the-listview</id>
    <content type="html"><![CDATA[<p>修改main.xml，添加Button控件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    android:layout_width="fill_parent"
</span><span class='line'>    android:layout_height="fill_parent"&gt;
</span><span class='line'>    &lt;LinearLayout
</span><span class='line'>        android:layout_width="fill_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:layout_weight="1.0"&gt;
</span><span class='line'>        &lt;ListView
</span><span class='line'>            android:id="@+id/list_view"
</span><span class='line'>            android:layout_width="fill_parent"
</span><span class='line'>            android:layout_height="wrap_content" /&gt;
</span><span class='line'>    &lt;/LinearLayout&gt;
</span><span class='line'>    &lt;LinearLayout
</span><span class='line'>        android:layout_width="fill_parent"
</span><span class='line'>        android:layout_height="wrap_content"&gt;
</span><span class='line'>        &lt;Button
</span><span class='line'>            android:id="@+id/uninstall_button"
</span><span class='line'>            android:text="Uninstall Selected Apps"
</span><span class='line'>            android:layout_width="fill_parent"
</span><span class='line'>            android:layout_height="wrap_content" /&gt;
</span><span class='line'>    &lt;/LinearLayout&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<p>然后在MainActivity类中添加卸载应用的代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>private UninstallReceiver mUninstallReceiver;
</span><span class='line'>
</span><span class='line'>@Override
</span><span class='line'>public void onCreate(Bundle savedInstanceState) {
</span><span class='line'>
</span><span class='line'>  Button btn = (Button)findViewById(R.id.uninstall_button);
</span><span class='line'>  btn.setOnClickListener(new OnClickListener() {
</span><span class='line'>      @Override
</span><span class='line'>      public void onClick(View v) {
</span><span class='line'>          for (int i = 0; i &lt; mListData.size(); i++) {
</span><span class='line'>              HashMap&lt;String, Object&gt; map = mListData.get(i);
</span><span class='line'>              boolean isSelected = (Boolean)map.get("app_select");
</span><span class='line'>              if (isSelected) {
</span><span class='line'>                  Uri packageUri = Uri.parse("package:" + map.get("app_package"));
</span><span class='line'>                  Intent intent = new Intent(Intent.ACTION_DELETE, packageUri);
</span><span class='line'>                  startActivity(intent);
</span><span class='line'>              }
</span><span class='line'>          }
</span><span class='line'>      }
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>    // 监听卸载广播
</span><span class='line'>  mUninstallReceiver = new UninstallReceiver();
</span><span class='line'>  IntentFilter filter = new IntentFilter(Intent.ACTION_PACKAGE_REMOVED);
</span><span class='line'>  filter.addDataScheme("package");
</span><span class='line'>  registerReceiver(mUninstallReceiver, filter);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// 有时选择移除的程序在确认时被取消了，因此要用BroadcastReceiver监听应用是否被真正地卸载
</span><span class='line'>private class UninstallReceiver extends BroadcastReceiver {
</span><span class='line'>  @Override
</span><span class='line'>  public void onReceive(Context ctx, Intent intent) {
</span><span class='line'>      Log.d("UninstallReceiver.onReceive()", intent.getDataString());
</span><span class='line'>
</span><span class='line'>      for (int i = 0; i &lt; mListData.size(); i++) {
</span><span class='line'>          HashMap&lt;String, Object&gt; map = mListData.get(i);
</span><span class='line'>          String packageUri = "package:" + map.get("app_package");
</span><span class='line'>          if (packageUri.equals(intent.getDataString())) {
</span><span class='line'>              mListData.remove(map);
</span><span class='line'>          }
</span><span class='line'>      }
</span><span class='line'>      mHandler.sendEmptyMessage(0);
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@Override
</span><span class='line'>public void onDestroy() {
</span><span class='line'>  super.onDestroy();
</span><span class='line'>  unregisterReceiver(mUninstallReceiver);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[向ListView中添加CheckBox]]></title>
    <link href="http://codemany.com/blog/2011/06/03/adding-checkbox-to-the-listview/"/>
    <updated>2011-06-03T14:30:01+08:00</updated>
    <id>http://codemany.com/blog/2011/06/03/adding-checkbox-to-the-listview</id>
    <content type="html"><![CDATA[<p>修改list_item.xml文件，添加CheckBox控件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:layout_width="fill_parent"
</span><span class='line'>    android:layout_height="wrap_content"&gt;
</span><span class='line'>    &lt;ImageView
</span><span class='line'>        android:id="@+id/app_icon"
</span><span class='line'>        android:layout_gravity="center_vertical"
</span><span class='line'>        android:layout_width="32.0dip"
</span><span class='line'>        android:layout_height="32.0dip"
</span><span class='line'>        android:layout_marginLeft="3.0dip"
</span><span class='line'>        android:layout_marginRight="3.0dip" /&gt;
</span><span class='line'>    &lt;LinearLayout
</span><span class='line'>        android:orientation="vertical"
</span><span class='line'>        android:layout_width="fill_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:layout_weight="1.0"&gt;
</span><span class='line'>        &lt;TextView
</span><span class='line'>            android:id="@+id/app_title"
</span><span class='line'>            android:layout_width="fill_parent"
</span><span class='line'>            android:layout_height="wrap_content"
</span><span class='line'>            android:textSize="16.0dip"
</span><span class='line'>            android:textStyle="bold" /&gt;
</span><span class='line'>        &lt;TextView
</span><span class='line'>            android:id="@+id/app_package"
</span><span class='line'>            android:layout_width="fill_parent"
</span><span class='line'>            android:layout_height="wrap_content"
</span><span class='line'>            android:textSize="13.0dip" /&gt;
</span><span class='line'>    &lt;/LinearLayout&gt;
</span><span class='line'>    &lt;CheckBox
</span><span class='line'>        android:id="@+id/app_select"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:focusable="false"
</span><span class='line'>        android:focusableInTouchMode="false"
</span><span class='line'>        android:clickable="false"
</span><span class='line'>        android:checkMark="?android:attr/listChoiceIndicatorMultiple" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<p>这三行代码很重要，如果不加会出现一些奇怪的错误。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>android:focusable="false"
</span><span class='line'>android:focusableInTouchMode="false"
</span><span class='line'>android:clickable="false"</span></code></pre></td></tr></table></div></figure>


<p>加入CheckBox后，在程序运行过程中会发现整个ListView无法响应onItemClick、onItemLongClick或onCreateContextMenu事件。原因在于CheckBox是拥有焦点的，它的优先级比ListItem的焦点优先级更高，于是ListItem的点击事件被屏蔽了。解决方法是让CheckBox不能获得焦点。android:focusable=&#8221;false&#8221;就是做这个的。</p>

<p>修改整个SimpleIconAdapter类为以下内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class SimpleIconAdapter extends BaseAdapter {
</span><span class='line'>    private LayoutInflater mInflater;
</span><span class='line'>    private List&lt;? extends Map&lt;String, ?&gt;&gt; mData;
</span><span class='line'>
</span><span class='line'>    public SimpleIconAdapter(Context context, List&lt;? extends Map&lt;String, ?&gt;&gt; data) {
</span><span class='line'>        mInflater = LayoutInflater.from(context);
</span><span class='line'>        mData = data;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public int getCount() {
</span><span class='line'>        return mData.size();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public Object getItem(int position) {
</span><span class='line'>        return mData.get(position);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public long getItemId(int position) {
</span><span class='line'>        return position;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @SuppressWarnings({ "rawtypes", "unchecked" })
</span><span class='line'>    @Override
</span><span class='line'>    public View getView(int position, View convertView, ViewGroup parent) {
</span><span class='line'>        View view;
</span><span class='line'>        if (convertView != null) {
</span><span class='line'>            view = convertView;
</span><span class='line'>        } else {
</span><span class='line'>            view = mInflater.inflate(R.layout.list_item, parent, false);
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>        Map map = (Map)getItem(position);
</span><span class='line'>        TextView tv = (TextView)view.findViewById(R.id.app_title);
</span><span class='line'>        tv.setText((String)map.get("app_title"));
</span><span class='line'>
</span><span class='line'>        tv = (TextView)view.findViewById(R.id.app_package);
</span><span class='line'>        tv.setText((String)map.get("app_package"));
</span><span class='line'>
</span><span class='line'>        ImageView iv = (ImageView)view.findViewById(R.id.app_icon);
</span><span class='line'>        iv.setImageDrawable((Drawable)map.get("app_icon"));
</span><span class='line'>
</span><span class='line'>        CheckBox cb = (CheckBox)view.findViewById(R.id.app_select);
</span><span class='line'>        if ((Boolean)map.get("app_select") ==  null) {
</span><span class='line'>            map.put("app_select", false);
</span><span class='line'>        }
</span><span class='line'>        cb.setChecked((Boolean)map.get("app_select"));
</span><span class='line'>
</span><span class='line'>        return view;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>再就是修改MainActivity文件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class MainActivity extends Activity {
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.main);
</span><span class='line'>
</span><span class='line'>        mListView = (ListView)findViewById(R.id.list_view);
</span><span class='line'>        mListData = new ArrayList&lt;HashMap&lt;String, Object&gt;&gt;();
</span><span class='line'>        mAdapter = new SimpleIconAdapter(this, mListData);
</span><span class='line'>        mListView.setAdapter(mAdapter);
</span><span class='line'>        mListView.setItemsCanFocus(false);
</span><span class='line'>        mListView.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE);
</span><span class='line'>        mListView.setOnItemClickListener(new OnItemClickListener() {
</span><span class='line'>            @SuppressWarnings({ "unchecked", "rawtypes" })
</span><span class='line'>            @Override
</span><span class='line'>            public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
</span><span class='line'>                // 这里如此处理是因为当选中CheckBox，滚动ListView的时候，会出现一些
</span><span class='line'>                // CheckBox选择错位的现象，所以在选择CheckBox时，记下其状态，然后在
</span><span class='line'>                // getView方法中进行设置。
</span><span class='line'>                //
</span><span class='line'>                // 原因：
</span><span class='line'>                // ListView中的getChildCount()并不总是等于Adapter中的数据行数。当手
</span><span class='line'>                // 机一屏显示不了所有数据时（需要翻页），getChildCount()就等于一屏
</span><span class='line'>                // 所显示的行数（一般为10），小于Adapter中的数据行数。而ListView的
</span><span class='line'>                // getCount()与Adapter中的数据行数相等。
</span><span class='line'>                // 当光标下移到屏幕最底部，新显示出来的View，在调用Adapter的getView
</span><span class='line'>                // 方法中，会判断convertView为null，而再有新的View显示就会发现
</span><span class='line'>                // convertView不为空，所以新显示的View其实使用了之前某个View的对象。
</span><span class='line'>                // 这就造成了状态可能混乱。比如第一行的CheckBox点选时，第11行的也同
</span><span class='line'>                // 时会被点选。
</span><span class='line'>                CheckBox cb = (CheckBox)view.findViewById(R.id.app_select);
</span><span class='line'>                cb.toggle();
</span><span class='line'>                ((Map)mListData.get(position)).put("app_select", cb.isChecked());
</span><span class='line'>            }
</span><span class='line'>        });
</span><span class='line'>
</span><span class='line'>        mProgressDialog = ProgressDialog.show(this, "Wait", "loading...");
</span><span class='line'>        new Thread() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                mListData.addAll(getInstalledApps(false));
</span><span class='line'>                mHandler.sendEmptyMessage(0);
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[实现带Icon的ListView（改进版）]]></title>
    <link href="http://codemany.com/blog/2011/06/02/implement-listview-with-icon-improved/"/>
    <updated>2011-06-02T02:47:58+08:00</updated>
    <id>http://codemany.com/blog/2011/06/02/implement-listview-with-icon-improved</id>
    <content type="html"><![CDATA[<p>带Icon的ListView工作起来还不错，但是如果手机里安装的软件比较多的话就有问题了。在程序启动时会黑屏一段时间，就好像程序挂起了一样。所以这时需要显示一个对话框，告诉用户正在加载数据，最好还能准确告诉用户加载的进度。</p>

<p>显示对话框用ProgressDialog，它有两种样式：HORIZONTAL和SPINNER。这里暂时选择SPINNER，等以后有机会再改成HORIZONTAL。</p>

<p>我们在加载数据前显示ProgressDialog，在之后关闭对话框。示例代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ProgressDialog pd = ProgressDialog.show(this, "Wait", "loading...");
</span><span class='line'>
</span><span class='line'>ListView lv = (ListView)findViewById(R.id.list_view);
</span><span class='line'>adapter = new SimpleIconAdapter(this,
</span><span class='line'>        getInstalledApps(false),
</span><span class='line'>        R.layout.list_item,
</span><span class='line'>        new String[] {APP_ICON, APP_TITLE, APP_PACKAGE},
</span><span class='line'>        new int[] {R.id.app_icon, R.id.app_title, R.id.app_package});
</span><span class='line'>lv.setAdapter(adapter);
</span><span class='line'>
</span><span class='line'>pd.dismiss();</span></code></pre></td></tr></table></div></figure>


<p>但结果ProgressDialog没有显示出来，因为加载数据的代码也执行在UI线程中，所以对话框的显示被阻塞了。怎么办呢？可以试着创建一个新线程，然后把加载数据这个耗时的操作放到这个非UI线程中去执行，这样不就可以了么：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ProgressDialog pd = ProgressDialog.show(this, "Wait", "loading...");
</span><span class='line'>
</span><span class='line'>new Thread() {
</span><span class='line'>    @Override
</span><span class='line'>    public void run() {
</span><span class='line'>        ListView lv = (ListView)findViewById(R.id.list_view);
</span><span class='line'>        adapter = new SimpleIconAdapter(Main.this,
</span><span class='line'>                getInstalledApps(false),
</span><span class='line'>                R.layout.list_item,
</span><span class='line'>                new String[] {APP_ICON, APP_TITLE, APP_PACKAGE},
</span><span class='line'>                new int[] {R.id.app_icon, R.id.app_title, R.id.app_package});
</span><span class='line'>        lv.setAdapter(adapter);
</span><span class='line'>    }
</span><span class='line'>}.start();
</span><span class='line'>
</span><span class='line'>pd.dismiss();</span></code></pre></td></tr></table></div></figure>


<p>这下更惨了，直接报Runtime异常，连界面都打不开了。</p>

<p>深入研究一下Android的线程模型，看看Android到底是怎么处理UI线程和其它线程的交互的，为什么上面的代码会报异常?</p>

<blockquote><p>When an application is launched, the system creates a thread called &#8220;main&#8221; for the application. The main thread, also called the UI thread, is very important because it is in charge of dispatching the events to the appropriate widgets, including drawing events. It is also the thread where your application interacts with running components of the Android UI toolkit.</p>

<p>For instance, if you touch the a button on screen, the UI thread dispatches the touch event to the widget, which in turn sets its pressed state and posts an invalidate request to the event queue. The UI thread dequeues the request and notifies the widget to redraw itself.</p>

<p>This single-thread model can yield poor performance unless your application is implemented properly. Specifically, if everything is happening in a single thread, performing long operations such as network access or database queries on the UI thread will block the whole user interface. No event can be dispatched, including drawing events, while the long operation is underway. From the user&#8217;s perspective, the application appears hung. Even worse, if the UI thread is blocked for more than a few seconds (about 5 seconds currently) the user is presented with the infamous &#8220;application not responding&#8221; (ANR) dialog.</p></blockquote>

<p>看了上面这段话可以知道为啥程序一打开就黑屏，像挂掉了一样。</p>

<p>那为什么用新建线程来执行耗时操作的代码也有问题呢？这是因为它虽然没有阻塞UI线程，但它违背了单线程模型，Android的UI操作并不是线程安全的，并且这些操作必须在UI线程中执行。在这段代码片段中，在另一个线程中执行数据加载绑定，这会引起一些古怪的问题。</p>

<p>Andriod提供了几种在其它线程中访问UI线程的方法：</p>

<ul>
<li><a href="http://developer.android.com/reference/android/app/Activity.html#runOnUiThread(java.lang.Runnable)">Activity.runOnUiThread(Runnable)</a></li>
<li><a href="http://developer.android.com/reference/android/view/View.html#post(java.lang.Runnable)">View.post(Runnable)</a></li>
<li><a href="http://developer.android.com/reference/android/view/View.html#postDelayed(java.lang.Runnable,%20long)">View.postDelayed(Runnable, long)</a></li>
<li><a href="http://developer.android.com/reference/android/os/Handler.html">Hanlder</a></li>
</ul>


<p>上面的任何一个类或方法都可以修复我们前面代码中遇到的问题，很不幸的是这些类或方法同样会使你的代码变的很复杂很难理解。而且当你需要实现一些很复杂的操作并需要频繁地更新UI时会变得更糟糕。为了解决这个问题，Android 1.5提供了一个工具类AsyncTask，它使创建需要与用户界面交互的长时间运行的任务变得更简单。在Android 1.0和1.1中具有与AsyncTask相同功能的类UserTask，它提供了完全一样的API，你需要做的只是把它的代码拷贝的你的程序中。</p>

<p>其实这些方案背后采用的都是Handler。所以这里仍然使用旧有的，复杂的Handler来修复上述问题。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package com.codemany.apkmgt;
</span><span class='line'>
</span><span class='line'>import java.util.ArrayList;
</span><span class='line'>import java.util.HashMap;
</span><span class='line'>import java.util.List;
</span><span class='line'>
</span><span class='line'>import android.app.Activity;
</span><span class='line'>import android.app.ProgressDialog;
</span><span class='line'>import android.content.pm.ApplicationInfo;
</span><span class='line'>import android.content.pm.PackageInfo;
</span><span class='line'>import android.graphics.drawable.Drawable;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.os.Handler;
</span><span class='line'>import android.os.Message;
</span><span class='line'>import android.widget.ListView;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends Activity {
</span><span class='line'>    private static final String APP_ICON = "app_icon";
</span><span class='line'>    private static final String APP_TITLE = "app_title";
</span><span class='line'>    private static final String APP_PACKAGE = "app_package";
</span><span class='line'>
</span><span class='line'>    private SimpleIconAdapter adapter;
</span><span class='line'>    private List&lt;HashMap&lt;String, Object&gt;&gt; listData;
</span><span class='line'>    private ProgressDialog pd;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.main);
</span><span class='line'>
</span><span class='line'>        ListView lv = (ListView)findViewById(R.id.list_view);
</span><span class='line'>        listData = new ArrayList&lt;HashMap&lt;String, Object&gt;&gt;();
</span><span class='line'>        adapter = new SimpleIconAdapter(this,
</span><span class='line'>                listData,
</span><span class='line'>                R.layout.list_item,
</span><span class='line'>                new String[] {APP_ICON, APP_TITLE, APP_PACKAGE},
</span><span class='line'>                new int[] {R.id.app_icon, R.id.app_title, R.id.app_package});
</span><span class='line'>        lv.setAdapter(adapter);
</span><span class='line'>
</span><span class='line'>        pd = ProgressDialog.show(this, "Wait", "loading...");
</span><span class='line'>
</span><span class='line'>        new Thread() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                // 耗时操作，加载数据
</span><span class='line'>                listData.addAll(getInstalledApps(false));
</span><span class='line'>                handler.sendEmptyMessage(0);
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    private Handler handler = new Handler() {
</span><span class='line'>        @Override
</span><span class='line'>        public void handleMessage(Message msg) {
</span><span class='line'>            // 通知UI更新。必须要放在这里
</span><span class='line'>            adapter.notifyDataSetChanged();
</span><span class='line'>
</span><span class='line'>            pd.dismiss();
</span><span class='line'>        }
</span><span class='line'>    };
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>参考资料：<br />
<a href="http://developer.android.com/resources/articles/painless-threading.html">http://developer.android.com/resources/articles/painless-threading.html</a><br />
<a href="http://kiminotes.iteye.com/blog/382683">http://kiminotes.iteye.com/blog/382683</a> 这个实际上是上面文章的译文</p>
]]></content>
  </entry>
  
</feed>
