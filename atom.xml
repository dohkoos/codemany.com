<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[乐者为王]]></title>
  <link href="http://codemany.com/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2016-09-10T08:15:33+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（19）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part19/"/>
    <updated>2016-06-21T21:12:40+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part19</id>
    <content type="html"><![CDATA[<p>因为词法规则可以使用递归，所以词法解析器在技术上和语法解析器一样强大。那意味着我们甚至可以在词法分析器中匹配语法结构。或者，在另一个极端，我们可以把字符当作记号，使用语法分析器去把语法结构应用到字符流（这种被称为无扫描语法分析器）。这导致什么在词法分析器中匹配和什么在语法分析器中匹配的界线在哪里并不是很明显。幸运的是，有几条经验法则可以让我们做出判断：</p>

<ul>
<li>在词法分析器中匹配和丢弃任何语法分析器根本不需要见到的东西。例如，在词法分析器中识别和扔掉像空格和注释这些东西。否则，语法分析器必须经常查看是否有空格或注释在记号间。</li>
<li>在词法分析器中匹配诸如标志符、关键字、字符串和数字这样的常用记号。语法分析器比词法分析器有更多的开销，因此我们不必让语法分析器承受把数字放在一起识别成整数的负担。</li>
<li>把那些语法分析器不需要去辨别的词法结构合并成一个单独的记号类型。例如，如果我们的应用把整数和浮点数当作同一事物对待，然后把它们合并成记号类型NUMBER，那么就没必要向语法分析器发送单独的记号类型。</li>
<li>合并能被语法分析器视为一个单独实体的任何东西。例如，如果语法分析器不在乎XML标签里的内容，词法分析器可以把尖括号中的任何东西合并成一个单独的被称为TAG的记号类型。</li>
<li>如果语法分析器需要先分开一小块文本后才能去处理它，那么词法分析器应该传递独立的构件作为记号给语法分析器。例如，如果语法分析器需要处理一个IP地址的元素，词法分析器应该发送IP构件（整数和点）的独立的记号。</li>
</ul>

<p>想象下现在需要处理Web服务器上的日志文件，每一行表示一条记录。让我们假设每条记录都有一个请求IP地址、HTTP协议命令和结果代码。这里是一个日志条目的示例：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.209.85 "GET /download/foo.html HTTP/1.0" 200</span></code></pre></td></tr></table></div></figure>

<p>如果想要统计文件中有多少行，那么我们可以忽略掉任何东西除了换行字符的序列：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file  : NL+ ;               // 匹配换行（NL）序列的语法规则
</span><span class='line'>STUFF : ~'\n'+ -&gt; skip ;    // 匹配和丢弃除'\n'外的任何东西
</span><span class='line'>NL    : '\n' ;              // 返回NL给语法分析器或调用代码</span></code></pre></td></tr></table></div></figure>

<p>词法分析器不必识别太多的结构，语法分析器会匹配换行记号的序列。</p>

<p>接下来，我们需要从日志文件中收集一系列的IP地址。这意味着我们需要一条规则去识别IP地址的词法结构。并且我们也可以提供其它记录元素的词法规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>IP    : INT '.' INT '.' INT '.' INT ;    // 192.168.209.85
</span><span class='line'>INT   : [0-9]+ ;                         // 匹配IP八位组或者HTTP结果代码
</span><span class='line'>STRING: '"' .*? '"' ;                    // 匹配HTTP协议命令
</span><span class='line'>NL    : '\n' ;                           // 匹配日志文件记录终结符
</span><span class='line'>WS    : ' ' -&gt; skip ;                    // 忽略空格</span></code></pre></td></tr></table></div></figure>

<p>拥有一套完整的记号后，我们可以让语法规则匹配日志文件中的记录：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file  : row+ ;                // 匹配日志文件中行的语法规则
</span><span class='line'>row   : IP STRING INT NL ;    // 匹配日志文件记录</span></code></pre></td></tr></table></div></figure>

<p>更进一步，我们需要把文本IP地址转换成32位的数字。使用便利的库函数split(&#39;.&#39;)，我们可以把IP地址作为字符串传递给语法分析器让它去处理。但是，更好的做法是让词法分析器匹配IP地址的词法结构，然后把匹配出的构件作为记号传递给语法分析器。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file  : row+ ;                           // 匹配日志文件中行的语法规则
</span><span class='line'>row   : ip STRING INT NL ;               // 匹配日志文件记录
</span><span class='line'>ip    : INT '.' INT '.' INT '.' INT ;    // 在语法分析器中匹配IP地址
</span><span class='line'>INT   : [0-9]+ ;                         // 匹配IP八位组或者HTTP结果代码
</span><span class='line'>STRING: '"' .*? '"' ;                    // 匹配HTTP协议命令
</span><span class='line'>NL    : '\n' ;                           // 匹配日志文件记录终结符
</span><span class='line'>WS    : ' ' -&gt; skip ;                    // 忽略空格</span></code></pre></td></tr></table></div></figure>

<p>把词法规则IP切换成语法规则ip显示了我们可以多么轻易地移动这条分界线。</p>

<p>如果要求处理HTTP协议命令字符串的内容，我们可以遵循相同的思考过程。如果不需要检查字符串的部分，那么词法分析器可以把整个字符串作为一个单独的记号传递给语法分析器。如果我们需要抽出各种不同的部分，最好就是让词法分析器去识别那些部分后再把这些匹配出的构件传递给语法分析器。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（18）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part18/"/>
    <updated>2016-06-14T11:56:18+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part18</id>
    <content type="html"><![CDATA[<p>编程语言在词法上看起来惊人地相似，无论是函数式、过程式、声明式还是面向对象语言，看起来几乎都是一样的。这很棒，因为我们只需要学习一次如何描述标志符和整数，没有太大的变化，就可以把它们应用到大多数编程语言上。正如语法分析器以及词法分析器使用规则去描述各种语言构造体一样，我们要使用基本相同的表示法。唯一的区别是语法分析器识别在记号流中的语法结构，而词法分析器识别在字符流中的语法结构。</p>

<p>因为词法分析和语法分析有相似的结构，ANTLR允许我们把两者合并在单个语法文件中。但是因为词法分析和语法分析是语言识别的两个不同阶段，我们必须告诉ANTLR每个规则是和哪个阶段相关联的。我们能够通过以大写字母开始的词法规则名字和以小写字母开始的语法规则名字做到这点。例如，ID是一个词法规则名字，expr则是一个语法规则名字。</p>

<p>当开始构建一个新的语法时，对于那些常用的词法构造体：标志符、数字、字符串、注释以及空格等，我们可以从已经存在的语法中拷贝粘贴规则。然后，通过一些细微的调整，就可以让它运行起来。几乎所有的语言，甚至像JSON和XML这样的非编程语言，都有这些记号的变体。例如，C语言的词法分析器完全可以标记化以下的JSON代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  "title":"Cat wrestling",
</span><span class='line'>  "chapters":[ {"Intro":"..."}, ... ]
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>另一个例子就是块注释。在C语言中，它们是被/* ... */括起来的。而在XML里，注释是被&lt;!-- ... --&gt;括起来。但它们除了开始和结束符号之外，或多或少都有相同的词法构造。</p>

<p>对于关键词、运算符和标点符号，我们不需要词法规则，因为我们可以在语法分析器规则中直接引用它们，用单引号括起来，就像<code>&#39;while&#39;</code>、<code>&#39;*&#39;</code>、<code>&#39;++&#39;</code>这样。有些开发者更喜欢使用像MUL而不是字面量<code>&#39;*&#39;</code>这样的词法规则引用，这些都没问题，因为它们都有相同的记号类型。</p>

<p>为了阐明词法规则看起来像什么，让我们从标志符开始构建一个常用记号的简单版本。</p>

<h4 id="匹配标志符">匹配标志符</h4>

<p>在语法伪代码中，一个基本的标志符是一个大写和小写字母的非空序列。根据已经学习到的知识，我们知道需要用(...)+表示法来表示这样的序列模式。因为序列元素可以是大写或小写字母，所以在子规则中我们需要使用选择运算符：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ID : ('a'..'z'|'A'..'Z')+ ;    // 匹配一个或多个大小写字母</span></code></pre></td></tr></table></div></figure>

<p>唯一的新ANTLR表示法是范围运算符：&#39;a&#39;..&#39;z&#39;代表从a到z的任意字符。或者你也可以使用Unicode代码点字面量&#39;\uXXXX&#39;，这里的XXXX是Unicode字符代码点值的十六进制值。</p>

<p>作为字符集的一个简写，ANTLR支持我们使用更熟悉的正则表达式集合表示法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ID : [a-zA-Z]+ ;    // 匹配一个或多个大小写字母</span></code></pre></td></tr></table></div></figure>

<p>有时候我们会发现像下面的语法貌似存在冲突的现象：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enumDef : 'enum' '{' ... '}' ;
</span><span class='line'>FOR : 'for' ;
</span><span class='line'>ID : [a-zA-Z]+ ;    // 不匹配'enum'或者'for'</span></code></pre></td></tr></table></div></figure>

<p>规则ID也可以同时匹配enum和for这样的关键词，这意味着同样的字符串能被多个规则匹配。但事实上，ANTLR处理这种混合语法时会把字符串字面量以及词法规则与语法规则分隔开，像enum这样的字面量就变成了词法规则并紧随在语法规则之后和在显式的词法规则之前。</p>

<p>ANTLR词法分析器通过偏爱首先指定的规则来解决词法规则间的二义性，这意味着ID规则应该定义在所有的关键词规则之后。ANTLR把隐式的为字面量生成的词法规则放在显式的词法规则之前，因此它们总是有更高的优先级。在这里，&#39;enum&#39;被自动赋予比ID高的优先级。</p>

<p>因为ANTLR会重新排序词法规则并让它在语法规则之后发生。所以上面的语法与下面的变体是相同的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FOR : 'for' ;
</span><span class='line'>ID : [a-zA-Z]+ ;    // 不匹配'enum'或者'for'
</span><span class='line'>enumDef : 'enum' '{' ... '}' ;</span></code></pre></td></tr></table></div></figure>

<h4 id="匹配数字">匹配数字</h4>

<p>描述像10这样的整型数字非常容易，因为它只是一个数字序列。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>INT : '0'..'9'+ ;    // 匹配一个或多个数字</span></code></pre></td></tr></table></div></figure>

<p>或者</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>INT : [0..9]+ ;    // 匹配一个或多个数字</span></code></pre></td></tr></table></div></figure>

<p>浮点数要复杂的多，但如果我们忽略指数的话，可以很容易地制作一个简化版本。浮点数是数字序列后面跟着一个句点和一个可选的小数部分；或者以一个句点开始，然后是数字序列。单独一个句点是不合法的。因此我们的浮点规则使用一个选择和一些序列模式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FLOAT: DIGIT+ '.' DIGIT*    // 匹配1. 39. 3.14159等等
</span><span class='line'>     | '.' DIGIT+           // 匹配.1 .14159
</span><span class='line'>     ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>DIGIT: [0-9] ;              // 匹配单个数字</span></code></pre></td></tr></table></div></figure>

<p>这里我们使用了一个帮助规则DIGIT，因此我们不必到处去写[0-9]。通过在规则前面加上fragment前缀，我们让ANTLR知道该规则仅被其它词法规则使用。它本身不是一个记号，这意味着我们不能在语法规则中引用它。</p>

<h4 id="匹配字符串字面量">匹配字符串字面量</h4>

<p>计算机语言中共同具有的下一个常用记号是字符串字面量，例如&quot;hello&quot;。大部分使用双引号作分隔符，有些使用单引号或两者都使用。以双引号为分隔符而言，在语法伪代码中，一个字符串就是在双引号中的任意字符序列：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STRING : '"' .*? '"' ;    // 匹配在双引号中的任意字符</span></code></pre></td></tr></table></div></figure>

<p>语法中的点是通配符运算符，它可以匹配任意单个字符。因此，“<code>.*</code>”是一个能够匹配任意零个或多个字符的序列的循环。当然，它也将消费字符直到文件结尾，所以不是很有用。幸运的是，ANTLR通过正则表达式表示法（?后缀）提供对非贪婪模式规则的支持。非贪婪模式意味着“直到看见在词法规则中跟在子规则后的字符时才停止吃掉字符”。更确切地说，非贪婪模式规则匹配最小数量的字符，同时仍然允许整个周围的规则被匹配。相反，“<code>.*</code>”被认为是贪婪模式，因为它贪婪地消费能够匹配循环内部的所有字符。</p>

<p>以上的STRING规则还做得不够好，因为它不允许字符串中有双引号。为了做到这点，大部分语言定义了以反斜杠开始的转义字符。在字符串中的双引号我们可以使用“\&quot;”。为支持常用的转义字符，我们需要使用以下规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STRING: '"' (ESC|.)*? '"' ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>ESC : '\\"' | '\\\\' ;    // 匹配字符\"和\\</span></code></pre></td></tr></table></div></figure>

<p>ANTLR自身也需要避开转义字符，所以这里我们需要用“\”去指定反斜杠字符。</p>

<p>现在，在STRING规则中的循环既可以通过调用fragment规则RULE去匹配转义字符序列，也可以通过点通配符去匹配任意字符。当看到一个非转义双引号字符时“<code>*?</code>”子规则运算符终止“<code>(ESC|.)*?</code>”循环。</p>

<h4 id="匹配注释和空格">匹配注释和空格</h4>

<p>词法分析器会把匹配到的记号通过记号流传递给语法分析器，然后语法分析器检查流的语法结构。但我们希望当词法分析器匹配到注释和空格时能把它们扔掉。那样，语法分析器就不必为匹配无处不在的可选的注释和空格担心。例如，当WS是一个空格的词法规则时以下的语法规则就非常尴尬和容易出错：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>assign : ID (WS|COMMENT)? '=' (WS|COMMENT)? expr (WS|COMMENT)? ;</span></code></pre></td></tr></table></div></figure>

<p>定义这些被丢弃的记号和定义非丢弃的记号一样，我们只需要使用skip指令去表明词法分析器应该扔掉它们。以下是匹配那些衍生自C的语言的单行和多行注释的语法规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>LINE_COMMENT : '//' .*? '\r'? '\n' -&gt; skip ;    // 匹配"//" stuff '\n'
</span><span class='line'>COMMENT      : '/*' .*? '*/'       -&gt; skip ;    // 匹配"/*" stuff "*/"</span></code></pre></td></tr></table></div></figure>

<p>在COMMENT中，“<code>.*?</code>”消费在“<code>/*</code>”和“<code>*/</code>”之间的任意字符。在LINE_COMMENT中，“<code>.*?</code>”消费“//”之后的任意字符，直到它看到一个换行符。</p>

<p>词法分析器接受若干跟随在-&gt;运算符后的指令，skip只是它们中的一个。例如，我们可以通过使用channel指令把传递给语法分析器的记号放进隐藏通道。</p>

<p>最后，让我们处理空格这个常用记号。大部分编程语言都把空格当作记号分隔符，但某些像Python这样的语言则把空格用作特殊语法目的。以下是告诉ANTLR如何扔掉空格的语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>WS : (' '|'\t'|'\r'|'\n')+ -&gt; skip ;    // 匹配一个或多个空格但丢弃</span></code></pre></td></tr></table></div></figure>

<p>或者</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>WS : [ \t\r\n]+ -&gt; skip ;    // 匹配一个或多个空格但丢弃</span></code></pre></td></tr></table></div></figure>

<p>当换行既是要被忽略的空格又是命令终结符时，就会有个问题。换行是上下文有关的，在语法上下文中，我们需要扔掉换行，但在其它地方，我们需要把它传递给语法分析器以便让它知道某个命令已经结束。该问题以及它的具体解决方案我们将在以后讨论。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何使用Flexbox构建新闻站点布局]]></title>
    <link href="http://codemany.com/blog/how-to-build-a-news-website-layout-with-flexbox/"/>
    <updated>2016-06-11T23:31:14+08:00</updated>
    <id>http://codemany.com/blog/how-to-build-a-news-website-layout-with-flexbox</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://webdesign.tutsplus.com/tutorials/how-to-build-a-news-website-layout-with-flexbox--cms-26611">http://webdesign.tutsplus.com/tutorials/how-to-build-a-news-website-layout-with-flexbox--cms-26611</a></p>

<p><img src="http://codemany.com/uploads/flexbox-preview.png" title="flexbox-preview" ></p>

<p>在投入并开始之前你没有必要理解Flexbox的<em>每个</em>方面。在这篇教程中，我们将介绍一些Flexbox的特性，同时设计一个类似<a href="http://www.theguardian.com/">The Guardian</a>的“新闻布局”。</p>

<p>我们正在使用Flexbox的原因是它提供了非常强大的特性：</p>

<ul>
<li>我们可以很容易制作响应式列</li>
<li>我们可以使列等高</li>
<li>我们可以把内容推到容器的<em>底部</em></li>
</ul>

<p>那么让我们开始吧！</p>

<h3 id="1-从两个列开始">1. 从两个列开始</h3>

<p>在CSS中创建列一直是个挑战。长期以来，唯一的选项是使用float或者table，但它们都有它们自己的问题。</p>

<p>Flexbox使这个过程更简单，给予我们：</p>

<ul>
<li><strong>更简洁的代码</strong>：我们只需要一个带有display: flex的容器</li>
<li>不需要<strong>清除</strong>float，以防止意外的布局行为</li>
<li><strong>语义化的标记</strong></li>
<li><strong>灵活性</strong>：我们可以用几行CSS代码来调整列的大小、拉伸或者对齐列</li>
</ul>

<p>让我们从创建两个列开始：一个是容器宽度的2/3，一个是1/3。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="columns"&gt;
</span><span class='line'>  &lt;div class="column main-column"&gt;
</span><span class='line'>    2/3 column
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;div class="column"&gt;
</span><span class='line'>    1/3 column
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>

<p>这里有两个元素：</p>

<ul>
<li>columns容器</li>
<li>两个column子容器，其中一个带有附加的名为main-column的class，我们将用它来让该子容器更宽</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  flex: 1;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>作为有一个flex值为2的主列，它将占用其它列的两倍空间。</p>

<p>通过添加一些附加的视觉样式，这里是我们得到的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  background: #eee;
</span><span class='line'>  border: 5px solid #ccc;
</span><span class='line'>  flex: 1;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="2-让每一列都成为flexbox容器">2. 让每一列都成为Flexbox容器</h3>

<p>这两列中的每一个都将包含若干垂直堆叠的文章，因此我们打算把column元素也转变成Flexbox容器。我们想要：</p>

<ul>
<li>文章被垂直堆叠</li>
<li>文章<em>拉伸</em>并填充可用空间</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.column {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex-direction: column;  /* 使文章垂直堆叠 */
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  flex: 1;  /* 拉伸文章以填补剩余的空间 */
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>在<em>容器</em>上的flex-direction: column规则结合在<em>子容器</em>上的flex: 1规则确保文章将填补整个垂直空间，保持最初两列具有相同的高度。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="columns"&gt;
</span><span class='line'>  &lt;div class="column main-column"&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;div class="column"&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World&lt;br&gt;
</span><span class='line'>      Foo Bar
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  background: #eee;
</span><span class='line'>  border: 5px solid #ccc;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  border: 5px solid seagreen;
</span><span class='line'>  color: white;
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin: 10px;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="3-让每篇文章都成为flexbox容器">3. 让每篇文章都成为Flexbox容器</h3>

<p>现在，为了给我们额外的控制，让我们把每篇文章也转变成一个Flexbox容器。每篇文章将包含：</p>

<ul>
<li>一个标题</li>
<li>一个段落</li>
<li>一个带有作者和评论数量的信息栏</li>
<li>一张可选的响应式图片</li>
</ul>

<p>我们在这里使用Flexbox是为了把信息栏推到底部。我们的目标文章布局如下图所示：</p>

<p><img src="http://codemany.com/uploads/flexbox-card.png" title="flexbox-card" ></p>

<p>这里是代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a class="article first-article"&gt;
</span><span class='line'>  &lt;figure class="article-image"&gt;
</span><span class='line'>    &lt;img src=""&gt;
</span><span class='line'>  &lt;/figure&gt;
</span><span class='line'>  &lt;div class="article-body"&gt;
</span><span class='line'>    &lt;h2 class="article-title"&gt;
</span><span class='line'>      &lt;!-- 标题 --&gt;
</span><span class='line'>    &lt;/h2&gt;
</span><span class='line'>    &lt;p class="article-content"&gt;
</span><span class='line'>      &lt;!-- 内容 --&gt;
</span><span class='line'>    &lt;/p&gt;
</span><span class='line'>    &lt;footer class="article-info"&gt;
</span><span class='line'>      &lt;!-- 信息 --&gt;
</span><span class='line'>    &lt;/footer&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/a&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.article {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;  /* 基于其内容设置初始元素大小 */
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;  /* 这将使内容填补剩余的空间，并因此在底部压入信息栏 */
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>文章元素被垂直放置归功于flex-direction: column规则。</p>

<p>我们把flex: 1应用到article-content元素以便它填补空白空间，并且把article-info推到底部，无论列的高度如何。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;main class="main columns"&gt;
</span><span class='line'>  &lt;section class="column main-column"&gt;
</span><span class='line'>    &lt;a class="article first-article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-4by3"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-01.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-02.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>
</span><span class='line'>  &lt;section class="column"&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-3by2"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-03.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>&lt;/main&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>  font-size: 14px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>a {
</span><span class='line'>  text-decoration: none;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>div, h2, p, figure {
</span><span class='line'>  margin: 0;
</span><span class='line'>  padding: 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main {
</span><span class='line'>  margin: 0 auto;
</span><span class='line'>  max-width: 1040px;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: white;
</span><span class='line'>  color: #666;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;
</span><span class='line'>  margin: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image {
</span><span class='line'>  background: #eee;
</span><span class='line'>  display: block;
</span><span class='line'>  padding-top: 75%;
</span><span class='line'>  position: relative;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image img {
</span><span class='line'>  display: block;
</span><span class='line'>  height: 100%;
</span><span class='line'>  left: 0;
</span><span class='line'>  position: absolute;
</span><span class='line'>  top: 0;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-3by2 {
</span><span class='line'>  padding-top: 66.6666%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-16by9 {
</span><span class='line'>  padding-top: 56.25%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-title {
</span><span class='line'>  color: #333;
</span><span class='line'>  flex-shrink: 0;
</span><span class='line'>  font-size: 1.4em;
</span><span class='line'>  font-weight: bold;
</span><span class='line'>  font-weight: 700;
</span><span class='line'>  line-height: 1.2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin-top: 5px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-info {
</span><span class='line'>  display: flex;
</span><span class='line'>  font-size: 0.85em;
</span><span class='line'>  justify-content: space-between;
</span><span class='line'>  margin-top: 10px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="4-添加一些嵌套列">4. 添加一些嵌套列</h3>

<p>在左边的列中，我们真正想要的是<em>另一组</em>列。因此我们将以我们已经用过的同样的columns容器代替第二篇文章。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="columns"&gt;
</span><span class='line'>  &lt;div class="column nested-column"&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>  &lt;div class="column"&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>

<p>因为我们想要第一个嵌套列更宽，我们添加一个带有附加样式的名为nested-column的class：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.nested-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>这将使新列的宽度是其它列的两倍。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;main class="main columns"&gt;
</span><span class='line'>  &lt;section class="column main-column"&gt;
</span><span class='line'>    &lt;a class="article first-article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-4by3"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-01.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>
</span><span class='line'>    &lt;div class="columns"&gt;
</span><span class='line'>      &lt;div class="column nested-column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-02.png" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>      &lt;div class="column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-03.png" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>
</span><span class='line'>  &lt;section class="column"&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-3by2"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-04.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>&lt;/main&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>  font-size: 14px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>a {
</span><span class='line'>  text-decoration: none;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>div, h2, p, figure {
</span><span class='line'>  margin: 0;
</span><span class='line'>  padding: 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main {
</span><span class='line'>  margin: 0 auto;
</span><span class='line'>  max-width: 1040px;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 3;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.nested-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: white;
</span><span class='line'>  color: #666;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;
</span><span class='line'>  margin: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image {
</span><span class='line'>  background: #eee;
</span><span class='line'>  display: block;
</span><span class='line'>  padding-top: 75%;
</span><span class='line'>  position: relative;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image img {
</span><span class='line'>  display: block;
</span><span class='line'>  height: 100%;
</span><span class='line'>  left: 0;
</span><span class='line'>  position: absolute;
</span><span class='line'>  top: 0;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-3by2 {
</span><span class='line'>  padding-top: 66.6666%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-16by9 {
</span><span class='line'>  padding-top: 56.25%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-title {
</span><span class='line'>  color: #333;
</span><span class='line'>  flex-shrink: 0;
</span><span class='line'>  font-size: 1.4em;
</span><span class='line'>  font-weight: bold;
</span><span class='line'>  font-weight: 700;
</span><span class='line'>  line-height: 1.2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin-top: 5px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-info {
</span><span class='line'>  display: flex;
</span><span class='line'>  font-size: 0.85em;
</span><span class='line'>  justify-content: space-between;
</span><span class='line'>  margin-top: 10px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="5-给第一篇文章一个水平布局">5. 给第一篇文章一个水平布局</h3>

<p>第一篇文章真的很大。为了优化空间的使用，让我们把它的布局切换成水平的。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.first-article {
</span><span class='line'>  flex-direction: row;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.first-article .article-body {
</span><span class='line'>  flex: 1;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.first-article .article-image {
</span><span class='line'>  height: 300px;
</span><span class='line'>  order: 2;
</span><span class='line'>  padding-top: 0;
</span><span class='line'>  width: 400px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>这里的order属性是非常有用的，因为它允许我们改变HTML元素的顺序而不影响HTML标记。在标记中article-image实际上出现在article-body的<em>前面</em>，但它表现的好像出现在<em>后面</em>。</p>

<h3 id="6-使布局可响应">6. 使布局可响应</h3>

<p>这些就是我们想看到的，虽然它有点儿扁平。让我们通过响应式来修复它。</p>

<p>Flexbox一个极好的特性是你只需要移除容器上的display: flex规则就可以完全禁用Flexbox，同时保持所有其它的Flexbox属性（例如align-items或者flex）有效。</p>

<p>结果是，你可以通过仅在某个断点上启用Flexbox来触发一个响应式布局。</p>

<p>我们将从.columns和.column选择器中移除display: flex，而不是用一个Media Query包装它们：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@media screen and (min-width: 800px) {
</span><span class='line'>  .columns,
</span><span class='line'>  .column {
</span><span class='line'>    display: flex;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>就是这样！在更小的屏幕上，所有的文章都在彼此的上面。超过800px时，它们将会被放置在两列中。</p>

<h3 id="7-添加最后的润色">7. 添加最后的润色</h3>

<p>为使布局在大屏幕上更具吸引力，让我们添加一些CSS微调：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@media screen and (min-width: 1000px) {
</span><span class='line'>  .first-article {
</span><span class='line'>    flex-direction: row;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-body {
</span><span class='line'>    flex: 1;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-image {
</span><span class='line'>    height: 300px;
</span><span class='line'>    order: 2;
</span><span class='line'>    padding-top: 0;
</span><span class='line'>    width: 400px;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .main-column {
</span><span class='line'>    flex: 3;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .nested-column {
</span><span class='line'>    flex: 2;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>第一篇文章的内容是水平放置的，文本在左边，图片在右边。而且，主列现在更宽（75%），嵌套列也是（66%）。这里是最终结果！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;header class="header"&gt;
</span><span class='line'>  &lt;h1&gt;The Envato Tuts+ Report&lt;/h1&gt;
</span><span class='line'>  &lt;h2&gt;&lt;a href="http://webdesign.tutsplus.com/tutorials/how-to-build-a-news-website-layout-with-flexbox--cms-26611"&gt;Read tutorial&lt;/a&gt;&lt;/h2&gt;
</span><span class='line'>&lt;/header&gt;
</span><span class='line'>
</span><span class='line'>&lt;main class="main columns"&gt;
</span><span class='line'>  &lt;section class="column main-column"&gt;
</span><span class='line'>    &lt;a class="article first-article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-4by3"&gt;
</span><span class='line'>        &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-01-lo.jpg" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>
</span><span class='line'>    &lt;div class="columns"&gt;
</span><span class='line'>      &lt;div class="column nested-column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-02-lo.jpg" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>      &lt;div class="column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-03-lo.jpg" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>
</span><span class='line'>  &lt;section class="column"&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-3by2"&gt;
</span><span class='line'>        &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-04-lo.jpg" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>&lt;/main&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700);
</span><span class='line'>@import url(https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css);
</span><span class='line'>
</span><span class='line'>html {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  font-size: 14px;
</span><span class='line'>  -moz-osx-font-smoothing: grayscale;
</span><span class='line'>  -webkit-font-smoothing: antialiased;
</span><span class='line'>  min-width: 300px;
</span><span class='line'>  overflow-x: hidden;
</span><span class='line'>  overflow-y: scroll;
</span><span class='line'>  text-rendering: optimizeLegibility;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>body {
</span><span class='line'>  color: #666;
</span><span class='line'>  font-family: "Source Sans Pro", "Helvetica", "Arial", sans-serif;
</span><span class='line'>  font-size: 1rem;
</span><span class='line'>  font-weight: 400;
</span><span class='line'>  line-height: 1.4;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>a {
</span><span class='line'>  text-decoration: none;
</span><span class='line'>  transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>div, h2, p, figure {
</span><span class='line'>  margin: 0;
</span><span class='line'>  padding: 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header {
</span><span class='line'>  color: white;
</span><span class='line'>  padding: 40px 0 20px;
</span><span class='line'>  text-align: center;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header h1 {
</span><span class='line'>  font-size: 40px;
</span><span class='line'>  font-weight: bold;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header h2 a {
</span><span class='line'>  border-bottom: 1px solid rgba(255, 255, 255, 0.5);
</span><span class='line'>  color: white;
</span><span class='line'>  font-size: 20px;
</span><span class='line'>  opacity: 0.5;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header h2 a:hover {
</span><span class='line'>  border-bottom-color: white;
</span><span class='line'>  opacity: 1;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main {
</span><span class='line'>  margin: 0 auto;
</span><span class='line'>  max-width: 1040px;
</span><span class='line'>  padding: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: white;
</span><span class='line'>  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
</span><span class='line'>  color: #666;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;
</span><span class='line'>  margin: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article:hover,
</span><span class='line'>.article:focus {
</span><span class='line'>  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
</span><span class='line'>  color: #444;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image {
</span><span class='line'>  background: #eee;
</span><span class='line'>  display: block;
</span><span class='line'>  padding-top: 75%;
</span><span class='line'>  position: relative;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image img {
</span><span class='line'>  display: block;
</span><span class='line'>  height: 100%;
</span><span class='line'>  left: 0;
</span><span class='line'>  position: absolute;
</span><span class='line'>  top: 0;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-3by2 {
</span><span class='line'>  padding-top: 66.6666%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-16by9 {
</span><span class='line'>  padding-top: 56.25%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-title {
</span><span class='line'>  color: #333;
</span><span class='line'>  flex-shrink: 0;
</span><span class='line'>  font-size: 1.4em;
</span><span class='line'>  font-weight: 700;
</span><span class='line'>  line-height: 1.2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin-top: 5px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-info {
</span><span class='line'>  display: flex;
</span><span class='line'>  font-size: 0.85em;
</span><span class='line'>  justify-content: space-between;
</span><span class='line'>  margin-top: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@media screen and (min-width: 800px) {
</span><span class='line'>  .columns,
</span><span class='line'>  .column {
</span><span class='line'>    display: flex;
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@media screen and (min-width: 1000px) {
</span><span class='line'>  .first-article {
</span><span class='line'>    flex-direction: row;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-body {
</span><span class='line'>    flex: 1;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-image {
</span><span class='line'>    height: 300px;
</span><span class='line'>    order: 2;
</span><span class='line'>    padding-top: 0;
</span><span class='line'>    width: 400px;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .main-column {
</span><span class='line'>    flex: 3;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .nested-column {
</span><span class='line'>    flex: 2;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="总结">总结</h3>

<p>我希望我已经向你展示在投入和开始使用Flexbox前你不需要理解它的每个方面！响应式新闻布局是一个真正有用的模式。拆解它，把玩它，让我们知道你是如何进展的！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（17）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part17/"/>
    <updated>2016-06-07T13:09:54+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part17</id>
    <content type="html"><![CDATA[<p>用自顶向下的语法指定和通过手工的递归下降语法分析器识别表达式一直是个麻烦。首先是因为大部分自然语法是模糊的，其次是因为大部分自然语法规格使用一种被称为左递归的特殊类型递归。所以自顶向下的语法和语法分析器不能处理传统形式上的左递归。</p>

<p>为了阐明这个问题，设想一个算术表达式语言，它只有乘法和加法运算符以及整数。表达式是自相似的。也就是说，一个乘法表达式是由“*”运算符连接的两个子表达式。同样的，一个加法表达式是由“+”运算符连接的两个子表达式。我们也可以把整数看作表达式。整个语法规则看起来就像以下显示的那样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expr '*' expr    // 匹配由“*”运算符连接的子表达式
</span><span class='line'>     | expr '+' expr    // 匹配由“+”运算符连接的子表达式
</span><span class='line'>     | INT              // 匹配简单整数
</span><span class='line'>     ;</span></code></pre></td></tr></table></div></figure>

<p>问题是上述规则对于某些输入短语来说是模棱两可的。换句话说，这个规则能用多种方法匹配单个输入流。对于简单的整数和像1+2和1*2这样的单运算符表达式是没问题的，因为只有一种方法能去匹配它们。例如，规则可以仅用第二个选项匹配1+2。就像下图左边所示的那样：</p>

<p><img src="http://codemany.com/uploads/ambiguity-parse-tree.png" title="ambiguity-parse-tree" ></p>

<p>问题是指定的规则可以像中间和右边语法分析树描绘的那样用两种方法解释1+2*3这样的输入。两者的解释是不同的，因为中间的树说加1到2乘3的结果上，而右边的树说3乘以1加2的结果。这是一个运算符优先级的问题，但常规语法根本没有指定优先级的方法。大部分语法工具使用额外的符号来指定运算符优先级。</p>

<p>与之相反的是，ANTLR解决二义性有利于首先给出的选项，隐式地允许我们指定运算符优先级。规则expr有一个乘法选项在加法选项之前，因此，ANTLR解决1+2*3的运算符二义性有利于乘法。</p>

<p>默认情况下，ANTLR从左到右结合运算符，然而某些像指数群这样的运算符则是从右到左。因此，我们必须使用选项assoc手动指定运算符记号上的相关性。这里是一个能正确地把输入<code>2^3^4</code>解释成<code>2^(3^4)</code>的表达式规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expr '^'&lt;assoc=right&gt; expr    // 运算符是右结合的
</span><span class='line'>     | INT
</span><span class='line'>     ;</span></code></pre></td></tr></table></div></figure>

<p>下图中的语法分析树阐明了运算符左右结合版本的不同。右边的语法分析树是惯常的解释：</p>

<p><img src="http://codemany.com/uploads/power-parse-tree.png" title="power-parse-tree" ></p>

<p>为了把所有这三个运算符合并成一条规则，我们把指数表达式选项放在其它表达式选项之前，因为它的运算符比乘法和加法都有更高的优先级。合并后的语法如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expr '^'&lt;assoc=right&gt; expr    // 运算符是右结合的
</span><span class='line'>     | expr '*' expr                 // 匹配由“*”运算符连接的子表达式
</span><span class='line'>     | expr '+' expr                 // 匹配由“+”运算符连接的子表达式
</span><span class='line'>     | INT                           // 匹配简单整数
</span><span class='line'>     ;</span></code></pre></td></tr></table></div></figure>

<p>不像其它常规的语法分析器生成器那样，ANTLR v4是可以处理直接左递归的。左递归规则是指直接或者间接调用在选项左边缘的自身的规则。规则expr是直接左递归的，因为除INT选项外的其它所有选项都开始于规则expr自身的引用。如果规则expr的引用处在某些选项的右边缘，那么它就是右递归的。虽然ANTLR v4可以处理直接左递归，但它不能处理间接左递归。这意味着我们不能把expr因子化为语法等效规则。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expo ;    // 通过expo左递归地间接调用expr
</span><span class='line'>expo : expr '^'&lt;assoc=right&gt; expr ;</span></code></pre></td></tr></table></div></figure>

<p>ANTLR v4可以简化直接左递归的表达式规则的工作。这种新的机制不仅更有效率，而且表达式规则也更小和更容易理解。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（16）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part16/"/>
    <updated>2016-06-02T10:16:21+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part16</id>
    <content type="html"><![CDATA[<ul>
<li>initializer 初始值设定项</li>
<li>construct 构造体</li>
</ul>

<p>现在，我们已经有了一个自顶向下的草拟出语法的通用策略，下面我们要专注于一些常用的语言模式。尽管在过去几十年里有大量的语言被发明，但仍然只有较少的基本语言模式需要被处理。这是因为人们趋向于设计遵循自然语言约束的语言，语言也会因为设计者遵循数学上的常用表示法而趋向于相似。甚至在词法级别，语言趋向于重用一些相同的结构，例如标志符、整数、字符串等。这些单词顺序和依赖的约束来源于自然语言，并逐渐演化成为四种抽象的语言模式：</p>

<h4 id="模式：序列">模式：序列</h4>

<p>这是像数组初始值设定项中的值那样的元素序列，也是在计算机语言中最常见的结构。例如，下面是登录到POP服务器时的序列：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>USER parrt
</span><span class='line'>PASS secret
</span><span class='line'>RETR 1</span></code></pre></td></tr></table></div></figure>

<p>这些命令本身也是序列。大部分命令是一个关键词（保留标志符，例如USER和RETR）跟随一个运算元再跟随一个换行符。为了在语法中指定此类序列，我们可以按照顺序简单地列出各个元素。以下是检索命令的序列（其中INT表示整数记号类型）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>retr : 'RETR' INT '\n' ;</span></code></pre></td></tr></table></div></figure>

<p>我们可以给RETR序列打上retr规则的标签，这样在语法的其它地方，我们就能使用规则名字作为简写来引用RETR序列。</p>

<p>对于任意长度的序列像矢量[1 2 3]这样的简单整数列表，虽然它是一个有限序列，但我们不可能通过像INT INT INT ...这样的规则片段来列出所有可能的整数列表。为了编码这样的一个或者多个元素，我们使用“+”子规则运算符。例如，{INT}+表示任意长度的整数序列，或者使用简写INT+也可以。至于可以为空的列表，我们则使用零个或者多个运算符“*”。</p>

<p>这种模式的变体有带终结符的序列和带分隔符的序列，CSV文件就很好地示范了这两者。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file : (row '\n')* ;           // 带一个“\n”终结符的序列
</span><span class='line'>row  : field (',' field)* ;    // 带一个“,”分隔符的序列
</span><span class='line'>field: INT ;                   // 假设字段只是整数</span></code></pre></td></tr></table></div></figure>

<p>规则file使用带终结符模式的列表去匹配零个或者多个row &#39;\n&#39;序列，记号“\n”终结序列的每个元素。规则row使用带分隔符模式的列表去匹配一个field后面有零个或者多个&#39;,&#39; field序列，记号“,”分隔各个字段。</p>

<p>最后，还有个特殊类型的零个或者一个序列，用“?”指定。可以使用它去表达可选的构造体。</p>

<h4 id="模式：选择">模式：选择</h4>

<p>这是一个在多个可供替代的短语之间的选择，比如在编程语言中不同种类的语句。为了在语言中表示选择的这个概念，我们使用“|”作为ANTLR中的“or”运算符去分隔被称为“选项”的语法选择。</p>

<p>回到CVS语法，我们可以通过整数或者字符串的选择让规则field变得更灵活。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>field: INT | STRING ;</span></code></pre></td></tr></table></div></figure>

<p>任何时候，如果你发现正在说“语言结构x可以是这个或者那个”，那么你就可以确定应该使用选择模式，在规则x中使用“|”。</p>

<h4 id="模式：记号依赖">模式：记号依赖</h4>

<p>记号依赖表示一个记号的存在需要在短语的其它地方有它的对等物的存在，比如匹配的左右括号。前面我们曾经使用INT+去表达在矢量[1 2 3]中的整数非空序列。为指定周围有方括号的矢量，我们需要一种方法去表达记号中的依赖。如果我们在句子中看到一个符号，那么我们必须在句子的其它地方找到它的对等物。为表达这种语法，我们必须使用同时指定对等符号的序列，它们通常包围或分组着其它元素。在这个案例中，我们这样指定矢量：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vector : '[' INT+ ']' ;    // [1], [1 2], [1 2 3], ...</span></code></pre></td></tr></table></div></figure>

<p>扫视任何有效的代码，你会看到必须成对出现的各种分组符号：(...)，[...]，{...}。但是要牢记，依赖符号并不是必须配对的，类C语言都有的a ? b : c三元运算符就指定了当看到“?”符号时需要在接下来的短语中看到“:”符号。</p>

<h4 id="模式：嵌套短语">模式：嵌套短语</h4>

<p>嵌套短语有一个自相似的语言结构，它的子短语也遵循相同的结构。表达式是典型的自相似语言结构，由被运算符分隔的嵌套子表达式组成。类似地，while的代码块是嵌套在外部代码块内的一个代码块。我们在语法中使用递归规则表达自相似的语言结构。因此，如果规则的伪代码引用它自身，我们将需要一个递归的自引用规则。</p>

<p>让我们来看下代码块的嵌套是如何工作的。while语句是关键词while跟随一个在括号中的条件表达式再跟随一个语句。我们也可以把多条语句包裹在花括号里当作一个单块语句。表达语法如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>stat: 'while' '(' expr ')' stat    // 匹配WHILE语句
</span><span class='line'>    | '{' stat* '}'                // 匹配在括号中的语句块
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>这里的stat可以是单条语句或者被花括号括起来的一组语句。规则stat是直接递归的，因为它在两个选项中直接引用它自身。如果我们把第二个选项移到它自己的规则中，规则stat和block将是双向间接递归的。语法如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>stat: 'while' '(' expr ')' stat    // 匹配WHILE语句
</span><span class='line'>    | '{' stat* '}'                // 匹配语句块
</span><span class='line'>    ;
</span><span class='line'>block: '{' stat* '}' ;             // 匹配在括号中的语句块</span></code></pre></td></tr></table></div></figure>

<p>看下面仅有3类表达式（索引数组引用、括号表达式和整数）的简单语言的语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr: ID '[' expr ']'    // a[1], a[b[1]], a[(2*b[1])]
</span><span class='line'>    | '(' expr ')'       // (1), (a[1]), (((1))), (2*a[1])
</span><span class='line'>    | INT                // 1, 94117
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>注意递归是如何自然地发生的。数组索引表达式的索引组件是表达式本身，因此我们只需要在选项中引用expr即可。</p>

<p>下图是关于两个例子输入的语法分析树：</p>

<p><img src="http://codemany.com/uploads/expr-parse-tree.png" title="expr-parse-tree" ></p>

<p>分析树中的内部树节点是规则引用，叶子是记号引用。从树根到任何节点的路径表示元素的规则调用栈（或者ANTLR生成的递归下降语法分析器调用栈）。路径代表递归嵌套的子树有多个相同规则的引用。规则节点是其下方子树的标签。根节点是expr，所以整棵树是一个表达式。在1之前的那棵expr子树会把整数当作一个表达式。</p>

<p>为实现这些模式，我们只需要由选项、记号引用、规则引用组成的语法规则即可。我们还可以把这些元素组成子规则，子规则是裹在括号内的行内规则。我们也可以将子规则标记为“?”或“*”或“+”循环去识别被包围的语法片段多次。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（15）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part15/"/>
    <updated>2016-05-22T17:51:36+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part15</id>
    <content type="html"><![CDATA[<p>在聚焦到具体的语法规则内部结构之前，我们要先讨论下语法的整体剖析以及如何形成一套初始的语法骨架。</p>

<p>语法文件通常是由一个命名语法的头和一系列可以彼此调用的规则组成。就像下面的那样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grammar MyG;
</span><span class='line'>rule1 : «stuff» ;
</span><span class='line'>rule2 : «more stuff» ;
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>

<p>设计语法就是要搞清楚«stuff»是什么？哪个规则是开始规则。这要求我们需要知道给定语言的一系列代表性的输入例子。当然，从语言参考手册或者其它语法分析器生成器格式而来的语法也是有帮助的。</p>

<p>正确设计语法的方法是借鉴功能分解或者自顶向下的设计，从粗粒度级别到细粒度级别逐步定义语言结构并把它们编码为语法规则。所以，我们的第一个任务就是找到粗粒度语言结构的名字，同时它也是开始规则。在英语中我们使用sentence，对于XML文件来说它则是document。</p>

<p>设计开始规则的内容是用英语伪代码描述整个输入格式的问题。例如，“a comma-separated-value (CSV) file is a sequence of rows terminated by newlines.”这段文字，在is a左边的至关重要的单词file是规则名字，在is a右边的所有内容则成为在规则定义右则的«stuff»的内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file : «sequence of rows that are terminated by newlines» ;</span></code></pre></td></tr></table></div></figure>

<p>然后我们通过描述在开始规则右侧被确定的元素来进行下一个粒度级别的设计。在规则右侧的名词通常是对记号或尚未定义的规则的引用，这些记号是那些我们在正常情况下视为单词、标点符号、运算符的元素。就像单词是英语句子中的原子成分那样，记号在语法规则中也是如此。规则引用则涉及到像row那样需要被分解为更详细部分的其它语言结构。</p>

<p>进入细节的另外一层，我们可以说row是一系列被逗号分隔的field，而field则是一个数字或字符串。就像以下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>row   : «sequence of fields separated by commas» ;
</span><span class='line'>field : «number or string» ;</span></code></pre></td></tr></table></div></figure>

<p>当没有规则需要再定义时，我们就得到了语法的一个粗略的草图。</p>

<p>如果有其它格式的语法作为参考的话设计语法会容易的多，但小心不要盲目地遵循它，否则你会误入歧途的。非ANTLR格式的语法只是让你知道别人是如何决定分解语言中的短语的，它最大的作用就是可以给我们一份规则名称的列表用作参考。</p>

<p>不推荐从参考手册上复制粘贴语法到ANTLR，然后再通过细微的调整让它工作。把它当作一套指南而不是一段代码是更好的办法。为了清晰地描述语法，参考手册通常是相当松散的。这意味着语法能识别大量不在语言中的句子，或者语法可能不够明确，可以用多种方法匹配相同的输入序列。例如，语法可能会说表达式可以调用一个构建器或者访问一个函数，问题是像T(i)这样的输入可以同时匹配两者。理想情况下，在语法中是不能有这样的二义性的，每个输入句子我们只需要一种解释。</p>

<p>在另一个极端，参考手册中的语法有时过于明确地说明了规则。有些约束是需要在分析完输入后实施的，而不是试图对语法结构实施约束。例如，W3C XML语法就显式地指定标签中什么地方必须要有空格以及什么地方的空格可以省略。但事实是我们可以简单地让词法分析器在把记号发送给语法分析器之前去除空格，不需要在语法中到处测试它。</p>

<p>规格还说&lt;?xml ...&gt;标签可以有两个附加属性encoding和standalone。我们需要知道约束，但它是很容易去允许任何属性名字，然后在语法分析后检查语法分析树，以确保所有这些限制都满足的。
归根结底，XML只是嵌在文本中的一对标签，因此它的语法结构是相当直白的。唯一的挑战是如何分别对待什么在标签内以及什么在标签外。</p>

<p>识别语法规则并用伪代码表示它们的右侧部分最初是个挑战，但当你为更多的语言构建语法后它会变得越来越容易。一旦我们有了伪代码，我们就需要把它转换成ANTLR表示法，以便能得到一个可工作的语法。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（14）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part14/"/>
    <updated>2016-05-16T20:26:22+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part14</id>
    <content type="html"><![CDATA[<p>对于大多数语法，注释和空格都是语法分析器可以忽略的东西。如果我们不想让注释和空格在语法中到处都是，那么就需要让词法分析器把它们扔掉。不幸的是，这意味着任何后续处理步骤都不能再访问注释和空格。安全地忽略掉注释和空格的方法是把这些发送给语法分析器的记号放到一个“隐藏通道”中，语法分析器仅需要调协到单个通道即可。我们可以把任何我们想要的东西传递到其它通道中。这里是如何实现的语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>COMMENT
</span><span class='line'>    : '/*' .*? '*/' -&gt; channel(HIDDEN)    // match anything between /* and */
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>WS  : [ \r\t\n]+    -&gt; channel(HIDDEN)
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>就像我们前面讨论过的<code>-&gt; skip</code>那样，<code>-&gt; channel(HIDDEN)</code>也是一个的词法分析器指令。在这里，它设置那些记号的通道号码以便这些记号可以被语法分析器忽略。记号流仍然维护着原始的记号序列，但在喂食给语法分析器时则略过离线通道中的记号。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[逻辑题-谁养鱼]]></title>
    <link href="http://codemany.com/blog/logic-problems-who-owns-the-fish/"/>
    <updated>2016-05-12T18:06:58+08:00</updated>
    <id>http://codemany.com/blog/logic-problems-who-owns-the-fish</id>
    <content type="html"><![CDATA[<ol>
<li>在一条街上，有5座房子，喷了5种颜色。</li>
<li>每座房子里住着不同国籍的人。</li>
<li>每个人喝不同的饮料，抽不同品牌的香烟，养不同的宠物。</li>
</ol>

<p>问题是：谁养鱼？</p>

<p>提示：</p>

<ol>
<li>英国人住红色房子。</li>
<li>瑞典人养狗。</li>
<li>丹麦人喝茶。</li>
<li>绿色房子在白色房子左面。</li>
<li>绿色房子主人喝咖啡。</li>
<li>抽Pall Mall香烟的人养鸟。</li>
<li>黄色房子主人抽Dunhill香烟。</li>
<li>住在中间房子的人喝牛奶。</li>
<li>挪威人住第一间房子。</li>
<li>抽Blends香烟的人住在养猫的人隔壁。</li>
<li>养马的人住抽Dunhill香烟的人隔壁。</li>
<li>抽Blue Master的人喝啤酒。</li>
<li>德国人抽Prince香烟。</li>
<li>挪威人住蓝色房子隔壁。</li>
<li>抽Blends香烟的人有一个喝水的邻居。</li>
</ol>

<p>在回答上述问题前先画一个6行5列的表格，从上到下的每一行分别代表房子的顺序（A表示左边第一间房子）、哪国人、房子颜色、饮料、香烟、宠物。下表是问题的初始状态：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>根据提示8、9和14可以得到：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>由提示4和5可以判定房子D的颜色是绿色，房子主人喝咖啡，房子E的颜色是白色。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">?</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>结合提示1、7和11可以知道房子C是红色的，住的是英国人，房子A是黄色的。挪威人抽Dunhill香烟。住房子B的人养马。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>依据上表可知，挪威人喝的饮料是水、茶或者啤酒。结合提示3和12可以断定挪威人喝的是水。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>通过提示15可以得出住房子B的人抽Blends香烟。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>结合提示12可以推断住房子E的人抽Blue Master香烟、喝啤酒。住房子B的人喝茶。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>由提示3、13得到房子B住的是丹麦人。房子D住的是德国人，抽Prince香烟。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">丹麦人</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">德国人</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">?</td>
<td style="text-align: center">Prince</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>再由提示6和10确定住房子C的人抽Pall Mall香烟、养鸟。挪威人养猫。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">丹麦人</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">德国人</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">Pall Mall</td>
<td style="text-align: center">Prince</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">猫</td>
<td style="text-align: center">马</td>
<td style="text-align: center">鸟</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>最后结合提示2推断得到房子E住的是瑞典人，养狗。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">丹麦人</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">德国人</td>
<td style="text-align: center">瑞典人</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">Pall Mall</td>
<td style="text-align: center">Prince</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">猫</td>
<td style="text-align: center">马</td>
<td style="text-align: center">鸟</td>
<td style="text-align: center">?</td>
<td style="text-align: center">狗</td>
</tr>
</tbody></table>

<p>现在，结果已经出来了：德国人养鱼。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（13）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part13/"/>
    <updated>2016-05-06T18:24:18+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part13</id>
    <content type="html"><![CDATA[<p>现在准备要构建一个工具，用来把<a href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part7/">ANTLR 4权威参考读书笔记（7）</a>中idata.txt里的数据按group分行显示，就像这样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>2 9 10
</span><span class='line'>3 1 2 3</span></code></pre></td></tr></table></div></figure>

<p>我们可以借助语法分析树的Listener机制来对词法分析结束后生成的记号流进行改写，我们不需要实现每一个Listener接口方法，只需要在捕获到group的时候把换行符插到它末尾就行。实现改写的代码如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import org.antlr.v4.runtime.TokenStream;
</span><span class='line'>import org.antlr.v4.runtime.TokenStreamRewriter;
</span><span class='line'>
</span><span class='line'>public class RewriteListener extends IDataBaseListener {
</span><span class='line'>    TokenStreamRewriter rewriter;
</span><span class='line'>
</span><span class='line'>    public RewriteListener(TokenStream tokens) {
</span><span class='line'>        rewriter = new TokenStreamRewriter(tokens);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void enterGroup(IDataParser.GroupContext ctx) {
</span><span class='line'>        rewriter.insertAfter(ctx.stop, '\n');
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>接着就是写一个小程序来调用我们上面的改写类：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import org.antlr.v4.runtime.*;
</span><span class='line'>import org.antlr.v4.runtime.tree.*;
</span><span class='line'>import java.io.FileInputStream;
</span><span class='line'>import java.io.InputStream;
</span><span class='line'>
</span><span class='line'>public class IData {
</span><span class='line'>
</span><span class='line'>    public static void main(String[] args) throws Exception {
</span><span class='line'>        InputStream is = args.length &gt; 0 ? new FileInputStream(args[0]) : System.in;
</span><span class='line'>
</span><span class='line'>        ANTLRInputStream input = new ANTLRInputStream(is);
</span><span class='line'>        IDataLexer lexer = new IDataLexer(input);
</span><span class='line'>        CommonTokenStream tokens = new CommonTokenStream(lexer);
</span><span class='line'>        IDataParser parser = new IDataParser(tokens);
</span><span class='line'>        ParseTree tree = parser.file();
</span><span class='line'>
</span><span class='line'>        RewriteListener listener = new RewriteListener(tokens);
</span><span class='line'>
</span><span class='line'>        System.out.println("Before Rewriting");
</span><span class='line'>        System.out.println(listener.rewriter.getText());
</span><span class='line'>
</span><span class='line'>        ParseTreeWalker walker = new ParseTreeWalker();
</span><span class='line'>        walker.walk(listener, tree);
</span><span class='line'>
</span><span class='line'>        System.out.println("After Rewriting");
</span><span class='line'>        System.out.println(listener.rewriter.getText());
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>这里的关键是TokenStreamRewriter对象知道如何在不修改流的情况下提供一个记号流的修改过的视图。它把所有的操作方法当作指令并把它们排进队列，等到在遍历记号流把它作为文本渲染回去的时候延迟执行。每次我们调用getText()时rewriter就会执行那些指令。</p>

<p>最后就是构建和测试应用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>antlr IData.g
</span><span class='line'>compile *.java
</span><span class='line'>run IData idata.txt</span></code></pre></td></tr></table></div></figure>

<p>以下是输出结果：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Before Rewriting
</span><span class='line'>29103123
</span><span class='line'>After Rewriting
</span><span class='line'>2910
</span><span class='line'>3123</span></code></pre></td></tr></table></div></figure>

<p>仅用几行代码，我们就能够没有任何烦恼地对某些内容做轻微的调整。这种策略对于源代码检测或重构这类一般性的问题是非常有效的。TokenStreamRewriter是一个非常强大且有效的操作记号流的方法。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[开发者被灯光蒙蔽了双眼]]></title>
    <link href="http://codemany.com/blog/developers-are-blinded-by-the-light/"/>
    <updated>2016-04-30T23:08:43+08:00</updated>
    <id>http://codemany.com/blog/developers-are-blinded-by-the-light</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://programmingzen.com/2008/12/30/developers-are-blinded-by-the-light/">http://programmingzen.com/2008/12/30/developers-are-blinded-by-the-light/</a></p>

<blockquote>
<p>Blinded by the light,<br>
revved up like a deuce,<br>
another runner in the night<br>
— Bruce Springsteen</p>
</blockquote>

<p>人类在计算几率方面是异常地差。我们有限的经验强烈地影响着我们对事件的可能性的认知。例如，我们往往极大地高估由恐怖袭击、意外枪支走火或者飓风引起死亡的几率，并且极大地低估像坠落、溺水或者流感死亡的原因。其原因是媒体经常提醒我们恐怖主义、飓风的危险或者关于孩子们被意外射杀的瞬间故事。你很少发现关于一个人溺水、坠落或者由于流感死亡的故事在国家新闻频道上被报道。新闻报道有一种倾向是耸人听闻，为的是引起人们的注意和钩住大量的观众，因此当谈到估计什么可能/不可能发生时它们促成人们的偏见。</p>

<p>同样的，在电视和报纸上过度曝光心花怒放的彩票中奖者举起他们超大的支票往往歪曲人们对通过购买一注彩票胜利的可能性的认知。对这个问题持一个严谨和客观的态度将会很快揭露中奖的几率比它们表面上看起来的要差得多。[1]</p>

<p>我注意到这种情况也正在开发/创业的世界里发生。这是一波新的淘金热。太多的开发者正在试图建立下一个大的社交网络，成为下一个Facebook（或YouTube），聚集数以百万计的人群，希望被大公司以一笔数量荒谬的钱收购。媒体喜欢这类故事。</p>

<p>因此，正在试图构建下一个Facebook的开发者类似于彩票买家。他们中的一些人会成功和获胜，但大部分人会惨遭失败。我们真正需要多少社交网络？广告支撑的模式适合某些设法吸引庞大的人群同时保持其费用最低（例如PlentyOfFish）或者被收购（例如YouTube，它也在花Google的钱）的幸运的公司。在这个过程中其他人都是在烧钱以及浪费VC的钱和诚意。</p>

<p>我担心很多开发者被灯光蒙蔽了双眼。他们对获得成功的真实几率的认知受到了媒体连续报道的百万——如果不是10亿——美元收购和成功故事的扭曲。而且有些VC鼓励这种行为，希望能在他们的投资上看到高回报。毕竟这些都是非常富有的人，他们对小规模的成功不感兴趣。</p>

<p>除了明显的浪费时间和资源之外，我认为许多开发者为了追求极不可能的结果放弃了极好的机会。用一个传统商业计划挣1,000万的可能性和按YouTube的方式挣10亿的可能性的比例，与这些金额能负担得起你的不同生活质量不成正比。如果你破产了，有3万美元的信用卡债务，或者你是中产阶级，你会发现1,000万美元可以提高的生活质量总是远远超过从1,000万到10亿能提高的。而且重要的是，我们要认识到瞄准尽管更小，但更有可能的结果不会以任何方式阻止你以后的“伟大梦想”，一旦你的第一次（或者第一次成功的）创业已经取得了成功。</p>

<p>你愿意参加20次有1次胜利机会的100万美元抽奖，还是50,000,000次有1次机会的5亿美元抽奖？理性的人会选择第1个，然而在今天，大部分创业公司都倾向于选择第2个。他们这么做是因为他们极大地高估了他们以第2个抽奖成功的几率。</p>

<p>创建一个产品并让人们为它付费。不要拿VC的钱，除非你真的不考虑依靠自己的力量启动你的公司。软件世界的主要优点之一是在开始的时候极少量的资本需要。如果你想做Web应用，可以使用软件即服务（SaaS）模型，让你的用户为你提供的软件和服务付费。你将会有更加少的受众，更少的可伸缩性问题和费用，以及有更多的收入和更大的盈利机会。Joel Spolsky（和<a href="http://www.joelonsoftware.com/items/2008/12/29.html">他那华丽的办公空间</a>）挣得数百万收入是因为他的公司在出售一套Web版的bug追踪器。你知道有多少免费的bug追踪器？在这个市场上存在多少竞争对手？我确信有许多。然而，虽然Joel的人气毫无疑问地帮助到了他的公司，但此案例仍然展示了一个企业如何通过构建一个更好的产品而成功。</p>

<p>就像David Heinemeier Hansson提及的，有无数不受关注的公司在像那样挣钱。[2]如果你把视线从聚光灯上移开，你将看到许多公司在它们所做的事情上面非常成功，尽管它们不出名或者没有制造新闻头条。它们中的有些公司实际上努力不去吸引太多的关注到它们的成功上（经常用数百万美元来衡量），以便防止竞争对手的涌现。</p>

<p>不管你的名字是不是家喻户晓，你甚至不必创建Web应用才能非常成功。你可能会想到为智能手机包括iPhone开发移动应用。但是良好的老式桌面应用让各种各样的软件公司继续发展。这就是为什么“你不能再用商业桌面软件挣钱，或者桌面应用都死了”的扭曲的认知太荒谬的原因。作为开发者/微型ISV/创业公司，你用良好设计的桌面软件挣钱的机会远远高于构建任何一款YouTube、Flickr或者Facebook复制品的机会。</p>

<p>要了解我们的认知是怎么被扭曲的，你只需要和那些公开分享它们软件销售统计的公司交谈。你将会被用相对普通的软件挣到钱的数额震惊。Balsamiq制作了一款UI草图应用卖79美元。作者成功挣到了<a href="http://www.balsamiq.com/blog/?p=424">10万美元收入在前5个月</a>，大部分是通过销售应用的桌面版本。在这个产业里他当然远非最大的赢家之一。我提到这个不过是因为它表明那是一个非常不错的想法，很好执行，当你让你的用户付费时能很快带来收入。如果你认为在5个月里10万美元很少，那我来问你有多少免费网站达成一个类似的每月收入净额。如果你正在寻找更大的收入，了解下Omni Graffle，它给<a href="http://www.omnigroup.com/applications/OmniGraffle/">Omni Group</a>赚取了数百万美元，或者把你的目光放到B2B应用上（在那个市场里某些应用卖上千美元一份）。</p>

<p>当许多开发者被灯光蒙蔽了双眼的时候，有创业想法的智者正在建立真正的软件业务。我请你走出来做同样的事情。</p>

<p>脚注</p>

<p>[1] 我在这里总结的概念被Dan Gilbert在<a href="http://www.ted.com/index.php/talks/dan_gilbert_researches_happiness.html">这个TED演讲</a>里更详细地说明了。</p>

<p>[2] David Heinemeier Hansson在<a href="http://www.37signals.com/svn/posts/1495-the-untold-millions">他的一篇帖子</a>中持类似的观点，该帖给了本文以灵感。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（12）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part12/"/>
    <updated>2016-04-26T10:20:44+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part12</id>
    <content type="html"><![CDATA[<ul>
<li>sentinel 哨兵</li>
<li>tag 标签</li>
</ul>

<p>目前我们看到的输入文件都只包含一种语言，但在实际应用中我们会遇到有些包含多种语言的常用文件格式。例如，Java的文档注释，XML文件等。这些环绕着模板表达式的文本需要不同的处理方式，它们被称为孤岛语言。</p>

<p>ANTLR有提供一个称之为“词法模型”的词法分析器特性，它让我们可以很容易地处理包含混合格式的文件。基本思路是：当词法分析器看到特殊的哨兵字符序列时，让它在模式之间来回切换。</p>

<p>XML是一个很好例子，它通常会在同一个文件中包含不同的词法结构。一个XML语法分析器会把除标签和实体引用（例如&hearts;）之外的任何东西当作文本块。当词法分析器看到<code>&lt;</code>时，它切换到“inside”模式；当它看到<code>&gt;</code>或<code>/&gt;</code>时，就切换回默认模式。以下语法展示了该特性是如何工作的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lexer grammar XMLLexer;
</span><span class='line'>
</span><span class='line'>// Default "mode": Everything OUTSIDE of a tag
</span><span class='line'>OPEN        :   '&lt;'                 -&gt; pushMode(INSIDE) ;
</span><span class='line'>COMMENT     :   '&lt;!--' .*? '--&gt;'    -&gt; skip ;
</span><span class='line'>EntityRef   :   '&' [a-z]+ ';' ;
</span><span class='line'>TEXT        :   ~('&lt;'|'&')+ ;    // match any 16 bit char minus &lt; and &
</span><span class='line'>
</span><span class='line'>// ----------------- Everything INSIDE of a tag ---------------------
</span><span class='line'>mode INSIDE;
</span><span class='line'>
</span><span class='line'>CLOSE       :   '&gt;'                 -&gt; popMode ;    // back to default mode
</span><span class='line'>SLASH_CLOSE :   '/&gt;'                -&gt; popMode ;
</span><span class='line'>EQUALS      :   '=' ;
</span><span class='line'>STRING      :   '"' .*? '"' ;
</span><span class='line'>SlashName   :   '/' Name ;
</span><span class='line'>Name        :   ALPHA (ALPHA|DIGIT)* ;
</span><span class='line'>S           :   [ \t\r\n]           -&gt; skip ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>ALPHA       :   [a-zA-Z] ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>DIGIT       :   [0-9] ;</span></code></pre></td></tr></table></div></figure>

<p>把上述语法保存为XMLLexer.g文件，然后使用包含以下内容的t.xml文件作为输入来测试它：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;tools&gt;
</span><span class='line'>  &lt;tool name="ANTLR"&gt;A parser generator&lt;/tool&gt;
</span><span class='line'>&lt;/tools&gt;</span></code></pre></td></tr></table></div></figure>

<p>以下是构建和运行测试的命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>antlr XMLLexer.g
</span><span class='line'>compile *.java
</span><span class='line'>grun XML tokens -tokens t.xml</span></code></pre></td></tr></table></div></figure>

<p>这里是输出的内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[@0,0:0='&lt;',&lt;1&gt;,1:0]
</span><span class='line'>[@1,1:5='tools',&lt;10&gt;,1:1]
</span><span class='line'>[@2,6:6='&gt;',&lt;5&gt;,1:6]
</span><span class='line'>[@3,7:10='\r\n  ',&lt;4&gt;,1:7]
</span><span class='line'>[@4,11:11='&lt;',&lt;1&gt;,2:2]
</span><span class='line'>[@5,12:15='tool',&lt;10&gt;,2:3]
</span><span class='line'>[@6,17:20='name',&lt;10&gt;,2:8]
</span><span class='line'>[@7,21:21='=',&lt;7&gt;,2:12]
</span><span class='line'>[@8,22:28='"ANTLR"',&lt;8&gt;,2:13]
</span><span class='line'>[@9,29:29='&gt;',&lt;5&gt;,2:20]
</span><span class='line'>[@10,30:47='A parser generator',&lt;4&gt;,2:21]
</span><span class='line'>[@11,48:48='&lt;',&lt;1&gt;,2:39]
</span><span class='line'>[@12,49:53='/tool',&lt;9&gt;,2:40]
</span><span class='line'>[@13,54:54='&gt;',&lt;5&gt;,2:45]
</span><span class='line'>[@14,55:56='\r\n',&lt;4&gt;,2:46]
</span><span class='line'>[@15,57:57='&lt;',&lt;1&gt;,3:0]
</span><span class='line'>[@16,58:63='/tools',&lt;9&gt;,3:1]
</span><span class='line'>[@17,64:64='&gt;',&lt;5&gt;,3:7]
</span><span class='line'>[@18,65:66='\r\n',&lt;4&gt;,3:8]
</span><span class='line'>[@19,67:66='&lt;EOF&gt;',&lt;-1&gt;,4:0]</span></code></pre></td></tr></table></div></figure>

<p>上面输出的每一行代表一个记号，包含记号索引、开始和结束字符、记号文本、记号类型，最后的行和字符位置则告诉我们词法分析器如何标记化输入。</p>

<p>在命令行中，XML tokens序列处通常是一个语法名字后面跟着开始规则，但在这里，我们使用语法名字后面跟着特殊的规则名字tokens来告诉TestRig应该运行词法分析器而不是语法分析器。接着使用选项-tokens打印出匹配的记号列表。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（11）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part11/"/>
    <updated>2016-04-18T18:13:27+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part11</id>
    <content type="html"><![CDATA[<p>为制作语言应用，我们必须为每个输入短语或子短语执行一些适当的代码，那样做最简单的方法是操作由语法分析器自动创建的语法分析树。</p>

<p>早些时候我们已经学习了词法分析器处理字符和把记号传递给语法分析器，然后语法分析器分析语法和创建语法分析树的相关知识。对应的ANTLR类分别是CharStream、Lexer、Token、Parser和ParseTree。连接词法分析器和语法分析器的管道被称为TokenStream。下图说明了这些类型的对象如何连接到内存中其它的对象。</p>

<p><img src="http://codemany.com/uploads/basic-data-structure.png" title="basic-data-structure" ></p>

<p>这些ANTLR数据结构分享尽可能多的数据以便节省内存的需要。上图显示在语法分析树中的叶子（记号）节点含有在记号流中记号的点。记号记录开始和结束字符在CharStream中的索引，而不是复制子串。这里没有与空格字符有关的记号，因为我们假设我们的词法分析器扔掉了空格。</p>

<p>下图显示的是ParseTree的子类RuleNode和TerminalNode以及它们所对应的子树根节点和叶子节点。RuleNode包含有方法如getChild()和getParent()等，但RuleNode并不专属于特定语法所有。为支持更好地访问在特定节点中的元素，ANTLR为每个规则生成一个RuleNode子类。下图为我们显示了赋值语句例子的子树根节点的特定类，它们是StatContext、AssignContext和ExprContext：</p>

<p><img src="http://codemany.com/uploads/parse-tree-node.png" title="parse-tree-node" ></p>

<p>因为它们记录了我们知道的通过规则对短语识别的每件事，所以这些被称为上下文对象。每个上下文对象知道被识别短语的开始和结束记号以及提供对所有短语的元素的访问。例如，AssignContext提供方法ID()和expr()去访问标志符节点和表达式子树。</p>

<p>给出了具体类型的描述，我们可以手工写代码去执行树的深度优先遍历。当我们发现和完成节点时我们可以执行任何我们想要的动作。典型的操作是诸如计算结果，更新数据结构，或者生成输出。相比每次为每个应用写同样的树遍历样板代码，我们可以使用ANTLR自动生成的树遍历机制。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（10）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part10/"/>
    <updated>2016-04-08T22:11:39+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part10</id>
    <content type="html"><![CDATA[<p>一个模棱两可的短语或句子通常是指它有不止一种解释。换句话说，短语或句子能适配不止一种语法结构。要解释或转换一个短语，程序必须要能唯一地确认它的含义，这意味着我们必须提供无歧义的语法，以便生成的语法分析器能用明确的一个方法匹配每个输入短语。</p>

<p>在这里，让我们展示一些有歧义的语法以便让二义性的概念更具体。如果你以后在构建语法时陷入二义性，你可以参考本节的内容。</p>

<p>一些明显有歧义的语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>assign
</span><span class='line'>    : ID '=' expr    // 匹配一个赋值语句，例如f()
</span><span class='line'>    | ID '=' expr    // 前面选项的精确复制
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>expr
</span><span class='line'>    : INT ;</span></code></pre></td></tr></table></div></figure>

<p>大多数时候二义性是不明显的，如同以下的语法，它能通过规则stat的两个选项匹配函数调用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>stat
</span><span class='line'>    : expr          // 表达式语句
</span><span class='line'>    | ID '(' ')'    // 函数调用语句
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>expr
</span><span class='line'>    : ID '(' ')'
</span><span class='line'>    | INT
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>这里是两个输入f()的解释，从规则stat开始：</p>

<p><img src="http://codemany.com/uploads/fn-parse-tree.png" title="fn-parse-tree" ></p>

<p>左边的语法分析树显示f()匹配规则expr。右边的语法分析树显示f()匹配规则stat的第二个选项。</p>

<p>因为大部分语言它们的语法都被设计成无歧义的，有歧义的语法类似于编程缺陷。我们需要识别语法以便为每个输入短语提交单一选择给语法分析器。如果语法分析器发现一个有歧义的短语，它必须选一个可行的选项。ANTLR通过选择涉及决定的第一个选项解决二义性。在本例中，语法分析器将选择与左边的语法分析树有关的f()的解释。</p>

<p>二义性可以发生在词法分析器中也能发生在语法分析器中，但ANTLR可以自动地解决它们。ANTLR通过使输入字符串和语法中第一个指定的规则匹配来解决词法二义性。为了明白这是如何工作的，让我们看看对大部分编程语言都很普遍的二义性：在关键字和标志符规则中的二义性。关键字begin（后面有个非字母）也是标志符，至少词法上，因此词法分析器可以匹配b-e-g-i-n到两者中的任何一个规则。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>BEGIN : 'begin' ;    // 匹配b-e-g-i-n序列，即把二义性解析为BEGIN
</span><span class='line'>ID    : [a-z]+ ;     // 匹配一个或多个任意小写字母</span></code></pre></td></tr></table></div></figure>

<p>注意，词法分析器会试着为每个记号尽可能匹配最长的字符串，这意味着输入beginner将仅匹配规则ID。词法分析器不会把beginner匹配成BEGIN随后ID匹配输入ner。</p>

<p>有时候语言的语法就明显有歧义，没有任何的语法重组能改变这个事实。例如，算术表达式的自然语法可以用两种方式解释输入像1+2*3这样，要么执行运算符从左到右，要么像大部分语言那样按优先级顺序。</p>

<p>C语言展示了另一种二义性，但我们可以使用上下文信息比如标志符如何被定义来解决它。考虑代码片段i*j;。在语法上，它看起来像是一个表达式，但它的含义或者语义依赖i是类型名还是变量。如果i是类型名，那么这个片段不是表达式，而是一个声明为指向类型i的指针变量j。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（9）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part9/"/>
    <updated>2016-03-27T07:10:05+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part9</id>
    <content type="html"><![CDATA[<ul>
<li>predication 预测</li>
<li>predict 预判</li>
<li>lookahead 预读</li>
</ul>

<p>ANTLR工具根据语法规则，例如我们刚才看到的assign，生成递归下降语法分析器。递归下降语法分析器只是递归方法的一个集合，每个规则一个方法。下降这个术语指的是分析从语法分析树的根开始向着叶子进行（记号）。我们首先调用的规则，即stat符号，成为语法分析树的根。那也就意味着对<a href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part8/">ANTLR 4权威参考读书笔记（8）</a>中的语法分析树来说需要调用方法stat()。这类分析更通用的术语是自顶向下分析：递归下降语法分析器仅仅是自顶向下语法分析器实现的一种。</p>

<p>要了解递归下降语法分析器是什么样子，这里是ANTLR为规则assign生成的方法（稍微整理）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// assign : ID '=' expr ;
</span><span class='line'>void assign() {    // 根据规则assign生成的方法
</span><span class='line'>    match(ID);     // 比较ID和当前输入符号然后消费
</span><span class='line'>    match('=');
</span><span class='line'>    expr();        // 通过调用expr()匹配表达式
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>递归下降语法分析器最酷的部分是通过调用方法stat()、assign()和expr()跟踪出的调用关系图反映了内部的语法分析树节点。match()的调用对应语法分析树叶子。为了在一个手工构建的语法分析器中手动构建一颗语法分析树，我们需要在每个规则方法的开始处插入“添加新子树根”操作，以及给match()一个“添加新叶子节点”操作。</p>

<p>方法assign()只是检查确保所有必要的记号存在且以正确的顺序。当语法分析器进入assign()时，它不必在多个选项之间进行选择。选项是规则定义右边的选择之一。例如，调用assign的stat规则可能有其它类型的语句。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** 匹配起始于当前输入位置的任何语句 */
</span><span class='line'>stat
</span><span class='line'>    : assign    // 第一个选项（'|'是选项分隔符）
</span><span class='line'>    | ifstat    // 第二个选项
</span><span class='line'>    | whilestat
</span><span class='line'>    ...
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>stat的分析规则看起来像一条switch语句：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>void stat() {
</span><span class='line'>    switch ( «current input token» ) {
</span><span class='line'>        CASE ID : assign(); break;
</span><span class='line'>        CASE IF : ifstat(); break;    // IF是关键字'if'的记号类型
</span><span class='line'>        CASE WHILE : whilestat(); break;
</span><span class='line'>        ...
</span><span class='line'>        default : «raise no viable alternative exception»
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>方法stat()必须通过检查下一个输入记号作出分析决定或预测。分析决定预判哪一个选项将会成功。在本例中，当看到WHILE关键字时会预判是规则stat的第三个选项。规则方法stat()然后就会调用whilestat()。你以前可能听说过术语预读记号，那只是下一个输入记号。预读记号可以是语法分析器在匹配和消费它之前嗅探的任何记号。</p>

<p>有时候，语法分析器需要一些预读记号去预判哪个选项会成功。它甚至必须考虑从当前位置直到文件结尾的所有的记号。ANTLR默默地为你处理所有的这些事情，但是对决策过程有个基本的了解是有帮助的，可以让调试生成的语法分析器更容易。</p>

<p>为更好地理解分析决定，想象有个单一入口和单一出口的迷宫，有单词写在地板上。每个沿着从入口到出口路径的单词序列表示一个句子。迷宫的结构与定义一门语言的语法规则类似。为测试一个句子在一门语言中的成员身份，我们在穿越迷宫时把句子的单词和沿着地板的单词作比较。如果通过句子的单词我们能到达出口，那么句子是有效的。</p>

<p>为了通过迷宫，我们必须在每个岔口选择一条有效路径，正如我们必须在语法分析器中选择选项。我们必须决定该走哪条路，通过把我们句子中下一个单词（们）和沿着来自每个岔口的每条路径上可见的单词比较。我们能从岔口看到的单词与预读记号类似。当每条路径以唯一的单词开始时决定是相当容易的。在规则stat中，每个选项从唯一的记号开始，因此stat()可以通过查看第一个预读记号识别选项。</p>

<p>当单词从一个岔口重叠部分开始每条路径时，语法分析器需要继续往前看，扫描可以识别选项的单词。ANTLR根据需要为每个决定自动上下调节预读数量。如果预读的结果是多条同样的到出口的路径，即当前的输入短语有多种解释。解决这样的二义性将是我们的下一个主题。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[哪些书不要读]]></title>
    <link href="http://codemany.com/blog/books-not-recommended/"/>
    <updated>2016-03-25T19:48:57+08:00</updated>
    <id>http://codemany.com/blog/books-not-recommended</id>
    <content type="html"><![CDATA[<p>为什么要列这个资源？因为某些书读完之后往往会有浪费时间的感觉。为了帮助各位读者节省时间，我决定在我看过的书中选出一份合适的书单，并给出我的观点，方便读者在购书和选书时作出取舍。本清单离详尽还很远（会不断更新的），而且难免带有本人的主观偏见，所以各位如果觉得有什么错漏的话，可以在评论区给我留言。</p>

<h3 id="计算机">计算机</h3>

<h4 id="《像程序员一样思考》"><a href="https://book.douban.com/subject/24733747/">《像程序员一样思考》</a></h4>

<p>点评：这是一本教你学会如何解决编程问题的书。但实际上只有第1、第7和第8章值得一读。</p>

<h3 id="经济学">经济学</h3>

<h4 id="《郎咸平说：我们的日子为什么这么难》"><a href="https://book.douban.com/subject/5283699/">《郎咸平说：我们的日子为什么这么难》</a></h4>

<p>点评：提出的观点都是当前大家关心的问题，可惜他只是财务和公司治理专家，不是经济学专家，所提的解决方案或说的话也只是让大家心中的郁闷可以有机会发泄下，所以郎咸平的其它关于经济学的书籍你就可以不要看了。如果你想学公司财务方面的东西，那么他的论文（注意不是书，是发表过的学术论文）是一定要读的。延伸阅读是东方出版社搞的，而非郎咸平，推荐的也都是该出版社的书。</p>

<h4 id="《货币战争》"><a href="https://book.douban.com/subject/2081876/">《货币战争》</a></h4>

<p>点评：又是一本博大众眼球的书。可是一个连美联储是私有的都要当作秘密大声来讲的作者你就知道他是什么水平了，这些可是人家美联储官方网站上都黑纸白纸写出来的。其它什么断章取义、胡乱拼凑的就不要讲了，我读了一部分就看不下去，把它扔角落里去了。以前还写过一篇<a href="http://codemany.com/blog/how-currency-wars-confuse-reader-opnion">博文</a>来讲这本书是如何混淆读者视听的，只是可惜没有完成。</p>

<h4 id="《魔鬼经济学》"><a href="https://book.douban.com/subject/1473250/">《魔鬼经济学》</a></h4>

<p>点评：引用郭凯的话“虽然书里的每个故事都是基于作者的实证研究，可是他的那些实证研究没有一个不存在致命缺陷，他所有的结论事后都被更仔细的研究推翻了。”</p>

<h4 id="《13个严重的经济学谬误》"><a href="https://book.douban.com/subject/4884855/">《13个严重的经济学谬误》</a></h4>

<p>点评：这本书有点专业，且翻译的极为糟糕，好些语句和段落不甚通顺，所以部分内容读起来有种似是而非的感觉。翻译后的书名加上“经济学的真相”，完全是想用耸人听闻的标题吸引读者的注意。该书最值得看的是《前言》和《一份经济学研究方法的备忘录》，尤其是后者，可以让你了解一些经济学观点是怎么得出的。谬误1整篇文章几乎看不出是在证明命题的错误；谬误3中的印度可以用中国替代。作者的观点看似有理其实偏颇，看过郭凯的《王二的经济学故事》中关于汇率的文章就可以知道，印度出口商品换成美元结余，只劳动不消费，相当于给美国白打工；印度坚持高估美元，虽然可以保持它在与美国贸易中的顺差地位，但这种强制性的高估实际上是在用贸易补贴美国。谬误5虽然讲的有道理，但实在想不明白作者是如何得到租金限制法令的几个特征的！谬误7中房屋的建筑成本是不包含土地价格的，这种违背常识的假设会增加理解的困难。而且，设定房屋价格后再去谈论削减建筑成本不会影响房价，怎么看怎么觉得奇怪，虽然我同意他关于削减建筑成本不会降低房价的观点。谬误9的第4段翻译的极其马虎，明显有两个人翻译的痕迹，错字漏字导致边际成本傻傻的说不清。</p>

<h4 id="《一切皆有价》"><a href="https://book.douban.com/subject/6519849/">《一切皆有价》</a></h4>

<p>点评：书名标题很诱人，容易引起读者进一步阅读的欲望，可惜内容只是大量数据和案例的罗列，毫无作者自己的观点。</p>

<h3 id="书法">书法</h3>

<h4 id="《书法有法》"><a href="https://book.douban.com/subject/5247986/">《书法有法》</a></h4>

<p>点评：全书可用“转笔”二字一言蔽之。但疑惑的是，既然她这么推崇转笔，并且通过私相授受的方式从长辈手中得以传承这个笼罩着神秘、高深莫测、技巧高难、妙不可言的笔法的不传之秘，为什么她在书写时却几乎不用呢？而且文中对古人论述书法的言论的解释多有牵强附会之处。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[贫富差距精简版]]></title>
    <link href="http://codemany.com/blog/economic-inequality-the-short-version/"/>
    <updated>2016-03-21T20:40:27+08:00</updated>
    <id>http://codemany.com/blog/economic-inequality-the-short-version</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://paulgraham.com/sim.html">http://paulgraham.com/sim.html</a></p>

<p>2016年1月</p>

<p><em>正如经常发生的那样——当说一些有争议的话题时，已经有我刚写的一篇贫富差距的文章的一些非常新奇的解释。我想这可能有助于澄清问题，如果我试着写一个简简单单、没有误解的版本。</em></p>

<p>很多人谈论贫富差距。几乎所有人都说贫富差距增大是坏的，贫富差距缩小是好的。</p>

<p>但是贫富差距本身并非坏事。它有多方面的原因。很多是坏的，但有些是好的。</p>

<p>例如，高入狱率和税收漏洞是增大贫富差距的不良因素。</p>

<p>但是创业同样地增大贫富差距。创业成功的创始人最终会得到值很多钱的股票。</p>

<p>而且不像高入狱率和税收漏洞，创业整体上是好的。</p>

<p>既然贫富差距本身并非坏事，我们就不应该攻击它。相反，我们应该攻击那些造成贫富差距的不良因素。</p>

<p>例如，我们应该攻击贫穷，而不是攻击贫富差距。</p>

<p>攻击贫富差距是双重错误。它会损害好的和坏的原因。但更糟的是，这是一个攻击坏的原因的无效方式。</p>

<p>除非我们直接攻击坏的贫富差距原因，否则我们不能做好解决它们的工作。</p>

<p>但是，如果我们解决了所有坏的贫富差距原因，我们依然将增加贫富差距的水平，因为正在增长的技术力量。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（8）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part8/"/>
    <updated>2016-03-20T09:57:45+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part8</id>
    <content type="html"><![CDATA[<ul>
<li>syntax analyzer 语法分析器</li>
<li>syntax tree 语法树</li>
<li>sentence 句子</li>
</ul>

<p>一门语言由有效的句子组成，一个句子由短语组成，一个短语由子短语和词汇符号组成。要实现一门语言，我们必须构建一个能读取句子以及对发现的短语和输入符号作出适当反应的应用。</p>

<p>这样的应用必须能识别特定语言的所有有效的句子、短语和子短语。识别一个短语意味着我们能确定短语的各种组件并能指出它与其它短语的区别。例如，我们把输入sp = 100识别为赋值语句，这就意味着我们知道sp是赋值目标以及100是要存储的值。识别赋值语句sp = 100也意味着应用认为它是明显不同于，比如说，a+b语句的。在识别后，应用将执行适当的操作，例如performAssignment(&quot;sp&quot;, 100)或者translateAssignment(&quot;sp&quot;, 100)。</p>

<p>识别语言的程序被称为语法分析器。语法指代控制语言成员的规则，每条规则都表示一个短语的结构。为了更容易地实现识别语言的程序，通常我们会把识别语言的语法分析拆解成两个相似但不同的任务或阶段。</p>

<p>把字符组成单词或符号（记号）的过程被称为词法分析或简单标记化。我们把标记输入的程序称为词法分析器。词法分析器能把相关的记号组成记号类型，例如INT（整数）、ID（标志符）、FLOAT（浮点数）等。当语法分析器只关心类型的时候，词法分析器会把词汇符号组成类型，而不是单独的符号。记号至少包含两块信息：记号类型（确定词法结构）和匹配记号的文本。</p>

<p>第二阶段是真正的语法分析器，它使用这些记号去识别句子结构，在本例中是赋值语句。默认情况下，ANTLR生成的语法分析器会构建一个称为语法分析树或语法树的数据结构，它记录语法分析器如何识别输入句子的结构和它的组件短语。下图阐明了语言识别器的基本数据流：</p>

<p><img src="http://codemany.com/uploads/basic-data-flow.png" title="basic-data-flow" ></p>

<p>语法分析树的内部节点是分组和确认它们子节点的短语名字。根节点是最抽象的短语名字，在本例中是stat（“statement”的缩写）。语法分析树的叶子节点永远是输入记号。</p>

<p>通过生成语法分析树，语法分析器给应用的其余部分提供了方便的数据结构，它们含有关于语法分析器如何把符号组成短语的完整信息。树是非常容易处理的，并且也能被程序员很好的理解。更好的是，语法分析器能自动地生成语法分析树。</p>

<p>通过操作语法分析树，需要识别相同语言的多个应用能重用同一个语法分析器。当然，你也可以选择直接在语法中嵌入特定应用的代码片段，这是语法分析器生成器传统的做法。ANTLR v4仍然允许这样做，但是语法分析树有助于更简洁更解耦的设计。</p>

<p>语法分析树对于需要多次树遍历的转换也是非常有用的，因为在计算依赖关系的阶段通常会需要前一个阶段的信息。相比于在每个阶段都要准备输入字符，我们只需要遍历语法分析树多次，更具有效率。</p>

<p>因为我们用一套规则指定短语，语法分析树子树根节点对应于语法规则名。这里的语法规则对应于上图中assign子树的第一层：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>assign : ID '=' expr ;    // 匹配赋值语句像"sp = 100"</span></code></pre></td></tr></table></div></figure>

<p>明白ANTLR如何把这些规则转换为人类可读的语法分析代码是使用和调试语法的基础，因此让我们深入地挖掘语法分析是如何工作的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（7）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part7/"/>
    <updated>2016-03-11T16:42:08+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part7</id>
    <content type="html"><![CDATA[<ul>
<li>sequence 序列</li>
</ul>

<p>在<a href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part6/">ANTLR 4权威参考读书笔记（6）</a>中的这些操作仅仅是提取和打印被语法分析器匹配的值，它们并没有改变语法分析器本身。</p>

<p>实际上，操作还可以影响语法分析器如何识别输入短语。这类特殊的操作被称为语义谓词。下面我们会用一个简单的例子来展示语义谓词的强大能力：动态地打开和关闭语法的某个部分。</p>

<h3 id="使用语义谓词改变语法分析">使用语义谓词改变语法分析</h3>

<p>有一个读入整数序列的语法，它的玄机是由输入的部分指定有多少个整数组合在一起，所以我们必须等到运行时才能知道有多少整数被匹配。这里是示例输入文件idata.txt的内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>2 9 10 3 1 2 3</span></code></pre></td></tr></table></div></figure>

<p>第1个数字表示匹配后续两个数字9和10；紧跟10的数字3表示匹配接下来的三个数字。我们的目的是设计一个语法IData.g，把9和10组合在一起，把1、2和3组合在一起。在语法上执行以下命令后显示的语法分析树能够清楚地标识出整数的分组，就像下图显示的那样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>antlr -no-listener IData.g
</span><span class='line'>compile *.java
</span><span class='line'>grun IData file -gui idata.txt</span></code></pre></td></tr></table></div></figure>

<p><img src="http://codemany.com/uploads/idata-parse-tree.png" title="idata-parse-tree" ></p>

<p>要达成这个目标，以下语法中的关键是一个被称为语义谓词的布尔值操作：{$i &lt;= $n}?。当谓词计算结果为true时，语法分析器匹配整数直到超过序列规则参数n要求的数量；当计算结果为false时，谓词让相关的选项从生成的语法分析器中“消失”。
在这个案例中，值为false的谓词让(...)*循环从规则序列里终止并返回。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grammar IData;
</span><span class='line'>
</span><span class='line'>file : group+ ;
</span><span class='line'>
</span><span class='line'>group: INT sequence[$INT.int] ;
</span><span class='line'>
</span><span class='line'>sequence[int n]
</span><span class='line'>locals [int i = 1;]
</span><span class='line'>     : ( {$i&lt;=$n}? INT {$i++;} )*    // match n integers
</span><span class='line'>     ;
</span><span class='line'>
</span><span class='line'>INT  : [0-9]+ ;  // match integers
</span><span class='line'>WS   : [ \t\n\r]+ -&gt; skip ;    // toss out all whitespace</span></code></pre></td></tr></table></div></figure>

<p>被语法分析器使用的规则序列的内部语法表示看起来就像下图这样：</p>

<p><img src="http://codemany.com/uploads/idata-rule-sequence.png" title="idata-rule-sequence" ></p>

<p>虚线表明谓词可以剪断那条路径，只给语法分析器留下一个选择：退出的路径。</p>

<p>虽然大部分时间我们不需要这样的微管理，但它至少让我们知道我们有这样的武器可以处理病理分析问题。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google Analytics中如何检测并防止垃圾流量]]></title>
    <link href="http://codemany.com/blog/how-to-detect-and-prevent-spam-traffic-in-ga/"/>
    <updated>2016-02-27T18:38:18+08:00</updated>
    <id>http://codemany.com/blog/how-to-detect-and-prevent-spam-traffic-in-ga</id>
    <content type="html"><![CDATA[<p>使用Google Analytics网站分析工具对博客进行数据统计。在经过一段时间的数据收集后，发现总是会有大量的垃圾流量存在。这里的垃圾流量，指的是对网站毫无作用且会影响网站数据报表质量的流量。通常Google Analytics中的垃圾流量可以分为以下两大类：</p>

<ul>
<li>一类被称为ghost referral，这些流量事实上从来没有来过你的网站，也不会出现在你网站服务器的日志中，但你可以在数据报表中发现它们，它们影响了Google Analytics中的数据；</li>
<li>另一类是爬虫流量，包括搜索引擎爬虫流量和非搜索引擎爬虫流量，这些流量会影响Google Analytics中各渠道流量占比及会话次数、跳出率、停留时间等关键指标。</li>
</ul>

<h3 id="垃圾流量检测方法">垃圾流量检测方法</h3>

<p>打开报告 -&gt; 受众群体 -&gt; 技术 -&gt; 广告网络 -&gt; 主机名，统计报表如下图所示：</p>

<p><img src="http://codemany.com/uploads/report-with-spam.png" title="report-with-spam" ></p>

<p>可以看到，只有181个会话的主机名是我的博客域名，即真实来到我博客的流量，也就是说有超过一半的流量属于垃圾流量。并且这些垃圾流量基本都出现了不同程度的数据异常，如新会话百分比为0%、新用户为0、跳出率为100%、平均会话时长为00:00:00。这些垃圾流量的主机名与博客域名无关，说明是第一类垃圾流量。出现这类数据的原因可能是：</p>

<ul>
<li>别的网站使用了和你网站相同的媒体资源ID，这种情况一般来说不可能，除非恶意为之；</li>
<li>有人使用Google Analytics中的Measurement Protocol做机器生成的访问流量，而你的媒体资源ID不幸躺枪。</li>
</ul>

<h3 id="使用过滤器屏蔽垃圾流量">使用过滤器屏蔽垃圾流量</h3>

<p>打开“管理”页面，在博客帐号的“所有过滤器”下添加新的过滤条件，使用预定义或自定义均可，基本配置如下所示：</p>

<p><img src="http://codemany.com/uploads/exclude-spam-filter.png" title="exclude-spam-filter" ></p>

<p>然后把“可选择的数据视图”中的选项添加到“选定的数据视图”中，保存即可。</p>

<p>过段时间后再回来查看报表，就会发现垃圾流量消失的干干净净了：</p>

<p><img src="http://codemany.com/uploads/report-without-spam.png" title="report-without-spam" ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ANTLR 4权威参考读书笔记（6）]]></title>
    <link href="http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part6/"/>
    <updated>2016-02-14T16:16:37+08:00</updated>
    <id>http://codemany.com/blog/reading-notes-the-definitive-antlr4-reference-part6</id>
    <content type="html"><![CDATA[<ul>
<li>action 操作</li>
<li>clause 子句</li>
</ul>

<p>Listener和Visitor机制是极好的。大多数时候，我们可以用Listener或Visitor构建语言应用，它们让特定应用的代码置身于语法之外，使语法容易被阅读。</p>

<p>但有时候我们需要额外的控制权和灵活性。为了达到这个目的，我们可以直接在语法中嵌入代码片段（这些嵌入的代码片段被称为操作）。这些操作会被注入到由ANTLR工具生成的分析器代码中。这些被注入的代码在分析期间执行，并且能像其它任意代码片段一样收集信息或生成输出。结合语义谓词，我们甚至可以在运行时让我们语法的某部分消失！例如，我们可能想打开或关闭Java语法中的enum关键词，分析语言的不同版本。没有语义谓词，我们就需要两个不同版本的语法。</p>

<p>下面我们将实现一个简单的程序，读入数据行，然后打印出在特定列中找到的值。</p>

<h3 id="在语法中嵌入任意的操作">在语法中嵌入任意的操作</h3>

<p>如果我们不想付出构建语法分析树的开销，或者想要在分析期间动态地计算值或把东西打印出来，那么可以通过在语法中嵌入任意代码实现。它的比较困难的，因为我们必须明白在语法分析器上的操作的影响，以及在哪里放置这些操作。</p>

<p>为了解释嵌入在语法中的操作，让我们先来看下文件rows.txt中的数据：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>parrt   Terence Parr    101
</span><span class='line'>tombu   Tom Burns       020
</span><span class='line'>bke     Kevin Edgar     008</span></code></pre></td></tr></table></div></figure>

<p>这些列是由TAB分隔的，每一行用一个换行结束。匹配这种类型的输入在语法上还是相当简单的。下面是此语法文件Rows.g的内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file : (row NL)+ ;    // NL is newline token: '\r'? '\n'
</span><span class='line'>row  : STUFF+ ;</span></code></pre></td></tr></table></div></figure>

<p>我们需要创建一个构造器以便我们能传递我们想要的列号（从1开始计数），所以我们需要在规则中添加一些操作来做这些事情：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grammar Rows;
</span><span class='line'>
</span><span class='line'>@parser::members {    // add members to generated RowsParser
</span><span class='line'>    int col;
</span><span class='line'>    public RowsParser(TokenStream input, int col) {    // custom constructor
</span><span class='line'>        this(input);
</span><span class='line'>        this.col = col;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>file: (row NL)+ ;
</span><span class='line'>
</span><span class='line'>row
</span><span class='line'>locals [int i=0]
</span><span class='line'>    : ( STUFF
</span><span class='line'>        {
</span><span class='line'>        $i++;
</span><span class='line'>        if ( $i == col ) System.out.println($STUFF.text);
</span><span class='line'>        }
</span><span class='line'>      )+
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>TAB  :  '\t' -&gt; skip ;    // match but don't pass to the parser
</span><span class='line'>NL   :  '\r'? '\n' ;      // match and pass to the parser
</span><span class='line'>STUFF:  ~[\t\r\n]+ ;      // match any chars except tab, newline</span></code></pre></td></tr></table></div></figure>

<p>在上述语法中，操作是被花括号括起来的代码片段；members操作的代码将会被注入到生成的语法分析器类中的成员区；在规则row中的操作访问的$i是由locals子句定义的局部变量，该操作也用$STUFF.text获取最近匹配的STUFF记号的文本内容。STUFF词法规则匹配任何非TAB或换行的字符，这意味着在列中可以有空格字符。</p>

<p>现在，是时候去思考如何使用定制的构造器传递一个列号给语法分析器，并且告诉语法分析器不要构建语法分析树了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class Rows {
</span><span class='line'>
</span><span class='line'>    public static void main(String[] args) throws Exception {
</span><span class='line'>        ANTLRInputStream input = new ANTLRInputStream(System.in);
</span><span class='line'>        RowsLexer lexer = new RowsLexer(input);
</span><span class='line'>        CommonTokenStream tokens = new CommonTokenStream(lexer);
</span><span class='line'>        int col = Integer.valueOf(args[0]);
</span><span class='line'>        RowsParser parser = new RowsParser(tokens, col);    // pass column number!
</span><span class='line'>        parser.setBuildParseTree(false);    // don't waste time bulding a tree
</span><span class='line'>        parser.file();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>现在，让我们核实下我们的语法分析器能否正确匹配一些示例输入：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>antlr -no-listener Rows.g  # don't need the listener
</span><span class='line'>compile *.java
</span><span class='line'>run Rows 1 &lt; rows.txt</span></code></pre></td></tr></table></div></figure>

<p>这时你会看到rows.txt文件的第1列内容被输出：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>parrt
</span><span class='line'>tombu
</span><span class='line'>bke</span></code></pre></td></tr></table></div></figure>

<p>如果将上面命令中的1换成2，你会看到rows.txt文件的第2列内容被输出；如果换成3，那么rows.txt文件的第3列内容将会被输出。</p>
]]></content>
  </entry>
  
</feed>
