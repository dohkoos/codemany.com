<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[乐者为王]]></title>
  <link href="http://codemany.com/atom.xml" rel="self"/>
  <link href="http://codemany.com/"/>
  <updated>2014-08-25T22:21:52+08:00</updated>
  <id>http://codemany.com/</id>
  <author>
    <name><![CDATA[dohkoos]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Wordpress迁移到Octopress]]></title>
    <link href="http://codemany.com/blog/2014/08/05/migrating-wordpress-to-octopress/"/>
    <updated>2014-08-05T19:15:03+08:00</updated>
    <id>http://codemany.com/blog/2014/08/05/migrating-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p>GitHub Pages提供免费的静态站点托管服务，有两种类型：User/Organization Pages和Project Pages。前者是用户/组织的主页，一个用户/组织仅有一个；后者是每个项目的主页。</p>

<p>安装Octopress时，rake setup_github_pages会要求输入Github Pages项目的URL，根据URL判断是哪种服务。如果是前者，会在新建的<code>_deploy</code>目录上创建master分支，用于存放发布的静态文件，并把原master分支改为source分支；后者则仅在<code>_deploy</code>目录上创建gh-pages分支。</p>

<p>在Wordpress的Tools/Export页面选择导出文章内容，保存为wordpress.xml文件。然后使用工具把它转换成markdown格式。这里使用了YORKXIN的<a href="https://gist.github.com/chitsaou/1394128" title="wordpressdotcom.rb">修改版本</a>，将脚本和wordpress.xml放到Octopress根目录下，然后运行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ruby -r ./wordpressdotcom.rb -e Jekyll::WordpressDotCom.process</span></code></pre></td></tr></table></div></figure>


<p>这个脚本会把转换好的文章都放到source/_posts目录下，文件后缀是html，直接改成markdown就是。</p>

<p>然后就是苦力活：修改文中的站内链接、上传的图片路径以及代码高亮语法。</p>

<p>Octopress默认的permalink是/blog/:year/:month/:day/:title/，想把它改成/:title/这种格式，修改<code>_config.yml</code>中的permalink后，发现生成的文章都跑到了public目录下，默认应该是在public/blog目录里的。为了保持目录的简洁，放弃了permalink的修改。</p>

<p>至于评论的迁移，不想费过多的手脚，直接使用Octopress自带的Disqus。在Wordpress中安装好Disqus插件，通过插件设置将现有的评论内容导入Disqus。不过Disqus处理导入数据的时间有点长，需要等待一段时间，可以在 <a href="http://import.disqus.com">http://import.disqus.com</a> 查看导入进度。导入完成后，把Wordpress文章的permalink改成和Octopress相同，登录Disqus后台，找到Migrate Threads栏目，在Domain Migration Wizard里把旧域名改成新域名，然后一路Next就大功告成了。</p>

<p>不过在实践中碰到了问题，打开某篇有评论的文章，发现只有评论框，没有评论。查看页面源码，负责评论模块的代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;section id="comment"&gt;
</span><span class='line'>&lt;h1 class="title"&gt;Comments&lt;/h1&gt;
</span><span class='line'>&lt;div id="disqus_thread" aria-live="polite"&gt;
</span><span class='line'>  &lt;noscript&gt;Please enable JavaScript to view the &lt;a href="http://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;&lt;/noscript&gt;
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>&lt;/section&gt;</span></code></pre></td></tr></table></div></figure>


<p>搞不明白是怎么回事。后来受到 <a href="http://www.ducea.com/2012/11/12/disqus-comments-not-visible-in-octopress/">http://www.ducea.com/2012/11/12/disqus-comments-not-visible-in-octopress/</a> 的启发，原来是<code>_config.yml</code>中的URL还是生成项目时的，与CNAME中配置的域名不一致，修改后就没问题了。</p>

<p>在侧边栏显示最新评论也很简单，添加recent_comments.html到source/_includes/custom/asides目录下，在<code>_config.yml</code>的default_asides做好配置，最新评论内容就会出现在侧边栏中了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;section&gt;
</span><span class='line'>  &lt;h1&gt;Recent Comments&lt;/h1&gt;
</span><span class='line'>  &lt;div class="dsq-widget"&gt;
</span><span class='line'>    &lt;script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"&gt;&lt;/script&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/section&gt;</span></code></pre></td></tr></table></div></figure>


<p>在侧边栏显示Tag Cloud参照了 <a href="http://codemacro.com/2012/07/18/add-tag-to-octopress/">http://codemacro.com/2012/07/18/add-tag-to-octopress/</a> 教程，没几分钟就搞定了。</p>

<p>分享使用的是JiaThis，只要把source/_includes/post/sharing.html中的代码替换成以下代码就可以：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div id="jiathis_style_32x32"&gt;
</span><span class='line'>  &lt;a class="jiathis_button_qzone"&gt;&lt;/a&gt;
</span><span class='line'>  &lt;a class="jiathis_button_tsina"&gt;&lt;/a&gt;
</span><span class='line'>  &lt;a class="jiathis_button_tqq"&gt;&lt;/a&gt;
</span><span class='line'>  &lt;a class="jiathis_button_weixin"&gt;&lt;/a&gt;
</span><span class='line'>  &lt;a class="jiathis_button_renren"&gt;&lt;/a&gt;
</span><span class='line'>  &lt;a href="http://www.jiathis.com/share/" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"&gt;&lt;/a&gt;
</span><span class='line'>  &lt;a class="jiathis_counter_style"&gt;&lt;/a&gt;
</span><span class='line'>&lt;/div&gt;
</span><span class='line'>&lt;script type="text/javascript" src="http://v2.jiathis.com/code/jia.js" charset="utf-8"&gt;&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>相关文章本想用Octopress自带的lsi模块实现，只是当文章较多时生成速度实在是巨慢，按照推荐安装gsl模块，结果在Windows Server 2008系统上死活装不上，采用手动编译方式也总是死在rb-gsl的安装上。失望之余找到 <a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin">https://github.com/LawrenceWoodman/related_posts-jekyll_plugin</a> 这个插件，它使用起来非常简单，只需将related_posts.rb放到自己的plugins文件夹中，然后在source/_includes/post中新建related_posts.html文件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{ % if site.related_posts % }
</span><span class='line'>  &lt;h3&gt;Related posts&lt;/h3&gt;
</span><span class='line'>  &lt;ul class="posts"&gt;
</span><span class='line'>  { % for post in site.related_posts limit:3 % }
</span><span class='line'>    &lt;li class="related"&gt;
</span><span class='line'>      &lt;a href=""&gt;&lt;/a&gt;
</span><span class='line'>    &lt;/li&gt;
</span><span class='line'>  { % endfor % }
</span><span class='line'>  &lt;/ul&gt;
</span><span class='line'>{ % endif % }</span></code></pre></td></tr></table></div></figure>


<p>修改source/_layouts/post.html，在</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{ % include post/author.html % }
</span><span class='line'>{ % include post/date.html % }{ % if updated % }{ % else % }{ % endif % }
</span><span class='line'>{ % include post/categories.html % }</span></code></pre></td></tr></table></div></figure>


<p>后面添加</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{ % include post/related_posts.html % }</span></code></pre></td></tr></table></div></figure>


<p>就可以了。使用这个插件会有个小问题，就是它和Jekyll 2.1不兼容，rake generate时会报错，可以使用jumanji27提供的<a href="https://github.com/jumanji27/related_posts-jekyll_plugin">fork版本</a>。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nokogiri抓取页面URL含有中文参数的问题]]></title>
    <link href="http://codemany.com/blog/2014/07/17/problem-with-nokogiri-when-url-containing-chinese-character/"/>
    <updated>2014-07-17T22:48:00+08:00</updated>
    <id>http://codemany.com/blog/2014/07/17/problem-with-nokogiri-when-url-containing-chinese-character</id>
    <content type="html"><![CDATA[<p>使用Nokogiri抓取某网站的长江现货数据，被抓取页面的URL中含有中文参数，使用以下的代码抓取数据失败：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url = 'http://example.com/search.asp?type=长江有色&sort=asc'
</span><span class='line'>doc = Nokogiri::HTML(open(url))</span></code></pre></td></tr></table></div></figure>


<p>据 <a href="http://dingr.iteye.com/blog/647244">http://dingr.iteye.com/blog/647244</a> 讲是因为浏览器给服务器发送参数的时候是经过编码的，按照该文的意思试着也给URL里的中文编了下码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url = 'http://example.com/search.asp?type=长江有色&sort=asc'
</span><span class='line'>url = URI.escape(url)
</span><span class='line'>doc = Nokogiri::HTML(open(url))</span></code></pre></td></tr></table></div></figure>


<p>结果还是抓取失败。查看URL的编码信息：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>puts url.encoding  # 输出utf-8</span></code></pre></td></tr></table></div></figure>


<p>网站页面采用的是GB2132编码，猜测网站后台处理数据时很有可能也是采用的GB2132。做个实验就清楚了，将URL转成GB2132后再编码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url = 'http://example.com/search.asp?type=长江有色&sort=asc'
</span><span class='line'>url = url.encode('gbk', 'utf-8')
</span><span class='line'>url = URI.escape(url)
</span><span class='line'>doc = Nokogiri::HTML(open(url))</span></code></pre></td></tr></table></div></figure>


<p>发现果然OK了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[逻辑题-几条病狗]]></title>
    <link href="http://codemany.com/blog/2014/07/09/logic-problems-how-many-sick-dogs/"/>
    <updated>2014-07-09T19:35:00+08:00</updated>
    <id>http://codemany.com/blog/2014/07/09/logic-problems-how-many-sick-dogs</id>
    <content type="html"><![CDATA[<p>村子中有50个人，每人有一条狗，在这50条狗中有病狗（这种病不会传染），于是人们就要找出病狗，每个人可以观察其他49条狗，以判断它们是否生病，只有自己的狗不能看。观察后得到的结果不得交流，也不能通知病狗的主人。主人一旦推算出自己家的是病狗就要枪毙自己的狗，而且每个人只有权利枪毙自己的狗，没有权利打死其他人的狗。第一天，第二天都没有枪响，到了第三天传来一阵枪响，问有几条病狗？</p>

<p>推论：</p>

<p>A、假设有1条病狗，病狗的主人会看到其他狗都没有病，那么就知道自己的狗有病，所以第一天晚上就会有枪响。因为没有枪响，说明病狗数大于1。</p>

<p>B、假设有2条病狗，病狗的主人会看到有1条病狗，因为第一天没有听到枪响，是病狗数大于1，所以病狗的主人会知道自己的狗是病狗，因而第二天会有枪响。既然第二天也没有枪响，说明病狗数大于2。</p>

<p>由此推理，如果第三天枪响，则有3条病狗，第n天枪响，则有n条病狗。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Pry调试Rails项目]]></title>
    <link href="http://codemany.com/blog/2014/07/07/debugging-rails-with-pry/"/>
    <updated>2014-07-07T23:26:08+08:00</updated>
    <id>http://codemany.com/blog/2014/07/07/debugging-rails-with-pry</id>
    <content type="html"><![CDATA[<p>调试Rails程序的工具有ruby-debug、irb、rails-console等，不过现在这些工具都可以歇着了，因为有了Pry。</p>

<p>首先，在Gemfile中申明gem包：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'pry', group: :development</span></code></pre></td></tr></table></div></figure>


<p>然后执行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install</span></code></pre></td></tr></table></div></figure>


<p>用Pry代替irb，直接运行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pry</span></code></pre></td></tr></table></div></figure>


<p>用Pry代替rails console，运行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pry -r ./config/environment.rb</span></code></pre></td></tr></table></div></figure>


<p>调试Rails项目时，在需要调试的地方添加binding.pry，当rails server运行到这行代码时会自动调出一个pry窗口，可以在这里进行交互，退出调试用exit-all。例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def index
</span><span class='line'>  @articles = Article.all
</span><span class='line'>  binding.pry
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>可以使用exit-program命令无条件地退出循环。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(1..100).each do |i|
</span><span class='line'>  binding.pry
</span><span class='line'>  puts i
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Pry默认没有调试中经常用到的上一步，下一步等命令，可以安装pry-nav，然后就可以使用step, next, continue跳来跳去了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Raspberry Pi使用无线网卡]]></title>
    <link href="http://codemany.com/blog/2014/07/06/raspberry-pi-wifi-with-static-ip-address/"/>
    <updated>2014-07-06T20:25:08+08:00</updated>
    <id>http://codemany.com/blog/2014/07/06/raspberry-pi-wifi-with-static-ip-address</id>
    <content type="html"><![CDATA[<p>使用的是EDUP EP-N1556这款无线网卡，体积小巧，支持300M速率，买回来插在RPi上直接就能识别了。</p>

<p>输入lsusb命令，可以见到设备列表中有RTL8192CU 802.11n WLAN Adapter字样，说明网卡已经被系统识别，芯片是RTL8192。</p>

<p>下面就给无线网卡设置静态IP地址：</p>

<p>修改/etc/wpa_supplicant/wpa_supplicant.conf</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
</span><span class='line'>update_config=1
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>  ssid="NETGEAR"
</span><span class='line'>  psk="12345678"
</span><span class='line'>  proto=RSN #也可以写成WPA2
</span><span class='line'>  key_mgmt=WPA-PSK #一定不要写成WPA2-PSK
</span><span class='line'>  id_str="edup1556"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>修改/etc/network/interfaces</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>auto lo
</span><span class='line'>
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'>iface eth0 inet static
</span><span class='line'>  address 192.168.0.100
</span><span class='line'>  netmask 255.255.255.0
</span><span class='line'>  gateway 192.168.0.1
</span><span class='line'>  dns-nameservers 8.8.8.8
</span><span class='line'>
</span><span class='line'>allow-hotplug wlan0
</span><span class='line'>iface wlan0 inet manual
</span><span class='line'>  wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
</span><span class='line'>iface edup1556 inet static
</span><span class='line'>  address 192.168.0.200
</span><span class='line'>  netmask 255.255.255.0
</span><span class='line'>  gateway 192.168.0.1
</span><span class='line'>  dns-nameservers 8.8.8.8
</span><span class='line'>
</span><span class='line'>iface default inet dhcp</span></code></pre></td></tr></table></div></figure>


<p>然后用ifconfig命令列出所有的网络设备，可以看到wlan0的IP是192.168.0.200了。</p>

<p>你的树莓派自由了，不再需要网线拖着了。</p>

<p>参考资料：<br />
<a href="http://hostap.epitest.fi/cgit/hostap/plain/wpa_supplicant/wpa_supplicant.conf">http://hostap.epitest.fi/cgit/hostap/plain/wpa_supplicant/wpa_supplicant.conf</a><br />
<a href="http://www.electroschematics.com/9496/static-manual-ip-wireless-raspberry-pi/">http://www.electroschematics.com/9496/static-manual-ip-wireless-raspberry-pi/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我是如何让Ruby脚本速度提升156倍的]]></title>
    <link href="http://codemany.com/blog/2014/06/28/how-i-made-ruby-script-156x-faster/"/>
    <updated>2014-06-28T13:04:08+08:00</updated>
    <id>http://codemany.com/blog/2014/06/28/how-i-made-ruby-script-156x-faster</id>
    <content type="html"><![CDATA[<p>以前写过<a href="http://codemany.com/blog/2012/08/08/using-ruby-to-batch-rename-filename-from-traditional-to-simplified/">使用Ruby批量修改繁体文件名为简体</a>，可惜脚本的性能很有问题，批量重命名时运行速度非常慢。这次准备优化下代码，提升脚本的执行效率。</p>

<p>profile.rb是为Ruby程序准备的profiler，它可以统计并输出各方法的运行时间，以便于找到程序执行的性能瓶颈。这次就用它来剖析脚本的运行时间。使用方法很简单，加上命令行选项-r profile就可以：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ruby -r profile rename.rb</span></code></pre></td></tr></table></div></figure>


<p>运行结束后，会把统计信息输出到标准错误输出中。如下图所示：</p>

<p><img src="http://codemany.com/uploads/profile-before-tuning.png" title="profile-before-tuning" ></p>

<p>profile统计的是各方法的运行时间，分为两类。一类是计算的是从方法调用到方法返回之间的时间，称为整体时间；另一类则是从整体时间中扣除在该方法中调用其它方法所耗费时间之后得到的时间，称为实际时间。</p>

<p>上图输出信息每行中各字段含义如下（从左到右）：</p>

<ul>
<li>该方法执行时间占整体时间的百分比，比例越高越说明这行代码可能需要优化</li>
<li>整体时间的总和</li>
<li>实际时间的总和</li>
<li>被调用的次数</li>
<li>每次调用的平均实际时间（毫秒）</li>
<li>每次调用的平均整体时间（毫秒）</li>
<li>方法名</li>
</ul>


<p>由上图可以看出，脚本执行的时间大部分耗在了循环上。解决方法有两个：消除循环或减少循环次数。前者很难实现，暂且还没有想到办法，也许根本就没有可能。脚本中mapping的大小为2685，所以每修改一个文件名需要执行2685次循环，且循环中的encode和gsub!都是耗时操作。通常文件名的长度不超过30个字符，通过遍历文件名中每个字符的方式重命名就可以把循环次数缩减到不超过30次。</p>

<p>修改代码后重新执行分析命令，得到的结果是脚本运行时间从379395秒变成2418秒，性能整整提升了156倍，达到2个数量级的效果。</p>

<p><img src="http://codemany.com/uploads/profile-after-tuning.png" title="profile-after-tuning" ></p>

<p>参考资料：<br />
<a href="http://www.kuqin.com/rubycndocument/man/addlib/profile.html">http://www.kuqin.com/rubycndocument/man/addlib/profile.html</a><br />
<a href="http://ruby.about.com/od/advancedruby/a/profile.htm">http://ruby.about.com/od/advancedruby/a/profile.htm</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Raspberry Pi监控室内温湿度]]></title>
    <link href="http://codemany.com/blog/2014/06/24/using-raspberry-pi-to-monitor-humiture/"/>
    <updated>2014-06-24T14:19:44+08:00</updated>
    <id>http://codemany.com/blog/2014/06/24/using-raspberry-pi-to-monitor-humiture</id>
    <content type="html"><![CDATA[<p>机房没有温湿度监控系统，只有温湿度计，还不是数字的，只能得到个大概的读数，不是非常精确。怎么办？自己动手DIY个在线的温湿度监控系统吧！</p>

<p>物品清单：</p>

<ul>
<li>金士顿16G的SDHC卡1张</li>
<li>SDHC读卡器1个（可选）</li>
<li>网线1条</li>
<li>手机充电器（5V～1A）1个</li>
<li>MicroUSB数据线1条</li>
<li>电脑1台</li>
<li>1P-1P双头母杜邦线3条</li>
<li>10K电位器一个</li>
<li>DHT11或DHT22温湿度传感器一个（可以购买已经焊好电阻的传感器模块）</li>
</ul>


<p>1、让树莓派（Raspberry Pi）工作起来</p>

<p>从 <a href="http://www.raspberrypi.org/downloads">http://www.raspberrypi.org/downloads</a> 下载基于debian的wheezy镜像Raspbian。如果使用Windows系统，官方建议使用<a href="http://sourceforge.net/projects/win32diskimager/">Win32DiskImager</a>来复制image文件到SD卡（如果是Linux系统可以用工具dd）。写入系统后，把卡插到板子上，接上网线、电源，然后就启动了。等个20多秒，板上3个小灯都亮了，表明系统已经启动成功。</p>

<p>登录路由器后台找到raspberrypi设备分配到的IP。然后使用SSH或VNC（前者是命令行界面，后者是图形界面）连接刚才从路由器找到的IP地址。登录的默认账号是pi，密码是raspberry。登录RPi之后输入ping qq.com测试上网是否正常。</p>

<p>2、使用固定的IP访问RPi</p>

<p>默认情况下RPi使用的是自动分配的IP地址，每次登录都需要在路由器中查找对应IP，实在太麻烦，可以把它设置成静态的。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo vi /etc/network/interfaces</span></code></pre></td></tr></table></div></figure>


<p>打开配置文件，看到如下内容</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>auto lo
</span><span class='line'>
</span><span class='line'>iface lo inet loopback
</span><span class='line'>iface eth0 inet dhcp
</span><span class='line'>
</span><span class='line'>allow-hotplug wlan0
</span><span class='line'>iface wlan0 inet manual
</span><span class='line'>wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
</span><span class='line'>iface default inet dhcp</span></code></pre></td></tr></table></div></figure>


<p>将之修改成</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>auto lo
</span><span class='line'>
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'>iface eth0 inet static
</span><span class='line'>  address 192.168.0.100
</span><span class='line'>  netmask 255.255.255.0
</span><span class='line'>  gateway 192.168.0.1
</span><span class='line'>  dns-nameservers 8.8.8.8
</span><span class='line'>
</span><span class='line'>allow-hotplug wlan0
</span><span class='line'>iface wlan0 inet manual
</span><span class='line'>  wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf
</span><span class='line'>
</span><span class='line'>iface default inet dhcp</span></code></pre></td></tr></table></div></figure>


<p>然后存盘退出。以后就可以通过192.168.0.100来登录RPi了。</p>

<p>3、把温湿度传感器接到RPi上</p>

<p><img src="http://codemany.com/uploads/rpi-dht22.png" title="rpi-dht22" ></p>

<p>DHT11/DHT22共有4根引脚：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1 -&gt; 3.3v 接左边第1个GPIO针脚
</span><span class='line'>2 -&gt; GPIO 数据接口，可随意连接1个GPIO针脚（第7个针脚对应的是GPIO Pin #4）
</span><span class='line'>3 -&gt; NC 不接
</span><span class='line'>4 -&gt; GND 接地（第14个针脚）</span></code></pre></td></tr></table></div></figure>


<p>注意：在1脚和2脚间还需要并联10K的电阻，以保持读数稳定。</p>

<p>安装好的样子：</p>

<p><img src="http://codemany.com/uploads/rpi-actual.png" title="rpi-actual" ></p>

<p>4、用C读取当前的温度和湿度值</p>

<p>用的是树莓派2红色B型，它采用Broadcom BCM2835 (CPU, GPU, DSP, and SDRAM)芯片。所以读取GPIO口需要到 <a href="http://www.open.com.au/mikem/bcm2835/index.html">http://www.open.com.au/mikem/bcm2835/index.html</a> 获取最新的BCM2835 C语言库，然后下载，编译和安装。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget http://www.open.com.au/mikem/bcm2835/bcm2835-1.36.tar.gz
</span><span class='line'>tar -zxvf bcm2835-1.36.tar.gz
</span><span class='line'>cd bcm2835-1.36
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>sudo make install</span></code></pre></td></tr></table></div></figure>


<p>从Github库中获取DHT11/DHT22温湿度程序，编译测试。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /home/pi
</span><span class='line'>git clone https://github.com/dohkoos/Raspberry-Pi-Code.git
</span><span class='line'>cd Raspberry-Pi-Code/DHT22
</span><span class='line'>make
</span><span class='line'>sudo ./dht 22 4 # 数据接口接在第7针脚，所以这里是4</span></code></pre></td></tr></table></div></figure>


<p>5、记录曲线图到云端</p>

<p>这里使用<a href="http://www.yeelink.net/">Yeelink</a>的服务，Yeelink是国内比较知名的免费物联网数据平台。根据它的API规则，提交的数据必须为JSON格式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{"timestamp": "2012-03-15 16:13:14", "value": 294.34}</span></code></pre></td></tr></table></div></figure>


<p>将温湿度值提交到Yeelink的Ruby代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Capture temperature & humidity value from the console
</span><span class='line'>output = `sudo ./dht 22 4`
</span><span class='line'>mt = /Temp =\s+([0-9.]+)/.match(output)
</span><span class='line'>temperature = mt[1]
</span><span class='line'>
</span><span class='line'>mt = /Hum =\s+([0-9.]+)/.match(output)
</span><span class='line'>humidity = mt[1]
</span><span class='line'>
</span><span class='line'># Combined temperature & humidity value into json format
</span><span class='line'>json_temperature = %Q[{\\"timestamp\\": \\"#{Time.now}\\", \\"value\\": #{temperature}}]
</span><span class='line'>json_humidity = %Q[{\\"timestamp\\": \\"#{Time.now}\\", \\"value\\": #{humidity}}]
</span><span class='line'>
</span><span class='line'># Post json data to Yeelink
</span><span class='line'>`curl -X POST -d "#{json_temperature}" -H "Content-Type: application/json" -H "U-ApiKey:XXXXXXXXXXXXXXXX" http://api.yeelink.net/v1.0/device/&lt;device_id&gt;/sensor/&lt;sensor_id&gt;/datapoints`
</span><span class='line'>`curl -X POST -d "#{json_humidity}" -H "Content-Type: application/json" -H "U-ApiKey:XXXXXXXXXXXXXXXX" http://api.yeelink.net/v1.0/device/&lt;device_id&gt;/sensor/&lt;sensor_id&gt;/datapoints`</span></code></pre></td></tr></table></div></figure>


<p>将U-ApiKey:XXXXXXXXXXXXXXXX替换为自已账户的API Key，后面的URL也需要替换为自己申请的传感器URL。</p>

<p>6、添加到计划任务</p>

<p>使用crontab命令将以下内容添加到计划任务中：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># m h dom mon dow command
</span><span class='line'>*/10 * * * * cd /home/pi/Raspberry-Pi-Code/DHT22/ && ruby yeelink.rb</span></code></pre></td></tr></table></div></figure>


<p>重启计划任务，然后每隔10分钟就会上传一次数据到云端。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo /etc/init.d/cron restart</span></code></pre></td></tr></table></div></figure>


<p>下面是我的曲线图：</p>

<p><img src="http://codemany.com/uploads/rpi-yeelink.png" title="rpi-yeelink" ></p>

<p>参考资料：<br />
<a href="http://www.2fz1.com/?p=370">http://www.2fz1.com/?p=370</a><br />
<a href="http://learn.adafruit.com/dht-humidity-sensing-on-raspberry-pi-with-gdocs-logging">http://learn.adafruit.com/dht-humidity-sensing-on-raspberry-pi-with-gdocs-logging</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用响应式设计改造小说网站]]></title>
    <link href="http://codemany.com/blog/2014/06/19/rebuild-novel-website-with-responsive-design/"/>
    <updated>2014-06-19T11:55:16+08:00</updated>
    <id>http://codemany.com/blog/2014/06/19/rebuild-novel-website-with-responsive-design</id>
    <content type="html"><![CDATA[<p>因为要在其它设备上测试响应式设计的效果，需要先对开发环境做些简单的配置。</p>

<p>启动服务器时需加上本机的IP地址和访问端口（通常是80）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails s -b 192.168.0.100 -p 80</span></code></pre></td></tr></table></div></figure>


<p>配置Windows系统的内置防火墙，开启80端口以供其它设备访问：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netsh advfirewall firewall add rule name="Open Port 80" dir=in action=allow protocol=TCP localport=80</span></code></pre></td></tr></table></div></figure>


<p>查看和删除防火墙规则的命令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>netsh advfirewall firewall delete rule name="Open Port 80" protocol=TCP localport=80
</span><span class='line'>netsh advfirewall firewall show rule name="Open Port 80"</span></code></pre></td></tr></table></div></figure>


<p>响应式设计的优缺点就不多说了，已经有太多的文章讲过这些。这里主要讲如何使用响应式设计改造现有的小说网站。</p>

<p>首先，需要使用viewport标签设置屏幕宽度为设备宽度，使网站内容可以适应响应式变化。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span></code></pre></td></tr></table></div></figure>


<p>因为这是一个非常简陋，并且以内容为主的网站。在上述设置后几乎不用再修改就能适应不同屏幕分辨率下的信息呈现，除了导航栏因为导航选项较多，在手机等设备上打开会出现后面部分选项被挤下去。抽屉样式的导航是解决这个问题的好方法。在网上找到一个横向导航栏切换成抽屉式导航栏的库<a href="http://srobbin.github.io/jquery-pageslide/">jQuery PageSlide</a>，它使用图片实现三明治图标，所以对它做了些修改，用标签来实现：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;ul class="burger"&gt;
</span><span class='line'>  &lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;</span></code></pre></td></tr></table></div></figure>


<p>对应的CSS代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.burger {
</span><span class='line'>  li {
</span><span class='line'>    height: 4px;
</span><span class='line'>    width: 30px;
</span><span class='line'>    background: #000;
</span><span class='line'>    border-radius: 3px;
</span><span class='line'>    margin: 5px 0;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>要实现响应式的话，只要让它在正常情况下隐藏，屏幕变小时显现即可：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.burger {
</span><span class='line'>  display: none;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@media screen and (max-width: 480px) {
</span><span class='line'>  .burger {
</span><span class='line'>    display: block;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>还需要在application.html.erb的底部开启点击三明治图标时的响应事件：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;%= javascript_include_tag "jquery.pageslide", "data-turbolinks-track" =&gt; true %&gt;
</span><span class='line'>&lt;script&gt;
</span><span class='line'>  $(".burger").pageslide();
</span><span class='line'>&lt;/script&gt;</span></code></pre></td></tr></table></div></figure>


<p>导航条的CSS也需要做些修改才能在屏幕变小时转换成抽屉式导航条。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nav ul {
</span><span class='line'>  margin: 0;
</span><span class='line'>  padding: 0;
</span><span class='line'>  width: 100%;
</span><span class='line'>  &:after {
</span><span class='line'>    content: "\0020";
</span><span class='line'>    display: block;
</span><span class='line'>    height: 0;
</span><span class='line'>    clear: both;
</span><span class='line'>    visibility: hidden;
</span><span class='line'>  }
</span><span class='line'>  li {
</span><span class='line'>    float: left;
</span><span class='line'>    width: 14.2%;
</span><span class='line'>    text-align: center;
</span><span class='line'>    a {
</span><span class='line'>      display: block;
</span><span class='line'>      background: #000;
</span><span class='line'>      color: #fff;
</span><span class='line'>      font-weight: bold;
</span><span class='line'>      padding: 10px;
</span><span class='line'>      border-right: 1px solid #fff;
</span><span class='line'>      &:hover {
</span><span class='line'>        background: #333;
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>以下是当屏幕变小时的CSS代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@media screen and (max-width: 480px) {
</span><span class='line'>  nav ul {
</span><span class='line'>    display: none;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>至此，小说网站的响应式改造就基本完成了。如果您觉得对你有所帮助，请将此文发送给你的朋友，如果你还有更好的建议也可以在下面的评论中分享你的经验。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用HTML5创建小说网站]]></title>
    <link href="http://codemany.com/blog/2013/05/24/create-novel-website-with-html5/"/>
    <updated>2013-05-24T15:04:32+08:00</updated>
    <id>http://codemany.com/blog/2013/05/24/create-novel-website-with-html5</id>
    <content type="html"><![CDATA[<p>在项目开始前，先要了解下HTML5规范包含的一些有用的新的语义标签，用于提供HTML页面的各个区域或部分的意义，例如页眉、页脚、导航栏、边栏等等。在以前的HTML版本中，这些部分通常使用div标签来创建，通过id或class属性来区分。</p>

<p>HTML5引入的主要标签包括：</p>

<p>header标签<br />
此标签用于定义WEB页面某些部分的页眉，可以是整个页面、article标签或section标签。</p>

<p>nav标签<br />
这是WEB页面上主要导航链接的容器。此标签不应用于所有链接组，而是应仅用于主要导航块。如果您有一个footer标签包含导航链接，不需要将这些链接封装在nav标签中，因为footer标签将可以独自包括这些链接。</p>

<p>footer标签<br />
此标签定义页面的某些部分的页脚。页脚不一定是在页面、文章或区域的结尾，但是它通常是在那个位置。</p>

<p>article标签<br />
定义文档或页面上的独立区块，例如新闻、杂志、博文或评论。</p>

<p>section标签<br />
此标签表示文档的一部分，例如，文章或教程的一章或一节。该标签通常具有一个页眉，虽然严格来说是不需要的。</p>

<p>aside标签<br />
用于标记边栏或一些将认为与其周围内容有点无关的内容。此项的一个例子就是广告块。</p>

<p>hgroup标签<br />
在某些情况下，页面、文章或区域可能需要多个标题，例如，您有一个标题和一个副标题。您可以在hgroup标签中封装这些标题，使用h1标签表示主标题，h2标签表示副标题。</p>

<p>这些标签的基础结构遵循以下大纲：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>header
</span><span class='line'>  hgroup
</span><span class='line'>nav
</span><span class='line'>article
</span><span class='line'>  header
</span><span class='line'>  section
</span><span class='line'>    header
</span><span class='line'>footer</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/html5-novel-layout.png" title="html5-novel-layout" >
上面是网站的布局设计，主要有header、navigation、footer和main四个区块，实现代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- HTML5的DOCTYPE声明模式，它可以向后兼容，
</span><span class='line'>     再也不用记忆XHTML中复杂的DOCTYPE了！--&gt;
</span><span class='line'>&lt;!DOCTYPE html&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>  &lt;!-- 指定文档字符编码的写法，该写法在所有浏览器上都有效。--&gt;
</span><span class='line'>  &lt;meta charset="utf-8" /&gt;
</span><span class='line'>  &lt;title&gt;HTML5 + CSS3 Demo&lt;/title&gt;
</span><span class='line'>  &lt;!-- link和script标签也无需提供type属性（No More Types for Scripts and Links），
</span><span class='line'>       因为CSS和JavaScript是目前惟一受支持的样式表和脚本类型 --&gt;
</span><span class='line'>  &lt;link href="style.css" rel="stylesheet" /&gt;
</span><span class='line'>  &lt;!-- 因为IE浏览器（甚至版本8）不支持新的HTML5标签，处理此问题的一个已知方法是使用
</span><span class='line'>       JavaScript函数document.createElement()为每个标记创建虚拟标签。html5.js文件将
</span><span class='line'>       为每个新的HTML标签进行此操作 --&gt;
</span><span class='line'>  &lt;!--[if lt IE 9]&gt;
</span><span class='line'>    &lt;script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"&gt;&lt;/script&gt;
</span><span class='line'>  &lt;![endif]--&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>
</span><span class='line'>&lt;body&gt;
</span><span class='line'>  &lt;header&gt;
</span><span class='line'>    &lt;hgroup&gt;
</span><span class='line'>      &lt;h1&gt;logo&lt;/h1&gt;
</span><span class='line'>      &lt;h2&gt;tagline&lt;/h2&gt;
</span><span class='line'>    &lt;/hgroup&gt;
</span><span class='line'>  &lt;/header&gt;
</span><span class='line'>
</span><span class='line'>  &lt;nav&gt;
</span><span class='line'>    &lt;ul&gt;
</span><span class='line'>      &lt;li&gt;&lt;a href="#"&gt;Catalog 1&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>      &lt;li&gt;&lt;a href="#"&gt;Catalog 2&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>      &lt;li&gt;&lt;a href="#"&gt;Catalog 3&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>      &lt;li&gt;&lt;a href="#"&gt;Catalog 4&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>    &lt;/ul&gt;
</span><span class='line'>  &lt;/nav&gt;
</span><span class='line'>
</span><span class='line'>  &lt;!-- main block begin --&gt;
</span><span class='line'>  &lt;!-- main block end --&gt;
</span><span class='line'>
</span><span class='line'>  &lt;footer&gt;
</span><span class='line'>    &copy; 2013 Unnamed
</span><span class='line'>  &lt;/footer&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>* {
</span><span class='line'>  font-family: Lucida Sans, Arial, Helvetica, sans-serif;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>body {
</span><span class='line'>  width: 768px;
</span><span class='line'>  margin: 0px auto;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>header h1 {
</span><span class='line'>  font-size: 36px;
</span><span class='line'>  margin: 0px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>header h2 {
</span><span class='line'>  font-size: 18px;
</span><span class='line'>  margin: 0px;
</span><span class='line'>  color: #888;
</span><span class='line'>  font-style: italic;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>nav ul {
</span><span class='line'>  list-style: none;
</span><span class='line'>  padding: 0px;
</span><span class='line'>  display: block;
</span><span class='line'>  background-color: #666;
</span><span class='line'>  padding-left: 4px;
</span><span class='line'>  height: 24px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>nav ul li {
</span><span class='line'>  display: inline;
</span><span class='line'>  padding: 0px 20px 5px 10px;
</span><span class='line'>  height: 24px;
</span><span class='line'>  border-right: 1px solid #ccc;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>nav ul li a {
</span><span class='line'>  color: #efd3d3;
</span><span class='line'>  text-decoration: none;
</span><span class='line'>  font-size: 13px;
</span><span class='line'>  font-weight: bold;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>nav ul li a:hover {
</span><span class='line'>  color: #fff;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>footer {
</span><span class='line'>  border-top: 1px solid #ccc;
</span><span class='line'>  text-align: center;
</span><span class='line'>  font-size: 12px;
</span><span class='line'>  color: #888;
</span><span class='line'>  margin-top: 24px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>整个网站主要有这么几个页面：首页、分类页、书目页、内容页，这些页面共用一个布局，主要区别在于main区块的不同。首页、分类页和书目页相似，都是由列表组成。</p>

<p>首页是多个无序列表：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;h3&gt;Latest&lt;/h3&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>&lt;h3&gt;Most Viewed&lt;/h3&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>&lt;h3&gt;Most Shared&lt;/h3&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;</span></code></pre></td></tr></table></div></figure>


<p>分类页是单个无序列表：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;h3&gt;Catalog 1&lt;/h3&gt;
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;Book's title&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;</span></code></pre></td></tr></table></div></figure>


<p>书目页是单个有序列表：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;h3&gt;Book's title&lt;/h3&gt;
</span><span class='line'>&lt;ol&gt;
</span><span class='line'>  &lt;li&gt;Chapter 1&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;Chapter 2&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;Chapter 3&lt;/li&gt;
</span><span class='line'>&lt;/ol&gt;</span></code></pre></td></tr></table></div></figure>


<p><img src="http://codemany.com/uploads/html5-novel-article.png" title="html5-novel-article" >
内容页，顾名思义就是显示小说具体内容的页面。文章内容用article标签表示，其中的标题、作者、发表时间等信息被包含在header标签中。主要代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;article&gt;
</span><span class='line'>  &lt;header&gt;
</span><span class='line'>    &lt;h1&gt;&lt;a href="#"&gt;Title&lt;/a&gt;&lt;/h1&gt;
</span><span class='line'>    &lt;p&gt;By &lt;a href="#"&gt;Peter&lt;/a&gt; on &lt;time&gt;2011-11-12 14:54&lt;/time&gt;&lt;/p&gt;
</span><span class='line'>  &lt;/header&gt;
</span><span class='line'>  &lt;p&gt;Lorem ipsum...&lt;/p&gt;
</span><span class='line'>  &lt;section&gt;
</span><span class='line'>    &lt;header&gt;
</span><span class='line'>      &lt;h1&gt;This is a section heading&lt;/h1&gt;
</span><span class='line'>    &lt;/header&gt;
</span><span class='line'>    &lt;p&gt;Lorem ipsum...&lt;/p&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>  &lt;footer&gt;
</span><span class='line'>    &lt;a href="#"&gt;Back&lt;/a&gt;
</span><span class='line'>    &lt;a href="#"&gt;List&lt;/a&gt;
</span><span class='line'>    &lt;a href="#"&gt;Forward&lt;/a&gt;
</span><span class='line'>  &lt;/footer&gt;
</span><span class='line'>&lt;/article&gt;</span></code></pre></td></tr></table></div></figure>


<p>在上面的代码里，header标签中我们仅使用了h1标签，这是因为HTML5会根据上下文计算出heading元素的层级，因此会有：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;body&gt;&lt;h1&gt;    &lt;!-- 相当于heading 1 --&gt;
</span><span class='line'>&lt;body&gt; ... &lt;section&gt;&lt;h1&gt;    &lt;!-- 相当于heading 2 --&gt;
</span><span class='line'>&lt;body&gt; ... &lt;section&gt;&lt;section&gt;&lt;h1&gt;    &lt;!-- 相当于heading 3 --&gt;</span></code></pre></td></tr></table></div></figure>


<p>最后顺便说一句，HTML5支持已存在的各种写法：xhtml1.0、xhtml1.1和html4.0，但建议使用xhtml1.1规范，即：</p>

<ol>
<li>所有标签/属性都使用小写字母;</li>
<li>所有属性值都必须加引号;</li>
<li>使用闭合标签。</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[敏捷开发走下坡路了吗？]]></title>
    <link href="http://codemany.com/blog/2013/05/19/agile-decline/"/>
    <updated>2013-05-19T12:36:14+08:00</updated>
    <id>http://codemany.com/blog/2013/05/19/agile-decline</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://thatextramile.be/blog/2008/11/agile-development-going-downhill">http://thatextramile.be/blog/2008/11/agile-development-going-downhill</a></p>

<p>James Shore（非常精彩的书《<a href="http://thatextramile.be/blog/2008/05/the-art-of-agile-development/">The Art Of Agile Development</a>》的作者）在他的博客上写了一篇很有趣的帖子：<a href="http://jamesshore.com/Blog/The-Decline-and-Fall-of-Agile.html">The Decline And Fall Of Agile</a>。你绝对应该读读它。</p>

<p>我想我同意James的观点。在过去的几年里，我已经听到了很多的人说他们在做敏捷开发，实际上，他们几乎都不是。引用James的话：</p>

<blockquote><p>But guess which part people adopt? That&#8217;s right&#8211;Sprints and Scrums. Rapid cycles, but none of the good stuff that makes rapid cycles sustainable.</p></blockquote>

<p>不幸的是，这是非常真实的。现在许多团队都在进行短迭代工作，很多团队也在做每日例会，或Scrum，或站立会议。但是，有多少人事实上致力于使敏捷开发成功的技术实践和原则呢？老实说，我一个也没见过。</p>

<p>我是一个真正的敏捷开发的铁杆迷，但即使在我现在的工作中，我最近的两个团队也没有完全正确地实现它。我们的研究结果虽然还不错，但我认为我们仍然可以做得更好。我逐渐尝试引入更多的原则和实践，但它确实需要一些时间。但是，所有这些关于敏捷开发的误解，所以很多人（开发人员，项目经理等）有没有真正帮助。在我当前的工作中，这些误解是非常小的，他们并不真正有不良影响。以前在客户那里，我确实注意到这些误解是如何导致异常低效的情况。其实这是非常伤心的，因为迟早经理可能会对敏捷方法持怀疑态度。如果这导致人们放弃一些技术实践和原则，对这个事业来说将会是一个相当大的损失。</p>

<p>我觉得有更多的理由去读James的那本出色的书。如果我可以合法地迫使人们去阅读这本书，我会的:)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[部署Qianbao到Heroku时的问题]]></title>
    <link href="http://codemany.com/blog/2013/05/19/problem-when-deploying-qianbao-to-heroku/"/>
    <updated>2013-05-19T06:25:33+08:00</updated>
    <id>http://codemany.com/blog/2013/05/19/problem-when-deploying-qianbao-to-heroku</id>
    <content type="html"><![CDATA[<p>Heroku现在已经是纯粹的只读PaaS了，也就是说以前还支持的SQlite现在也不能使用了。因此部署到Heroku上的Rails应用需要把使用的数据库改成PostgreSQL，并且要关闭assets的预编译功能。</p>

<p>修改Gemfile，将SQLite换成PostgreSQL：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gem 'sqlite3'
</span><span class='line'>gem 'pg'</span></code></pre></td></tr></table></div></figure>


<p>在config/application.rb中添加：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.assets.initialize_on_precompile = false</span></code></pre></td></tr></table></div></figure>


<p>股票功能需要导入交割单文件。因为导入后的文本文件不再使用，可以把上传路径由public/uploads改为tmp。这样就避免了不能Heroku不能写文件的问题。</p>

<p>应用上传后运行时出现异常，使用heroku logs -t查看日志发现有如下错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Error: column "stocks.share_name" must appear in the GROUP BY clause or be used in an aggregate function</span></code></pre></td></tr></table></div></figure>


<p>这是因为在controller中有这么一行代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>current_user.stocks.select("share_code, share_name, sum(actual_amount) as amount").group("share_code")</span></code></pre></td></tr></table></div></figure>


<p>在PostgreSQL中这会有问题。比如下面的数据表：</p>

<p><img src="http://codemany.com/uploads/qianbao-stocks-table.png" title="qianbao-stocks-table" ></p>

<p>执行上面的SQL语句后，share_name的值到底是取Ruby呢还是ST Ruby？解决这个问题的方法是使用aggregate函数。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>current_user.stocks.select("share_code, max(share_name) as share_name, sum(actual_amount) as amount").group("share_code")</span></code></pre></td></tr></table></div></figure>


<p>使用PostgreSQL还有个问题，就是decimal类型的字段，取出来的值是字符串类型。例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if stock.amount &lt; 0</span></code></pre></td></tr></table></div></figure>


<p>它会报错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ArgumentError (comparison of String with 0 failed)</span></code></pre></td></tr></table></div></figure>


<p>这个可以使用to_f函数解决：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if stock.amount.to_f &lt; 0</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[扫描ISBN条码实现藏书管理]]></title>
    <link href="http://codemany.com/blog/2013/04/25/manage-library-by-scanning-isbn-barcode/"/>
    <updated>2013-04-25T12:17:14+08:00</updated>
    <id>http://codemany.com/blog/2013/04/25/manage-library-by-scanning-isbn-barcode</id>
    <content type="html"><![CDATA[<p>每个程序猿家里都有一堆技术书籍，偶也不例外，因此想写个Android应用来管理自己的藏书以及想买的书籍。在网上找到marshal的<a href="http://marshal.easymorse.com/archives/2745">识别图书ISBN号并输出查询结果的示例</a>和<a href="http://marshal.easymorse.com/archives/2756">完善图书查询原型，增加收藏夹功能</a>两篇文章，写的非常不错，还提供源代码。下载代码研究后发现已基本具备了想要的功能，决定在它的基础上做些修改供自己使用。</p>

<p>把原来uses-sdk的minSdkVersion改成了9，增加android:targetSdkVersion=&#8221;17&#8221;。然后使用手机测试程序时发现，在连接网络时后台会抛出了android.os.NetworkOnMainThreadException异常，并且应用崩溃打不开。通过查阅相关资料了解到，自从Android 2.3之后，系统增加了一个类StrictMode。这个类对网络的访问方式进行了一定的改变。官方文档给出了这个类设置的目的：</p>

<blockquote><p>StrictMode is a developer tool which detects things you might be doing by accident and brings them to your attention so you can fix them.</p>

<p>StrictMode is most commonly used to catch accidental disk or network access on the application&#8217;s main thread, where UI operations are received and animations take place. Keeping disk and network operations off the main thread makes for much smoother, more responsive applications. By keeping your application&#8217;s main thread responsive, you also prevent ANR dialogs from being shown to users.</p>

<p>Note that even though an Android device&#8217;s disk is often on flash memory, many devices run a filesystem on top of that memory with very limited concurrency. It&#8217;s often the case that almost all disk accesses are fast, but may in individual cases be dramatically slower when certain I/O is happening in the background from other processes. If possible, it&#8217;s best to assume that such things are not fast.</p></blockquote>

<p>因为marshal把访问网络的代码直接放到UI线程中，造成和主线程的首要工作UI交互相矛盾。解决这类问题很容易，把访问网络的代码放到AsyncTask中就行了。官方有个<a href="http://developer.android.com/training/basics/network-ops/index.html">NetworkUsage</a>例子是个不错的参考。</p>

<p>接着发现豆瓣API查询返回的是500错误，在浏览器上访问却又正常，后来给HttpClient加上Agent头就没问题了，不知道是不是期间豆瓣的API在实现上作了改变。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HttpClient client = new DefaultHttpClient();
</span><span class='line'>String agent = System.getProperty("http.agent");
</span><span class='line'>client.getParams().setParameter(CoreProtocolPNames.USER_AGENT, agent);</span></code></pre></td></tr></table></div></figure>


<p>解析豆瓣XML查询结果的代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>XmlPullParserFactory factory = XmlPullParserFactory.newInstance();
</span><span class='line'>factory.setNamespaceAware(true);
</span><span class='line'>XmlPullParser parser = factory.newPullParser();
</span><span class='line'>parser.setInput(inputStream, "utf-8");
</span><span class='line'>Book book = new Book();
</span><span class='line'>
</span><span class='line'>int eventType = parser.getEventType();
</span><span class='line'>while (eventType != XmlPullParser.END_DOCUMENT) {
</span><span class='line'>    switch (eventType) {
</span><span class='line'>    case XmlPullParser.START_TAG:
</span><span class='line'>        if ("link".equals(parser.getName())
</span><span class='line'>                && "image".equals(parser.getAttributeValue(null, "rel"))) {
</span><span class='line'>            book.setImageUrl(parser.getAttributeValue(null, "href"));
</span><span class='line'>            eventType = parser.next();
</span><span class='line'>        } else if ("summary".equals(parser.getName())) {
</span><span class='line'>            book.setSummary(parser.nextText());
</span><span class='line'>        } else if ("attribute".equals(parser.getName())) {
</span><span class='line'>            String name = parser.getAttributeValue(null, "name");
</span><span class='line'>            if ("title".equals(name)) {
</span><span class='line'>                book.setTitle(parser.nextText());
</span><span class='line'>            } else if ("author".equals(name)) {
</span><span class='line'>                book.setAuthor(parser.nextText());
</span><span class='line'>            } else if ("isbn10".equals(name)) {
</span><span class='line'>                book.setIsbn10(parser.nextText());
</span><span class='line'>            } else if ("isbn13".equals(name)) {
</span><span class='line'>                book.setIsbn13(parser.nextText());
</span><span class='line'>            } else if ("publisher".equals(name)) {  
</span><span class='line'>                book.setPublisher(parser.getText());
</span><span class='line'>            }                 
</span><span class='line'>        }
</span><span class='line'>        break;
</span><span class='line'>    case XmlPullParser.END_TAG:
</span><span class='line'>        break;
</span><span class='line'>    }
</span><span class='line'>    eventType = parser.next();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>然后，然后就是结果页面不显示图书信息。想要找到原因，肿么办？看来要调试WebView了！<a href="http://developer.android.com/guide/webapps/debugging.html">http://developer.android.com/guide/webapps/debugging.html</a> 告诉了我们如何调试。</p>

<p>首先在WebView上设置setWebChromeClient方法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>webView.setWebChromeClient(new WebChromeClient() {
</span><span class='line'>    public void onConsoleMessage(String message,
</span><span class='line'>            int lineNumber, String sourceID) {
</span><span class='line'>        Log.d(TAG, message + " -- From line "
</span><span class='line'>                + lineNumber + " of " + sourceID);
</span><span class='line'>    }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>然后在JavaScript脚本中使用以下方法就可以在logcat中看到调试信息了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>console.log(String)
</span><span class='line'>console.info(String)
</span><span class='line'>console.warn(String)
</span><span class='line'>console.error(String)</span></code></pre></td></tr></table></div></figure>


<p>重新运行程序，果然在logcat中看到报如下错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Uncaught TypeError: Object [object Object] has no method...</span></code></pre></td></tr></table></div></figure>


<p>搜索后在Stack Overflow找到了<a href="http://stackoverflow.com/questions/14031635/android-4-2-1-webview-and-javascript-interface-breaks">问题的答案</a>（Stack Overflow真的非常不错，问题的回答都非常详尽）。<a href="http://developer.android.com/guide/webapps/webview.html#BindingJavaScript">这里</a>是Android官方文档的解释。</p>

<p>解决方法就是在要被JavaScript调用的方法上加@JavascriptInterface注解：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class Book {
</span><span class='line'>
</span><span class='line'>  @JavascriptInterface
</span><span class='line'>  public String getAuthor() {
</span><span class='line'>      return author;
</span><span class='line'>  }
</span><span class='line'>  
</span><span class='line'>  public void setAuthor(String author) {
</span><span class='line'>      if (this.author != null) {
</span><span class='line'>          this.author += ", " + author;
</span><span class='line'>      } else {
</span><span class='line'>          this.author = author;
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[绘制圆角的正确方法]]></title>
    <link href="http://codemany.com/blog/2013/04/11/the-proper-way-to-draw-rounded-corners/"/>
    <updated>2013-04-11T14:59:45+08:00</updated>
    <id>http://codemany.com/blog/2013/04/11/the-proper-way-to-draw-rounded-corners</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://www.usabilitypost.com/2009/01/26/the-proper-way-to-draw-rounded-corners/">http://www.usabilitypost.com/2009/01/26/the-proper-way-to-draw-rounded-corners/</a></p>

<p>在网络上，我已经注意到当人们在他们的设计中实现圆角时犯了很多同样的错误。因为某些原因，当有另外一个圆角在它里面的时候，这个圆角会带来一个问题—无论是有一个围绕周围的边界，还是另一个圆角形状坐落在一个圆角形状内。</p>

<p>这里是我要说的：</p>

<p><img src="http://codemany.com/uploads/bad-corner.png" title="bad-corner" ></p>

<p>我看到了很多这种类型的圆角。您可以看到圆角的半径和内圆角的是相同的。这是错误的，因为如果你保持相同半径，两个拐角之间的空间量不会自始至终相等。</p>

<p>下面是相等间距看起来的样子：</p>

<p><img src="http://codemany.com/uploads/good-corner.png" title="good-corner" ></p>

<p>这是正确的做法。有什么不同？内角的半径被减小了。好吧，但你怎么知道半径应该有多大？这很简单—如果你把外面的圆角想象成一个圆形，你可以看到它的圆心在哪里。</p>

<p><img src="http://codemany.com/uploads/corner-center.png" title="corner-center" ></p>

<p>把这个圆心同样地作为内角的圆心，你就会得到内角的半径。使用这种方法将确保两个形状之间的完美契合。</p>

<p><img src="http://codemany.com/uploads/good-corner-ruler.png" title="good-corner-ruler" ></p>

<p>现在你知道了吧？这是做多个圆角彼此包含的正确办法。当然，不需要你使用精确的圆心—有时为了设计良好还需要你移动一点点。但请不要仅仅把相同的圆角向内移动—这是绝对错误的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用SiteMesh做网页布局]]></title>
    <link href="http://codemany.com/blog/2013/04/09/page-layout-using-sitemesh/"/>
    <updated>2013-04-09T08:18:33+08:00</updated>
    <id>http://codemany.com/blog/2013/04/09/page-layout-using-sitemesh</id>
    <content type="html"><![CDATA[<p>SiteMesh是一个基于GoF的Decorator模式，用于页面布局的框架。能帮助我们在由大量页面构成的项目中创建一致的页面布局和外观。</p>

<p>这里我们将会把它整合到JBookShelf里去。要和Struts2整合，先在pom.xml添加以下插件，该插件会将依赖的SiteMesh也一并包含到项目中。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;dependency&gt;
</span><span class='line'>    &lt;groupId&gt;org.apache.struts&lt;/groupId&gt;
</span><span class='line'>    &lt;artifactId&gt;struts2-sitemesh-plugin&lt;/artifactId&gt;
</span><span class='line'>    &lt;version&gt;2.3.12&lt;/version&gt;
</span><span class='line'>&lt;/dependency&gt;</span></code></pre></td></tr></table></div></figure>


<p>将web.xml配置中原来的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;filter&gt;
</span><span class='line'>    &lt;filter-name&gt;struts2&lt;/filter-name&gt;
</span><span class='line'>    &lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter&lt;/filter-class&gt;
</span><span class='line'>&lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>&lt;filter-mapping&gt;
</span><span class='line'>    &lt;filter-name&gt;struts2&lt;/filter-name&gt;
</span><span class='line'>    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span><span class='line'>&lt;/filter-mapping&gt;</span></code></pre></td></tr></table></div></figure>


<p>改成</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;filter&gt;
</span><span class='line'>    &lt;filter-name&gt;struts-prepare&lt;/filter-name&gt;
</span><span class='line'>    &lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsPrepareFilter&lt;/filter-class&gt;
</span><span class='line'>&lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>&lt;filter&gt;
</span><span class='line'>    &lt;filter-name&gt;sitemesh&lt;/filter-name&gt;
</span><span class='line'>    &lt;filter-class&gt;com.opensymphony.sitemesh.webapp.SiteMeshFilter&lt;/filter-class&gt;
</span><span class='line'>&lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>&lt;filter&gt;
</span><span class='line'>    &lt;filter-name&gt;struts-execute&lt;/filter-name&gt;
</span><span class='line'>    &lt;filter-class&gt;org.apache.struts2.dispatcher.ng.filter.StrutsExecuteFilter&lt;/filter-class&gt;
</span><span class='line'>&lt;/filter&gt;
</span><span class='line'>
</span><span class='line'>&lt;filter-mapping&gt;
</span><span class='line'>    &lt;filter-name&gt;struts-prepare&lt;/filter-name&gt;
</span><span class='line'>    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span><span class='line'>&lt;/filter-mapping&gt;
</span><span class='line'>
</span><span class='line'>&lt;filter-mapping&gt;
</span><span class='line'>    &lt;filter-name&gt;sitemesh&lt;/filter-name&gt;
</span><span class='line'>    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span><span class='line'>&lt;/filter-mapping&gt;
</span><span class='line'>
</span><span class='line'>&lt;filter-mapping&gt;
</span><span class='line'>    &lt;filter-name&gt;struts-execute&lt;/filter-name&gt;
</span><span class='line'>    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span><span class='line'>&lt;/filter-mapping&gt;</span></code></pre></td></tr></table></div></figure>


<p>这里要注意过滤器的位置。SiteMesh过滤器必须在StrutsPrepareFilter之后和StrutsExecuteFilter之前，否则在SiteMesh的修饰器页面中将访问不到ActionContext。这是因为Struts2的所有值是保存在Stack Context或者ValueStack中的。默认情况下，某个过滤器一旦访问了该Stack Context或ValueStack，里面对应的值会被清洗掉。如果先使用Struts2的StrutsPrepareAndExecuteFilter来过滤用户请求，则SiteMesh的过滤器将无法取得Stack Context或者ValueStack中的数据。为了解决这个问题，Struts2提供了StrutsPrepareFilter和StrutsExecuteFilter类（在2.1.3版本前是ActionContextCleanUp和FilterDispatcher），通过它们协同来确保SiteMesh正常工作。</p>

<p>在WEB-INF下添加decorators.xml文档：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;decorators defaultdir="/layouts"&gt;
</span><span class='line'>    &lt;excludes&gt;
</span><span class='line'>        &lt;pattern&gt;/stylesheets/*&lt;/pattern&gt;
</span><span class='line'>        &lt;pattern&gt;/javascripts/*&lt;/pattern&gt;
</span><span class='line'>        &lt;pattern&gt;/images/*&lt;/pattern&gt;
</span><span class='line'>    &lt;/excludes&gt;
</span><span class='line'>
</span><span class='line'>    &lt;decorator name="application" page="application.jsp"&gt;
</span><span class='line'>        &lt;pattern&gt;/*&lt;/pattern&gt;
</span><span class='line'>    &lt;/decorator&gt;
</span><span class='line'>&lt;/decorators&gt;</span></code></pre></td></tr></table></div></figure>


<p>stylesheets、javascripts、images目录下的内容是不需要被修饰的，可以把它们放到execludes块中排除掉。</p>

<p>新建/layouts/application.jsp模版页：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;%@ taglib uri="/struts-tags" prefix="s" %&gt;
</span><span class='line'>&lt;%@ taglib uri="http://www.opensymphony.com/sitemesh/decorator" prefix="decorator" %&gt;
</span><span class='line'>
</span><span class='line'>&lt;!DOCTYPE html&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;meta charset="utf-8"&gt;
</span><span class='line'>&lt;title&gt;&lt;decorator:title default="JBookShelf" /&gt;&lt;/title&gt;
</span><span class='line'>&lt;decorator:head /&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>
</span><span class='line'>&lt;body&gt;
</span><span class='line'>    &lt;div&gt;
</span><span class='line'>        &lt;s:if test="#session.user_session_key != null"&gt;
</span><span class='line'>        &lt;s:a action="listBook"&gt;All Books&lt;/s:a&gt;
</span><span class='line'>        Welcome, you have logined.
</span><span class='line'>        &lt;s:a action="logout"&gt;Logout&lt;/s:a&gt;
</span><span class='line'>        &lt;/s:if&gt;
</span><span class='line'>        &lt;s:else&gt;
</span><span class='line'>        &lt;s:a action="login!input"&gt;Login&lt;/s:a&gt; |
</span><span class='line'>        &lt;s:a action="register!input"&gt;Register&lt;/s:a&gt;
</span><span class='line'>        &lt;/s:else&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>    &lt;hr /&gt;
</span><span class='line'>    &lt;div&gt;Navigation&lt;/div&gt;
</span><span class='line'>    &lt;hr /&gt;
</span><span class='line'>    &lt;decorator:body /&gt;
</span><span class='line'>    &lt;hr /&gt;
</span><span class='line'>    &lt;div&gt;Footer&lt;/div&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>


<p>代码下载：<a href="https://github.com/dohkoos/JBookShelf">https://github.com/dohkoos/JBookShelf</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PowerBuilder生成可执行文件的小技巧]]></title>
    <link href="http://codemany.com/blog/2013/03/29/tips-for-creating-executable-file-in-powerbuilder/"/>
    <updated>2013-03-29T14:10:04+08:00</updated>
    <id>http://codemany.com/blog/2013/03/29/tips-for-creating-executable-file-in-powerbuilder</id>
    <content type="html"><![CDATA[<p>使用资源文件（.pbr）引用资源</p>

<p>在资源相同目录下建立.pbr文件，其中列出在应用中动态引用的资源文件，一行列出一个资源，格式如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>appico.ico
</span><span class='line'>appbmp1.bmp
</span><span class='line'>...
</span><span class='line'>appbmp9.bmp</span></code></pre></td></tr></table></div></figure>


<p>在.pbr文件中指定的文件名必须与在脚本中引用的资源匹配，若引用时包含路径，则在.pbr文件中也必须包含同一路径，否则因PowerBuilder在执行时只是简单地进行字符串比较而导致无法发现该资源。</p>

<p>设置可执行文件图标</p>

<p>应用 -> 属性 -> General -> Additional Properties按钮 -> Icon页签 -> Icon Name</p>

<p>可执行文件所需的环境DLL</p>

<p>最简便的方式是使用自带的打包程序PowerBuilder Runtime Packager。这个应用会自动把脱离环境运行所需的DLL等文件筛选出来。<br />
Sybase -> PowerBuilder 9.0 -> PowerBuilder Runtime Packager</p>

<p>运行后会生成一个MSI应用，执行下就可以解压出需要的DLL文件了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用ichartjs画2D条形图]]></title>
    <link href="http://codemany.com/blog/2013/03/27/draw-2d-bar-graph-using-ichartjs/"/>
    <updated>2013-03-27T06:45:37+08:00</updated>
    <id>http://codemany.com/blog/2013/03/27/draw-2d-bar-graph-using-ichartjs</id>
    <content type="html"><![CDATA[<p><a href="http://codemany.com/blog/2011/09/23/in-rails-simple-to-use-open-flash-chart-ii-tutorial/">在Rails中使用Open Flash Chart II简单教程</a>中使用了OFC2来画2D条形图。现在Flash快要不行了，因为有了更好的HTML5。好的程序猿也要紧随潮流，使用新的技术来改进和增强他的代码。这里就尝试使用HTML5图形库来替换OFC2。比较已有的一些图形库，最后选定国产的<a href="http://www.ichartjs.com/">ichartjs</a>。</p>

<p>实现2D条形图真的很简单：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script type="text/javascript" src="ichart.1.1.min.js"&gt;&lt;/script&gt;
</span><span class='line'>&lt;script type="text/javascript"&gt;
</span><span class='line'>$(function() {
</span><span class='line'>  var data = [
</span><span class='line'>    {name: 'IE', value: 35.75, color: '#a5c2d5'},
</span><span class='line'>    {name: 'Chrome', value: 29.84, color: '#cbab4f'},
</span><span class='line'>    {name: 'Firefox', value: 24.88, color: '#76a871'},
</span><span class='line'>    {name: 'Safari',value: 6.77, color: '#9f7961'},
</span><span class='line'>    {name: 'Opera',value：2.02, color: '#a56f8f'},
</span><span class='line'>    {name: 'Other',value: 0.73, color: '#6f83a5'}
</span><span class='line'>  ];
</span><span class='line'>
</span><span class='line'>  new iChart.Bar2D({
</span><span class='line'>    render: 'canvasDiv',
</span><span class='line'>    data: data,
</span><span class='line'>    title: 'Top 5 Browsers from 1 to 29 Feb 2012',
</span><span class='line'>    showpercent: true,
</span><span class='line'>    decimalsnum: 2,
</span><span class='line'>    width: 800,
</span><span class='line'>    height: 400,
</span><span class='line'>    coordinate: {
</span><span class='line'>      scale: [{
</span><span class='line'>        position: 'bottom',
</span><span class='line'>        start_scale: 0,
</span><span class='line'>        end_scale: 40,
</span><span class='line'>        scale_space: 8,
</span><span class='line'>        listeners: {
</span><span class='line'>          parseText: function(t, x, y) {
</span><span class='line'>            return {text: t + "%"}
</span><span class='line'>          }
</span><span class='line'>        }
</span><span class='line'>      }]
</span><span class='line'>    }
</span><span class='line'>  }).draw();
</span><span class='line'>}); 
</span><span class='line'>&lt;/script&gt;
</span><span class='line'>
</span><span class='line'>&lt;div id="canvasDiv"&gt;&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[逻辑题-老师的生日]]></title>
    <link href="http://codemany.com/blog/2013/03/13/logic-problems-the-teachers-birthday/"/>
    <updated>2013-03-13T10:01:28+08:00</updated>
    <id>http://codemany.com/blog/2013/03/13/logic-problems-the-teachers-birthday</id>
    <content type="html"><![CDATA[<p>小明和小强都是某老师的学生，老师的生日是M月N日，他们都知道老师的生日是以下十组中的一个。老师把M告诉了小明，把N告诉了小强，然后问他们是否知道自己的生日。小明说“如果我不知道小强也不知道”，小强说“本来我不知道，你说了这话我就知道了”，小明说“那我也知道了 ”。问老师的生日是以下的哪个？</p>

<p>3/4, 3/5, 3/8, 6/4, 6/7, 9/1, 9/5, 12/1, 12/2, 12/8</p>

<p>按M排：<br />
3/4, 3/5, 3/8<br />
6/4, 6/7<br />
9/1, 9/5<br />
12/1, 12/2, 12/8</p>

<p>按N排：<br />
9/1, 12/1<br />
12/2<br />
3/4, 6/4<br />
3/5, 9/5<br />
6/7<br />
3/8, 12/8</p>

<p>条件一：小明说“如果我不知道小强也不知道”<br />
分析：因为M都是重复的，所以小明一定不知道。小明知道M以后肯定小强不知道，说明N肯定也是重复，可以剔除12/2和6/7这两个日期。另外，还可以排队N为2与7所对应的月份，因为当老师生日的M为6或12时，小强是有可能知道的，与已知条件相违背。<br />
结果：3/4, 3/5, 3/8, 9/1, 9/5</p>

<p>按M排：<br />
3/4, 3/5, 3/8<br />
9/1, 9/5</p>

<p>按N排：<br />
3/4<br />
3/5, 9/5<br />
3/8<br />
9/1</p>

<p>条件二：小强说“本来我不知道，你说了这话我就知道了”<br />
分析：根据上面的结果和条件二可以知道，现在N一定不能是重复的，可以把3/5和9/5排除。<br />
结果：3/4, 3/8, 9/1</p>

<p>按M排：<br />
3/4, 3/8<br />
9/1</p>

<p>按N排：<br />
3/4<br />
3/8<br />
9/1</p>

<p>条件三：小明说“那我也知道了”<br />
分析：综合条件二的结果和条件三可以判定现在M应该是单一的，所以只能是9。<br />
结果：9/1</p>

<p>老师的生日为9/1。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[.htaccess实例详解]]></title>
    <link href="http://codemany.com/blog/2013/03/10/htaccess-explanation-by-example/"/>
    <updated>2013-03-10T12:01:35+08:00</updated>
    <id>http://codemany.com/blog/2013/03/10/htaccess-explanation-by-example</id>
    <content type="html"><![CDATA[<p>又一次迁移博客服务器。因为是迁移，就没有采取安装新的Wordpress，而是把以前的程序拷贝到服务器上。</p>

<p>打开首页的时候还好，访问具体文章时就出现问题了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Not Found
</span><span class='line'>The requested URL /sample-article.html was not found on this server.</span></code></pre></td></tr></table></div></figure>


<p>百思不得其解。后来试着去后台重新做设置，然后就发现在根目录下多了.htaccess文件，内容如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># BEGIN WordPress
</span><span class='line'>&lt;IfModule mod_rewrite.c&gt;
</span><span class='line'>RewriteEngine On
</span><span class='line'>RewriteBase /
</span><span class='line'>RewriteRule ^index\.php$ - [L]
</span><span class='line'>RewriteCond %{REQUEST_FILENAME} !-f
</span><span class='line'>RewriteCond %{REQUEST_FILENAME} !-d
</span><span class='line'>RewriteRule . /index.php [L]
</span><span class='line'>&lt;/IfModule&gt;
</span><span class='line'># END WordPress</span></code></pre></td></tr></table></div></figure>


<p>以前也看过这个文件，总是模模糊糊不太明白。今天研究的时候发现一下子就清清楚楚了（这大概就是说的顿悟吧^_^不过它的发生应该还是建立在渐修的基础上）。</p>

<p>下面来说说这些内容的理解：</p>

<p>第1行就是打开重写引擎</p>

<p>第2行是设置URL前缀。</p>

<blockquote><p>Syntax:   RewriteRule Pattern Substitution [flags]</p>

<ul>
<li>(dash)
A dash indicates that no substitution should be performed (the existing path is passed through untouched). This is used when a flag (see below) needs to be applied without changing the path.</li>
</ul>


<p>last|L
 Stop the rewriting process immediately and don&#8217;t apply any more rules. Especially note caveats for per-directory and .htaccess context.</p></blockquote>

<p>第3行是完全匹配index.php的URI，但不做替换，并且匹配成功后就停止执行重写过程。</p>

<p>第6行就是把所有的访问请求重写，指给index.php，然后停止执行重写过程。</p>

<blockquote><p>Syntax: RewriteCond TestString CondPattern</p>

<p>REQUEST_FILENAME
 The full local filesystem path to the file or script matching the request, if this has already been determined by the server at the time REQUEST_FILENAME is referenced. Otherwise, such as when used in virtual host context, the same value as REQUEST_URI.</p>

<p>You can prefix the pattern string with a &#8216;!&#8217; character (exclamation mark) to specify a non-matching pattern.</p>

<p>&#8216;-d&#8217; (is directory)
 Treats the TestString as a pathname and tests whether or not it exists, and is a directory.</p>

<p>&#8216;-f&#8217; (is regular file)
 Treats the TestString as a pathname and tests whether or not it exists, and is a regular file.</p></blockquote>

<p>第4和第5行是不去测试访问URI是否是目录或文件。其实有了第6行这两行基本就是摆设了。</p>

<p>最后再唠叨一句，有问题直接查官方文档应该是最好的选择。官方文档链接：<a href="http://httpd.apache.org/docs/current/mod/mod_rewrite.html">Apache Module mod_rewrite</a>。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我们真的需要接口命名规范吗？]]></title>
    <link href="http://codemany.com/blog/2013/02/24/do-we-really-need-naming-conventions-for-interfaces/"/>
    <updated>2013-02-24T13:34:04+08:00</updated>
    <id>http://codemany.com/blog/2013/02/24/do-we-really-need-naming-conventions-for-interfaces</id>
    <content type="html"><![CDATA[<p>英文原文：<a href="http://www.adam-bien.com/roller/abien/entry/in_the_age_of_dryness">http://www.adam-bien.com/roller/abien/entry/in_the_age_of_dryness</a></p>

<p>译者：感觉这篇文章讲的不错，也不算太长，就翻译了过来。</p>

<p>在过去的项目/审查中我发现了如下的接口及其实现的命名规范：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>IService service = new Service();
</span><span class='line'>
</span><span class='line'>Service service = new ServiceImpl();
</span><span class='line'>
</span><span class='line'>ServiceIF service = new Service();</span></code></pre></td></tr></table></div></figure>


<p>每一条都含有多余信息。无论是强调接口或其实现，相关信息都已经包含在代码中，所以都是多余的。这种命名规范仅当你真的不知道如何命名实现的时候才需要，作为去思考一个名称的替代，它更容易依靠现有的模板。</p>

<p>实现名称的缺乏可能也是作为它的非充分责任的一个指标（an indicator for it&#8217;s unsufficient responsibilities）。因此，如果你找不到一个适当的实现名称，考虑移除接口直接暴露实现可能是个好主意－没有奇怪的规范。实际上JDK中没有这样的规范，接口及其实现也经常称为不同（are often even called differently）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Runnable r = new Thread();
</span><span class='line'>
</span><span class='line'>RootPaneContainer c = new JFrame();
</span><span class='line'>
</span><span class='line'>TableModel t = new DefaultTableModel();
</span><span class='line'>
</span><span class='line'>Remote remote = new UnicastRemoteObject();</span></code></pre></td></tr></table></div></figure>


<p>接口的目的是抽象或从几个实现解耦。一个单一的实现并不需要通过接口来解耦。也有一些例外的规则，如需要使用动态代理等。</p>

<p>通过单个的，有着奇怪命名规范的实现（implementation）来实现（realize）一个接口不应该被认为是一般的最佳实践&#8230;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[逻辑题-100盏电灯]]></title>
    <link href="http://codemany.com/blog/2013/02/24/logic-problems-100-lamps/"/>
    <updated>2013-02-24T08:56:21+08:00</updated>
    <id>http://codemany.com/blog/2013/02/24/logic-problems-100-lamps</id>
    <content type="html"><![CDATA[<p>房间里有100盏电灯，编号为1，2，3&#8230;100，每盏灯上有一个按钮，初始时灯全都是关的。</p>

<p>编好号的100位同学由房间外依次走进去，将自己编号的倍数的灯的按钮全部按一次，例如第一位同学把编号是1的倍数的灯的按钮按一下（此时100盏灯全亮），第二位同学把编号是2的倍数的灯的按钮按一下（此时只有50盏灯亮着，50盏被这个人按灭了）&#8230;第100位同学把编号是100的倍数的灯（即编号为100的灯）的按钮按一下，请问依次走完后，还有多少盏灯亮着？</p>

<p>解题思路：<br />
被按过奇数次的灯亮着，偶数次的灯关了。<br />
因为每个同学会把自己编号的倍数的灯全部按一次，所以：<br />
1号灯会被1号同学按下；<br />
2号灯会被1，2号同学按下；<br />
3号灯会被1，3号同学按下；<br />
4号灯会被1，2，4号同学按下；<br />
&#8230;<br />
10号灯会被1，2，5，10号同学按下；<br />
&#8230;</p>

<p>从上面可以总结出n号灯会被以它所有约数为编号的同学按下。</p>

<p>这样，问题就变成了求每盏灯的编号有多少个约数的数学问题。如果约数个数为奇数，灯亮着；反之，灯关着。</p>

<p>Ruby代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Light state: ON/OFF = true/false
</span><span class='line'>lamps = Array.new(100, false)
</span><span class='line'>
</span><span class='line'>1.upto(lamps.length) do |lno|
</span><span class='line'>  1.upto(lno) do |fno|
</span><span class='line'>    lamps[lno - 1] = !lamps[lno - 1] if lno % fno == 0
</span><span class='line'>  end
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>lamps.each_index do |i|
</span><span class='line'>  print "Light #{i + 1} is "
</span><span class='line'>  puts lamps[i] ? "ON" : "OFF"
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>最后，我们会发现编号1，4，9，16，25&#8230;100的灯是亮着的，其它都是灭的。即编号值可以开出整数平方根的灯是亮的。</p>
]]></content>
  </entry>
  
</feed>
