
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>构建一个更友好的404页面 - 乐者为王</title>
  <meta name="author" content="dohkoos">

  
  <meta name="description" content="用户访问网站时经常会遇到404错误。如果开发者有提供定制的404页面，那会让用户的体验更好。定制的404页面真的非常有用，它不仅提供有关错误信息，也会提供即时反馈给开发者，以便问题能被尽快修复。 这里是我对定制404页面的一些思考。 总体设计 为了提供有用和特定的信息给用户， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codemany.com/blog/build-a-more-friendly-404-page/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="乐者为王" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46570161-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">乐者为王</a></h1>
  
    <h2>Do one thing, and do it well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="codemany.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">构建一个更友好的404页面</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2010-07-13T19:01:50+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2010</span></span> <span class='time'>7:01 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>用户访问网站时经常会遇到404错误。如果开发者有提供定制的404页面，那会让用户的体验更好。定制的404页面真的非常有用，它不仅提供有关错误信息，也会提供即时反馈给开发者，以便问题能被尽快修复。</p>

<p>这里是我对定制404页面的一些思考。</p>

<h3 id="总体设计">总体设计</h3>

<p>为了提供有用和特定的信息给用户，需要界定404错误可能的原因。这里是4个可能的原因：</p>

<ol>
<li>用户打错URL或者使用过期的书签 a mistyped address</li>
<li>因为站点内失效的链接 a deleted page or content that has moved elsewhere. </li>
<li>搜索引擎返回的失效的链接</li>
<li>其它网站失效的链接造成 a bad link from somewhere else</li>
</ol>

<p>提供错误具体原因的信息
如果是情况2和4，后台程序发送邮件给维护者，失效链接，包括链接指向的URL和用户试图到达的页面</p>

<p>showing the visitor some helpful content would be a good idea.
Depending on your website, you could show recent articles or recently updated pages or perhaps even a custom search box.
it will help visitors find what they need.</p>

<h3 id="定制404页面">定制404页面</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>页面代码</span></code></pre></td></tr></table></div></figure>

<h3 id="后台脚本">后台脚本</h3>

<p>为了确定404错误的来源，程序需要访问HTTP_REFERER环境变量，HTTP_REFERER包含用户过来的页面URL
虽然不能保证它的正确性，因为它可以被伪造
但这不是我们真的要关注的。</p>

<p>一般而言，脚本执行以下步骤：</p>

<ol>
<li>检测HTTP_REFERER确定404错误的来源</li>
<li>显示适当的消息给用户</li>
<li>如果是特定的错误，发送邮件给开发者</li>
</ol>

<h4 id="case-1-mistyped-url-or-out-of-date-bookmark">Case 1: Mistyped URL or out-of-date bookmark</h4>

<p>在这个案例中，HTTP_REFERER可能为空，所以我们要使用下面的代码检查：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>request.env["HTTP_REFERER"]</span></code></pre></td></tr></table></div></figure>

<p>然后在定制的404页面上显示消息，告诉用户问题是什么。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>抱歉，你试图访问的页面http://example.com/no-such-page.shtml不存在。
</span><span class='line'>
</span><span class='line'>It looks like this was the result of either a mistyped address or an out-of-date bookmark in your web browser.
</span><span class='line'>
</span><span class='line'>You may want to try searching this site or using our site map to find what you were looking for.</span></code></pre></td></tr></table></div></figure>

<p>在显示消息给用户的同时发送邮件给开发者</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HTTP_REFERER</span></code></pre></td></tr></table></div></figure>

<h4 id="case-2-broken-link-on-my-website">Case 2: Broken link on my website</h4>

<p>当HTTP_REFERER不为空时，先要检查它是指向本站、其他人的站点，还是搜索引擎。如果包含本站域名，然后就知道用户是从其它页面过来的。使用以下代码检测：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HTTP_REFERER</span></code></pre></td></tr></table></div></figure>

<p>在本案例中，我们给用户显示消息，告诉他该页面的链接失效了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Sorry, but the page you were trying to get to, http://www.mydomain.com/
</span><span class='line'>no-such-page.shtml, does not exist.
</span><span class='line'>
</span><span class='line'>Apparently, we have a broken link on our page. An e-mail has just been sent to the person who can fix this and it should be corrected shortly. No further action is required on your part.</span></code></pre></td></tr></table></div></figure>

<p>同时发送包含所有必要信息的邮件给开发者，并且告诉用户邮件已经被发送，失效链接将马上被修正。
邮件的标题设置 要清晰地确定站点上有失效链接 并提供域名
邮件的内容 告诉我用户所在的页面的URL 以及请求页面的URL</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>From: www.mydomain.com 404 script
</span><span class='line'>
</span><span class='line'>Subject: Broken link on my site, www.mydomain.com.
</span><span class='line'>
</span><span class='line'>Message: BROKEN LINK ON MY SITE
</span><span class='line'>
</span><span class='line'>There appears to be a broken link on my page, http://www.mydomain.com/
</span><span class='line'>badlink.shtml. Someone was trying to get to http://www. mydomain.gov/
</span><span class='line'>no-such-page.shtml from that page.  Why don’t you take a look at it and see what’s wrong?</span></code></pre></td></tr></table></div></figure>

<h4 id="case-3-broken-link-from-a-search-engine">Case 3: Broken link from a search engine</h4>

<p>为了确定用户来自搜索引擎结果页面
需要用一个搜索引擎URL列表来检测HTTP_REFERER 这个列表是一个排序的文本文件 这样我们可以在任何时候更新列表而不需要修改脚本</p>

<p>这里是本案例的代码片段：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>my $SEARCHENGINE = "false";
</span><span class='line'>open(FILE, "searchengines.txt") or die "cannot open the file";
</span><span class='line'>while () {
</span><span class='line'>  chomp;
</span><span class='line'>  if (index($referrer, $_) &gt;= 0) {
</span><span class='line'>    $SEARCHENGINE = "true";
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>if ($SEARCHENGINE eq "true") {
</span><span class='line'>   // do something
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>在本案例中，我们让用户知道搜索引擎返回的是旧链接。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Sorry, but the page you were trying to get to, http://www.mydomain.com/no-such-page.shtml, does not exist.
</span><span class='line'>
</span><span class='line'>It looks like the search engine has returned a link to an old page. These old links should eventually be removed from their indexes but since these are automatically generated there is no one to contact to try to correct the problem.
</span><span class='line'>
</span><span class='line'>You may want to try searching this site or using our site map to find what you were looking for.</span></code></pre></td></tr></table></div></figure>

<p>因为真的没有什么我们可以做的，所以不需要发送邮件。或者也可以发送邮件，仅仅告诉开发者让他知道这个问题。</p>

<h4 id="case-4-broken-link-on-somebody-else’s-website">Case 4: Broken link on somebody else’s website</h4>

<p>如果404错误不是任何前面3种情况的结果，我们知道它是由其他人页面上的失效链接造成。脚本显示适当的信息给用户。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Sorry, but the page you were trying to get to, http://www.mydomain.com/
</span><span class='line'>no-such-page.shtml, does not exist.
</span><span class='line'>
</span><span class='line'>Apparently, there is a broken link on the page you just came from. We have been notified and will attempt to contact the owner of that page and let them know about it.
</span><span class='line'>
</span><span class='line'>You may want to try searching this site or using our site map to find what you were looking for.</span></code></pre></td></tr></table></div></figure>

<p>同时发送邮件给开发者，开发者可以到有失效链接的页面上，如果页面上有所有者的联系信息，可以通知他们这个问题。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>From:www.mydomain.com 404 script
</span><span class='line'>
</span><span class='line'>Subject: Broken link on somebody else’s site.
</span><span class='line'>
</span><span class='line'>Message: BROKEN LINK ON SOMEBODY ELSE’S SITE
</span><span class='line'>
</span><span class='line'>There appears to be a broken link on the page, http://www.somedomain.com/
</span><span class='line'>badlink.shtml.  Someone was trying to get to http://www.mydomain.com/
</span><span class='line'>no-such-page.shtml from that page.  Why don’t you take a look at it and see if you can contact the page owner and let them know about it?</span></code></pre></td></tr></table></div></figure>

<h3 id="最后">最后</h3>

<p>实现定制404页面可以通过帮助用户提高站点的可用性
还能让开发者知道失效的链接</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">dohkoos</span></span>

      




<time class='entry-date' datetime='2010-07-13T19:01:50+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2010</span></span> <span class='time'>7:01 pm</span></time>
      


      

<span class="tags">
  
    <a class='tag' href='/tags/html/'>HTML</a>, <a class='tag' href='/tags/rails/'>Rails</a>
  
</span>


    </p>
    
  <h3>Related Posts</h3>
  <ul class="posts">
  
    <li class="related">
      <a href="/blog/multipart-misspelling-cause-bug/">打错multipart引发的血案</a>
    </li>
  
    <li class="related">
      <a href="/blog/rebuild-ebook-website-with-responsive-design/">使用响应式设计改造电子书网站</a>
    </li>
  
    <li class="related">
      <a href="/blog/create-ebook-website-with-html5/">使用HTML5创建电子书网站</a>
    </li>
  
    <li class="related">
      <a href="/blog/draw-2d-bar-graph-using-ichartjs/">使用ichartjs画2D条形图</a>
    </li>
  
    <li class="related">
      <a href="/blog/table-text-alignment-rules/">表格内容对齐规则（left、right、center）</a>
    </li>
  
  </ul>


    
      <div id="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share/" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js" charset="utf-8"></script>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/with-check-option-in-view/" title="Previous Post: 创建视图时的with check option选项">&laquo; 创建视图时的with check option选项</a>
      
      
        <a class="basic-alignment right" href="/blog/findviewbyid-returns-null/" title="Next Post: findViewById()返回null">findViewById()返回null &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/how-to-build-a-news-website-layout-with-flexbox/">如何使用Flexbox构建新闻站点布局</a>
      </li>
    
      <li class="post">
        <a href="/blog/logic-problems-who-owns-the-fish/">逻辑题-谁养鱼</a>
      </li>
    
      <li class="post">
        <a href="/blog/developers-are-blinded-by-the-light/">开发者被灯光蒙蔽了双眼</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part11/">ANTLR 4权威参考读书笔记（11）</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part10/">ANTLR 4权威参考读书笔记（10）</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Recent Comments</h1>
  <div class="dsq-widget">
    <script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"></script>
  </div>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 129%" href="/tags/antlr/">ANTLR</a>
<a style="font-size: 107%" href="/tags/algorithm/">Algorithm</a>
<a style="font-size: 131%" href="/tags/android/">Android</a>
<a style="font-size: 104%" href="/tags/c-plus-plus/">C++</a>
<a style="font-size: 104%" href="/tags/css/">CSS</a>
<a style="font-size: 110%" href="/tags/crack/">Crack</a>
<a style="font-size: 107%" href="/tags/database/">Database</a>
<a style="font-size: 97%" href="/tags/eclipse/">Eclipse</a>
<a style="font-size: 112%" href="/tags/git/">Git</a>
<a style="font-size: 97%" href="/tags/html/">HTML</a>
<a style="font-size: 104%" href="/tags/jbookshelf/">JBookShelf</a>
<a style="font-size: 148%" href="/tags/java/">Java</a>
<a style="font-size: 101%" href="/tags/javascript/">JavaScript</a>
<a style="font-size: 97%" href="/tags/listview/">ListView</a>
<a style="font-size: 104%" href="/tags/mysql/">MySQL</a>
<a style="font-size: 97%" href="/tags/paperclip/">Paperclip</a>
<a style="font-size: 124%" href="/tags/powerbuilder/">PowerBuilder</a>
<a style="font-size: 110%" href="/tags/powerscript/">PowerScript</a>
<a style="font-size: 117%" href="/tags/qianbao/">Qianbao</a>
<a style="font-size: 150%" href="/tags/rails/">Rails</a>
<a style="font-size: 119%" href="/tags/ruby/">Ruby</a>
<a style="font-size: 97%" href="/tags/spring/">Spring</a>
<a style="font-size: 101%" href="/tags/struts/">Struts</a>
<a style="font-size: 130%" href="/tags/translation/">Translation</a>
<a style="font-size: 97%" href="/tags/ubuntu/">Ubuntu</a>
<a style="font-size: 107%" href="/tags/windows-server-2008/">Windows Server 2008</a>
<a style="font-size: 107%" href="/tags/wxwidgets/">wxWidgets</a>

  </ul>
</section>
<section>
  <h1>Blogroll</h1>
  <ul>
    <li><a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a></li>
    <li><a href="http://www.importnew.com/">ImportNew</a></li>
    <li><a href="http://ifeve.com/">并发编程网</a></li>
    <li><a href="http://codingnow.com/">云风的 BLOG</a></li>
    <li><a href="http://dbanotes.net/">DBA Notes</a></li>
    <li><a href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a></li>
    <li><a href="http://advdbg.org/">高端调试</a></li>
    <li><a href="http://www.cs.usfca.edu/~galles/visualization/Algorithms.html">Data Structure Visualization</a></li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/dohkoos">@dohkoos</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dohkoos',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  <div>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - dohkoos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codemany';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://codemany.com/blog/build-a-more-friendly-404-page/';
        var disqus_url = 'http://codemany.com/blog/build-a-more-friendly-404-page/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
