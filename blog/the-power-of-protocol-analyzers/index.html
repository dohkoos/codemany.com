
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>协议分析器的威力 - 乐者为王</title>
  <meta name="author" content="dohkoos">

  
  <meta name="description" content="英文原文：http://arstechnica.com/information-technology/2016/09/the-power-of-protocol-analyzers/ 问题发生在错综复杂的网络世界里。但要在一时激动之下确定一种新型问题的确切原因变得有些冒险。在这种情况下， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codemany.com/blog/the-power-of-protocol-analyzers/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="乐者为王" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46570161-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">乐者为王</a></h1>
  
    <h2>Do one thing, and do it well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="codemany.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">协议分析器的威力</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-20T18:06:40+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:06 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>英文原文：<a href="http://arstechnica.com/information-technology/2016/09/the-power-of-protocol-analyzers/">http://arstechnica.com/information-technology/2016/09/the-power-of-protocol-analyzers/</a></p>

<p>问题发生在错综复杂的网络世界里。但要在一时激动之下确定一种新型问题的确切原因变得有些冒险。在这种情况下，当Google-fu耗尽的时候甚至其他能干的工程师也可能会被迫去依赖试错法。</p>

<p>幸运的是，有个秘密武器等待乐意的工程师去部署——协议分析器。该工具允许你明确地确定几乎任何错误的根源，给你提供在底层协议上自我学习的能力。现在唯一的问题是，许多工程师因为（毫无根据的）恐惧而完全回避它。</p>

<h3 id="什么是协议分析器？">什么是协议分析器？</h3>

<p>协议分析器，或者数据包嗅探器，是一个用于拦截通信量，存储它们，并以一个已解码的、人类可读的状态呈现它们的工具。现代协议分析器比如Wireshark甚至可以靠自己发现基本的问题，然后使用捕获的数据执行统计分析。</p>

<p>不理会功能，数据包嗅探器都以基本相同的方式工作。它们把自己插入到网络堆栈中，把所有通信量复制到一个缓冲区或文件。大部分还会将网络驱动置于“混杂模式”，该模式从根本上说允许这些工具取回所有进入网络堆栈的通信量，而不是只采集前往系统本身的通信量。</p>

<h3 id="how-protocol-analyzers-can-help">How protocol analyzers can help</h3>

<p>在很多情况下，解决一个困难的网络问题的最难部分是找到和理解问题的根源。这种困难的部分源于这样的事实，你对大多数问题使用的工具不是正确的对底层问题的工具。</p>

<p>如果你是一个系统管理员，很有可能你经常用于数据采集的工具是某种日志和错误消息。通常，这些都是解释工具。这些实体试图把原始数据总结为对非开发者或非工程师有意义的东西。因为解释工具是从应用层的视角提供问题的汇总数据，它们往往不能帮助你解决底层的问题。</p>

<p>例如，一条事件日志消息可以告诉你应用程序无法连接到服务器。它甚至可以告诉你根本原因是超时。但这条消息不大可能告诉你超时是由一个黑洞路由器丢弃一个大帧引起。它不能，因为事件日志消息服务不知道错误为何发生。为了使工具知道那个，它需要预测（不解释）这个非常问题，在MTU稳步减少的情况下发送数据包，直到一个通过。如果一个事件日志消息服务早就被编写好要做那件事，从一开始你就不会有这个问题。</p>

<p>当使用错误的工具时，你可能会在某处花上几个小时甚至几周的时间，直到你侥幸得到解决方案。然而，通过使用协议分析器和历久弥新的ping命令，你可以非常容易地在大约5分钟内诊断这个问题。就像我的汽车技术辅导员早在高中时就告诉我的，它全都是关于对任务使用恰当的工具。</p>

<p>Beyond identifying the error, protocol analyzers offer one of the few ways to prove the source of a problem. Back in my days at Microsoft, it was very common for tough problems to get shuttled back and forth between teams as each group misinterpreted the data provided by interpretive tools. First the issue might be sent to the Exchange team, then it might be shuttled to Active Directory team, and then finally to the Networking team.</p>

<p>Usually, this was because a problem would legitimately appear to be in another team’s wheelhouse. Often, however, the game of hot-potato stopped with the Networking team. Why? Because the Networking team’s number one tool is the one that proves the source of the problem.</p>

<p>Networking, like all of computing, is completely logical at its core. And once you understand how it works under the hood, you will be capable of identifying problems at the lowest level regardless of how unique an issue is. And as a great side-effect for protocol analysis, you’ll also learn an enormous amount about networking, which is knowledge that will carry through and help you solve all sorts of networking problems (even those that don’t require protocol analysis).</p>

<h3 id="wireshark基础">Wireshark基础</h3>

<p>These days, there are a variety of protocol analyzers to choose from, from the free and quite functional Microsoft Message Analyzer to the very feature-rich but quite expensive Savvius Omnipeek. I’ve used a number of analyzers over the years, but my favorite protocol analyzer for general troubleshooting is Wireshark. It’s a free, open-source, multi-platform analyzer with a lot of features. A vibrant community stands behind it, and Wireshark is also pretty easy to get used to. This makes it a fine place to start.</p>

<p>You can download Wireshark for your OS from <a href="https://www.wireshark.org/">https://www.wireshark.org/</a>. There’s nothing special about installing it, but if you are installing it for Windows, make sure you also install the bundled WinPCAP driver. This allows Wireshark to actually capture packets (without it, you can only view your archived captures).</p>

<p>Wireshark normally places your NIC in promiscuous mode. Normally, your NIC would only retain frames destined for either your MAC or the Broadcast MAC (FF-FF-FF-FF-FF-FF). With promiscuous mode enabled, however, your NIC retains all frames it hears.</p>

<p>Theoretically, this means that you should receive all packets on your Ethernet segment. Practically, however, almost all Ethernet networks these days are switched networks. If you want all the traffic, a little more work is required.</p>

<p>Once you have Wireshark installed, using it is pretty straightforward. Open it up, and you are presented with the screen shown below.</p>

<p><img src="/uploads/wireshark-network-analyzer.png" title="wireshark-network-analyzer" ></p>

<p>This screen presents you with the option of choosing a NIC to capture packets on and the option of entering a filter for capturing only a portion of inbound packets. If you select a NIC and click the little shark fin icon below the File menu, Wireshark will immediately begin capturing packets.</p>

<p>As packets are captured, Wireshark displays them in real time in the main interface. When you are ready to stop, you simply click on the little red square beside the shark fin icon.</p>

<p><img src="/uploads/wireshark-main-interface.png" title="wireshark-main-interface" ></p>

<p>The packet list section shows everything you have captured to this point, sorted (by default) in the order they were captured in. (You can sort these packets at will by clicking the heading you want to sort by.)</p>

<p>The packet details section shows you each header that Wireshark decoded in the packet. Basically, Wireshark has decoders for nearly every protocol in use today, and the decoder tool automatically applies to each packet in order to show you the data split into fields.</p>

<p>For instance, below, I’ve expanded the Ethernet II header for a typical HTTP packet.</p>

<p><img src="/uploads/wireshark-http-header.png" title="wireshark-http-header" ></p>

<p>You can clearly see that Wireshark has separated out the destination and source MAC addresses and the Type field, which is 0x800. The type field specifies that the next header should be an IP version 4 header, which Wireshark conveniently tells you.</p>

<p>This decoding feature saves you from having to count bytes and decode it yourself (though, if you are so inclined, you can still do so in the raw bytes section). Also of interest in the raw bytes section: Wireshark simultaneously provides an ASCII conversion for all data, which sometimes provides surprising data.</p>

<p><img src="/uploads/wireshark-ascii-view.png" title="wireshark-ascii-view" ></p>

<p>Wireshark comes with some pretty nifty analysis and statistical features, too, including the ability to measure response times and round-trip times. But by far, the most useful feature is the filtering function.</p>

<p>Directly above the packet list is a text box where you can enter display filters. By default, no filters are applied, meaning all packets that were captured are displayed. However, you often end up with information overload, and filtering out the noise is a very important part of packet analysis.</p>

<p>Filters in Wireshark follow a simple ‘language’ combining protocol fields, comparison operators, and logical operators in order to filter out packets that do not match the criteria. For example, the filter http will only display HTTP traffic, and the filter ip.addr == 192.168.1.10 will only display packets where either the source or destination IP address is 192.168.1.10.</p>

<p>When you are first getting started, the filtering can be a little intimidating, but often the easiest way to learn filters in Wireshark is to use the built-in expression tool. Accessing this starts by clicking the Expression button to the right of the filter text box.</p>

<p>This tool allows you to sort through all of the protocols Wireshark natively supports and pick the fields you want to filter by without knowing the filter verbs or syntax. Simply select the protocols, fill out the fields that appear, and the filter will be built for you.</p>

<p><img src="/uploads/wireshark-filter-expression.png" title="wireshark-filter-expression" ></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">dohkoos</span></span>

      




<time class='entry-date' datetime='2016-09-20T18:06:40+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:06 pm</span></time>
      


      

<span class="tags">
  
    <a class='tag' href='/tags/translation/'>Translation</a>, <a class='tag' href='/tags/wireshark/'>Wireshark</a>
  
</span>


    </p>
    
  <h3>Related Posts</h3>
  <ul class="posts">
  
    <li class="related">
      <a href="/blog/how-to-build-a-news-website-layout-with-flexbox/">如何使用Flexbox构建新闻站点布局</a>
    </li>
  
    <li class="related">
      <a href="/blog/developers-are-blinded-by-the-light/">开发者被灯光蒙蔽了双眼</a>
    </li>
  
    <li class="related">
      <a href="/blog/economic-inequality-the-short-version/">贫富差距精简版</a>
    </li>
  
    <li class="related">
      <a href="/blog/overnight-success-it-takes-years/">一夜成名：这需要好几年时间</a>
    </li>
  
    <li class="related">
      <a href="/blog/10-tips-for-writing-consistently-popular-programming-articles/">写出受欢迎的编程文章的10个技巧</a>
    </li>
  
  </ul>


    
      <div id="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share/" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js" charset="utf-8"></script>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/reading-notes-the-definitive-antlr4-reference-part19/" title="Previous Post: ANTLR 4权威参考读书笔记（19）">&laquo; ANTLR 4权威参考读书笔记（19）</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/the-power-of-protocol-analyzers/">协议分析器的威力</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part19/">ANTLR 4权威参考读书笔记（19）</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part18/">ANTLR 4权威参考读书笔记（18）</a>
      </li>
    
      <li class="post">
        <a href="/blog/how-to-build-a-news-website-layout-with-flexbox/">如何使用Flexbox构建新闻站点布局</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part17/">ANTLR 4权威参考读书笔记（17）</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Recent Comments</h1>
  <div class="dsq-widget">
    <script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"></script>
  </div>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 135%" href="/tags/antlr/">ANTLR</a>
<a style="font-size: 107%" href="/tags/algorithm/">Algorithm</a>
<a style="font-size: 131%" href="/tags/android/">Android</a>
<a style="font-size: 104%" href="/tags/c-plus-plus/">C++</a>
<a style="font-size: 107%" href="/tags/css/">CSS</a>
<a style="font-size: 110%" href="/tags/crack/">Crack</a>
<a style="font-size: 107%" href="/tags/database/">Database</a>
<a style="font-size: 97%" href="/tags/eclipse/">Eclipse</a>
<a style="font-size: 115%" href="/tags/git/">Git</a>
<a style="font-size: 97%" href="/tags/html/">HTML</a>
<a style="font-size: 104%" href="/tags/jbookshelf/">JBookShelf</a>
<a style="font-size: 148%" href="/tags/java/">Java</a>
<a style="font-size: 101%" href="/tags/javascript/">JavaScript</a>
<a style="font-size: 97%" href="/tags/listview/">ListView</a>
<a style="font-size: 104%" href="/tags/mysql/">MySQL</a>
<a style="font-size: 97%" href="/tags/paperclip/">Paperclip</a>
<a style="font-size: 119%" href="/tags/powerbuilder/">PowerBuilder</a>
<a style="font-size: 101%" href="/tags/powerscript/">PowerScript</a>
<a style="font-size: 117%" href="/tags/qianbao/">Qianbao</a>
<a style="font-size: 150%" href="/tags/rails/">Rails</a>
<a style="font-size: 119%" href="/tags/ruby/">Ruby</a>
<a style="font-size: 97%" href="/tags/spring/">Spring</a>
<a style="font-size: 101%" href="/tags/struts/">Struts</a>
<a style="font-size: 134%" href="/tags/translation/">Translation</a>
<a style="font-size: 97%" href="/tags/ubuntu/">Ubuntu</a>
<a style="font-size: 107%" href="/tags/windows-server-2008/">Windows Server 2008</a>
<a style="font-size: 107%" href="/tags/wxwidgets/">wxWidgets</a>

  </ul>
</section>
<section>
  <h1>Blogroll</h1>
  <ul>
    <li><a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a></li>
    <li><a href="http://www.importnew.com/">ImportNew</a></li>
    <li><a href="http://ifeve.com/">并发编程网</a></li>
    <li><a href="http://codingnow.com/">云风的 BLOG</a></li>
    <li><a href="http://dbanotes.net/">DBA Notes</a></li>
    <li><a href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a></li>
    <li><a href="http://advdbg.org/">高端调试</a></li>
    <li><a href="http://www.cs.usfca.edu/~galles/visualization/Algorithms.html">Data Structure Visualization</a></li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/dohkoos">@dohkoos</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dohkoos',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  <div>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - dohkoos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codemany';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://codemany.com/blog/the-power-of-protocol-analyzers/';
        var disqus_url = 'http://codemany.com/blog/the-power-of-protocol-analyzers/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
