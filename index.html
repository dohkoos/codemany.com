
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>乐者为王</title>
  <meta name="author" content="dohkoos">

  
  <meta name="description" content="英文原文：http://arstechnica.com/information-technology/2016/09/the-power-of-protocol-analyzers/ 问题发生在错综复杂的网络世界里。但要在一时激动之下确定一种新型问题的确切原因变得有些冒险。在这种情况下， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codemany.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="乐者为王" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46570161-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">乐者为王</a></h1>
  
    <h2>Do one thing, and do it well.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="codemany.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/the-power-of-protocol-analyzers/">协议分析器的威力</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-20T18:06:40+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:06 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>英文原文：<a href="http://arstechnica.com/information-technology/2016/09/the-power-of-protocol-analyzers/">http://arstechnica.com/information-technology/2016/09/the-power-of-protocol-analyzers/</a></p>

<p>问题发生在错综复杂的网络世界里。但要在一时激动之下确定一种新型问题的确切原因变得有些冒险。在这种情况下，当Google-fu耗尽的时候甚至其他能干的工程师也可能会被迫去依赖试错法。</p>

<p>幸运的是，有个秘密武器等待乐意的工程师去部署——协议分析器。该工具允许你明确地确定几乎任何错误的根源，给你提供在底层协议上自我学习的能力。现在唯一的问题是，许多工程师因为（毫无根据的）恐惧而完全回避它。</p>

<h3 id="什么是协议分析器？">什么是协议分析器？</h3>

<p>协议分析器，或者数据包嗅探器，是一个用于拦截通信量，存储它们，并以一个已解码的、人类可读的状态呈现它们的工具。现代协议分析器比如Wireshark甚至可以靠自己发现基本的问题，然后使用捕获的数据执行统计分析。</p>

<p>不理会功能，数据包嗅探器都以基本相同的方式工作。它们把自己插入到网络堆栈中，把所有通信量复制到一个缓冲区或文件。大部分还会将网络驱动置于“混杂模式”，该模式从根本上说允许这些工具取回所有进入网络堆栈的通信量，而不是只采集前往系统本身的通信量。</p>

<h3 id="how-protocol-analyzers-can-help">How protocol analyzers can help</h3>

<p>在很多情况下，解决一个困难的网络问题的最难部分是找到和理解问题的根源。这种困难的部分源于这样的事实，你对大多数问题使用的工具不是正确的对底层问题的工具。</p>

<p>如果你是一个系统管理员，很有可能你经常用于数据采集的工具是某种日志和错误消息。通常，这些都是解释工具。这些实体试图把原始数据总结为对非开发者或非工程师有意义的东西。因为解释工具是从应用层的视角提供问题的汇总数据，它们往往不能帮助你解决底层的问题。</p>

<p>例如，一条事件日志消息可以告诉你应用程序无法连接到服务器。它甚至可以告诉你根本原因是超时。但这条消息不大可能告诉你超时是由一个黑洞路由器丢弃一个大帧引起。它不能，因为事件日志消息服务不知道错误为何发生。为了使工具知道那个，它需要预测（不解释）这个非常问题，在MTU稳步减少的情况下发送数据包，直到一个通过。如果一个事件日志消息服务早就被编写好要做那件事，从一开始你就不会有这个问题。</p>

<p>当使用错误的工具时，你可能会在某处花上几个小时甚至几周的时间，直到你侥幸得到解决方案。然而，通过使用协议分析器和历久弥新的ping命令，你可以非常容易地在大约5分钟内诊断这个问题。就像我的汽车技术辅导员早在高中时就告诉我的，它全都是关于对任务使用恰当的工具。</p>

<p>Beyond identifying the error, protocol analyzers offer one of the few ways to prove the source of a problem. Back in my days at Microsoft, it was very common for tough problems to get shuttled back and forth between teams as each group misinterpreted the data provided by interpretive tools. First the issue might be sent to the Exchange team, then it might be shuttled to Active Directory team, and then finally to the Networking team.</p>

<p>Usually, this was because a problem would legitimately appear to be in another team’s wheelhouse. Often, however, the game of hot-potato stopped with the Networking team. Why? Because the Networking team’s number one tool is the one that proves the source of the problem.</p>

<p>Networking, like all of computing, is completely logical at its core. And once you understand how it works under the hood, you will be capable of identifying problems at the lowest level regardless of how unique an issue is. And as a great side-effect for protocol analysis, you’ll also learn an enormous amount about networking, which is knowledge that will carry through and help you solve all sorts of networking problems (even those that don’t require protocol analysis).</p>

<h3 id="wireshark基础">Wireshark基础</h3>

<p>These days, there are a variety of protocol analyzers to choose from, from the free and quite functional Microsoft Message Analyzer to the very feature-rich but quite expensive Savvius Omnipeek. I’ve used a number of analyzers over the years, but my favorite protocol analyzer for general troubleshooting is Wireshark. It’s a free, open-source, multi-platform analyzer with a lot of features. A vibrant community stands behind it, and Wireshark is also pretty easy to get used to. This makes it a fine place to start.</p>

<p>You can download Wireshark for your OS from <a href="https://www.wireshark.org/">https://www.wireshark.org/</a>. There’s nothing special about installing it, but if you are installing it for Windows, make sure you also install the bundled WinPCAP driver. This allows Wireshark to actually capture packets (without it, you can only view your archived captures).</p>

<p>Wireshark normally places your NIC in promiscuous mode. Normally, your NIC would only retain frames destined for either your MAC or the Broadcast MAC (FF-FF-FF-FF-FF-FF). With promiscuous mode enabled, however, your NIC retains all frames it hears.</p>

<p>Theoretically, this means that you should receive all packets on your Ethernet segment. Practically, however, almost all Ethernet networks these days are switched networks. If you want all the traffic, a little more work is required.</p>

<p>Once you have Wireshark installed, using it is pretty straightforward. Open it up, and you are presented with the screen shown below.</p>

<p><img src="/uploads/wireshark-network-analyzer.png" title="wireshark-network-analyzer" ></p>

<p>This screen presents you with the option of choosing a NIC to capture packets on and the option of entering a filter for capturing only a portion of inbound packets. If you select a NIC and click the little shark fin icon below the File menu, Wireshark will immediately begin capturing packets.</p>

<p>As packets are captured, Wireshark displays them in real time in the main interface. When you are ready to stop, you simply click on the little red square beside the shark fin icon.</p>

<p><img src="/uploads/wireshark-main-interface.png" title="wireshark-main-interface" ></p>

<p>The packet list section shows everything you have captured to this point, sorted (by default) in the order they were captured in. (You can sort these packets at will by clicking the heading you want to sort by.)</p>

<p>The packet details section shows you each header that Wireshark decoded in the packet. Basically, Wireshark has decoders for nearly every protocol in use today, and the decoder tool automatically applies to each packet in order to show you the data split into fields.</p>

<p>For instance, below, I’ve expanded the Ethernet II header for a typical HTTP packet.</p>

<p><img src="/uploads/wireshark-http-header.png" title="wireshark-http-header" ></p>

<p>You can clearly see that Wireshark has separated out the destination and source MAC addresses and the Type field, which is 0x800. The type field specifies that the next header should be an IP version 4 header, which Wireshark conveniently tells you.</p>

<p>This decoding feature saves you from having to count bytes and decode it yourself (though, if you are so inclined, you can still do so in the raw bytes section). Also of interest in the raw bytes section: Wireshark simultaneously provides an ASCII conversion for all data, which sometimes provides surprising data.</p>

<p><img src="/uploads/wireshark-ascii-view.png" title="wireshark-ascii-view" ></p>

<p>Wireshark comes with some pretty nifty analysis and statistical features, too, including the ability to measure response times and round-trip times. But by far, the most useful feature is the filtering function.</p>

<p>Directly above the packet list is a text box where you can enter display filters. By default, no filters are applied, meaning all packets that were captured are displayed. However, you often end up with information overload, and filtering out the noise is a very important part of packet analysis.</p>

<p>Filters in Wireshark follow a simple ‘language’ combining protocol fields, comparison operators, and logical operators in order to filter out packets that do not match the criteria. For example, the filter http will only display HTTP traffic, and the filter ip.addr == 192.168.1.10 will only display packets where either the source or destination IP address is 192.168.1.10.</p>

<p>When you are first getting started, the filtering can be a little intimidating, but often the easiest way to learn filters in Wireshark is to use the built-in expression tool. Accessing this starts by clicking the Expression button to the right of the filter text box.</p>

<p>This tool allows you to sort through all of the protocols Wireshark natively supports and pick the fields you want to filter by without knowing the filter verbs or syntax. Simply select the protocols, fill out the fields that appear, and the filter will be built for you.</p>

<p><img src="/uploads/wireshark-filter-expression.png" title="wireshark-filter-expression" ></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reading-notes-the-definitive-antlr4-reference-part19/">ANTLR 4权威参考读书笔记（19）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-21T21:12:40+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>9:12 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>因为词法规则可以使用递归，所以词法解析器在技术上和语法解析器一样强大。那意味着我们甚至可以在词法分析器中匹配语法结构。或者，在另一个极端，我们可以把字符当作记号，使用语法分析器去把语法结构应用到字符流（这种被称为无扫描语法分析器）。这导致什么在词法分析器中匹配和什么在语法分析器中匹配的界线在哪里并不是很明显。幸运的是，有几条经验法则可以让我们做出判断：</p>

<ul>
<li>在词法分析器中匹配和丢弃任何语法分析器根本不需要见到的东西。例如，在词法分析器中识别和扔掉像空格和注释这些东西。否则，语法分析器必须经常查看是否有空格或注释在记号间。</li>
<li>在词法分析器中匹配诸如标志符、关键字、字符串和数字这样的常用记号。语法分析器比词法分析器有更多的开销，因此我们不必让语法分析器承受把数字放在一起识别成整数的负担。</li>
<li>把那些语法分析器不需要去辨别的词法结构合并成一个单独的记号类型。例如，如果我们的应用把整数和浮点数当作同一事物对待，然后把它们合并成记号类型NUMBER，那么就没必要向语法分析器发送单独的记号类型。</li>
<li>合并能被语法分析器视为一个单独实体的任何东西。例如，如果语法分析器不在乎XML标签里的内容，词法分析器可以把尖括号中的任何东西合并成一个单独的被称为TAG的记号类型。</li>
<li>如果语法分析器需要先分开一小块文本后才能去处理它，那么词法分析器应该传递独立的构件作为记号给语法分析器。例如，如果语法分析器需要处理一个IP地址的元素，词法分析器应该发送IP构件（整数和点）的独立的记号。</li>
</ul>

<p>想象下现在需要处理Web服务器上的日志文件，每一行表示一条记录。让我们假设每条记录都有一个请求IP地址、HTTP协议命令和结果代码。这里是一个日志条目的示例：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.209.85 "GET /download/foo.html HTTP/1.0" 200</span></code></pre></td></tr></table></div></figure>

<p>如果想要统计文件中有多少行，那么我们可以忽略掉任何东西除了换行字符的序列：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file  : NL+ ;               // 匹配换行（NL）序列的语法规则
</span><span class='line'>STUFF : ~'\n'+ -&gt; skip ;    // 匹配和丢弃除'\n'外的任何东西
</span><span class='line'>NL    : '\n' ;              // 返回NL给语法分析器或调用代码</span></code></pre></td></tr></table></div></figure>

<p>词法分析器不必识别太多的结构，语法分析器会匹配换行记号的序列。</p>

<p>接下来，我们需要从日志文件中收集一系列的IP地址。这意味着我们需要一条规则去识别IP地址的词法结构。并且我们也可以提供其它记录元素的词法规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>IP    : INT '.' INT '.' INT '.' INT ;    // 192.168.209.85
</span><span class='line'>INT   : [0-9]+ ;                         // 匹配IP八位组或者HTTP结果代码
</span><span class='line'>STRING: '"' .*? '"' ;                    // 匹配HTTP协议命令
</span><span class='line'>NL    : '\n' ;                           // 匹配日志文件记录终结符
</span><span class='line'>WS    : ' ' -&gt; skip ;                    // 忽略空格</span></code></pre></td></tr></table></div></figure>

<p>拥有一套完整的记号后，我们可以让语法规则匹配日志文件中的记录：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file  : row+ ;                // 匹配日志文件中行的语法规则
</span><span class='line'>row   : IP STRING INT NL ;    // 匹配日志文件记录</span></code></pre></td></tr></table></div></figure>

<p>更进一步，我们需要把文本IP地址转换成32位的数字。使用便利的库函数split(&#39;.&#39;)，我们可以把IP地址作为字符串传递给语法分析器让它去处理。但是，更好的做法是让词法分析器匹配IP地址的词法结构，然后把匹配出的构件作为记号传递给语法分析器。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file  : row+ ;                           // 匹配日志文件中行的语法规则
</span><span class='line'>row   : ip STRING INT NL ;               // 匹配日志文件记录
</span><span class='line'>ip    : INT '.' INT '.' INT '.' INT ;    // 在语法分析器中匹配IP地址
</span><span class='line'>INT   : [0-9]+ ;                         // 匹配IP八位组或者HTTP结果代码
</span><span class='line'>STRING: '"' .*? '"' ;                    // 匹配HTTP协议命令
</span><span class='line'>NL    : '\n' ;                           // 匹配日志文件记录终结符
</span><span class='line'>WS    : ' ' -&gt; skip ;                    // 忽略空格</span></code></pre></td></tr></table></div></figure>

<p>把词法规则IP切换成语法规则ip显示了我们可以多么轻易地移动这条分界线。</p>

<p>如果要求处理HTTP协议命令字符串的内容，我们可以遵循相同的思考过程。如果不需要检查字符串的部分，那么词法分析器可以把整个字符串作为一个单独的记号传递给语法分析器。如果我们需要抽出各种不同的部分，最好就是让词法分析器去识别那些部分后再把这些匹配出的构件传递给语法分析器。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reading-notes-the-definitive-antlr4-reference-part18/">ANTLR 4权威参考读书笔记（18）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-14T11:56:18+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:56 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>编程语言在词法上看起来惊人地相似，无论是函数式、过程式、声明式还是面向对象语言，看起来几乎都是一样的。这很棒，因为我们只需要学习一次如何描述标志符和整数，没有太大的变化，就可以把它们应用到大多数编程语言上。正如语法分析器以及词法分析器使用规则去描述各种语言构造体一样，我们要使用基本相同的表示法。唯一的区别是语法分析器识别在记号流中的语法结构，而词法分析器识别在字符流中的语法结构。</p>

<p>因为词法分析和语法分析有相似的结构，ANTLR允许我们把两者合并在单个语法文件中。但是因为词法分析和语法分析是语言识别的两个不同阶段，我们必须告诉ANTLR每个规则是和哪个阶段相关联的。我们能够通过以大写字母开始的词法规则名字和以小写字母开始的语法规则名字做到这点。例如，ID是一个词法规则名字，expr则是一个语法规则名字。</p>

<p>当开始构建一个新的语法时，对于那些常用的词法构造体：标志符、数字、字符串、注释以及空格等，我们可以从已经存在的语法中拷贝粘贴规则。然后，通过一些细微的调整，就可以让它运行起来。几乎所有的语言，甚至像JSON和XML这样的非编程语言，都有这些记号的变体。例如，C语言的词法分析器完全可以标记化以下的JSON代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  "title":"Cat wrestling",
</span><span class='line'>  "chapters":[ {"Intro":"..."}, ... ]
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>另一个例子就是块注释。在C语言中，它们是被/* ... */括起来的。而在XML里，注释是被&lt;!-- ... --&gt;括起来。但它们除了开始和结束符号之外，或多或少都有相同的词法构造。</p>

<p>对于关键词、运算符和标点符号，我们不需要词法规则，因为我们可以在语法分析器规则中直接引用它们，用单引号括起来，就像<code>&#39;while&#39;</code>、<code>&#39;*&#39;</code>、<code>&#39;++&#39;</code>这样。有些开发者更喜欢使用像MUL而不是字面量<code>&#39;*&#39;</code>这样的词法规则引用，这些都没问题，因为它们都有相同的记号类型。</p>

<p>为了阐明词法规则看起来像什么，让我们从标志符开始构建一个常用记号的简单版本。</p>

<h4 id="匹配标志符">匹配标志符</h4>

<p>在语法伪代码中，一个基本的标志符是一个大写和小写字母的非空序列。根据已经学习到的知识，我们知道需要用(...)+表示法来表示这样的序列模式。因为序列元素可以是大写或小写字母，所以在子规则中我们需要使用选择运算符：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ID : ('a'..'z'|'A'..'Z')+ ;    // 匹配一个或多个大小写字母</span></code></pre></td></tr></table></div></figure>

<p>唯一的新ANTLR表示法是范围运算符：&#39;a&#39;..&#39;z&#39;代表从a到z的任意字符。或者你也可以使用Unicode代码点字面量&#39;\uXXXX&#39;，这里的XXXX是Unicode字符代码点值的十六进制值。</p>

<p>作为字符集的一个简写，ANTLR支持我们使用更熟悉的正则表达式集合表示法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ID : [a-zA-Z]+ ;    // 匹配一个或多个大小写字母</span></code></pre></td></tr></table></div></figure>

<p>有时候我们会发现像下面的语法貌似存在冲突的现象：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>enumDef : 'enum' '{' ... '}' ;
</span><span class='line'>FOR : 'for' ;
</span><span class='line'>ID : [a-zA-Z]+ ;    // 不匹配'enum'或者'for'</span></code></pre></td></tr></table></div></figure>

<p>规则ID也可以同时匹配enum和for这样的关键词，这意味着同样的字符串能被多个规则匹配。但事实上，ANTLR处理这种混合语法时会把字符串字面量以及词法规则与语法规则分隔开，像enum这样的字面量就变成了词法规则并紧随在语法规则之后和在显式的词法规则之前。</p>

<p>ANTLR词法分析器通过偏爱首先指定的规则来解决词法规则间的二义性，这意味着ID规则应该定义在所有的关键词规则之后。ANTLR把隐式的为字面量生成的词法规则放在显式的词法规则之前，因此它们总是有更高的优先级。在这里，&#39;enum&#39;被自动赋予比ID高的优先级。</p>

<p>因为ANTLR会重新排序词法规则并让它在语法规则之后发生。所以上面的语法与下面的变体是相同的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FOR : 'for' ;
</span><span class='line'>ID : [a-zA-Z]+ ;    // 不匹配'enum'或者'for'
</span><span class='line'>enumDef : 'enum' '{' ... '}' ;</span></code></pre></td></tr></table></div></figure>

<h4 id="匹配数字">匹配数字</h4>

<p>描述像10这样的整型数字非常容易，因为它只是一个数字序列。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>INT : '0'..'9'+ ;    // 匹配一个或多个数字</span></code></pre></td></tr></table></div></figure>

<p>或者</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>INT : [0..9]+ ;    // 匹配一个或多个数字</span></code></pre></td></tr></table></div></figure>

<p>浮点数要复杂的多，但如果我们忽略指数的话，可以很容易地制作一个简化版本。浮点数是数字序列后面跟着一个句点和一个可选的小数部分；或者以一个句点开始，然后是数字序列。单独一个句点是不合法的。因此我们的浮点规则使用一个选择和一些序列模式：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FLOAT: DIGIT+ '.' DIGIT*    // 匹配1. 39. 3.14159等等
</span><span class='line'>     | '.' DIGIT+           // 匹配.1 .14159
</span><span class='line'>     ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>DIGIT: [0-9] ;              // 匹配单个数字</span></code></pre></td></tr></table></div></figure>

<p>这里我们使用了一个帮助规则DIGIT，因此我们不必到处去写[0-9]。通过在规则前面加上fragment前缀，我们让ANTLR知道该规则仅被其它词法规则使用。它本身不是一个记号，这意味着我们不能在语法规则中引用它。</p>

<h4 id="匹配字符串字面量">匹配字符串字面量</h4>

<p>计算机语言中共同具有的下一个常用记号是字符串字面量，例如&quot;hello&quot;。大部分使用双引号作分隔符，有些使用单引号或两者都使用。以双引号为分隔符而言，在语法伪代码中，一个字符串就是在双引号中的任意字符序列：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STRING : '"' .*? '"' ;    // 匹配在双引号中的任意字符</span></code></pre></td></tr></table></div></figure>

<p>语法中的点是通配符运算符，它可以匹配任意单个字符。因此，“<code>.*</code>”是一个能够匹配任意零个或多个字符的序列的循环。当然，它也将消费字符直到文件结尾，所以不是很有用。幸运的是，ANTLR通过正则表达式表示法（?后缀）提供对非贪婪模式规则的支持。非贪婪模式意味着“直到看见在词法规则中跟在子规则后的字符时才停止吃掉字符”。更确切地说，非贪婪模式规则匹配最小数量的字符，同时仍然允许整个周围的规则被匹配。相反，“<code>.*</code>”被认为是贪婪模式，因为它贪婪地消费能够匹配循环内部的所有字符。</p>

<p>以上的STRING规则还做得不够好，因为它不允许字符串中有双引号。为了做到这点，大部分语言定义了以反斜杠开始的转义字符。在字符串中的双引号我们可以使用“\&quot;”。为支持常用的转义字符，我们需要使用以下规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STRING: '"' (ESC|.)*? '"' ;
</span><span class='line'>
</span><span class='line'>fragment
</span><span class='line'>ESC : '\\"' | '\\\\' ;    // 匹配字符\"和\\</span></code></pre></td></tr></table></div></figure>

<p>ANTLR自身也需要避开转义字符，所以这里我们需要用“\”去指定反斜杠字符。</p>

<p>现在，在STRING规则中的循环既可以通过调用fragment规则RULE去匹配转义字符序列，也可以通过点通配符去匹配任意字符。当看到一个非转义双引号字符时“<code>*?</code>”子规则运算符终止“<code>(ESC|.)*?</code>”循环。</p>

<h4 id="匹配注释和空格">匹配注释和空格</h4>

<p>词法分析器会把匹配到的记号通过记号流传递给语法分析器，然后语法分析器检查流的语法结构。但我们希望当词法分析器匹配到注释和空格时能把它们扔掉。那样，语法分析器就不必为匹配无处不在的可选的注释和空格担心。例如，当WS是一个空格的词法规则时以下的语法规则就非常尴尬和容易出错：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>assign : ID (WS|COMMENT)? '=' (WS|COMMENT)? expr (WS|COMMENT)? ;</span></code></pre></td></tr></table></div></figure>

<p>定义这些被丢弃的记号和定义非丢弃的记号一样，我们只需要使用skip指令去表明词法分析器应该扔掉它们。以下是匹配那些衍生自C的语言的单行和多行注释的语法规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>LINE_COMMENT : '//' .*? '\r'? '\n' -&gt; skip ;    // 匹配"//" stuff '\n'
</span><span class='line'>COMMENT      : '/*' .*? '*/'       -&gt; skip ;    // 匹配"/*" stuff "*/"</span></code></pre></td></tr></table></div></figure>

<p>在COMMENT中，“<code>.*?</code>”消费在“<code>/*</code>”和“<code>*/</code>”之间的任意字符。在LINE_COMMENT中，“<code>.*?</code>”消费“//”之后的任意字符，直到它看到一个换行符。</p>

<p>词法分析器接受若干跟随在-&gt;运算符后的指令，skip只是它们中的一个。例如，我们可以通过使用channel指令把传递给语法分析器的记号放进隐藏通道。</p>

<p>最后，让我们处理空格这个常用记号。大部分编程语言都把空格当作记号分隔符，但某些像Python这样的语言则把空格用作特殊语法目的。以下是告诉ANTLR如何扔掉空格的语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>WS : (' '|'\t'|'\r'|'\n')+ -&gt; skip ;    // 匹配一个或多个空格但丢弃</span></code></pre></td></tr></table></div></figure>

<p>或者</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>WS : [ \t\r\n]+ -&gt; skip ;    // 匹配一个或多个空格但丢弃</span></code></pre></td></tr></table></div></figure>

<p>当换行既是要被忽略的空格又是命令终结符时，就会有个问题。换行是上下文有关的，在语法上下文中，我们需要扔掉换行，但在其它地方，我们需要把它传递给语法分析器以便让它知道某个命令已经结束。该问题以及它的具体解决方案我们将在以后讨论。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/how-to-build-a-news-website-layout-with-flexbox/">如何使用Flexbox构建新闻站点布局</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-11T23:31:14+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:31 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>英文原文：<a href="http://webdesign.tutsplus.com/tutorials/how-to-build-a-news-website-layout-with-flexbox--cms-26611">http://webdesign.tutsplus.com/tutorials/how-to-build-a-news-website-layout-with-flexbox--cms-26611</a></p>

<p><img src="/uploads/flexbox-preview.png" title="flexbox-preview" ></p>

<p>在投入并开始之前你没有必要理解Flexbox的<em>每个</em>方面。在这篇教程中，我们将介绍一些Flexbox的特性，同时设计一个类似<a href="http://www.theguardian.com/">The Guardian</a>的“新闻布局”。</p>

<p>我们正在使用Flexbox的原因是它提供了非常强大的特性：</p>

<ul>
<li>我们可以很容易制作响应式列</li>
<li>我们可以使列等高</li>
<li>我们可以把内容推到容器的<em>底部</em></li>
</ul>

<p>那么让我们开始吧！</p>

<h3 id="1-从两个列开始">1. 从两个列开始</h3>

<p>在CSS中创建列一直是个挑战。长期以来，唯一的选项是使用float或者table，但它们都有它们自己的问题。</p>

<p>Flexbox使这个过程更简单，给予我们：</p>

<ul>
<li><strong>更简洁的代码</strong>：我们只需要一个带有display: flex的容器</li>
<li>不需要<strong>清除</strong>float，以防止意外的布局行为</li>
<li><strong>语义化的标记</strong></li>
<li><strong>灵活性</strong>：我们可以用几行CSS代码来调整列的大小、拉伸或者对齐列</li>
</ul>

<p>让我们从创建两个列开始：一个是容器宽度的2/3，一个是1/3。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="columns"&gt;
</span><span class='line'>  &lt;div class="column main-column"&gt;
</span><span class='line'>    2/3 column
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;div class="column"&gt;
</span><span class='line'>    1/3 column
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>

<p>这里有两个元素：</p>

<ul>
<li>columns容器</li>
<li>两个column子容器，其中一个带有附加的名为main-column的class，我们将用它来让该子容器更宽</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  flex: 1;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>作为有一个flex值为2的主列，它将占用其它列的两倍空间。</p>

<p>通过添加一些附加的视觉样式，这里是我们得到的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  background: #eee;
</span><span class='line'>  border: 5px solid #ccc;
</span><span class='line'>  flex: 1;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="2-让每一列都成为flexbox容器">2. 让每一列都成为Flexbox容器</h3>

<p>这两列中的每一个都将包含若干垂直堆叠的文章，因此我们打算把column元素也转变成Flexbox容器。我们想要：</p>

<ul>
<li>文章被垂直堆叠</li>
<li>文章<em>拉伸</em>并填充可用空间</li>
</ul>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.column {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex-direction: column;  /* 使文章垂直堆叠 */
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  flex: 1;  /* 拉伸文章以填补剩余的空间 */
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>在<em>容器</em>上的flex-direction: column规则结合在<em>子容器</em>上的flex: 1规则确保文章将填补整个垂直空间，保持最初两列具有相同的高度。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="columns"&gt;
</span><span class='line'>  &lt;div class="column main-column"&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;div class="column"&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World&lt;br&gt;
</span><span class='line'>      Foo Bar
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>    &lt;article class="article"&gt;
</span><span class='line'>      Hello World
</span><span class='line'>    &lt;/article&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  background: #eee;
</span><span class='line'>  border: 5px solid #ccc;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  border: 5px solid seagreen;
</span><span class='line'>  color: white;
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin: 10px;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="3-让每篇文章都成为flexbox容器">3. 让每篇文章都成为Flexbox容器</h3>

<p>现在，为了给我们额外的控制，让我们把每篇文章也转变成一个Flexbox容器。每篇文章将包含：</p>

<ul>
<li>一个标题</li>
<li>一个段落</li>
<li>一个带有作者和评论数量的信息栏</li>
<li>一张可选的响应式图片</li>
</ul>

<p>我们在这里使用Flexbox是为了把信息栏推到底部。我们的目标文章布局如下图所示：</p>

<p><img src="/uploads/flexbox-card.png" title="flexbox-card" ></p>

<p>这里是代码：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a class="article first-article"&gt;
</span><span class='line'>  &lt;figure class="article-image"&gt;
</span><span class='line'>    &lt;img src=""&gt;
</span><span class='line'>  &lt;/figure&gt;
</span><span class='line'>  &lt;div class="article-body"&gt;
</span><span class='line'>    &lt;h2 class="article-title"&gt;
</span><span class='line'>      &lt;!-- 标题 --&gt;
</span><span class='line'>    &lt;/h2&gt;
</span><span class='line'>    &lt;p class="article-content"&gt;
</span><span class='line'>      &lt;!-- 内容 --&gt;
</span><span class='line'>    &lt;/p&gt;
</span><span class='line'>    &lt;footer class="article-info"&gt;
</span><span class='line'>      &lt;!-- 信息 --&gt;
</span><span class='line'>    &lt;/footer&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/a&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.article {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;  /* 基于其内容设置初始元素大小 */
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;  /* 这将使内容填补剩余的空间，并因此在底部压入信息栏 */
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>文章元素被垂直放置归功于flex-direction: column规则。</p>

<p>我们把flex: 1应用到article-content元素以便它填补空白空间，并且把article-info推到底部，无论列的高度如何。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;main class="main columns"&gt;
</span><span class='line'>  &lt;section class="column main-column"&gt;
</span><span class='line'>    &lt;a class="article first-article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-4by3"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-01.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-02.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>
</span><span class='line'>  &lt;section class="column"&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-3by2"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-03.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>&lt;/main&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>  font-size: 14px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>a {
</span><span class='line'>  text-decoration: none;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>div, h2, p, figure {
</span><span class='line'>  margin: 0;
</span><span class='line'>  padding: 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main {
</span><span class='line'>  margin: 0 auto;
</span><span class='line'>  max-width: 1040px;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: white;
</span><span class='line'>  color: #666;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;
</span><span class='line'>  margin: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image {
</span><span class='line'>  background: #eee;
</span><span class='line'>  display: block;
</span><span class='line'>  padding-top: 75%;
</span><span class='line'>  position: relative;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image img {
</span><span class='line'>  display: block;
</span><span class='line'>  height: 100%;
</span><span class='line'>  left: 0;
</span><span class='line'>  position: absolute;
</span><span class='line'>  top: 0;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-3by2 {
</span><span class='line'>  padding-top: 66.6666%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-16by9 {
</span><span class='line'>  padding-top: 56.25%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-title {
</span><span class='line'>  color: #333;
</span><span class='line'>  flex-shrink: 0;
</span><span class='line'>  font-size: 1.4em;
</span><span class='line'>  font-weight: bold;
</span><span class='line'>  font-weight: 700;
</span><span class='line'>  line-height: 1.2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin-top: 5px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-info {
</span><span class='line'>  display: flex;
</span><span class='line'>  font-size: 0.85em;
</span><span class='line'>  justify-content: space-between;
</span><span class='line'>  margin-top: 10px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="4-添加一些嵌套列">4. 添加一些嵌套列</h3>

<p>在左边的列中，我们真正想要的是<em>另一组</em>列。因此我们将以我们已经用过的同样的columns容器代替第二篇文章。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="columns"&gt;
</span><span class='line'>  &lt;div class="column nested-column"&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>  &lt;div class="column"&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article"&gt;
</span><span class='line'>      &lt;!-- 文章内容 --&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>

<p>因为我们想要第一个嵌套列更宽，我们添加一个带有附加样式的名为nested-column的class：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.nested-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>这将使新列的宽度是其它列的两倍。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;main class="main columns"&gt;
</span><span class='line'>  &lt;section class="column main-column"&gt;
</span><span class='line'>    &lt;a class="article first-article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-4by3"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-01.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>
</span><span class='line'>    &lt;div class="columns"&gt;
</span><span class='line'>      &lt;div class="column nested-column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-02.png" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>      &lt;div class="column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-03.png" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>
</span><span class='line'>  &lt;section class="column"&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-3by2"&gt;
</span><span class='line'>        &lt;img src="https://s3.amazonaws.com/cms-assets.tutsplus.com/uploads/users/1366/posts/26611/attachment/image-04.png" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>&lt;/main&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  font-family: sans-serif;
</span><span class='line'>  font-size: 14px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>a {
</span><span class='line'>  text-decoration: none;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>div, h2, p, figure {
</span><span class='line'>  margin: 0;
</span><span class='line'>  padding: 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main {
</span><span class='line'>  margin: 0 auto;
</span><span class='line'>  max-width: 1040px;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.columns {
</span><span class='line'>  display: flex;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main-column {
</span><span class='line'>  flex: 3;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.nested-column {
</span><span class='line'>  flex: 2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: white;
</span><span class='line'>  color: #666;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;
</span><span class='line'>  margin: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image {
</span><span class='line'>  background: #eee;
</span><span class='line'>  display: block;
</span><span class='line'>  padding-top: 75%;
</span><span class='line'>  position: relative;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image img {
</span><span class='line'>  display: block;
</span><span class='line'>  height: 100%;
</span><span class='line'>  left: 0;
</span><span class='line'>  position: absolute;
</span><span class='line'>  top: 0;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-3by2 {
</span><span class='line'>  padding-top: 66.6666%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-16by9 {
</span><span class='line'>  padding-top: 56.25%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-title {
</span><span class='line'>  color: #333;
</span><span class='line'>  flex-shrink: 0;
</span><span class='line'>  font-size: 1.4em;
</span><span class='line'>  font-weight: bold;
</span><span class='line'>  font-weight: 700;
</span><span class='line'>  line-height: 1.2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin-top: 5px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-info {
</span><span class='line'>  display: flex;
</span><span class='line'>  font-size: 0.85em;
</span><span class='line'>  justify-content: space-between;
</span><span class='line'>  margin-top: 10px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="5-给第一篇文章一个水平布局">5. 给第一篇文章一个水平布局</h3>

<p>第一篇文章真的很大。为了优化空间的使用，让我们把它的布局切换成水平的。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.first-article {
</span><span class='line'>  flex-direction: row;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.first-article .article-body {
</span><span class='line'>  flex: 1;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.first-article .article-image {
</span><span class='line'>  height: 300px;
</span><span class='line'>  order: 2;
</span><span class='line'>  padding-top: 0;
</span><span class='line'>  width: 400px;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>这里的order属性是非常有用的，因为它允许我们改变HTML元素的顺序而不影响HTML标记。在标记中article-image实际上出现在article-body的<em>前面</em>，但它表现的好像出现在<em>后面</em>。</p>

<h3 id="6-使布局可响应">6. 使布局可响应</h3>

<p>这些就是我们想看到的，虽然它有点儿扁平。让我们通过响应式来修复它。</p>

<p>Flexbox一个极好的特性是你只需要移除容器上的display: flex规则就可以完全禁用Flexbox，同时保持所有其它的Flexbox属性（例如align-items或者flex）有效。</p>

<p>结果是，你可以通过仅在某个断点上启用Flexbox来触发一个响应式布局。</p>

<p>我们将从.columns和.column选择器中移除display: flex，而不是用一个Media Query包装它们：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@media screen and (min-width: 800px) {
</span><span class='line'>  .columns,
</span><span class='line'>  .column {
</span><span class='line'>    display: flex;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>就是这样！在更小的屏幕上，所有的文章都在彼此的上面。超过800px时，它们将会被放置在两列中。</p>

<h3 id="7-添加最后的润色">7. 添加最后的润色</h3>

<p>为使布局在大屏幕上更具吸引力，让我们添加一些CSS微调：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@media screen and (min-width: 1000px) {
</span><span class='line'>  .first-article {
</span><span class='line'>    flex-direction: row;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-body {
</span><span class='line'>    flex: 1;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-image {
</span><span class='line'>    height: 300px;
</span><span class='line'>    order: 2;
</span><span class='line'>    padding-top: 0;
</span><span class='line'>    width: 400px;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .main-column {
</span><span class='line'>    flex: 3;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .nested-column {
</span><span class='line'>    flex: 2;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>第一篇文章的内容是水平放置的，文本在左边，图片在右边。而且，主列现在更宽（75%），嵌套列也是（66%）。这里是最终结果！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;header class="header"&gt;
</span><span class='line'>  &lt;h1&gt;The Envato Tuts+ Report&lt;/h1&gt;
</span><span class='line'>  &lt;h2&gt;&lt;a href="http://webdesign.tutsplus.com/tutorials/how-to-build-a-news-website-layout-with-flexbox--cms-26611"&gt;Read tutorial&lt;/a&gt;&lt;/h2&gt;
</span><span class='line'>&lt;/header&gt;
</span><span class='line'>
</span><span class='line'>&lt;main class="main columns"&gt;
</span><span class='line'>  &lt;section class="column main-column"&gt;
</span><span class='line'>    &lt;a class="article first-article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-4by3"&gt;
</span><span class='line'>        &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-01-lo.jpg" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>          Maecenas non massa sem.
</span><span class='line'>          Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Proin ornare magna eros.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>
</span><span class='line'>    &lt;div class="columns"&gt;
</span><span class='line'>      &lt;div class="column nested-column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-02-lo.jpg" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>              Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
</span><span class='line'>              Maecenas non massa sem.
</span><span class='line'>              Etiam finibus odio quis feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>      &lt;div class="column"&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;figure class="article-image is-16by9"&gt;
</span><span class='line'>            &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-03-lo.jpg" alt=""&gt;
</span><span class='line'>          &lt;/figure&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>        &lt;a class="article" href="#"&gt;
</span><span class='line'>          &lt;div class="article-body"&gt;
</span><span class='line'>            &lt;h2 class="article-title"&gt;
</span><span class='line'>              Hello World
</span><span class='line'>            &lt;/h2&gt;
</span><span class='line'>            &lt;p class="article-content"&gt;
</span><span class='line'>              Lorem ipsum dolor sit amet feugiat facilisis.
</span><span class='line'>            &lt;/p&gt;
</span><span class='line'>            &lt;footer class="article-info"&gt;
</span><span class='line'>              &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>              &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>            &lt;/footer&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/a&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>
</span><span class='line'>  &lt;section class="column"&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;figure class="article-image is-3by2"&gt;
</span><span class='line'>        &lt;img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/210284/image-04-lo.jpg" alt=""&gt;
</span><span class='line'>      &lt;/figure&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>    &lt;a class="article" href="#"&gt;
</span><span class='line'>      &lt;div class="article-body"&gt;
</span><span class='line'>        &lt;h2 class="article-title"&gt;
</span><span class='line'>          Hello World
</span><span class='line'>        &lt;/h2&gt;
</span><span class='line'>        &lt;p class="article-content"&gt;
</span><span class='line'>          Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span><span class='line'>        &lt;/p&gt;
</span><span class='line'>        &lt;footer class="article-info"&gt;
</span><span class='line'>          &lt;span&gt;By Joe Smith&lt;/span&gt;
</span><span class='line'>          &lt;span&gt;42 comments&lt;/span&gt;
</span><span class='line'>        &lt;/footer&gt;
</span><span class='line'>      &lt;/div&gt;
</span><span class='line'>    &lt;/a&gt;
</span><span class='line'>  &lt;/section&gt;
</span><span class='line'>&lt;/main&gt;</span></code></pre></td></tr></table></div></figure>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700);
</span><span class='line'>@import url(https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css);
</span><span class='line'>
</span><span class='line'>html {
</span><span class='line'>  background: mediumseagreen;
</span><span class='line'>  font-size: 14px;
</span><span class='line'>  -moz-osx-font-smoothing: grayscale;
</span><span class='line'>  -webkit-font-smoothing: antialiased;
</span><span class='line'>  min-width: 300px;
</span><span class='line'>  overflow-x: hidden;
</span><span class='line'>  overflow-y: scroll;
</span><span class='line'>  text-rendering: optimizeLegibility;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>body {
</span><span class='line'>  color: #666;
</span><span class='line'>  font-family: "Source Sans Pro", "Helvetica", "Arial", sans-serif;
</span><span class='line'>  font-size: 1rem;
</span><span class='line'>  font-weight: 400;
</span><span class='line'>  line-height: 1.4;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>a {
</span><span class='line'>  text-decoration: none;
</span><span class='line'>  transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>div, h2, p, figure {
</span><span class='line'>  margin: 0;
</span><span class='line'>  padding: 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header {
</span><span class='line'>  color: white;
</span><span class='line'>  padding: 40px 0 20px;
</span><span class='line'>  text-align: center;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header h1 {
</span><span class='line'>  font-size: 40px;
</span><span class='line'>  font-weight: bold;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header h2 a {
</span><span class='line'>  border-bottom: 1px solid rgba(255, 255, 255, 0.5);
</span><span class='line'>  color: white;
</span><span class='line'>  font-size: 20px;
</span><span class='line'>  opacity: 0.5;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.header h2 a:hover {
</span><span class='line'>  border-bottom-color: white;
</span><span class='line'>  opacity: 1;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.main {
</span><span class='line'>  margin: 0 auto;
</span><span class='line'>  max-width: 1040px;
</span><span class='line'>  padding: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.column {
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article {
</span><span class='line'>  background: white;
</span><span class='line'>  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
</span><span class='line'>  color: #666;
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  flex-basis: auto;
</span><span class='line'>  margin: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article:hover,
</span><span class='line'>.article:focus {
</span><span class='line'>  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
</span><span class='line'>  color: #444;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image {
</span><span class='line'>  background: #eee;
</span><span class='line'>  display: block;
</span><span class='line'>  padding-top: 75%;
</span><span class='line'>  position: relative;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image img {
</span><span class='line'>  display: block;
</span><span class='line'>  height: 100%;
</span><span class='line'>  left: 0;
</span><span class='line'>  position: absolute;
</span><span class='line'>  top: 0;
</span><span class='line'>  width: 100%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-3by2 {
</span><span class='line'>  padding-top: 66.6666%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-image.is-16by9 {
</span><span class='line'>  padding-top: 56.25%;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-body {
</span><span class='line'>  display: flex;
</span><span class='line'>  flex: 1;
</span><span class='line'>  flex-direction: column;
</span><span class='line'>  padding: 20px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-title {
</span><span class='line'>  color: #333;
</span><span class='line'>  flex-shrink: 0;
</span><span class='line'>  font-size: 1.4em;
</span><span class='line'>  font-weight: 700;
</span><span class='line'>  line-height: 1.2;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-content {
</span><span class='line'>  flex: 1;
</span><span class='line'>  margin-top: 5px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>.article-info {
</span><span class='line'>  display: flex;
</span><span class='line'>  font-size: 0.85em;
</span><span class='line'>  justify-content: space-between;
</span><span class='line'>  margin-top: 10px;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@media screen and (min-width: 800px) {
</span><span class='line'>  .columns,
</span><span class='line'>  .column {
</span><span class='line'>    display: flex;
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>@media screen and (min-width: 1000px) {
</span><span class='line'>  .first-article {
</span><span class='line'>    flex-direction: row;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-body {
</span><span class='line'>    flex: 1;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .first-article .article-image {
</span><span class='line'>    height: 300px;
</span><span class='line'>    order: 2;
</span><span class='line'>    padding-top: 0;
</span><span class='line'>    width: 400px;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .main-column {
</span><span class='line'>    flex: 3;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  .nested-column {
</span><span class='line'>    flex: 2;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<h3 id="总结">总结</h3>

<p>我希望我已经向你展示在投入和开始使用Flexbox前你不需要理解它的每个方面！响应式新闻布局是一个真正有用的模式。拆解它，把玩它，让我们知道你是如何进展的！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reading-notes-the-definitive-antlr4-reference-part17/">ANTLR 4权威参考读书笔记（17）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-07T13:09:54+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:09 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>用自顶向下的语法指定和通过手工的递归下降语法分析器识别表达式一直是个麻烦。首先是因为大部分自然语法是模糊的，其次是因为大部分自然语法规格使用一种被称为左递归的特殊类型递归。所以自顶向下的语法和语法分析器不能处理传统形式上的左递归。</p>

<p>为了阐明这个问题，设想一个算术表达式语言，它只有乘法和加法运算符以及整数。表达式是自相似的。也就是说，一个乘法表达式是由“*”运算符连接的两个子表达式。同样的，一个加法表达式是由“+”运算符连接的两个子表达式。我们也可以把整数看作表达式。整个语法规则看起来就像以下显示的那样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expr '*' expr    // 匹配由“*”运算符连接的子表达式
</span><span class='line'>     | expr '+' expr    // 匹配由“+”运算符连接的子表达式
</span><span class='line'>     | INT              // 匹配简单整数
</span><span class='line'>     ;</span></code></pre></td></tr></table></div></figure>

<p>问题是上述规则对于某些输入短语来说是模棱两可的。换句话说，这个规则能用多种方法匹配单个输入流。对于简单的整数和像1+2和1*2这样的单运算符表达式是没问题的，因为只有一种方法能去匹配它们。例如，规则可以仅用第二个选项匹配1+2。就像下图左边所示的那样：</p>

<p><img src="/uploads/ambiguity-parse-tree.png" title="ambiguity-parse-tree" ></p>

<p>问题是指定的规则可以像中间和右边语法分析树描绘的那样用两种方法解释1+2*3这样的输入。两者的解释是不同的，因为中间的树说加1到2乘3的结果上，而右边的树说3乘以1加2的结果。这是一个运算符优先级的问题，但常规语法根本没有指定优先级的方法。大部分语法工具使用额外的符号来指定运算符优先级。</p>

<p>与之相反的是，ANTLR解决二义性有利于首先给出的选项，隐式地允许我们指定运算符优先级。规则expr有一个乘法选项在加法选项之前，因此，ANTLR解决1+2*3的运算符二义性有利于乘法。</p>

<p>默认情况下，ANTLR从左到右结合运算符，然而某些像指数群这样的运算符则是从右到左。因此，我们必须使用选项assoc手动指定运算符记号上的相关性。这里是一个能正确地把输入<code>2^3^4</code>解释成<code>2^(3^4)</code>的表达式规则：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expr '^'&lt;assoc=right&gt; expr    // 运算符是右结合的
</span><span class='line'>     | INT
</span><span class='line'>     ;</span></code></pre></td></tr></table></div></figure>

<p>下图中的语法分析树阐明了运算符左右结合版本的不同。右边的语法分析树是惯常的解释：</p>

<p><img src="/uploads/power-parse-tree.png" title="power-parse-tree" ></p>

<p>为了把所有这三个运算符合并成一条规则，我们把指数表达式选项放在其它表达式选项之前，因为它的运算符比乘法和加法都有更高的优先级。合并后的语法如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expr '^'&lt;assoc=right&gt; expr    // 运算符是右结合的
</span><span class='line'>     | expr '*' expr                 // 匹配由“*”运算符连接的子表达式
</span><span class='line'>     | expr '+' expr                 // 匹配由“+”运算符连接的子表达式
</span><span class='line'>     | INT                           // 匹配简单整数
</span><span class='line'>     ;</span></code></pre></td></tr></table></div></figure>

<p>不像其它常规的语法分析器生成器那样，ANTLR v4是可以处理直接左递归的。左递归规则是指直接或者间接调用在选项左边缘的自身的规则。规则expr是直接左递归的，因为除INT选项外的其它所有选项都开始于规则expr自身的引用。如果规则expr的引用处在某些选项的右边缘，那么它就是右递归的。虽然ANTLR v4可以处理直接左递归，但它不能处理间接左递归。这意味着我们不能把expr因子化为语法等效规则。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr : expo ;    // 通过expo左递归地间接调用expr
</span><span class='line'>expo : expr '^'&lt;assoc=right&gt; expr ;</span></code></pre></td></tr></table></div></figure>

<p>ANTLR v4可以简化直接左递归的表达式规则的工作。这种新的机制不仅更有效率，而且表达式规则也更小和更容易理解。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reading-notes-the-definitive-antlr4-reference-part16/">ANTLR 4权威参考读书笔记（16）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-02T10:16:21+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>10:16 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>initializer 初始值设定项</li>
<li>construct 构造体</li>
</ul>

<p>现在，我们已经有了一个自顶向下的草拟出语法的通用策略，下面我们要专注于一些常用的语言模式。尽管在过去几十年里有大量的语言被发明，但仍然只有较少的基本语言模式需要被处理。这是因为人们趋向于设计遵循自然语言约束的语言，语言也会因为设计者遵循数学上的常用表示法而趋向于相似。甚至在词法级别，语言趋向于重用一些相同的结构，例如标志符、整数、字符串等。这些单词顺序和依赖的约束来源于自然语言，并逐渐演化成为四种抽象的语言模式：</p>

<h4 id="模式：序列">模式：序列</h4>

<p>这是像数组初始值设定项中的值那样的元素序列，也是在计算机语言中最常见的结构。例如，下面是登录到POP服务器时的序列：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>USER parrt
</span><span class='line'>PASS secret
</span><span class='line'>RETR 1</span></code></pre></td></tr></table></div></figure>

<p>这些命令本身也是序列。大部分命令是一个关键词（保留标志符，例如USER和RETR）跟随一个运算元再跟随一个换行符。为了在语法中指定此类序列，我们可以按照顺序简单地列出各个元素。以下是检索命令的序列（其中INT表示整数记号类型）：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>retr : 'RETR' INT '\n' ;</span></code></pre></td></tr></table></div></figure>

<p>我们可以给RETR序列打上retr规则的标签，这样在语法的其它地方，我们就能使用规则名字作为简写来引用RETR序列。</p>

<p>对于任意长度的序列像矢量[1 2 3]这样的简单整数列表，虽然它是一个有限序列，但我们不可能通过像INT INT INT ...这样的规则片段来列出所有可能的整数列表。为了编码这样的一个或者多个元素，我们使用“+”子规则运算符。例如，{INT}+表示任意长度的整数序列，或者使用简写INT+也可以。至于可以为空的列表，我们则使用零个或者多个运算符“*”。</p>

<p>这种模式的变体有带终结符的序列和带分隔符的序列，CSV文件就很好地示范了这两者。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file : (row '\n')* ;           // 带一个“\n”终结符的序列
</span><span class='line'>row  : field (',' field)* ;    // 带一个“,”分隔符的序列
</span><span class='line'>field: INT ;                   // 假设字段只是整数</span></code></pre></td></tr></table></div></figure>

<p>规则file使用带终结符模式的列表去匹配零个或者多个row &#39;\n&#39;序列，记号“\n”终结序列的每个元素。规则row使用带分隔符模式的列表去匹配一个field后面有零个或者多个&#39;,&#39; field序列，记号“,”分隔各个字段。</p>

<p>最后，还有个特殊类型的零个或者一个序列，用“?”指定。可以使用它去表达可选的构造体。</p>

<h4 id="模式：选择">模式：选择</h4>

<p>这是一个在多个可供替代的短语之间的选择，比如在编程语言中不同种类的语句。为了在语言中表示选择的这个概念，我们使用“|”作为ANTLR中的“or”运算符去分隔被称为“选项”的语法选择。</p>

<p>回到CVS语法，我们可以通过整数或者字符串的选择让规则field变得更灵活。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>field: INT | STRING ;</span></code></pre></td></tr></table></div></figure>

<p>任何时候，如果你发现正在说“语言结构x可以是这个或者那个”，那么你就可以确定应该使用选择模式，在规则x中使用“|”。</p>

<h4 id="模式：记号依赖">模式：记号依赖</h4>

<p>记号依赖表示一个记号的存在需要在短语的其它地方有它的对等物的存在，比如匹配的左右括号。前面我们曾经使用INT+去表达在矢量[1 2 3]中的整数非空序列。为指定周围有方括号的矢量，我们需要一种方法去表达记号中的依赖。如果我们在句子中看到一个符号，那么我们必须在句子的其它地方找到它的对等物。为表达这种语法，我们必须使用同时指定对等符号的序列，它们通常包围或分组着其它元素。在这个案例中，我们这样指定矢量：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vector : '[' INT+ ']' ;    // [1], [1 2], [1 2 3], ...</span></code></pre></td></tr></table></div></figure>

<p>扫视任何有效的代码，你会看到必须成对出现的各种分组符号：(...)，[...]，{...}。但是要牢记，依赖符号并不是必须配对的，类C语言都有的a ? b : c三元运算符就指定了当看到“?”符号时需要在接下来的短语中看到“:”符号。</p>

<h4 id="模式：嵌套短语">模式：嵌套短语</h4>

<p>嵌套短语有一个自相似的语言结构，它的子短语也遵循相同的结构。表达式是典型的自相似语言结构，由被运算符分隔的嵌套子表达式组成。类似地，while的代码块是嵌套在外部代码块内的一个代码块。我们在语法中使用递归规则表达自相似的语言结构。因此，如果规则的伪代码引用它自身，我们将需要一个递归的自引用规则。</p>

<p>让我们来看下代码块的嵌套是如何工作的。while语句是关键词while跟随一个在括号中的条件表达式再跟随一个语句。我们也可以把多条语句包裹在花括号里当作一个单块语句。表达语法如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>stat: 'while' '(' expr ')' stat    // 匹配WHILE语句
</span><span class='line'>    | '{' stat* '}'                // 匹配在括号中的语句块
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>这里的stat可以是单条语句或者被花括号括起来的一组语句。规则stat是直接递归的，因为它在两个选项中直接引用它自身。如果我们把第二个选项移到它自己的规则中，规则stat和block将是双向间接递归的。语法如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>stat: 'while' '(' expr ')' stat    // 匹配WHILE语句
</span><span class='line'>    | '{' stat* '}'                // 匹配语句块
</span><span class='line'>    ;
</span><span class='line'>block: '{' stat* '}' ;             // 匹配在括号中的语句块</span></code></pre></td></tr></table></div></figure>

<p>看下面仅有3类表达式（索引数组引用、括号表达式和整数）的简单语言的语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>expr: ID '[' expr ']'    // a[1], a[b[1]], a[(2*b[1])]
</span><span class='line'>    | '(' expr ')'       // (1), (a[1]), (((1))), (2*a[1])
</span><span class='line'>    | INT                // 1, 94117
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>注意递归是如何自然地发生的。数组索引表达式的索引组件是表达式本身，因此我们只需要在选项中引用expr即可。</p>

<p>下图是关于两个例子输入的语法分析树：</p>

<p><img src="/uploads/expr-parse-tree.png" title="expr-parse-tree" ></p>

<p>分析树中的内部树节点是规则引用，叶子是记号引用。从树根到任何节点的路径表示元素的规则调用栈（或者ANTLR生成的递归下降语法分析器调用栈）。路径代表递归嵌套的子树有多个相同规则的引用。规则节点是其下方子树的标签。根节点是expr，所以整棵树是一个表达式。在1之前的那棵expr子树会把整数当作一个表达式。</p>

<p>为实现这些模式，我们只需要由选项、记号引用、规则引用组成的语法规则即可。我们还可以把这些元素组成子规则，子规则是裹在括号内的行内规则。我们也可以将子规则标记为“?”或“*”或“+”循环去识别被包围的语法片段多次。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reading-notes-the-definitive-antlr4-reference-part15/">ANTLR 4权威参考读书笔记（15）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-22T17:51:36+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2016</span></span> <span class='time'>5:51 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在聚焦到具体的语法规则内部结构之前，我们要先讨论下语法的整体剖析以及如何形成一套初始的语法骨架。</p>

<p>语法文件通常是由一个命名语法的头和一系列可以彼此调用的规则组成。就像下面的那样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grammar MyG;
</span><span class='line'>rule1 : «stuff» ;
</span><span class='line'>rule2 : «more stuff» ;
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>

<p>设计语法就是要搞清楚«stuff»是什么？哪个规则是开始规则。这要求我们需要知道给定语言的一系列代表性的输入例子。当然，从语言参考手册或者其它语法分析器生成器格式而来的语法也是有帮助的。</p>

<p>正确设计语法的方法是借鉴功能分解或者自顶向下的设计，从粗粒度级别到细粒度级别逐步定义语言结构并把它们编码为语法规则。所以，我们的第一个任务就是找到粗粒度语言结构的名字，同时它也是开始规则。在英语中我们使用sentence，对于XML文件来说它则是document。</p>

<p>设计开始规则的内容是用英语伪代码描述整个输入格式的问题。例如，“a comma-separated-value (CSV) file is a sequence of rows terminated by newlines.”这段文字，在is a左边的至关重要的单词file是规则名字，在is a右边的所有内容则成为在规则定义右则的«stuff»的内容：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>file : «sequence of rows that are terminated by newlines» ;</span></code></pre></td></tr></table></div></figure>

<p>然后我们通过描述在开始规则右侧被确定的元素来进行下一个粒度级别的设计。在规则右侧的名词通常是对记号或尚未定义的规则的引用，这些记号是那些我们在正常情况下视为单词、标点符号、运算符的元素。就像单词是英语句子中的原子成分那样，记号在语法规则中也是如此。规则引用则涉及到像row那样需要被分解为更详细部分的其它语言结构。</p>

<p>进入细节的另外一层，我们可以说row是一系列被逗号分隔的field，而field则是一个数字或字符串。就像以下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>row   : «sequence of fields separated by commas» ;
</span><span class='line'>field : «number or string» ;</span></code></pre></td></tr></table></div></figure>

<p>当没有规则需要再定义时，我们就得到了语法的一个粗略的草图。</p>

<p>如果有其它格式的语法作为参考的话设计语法会容易的多，但小心不要盲目地遵循它，否则你会误入歧途的。非ANTLR格式的语法只是让你知道别人是如何决定分解语言中的短语的，它最大的作用就是可以给我们一份规则名称的列表用作参考。</p>

<p>不推荐从参考手册上复制粘贴语法到ANTLR，然后再通过细微的调整让它工作。把它当作一套指南而不是一段代码是更好的办法。为了清晰地描述语法，参考手册通常是相当松散的。这意味着语法能识别大量不在语言中的句子，或者语法可能不够明确，可以用多种方法匹配相同的输入序列。例如，语法可能会说表达式可以调用一个构建器或者访问一个函数，问题是像T(i)这样的输入可以同时匹配两者。理想情况下，在语法中是不能有这样的二义性的，每个输入句子我们只需要一种解释。</p>

<p>在另一个极端，参考手册中的语法有时过于明确地说明了规则。有些约束是需要在分析完输入后实施的，而不是试图对语法结构实施约束。例如，W3C XML语法就显式地指定标签中什么地方必须要有空格以及什么地方的空格可以省略。但事实是我们可以简单地让词法分析器在把记号发送给语法分析器之前去除空格，不需要在语法中到处测试它。</p>

<p>规格还说&lt;?xml ...&gt;标签可以有两个附加属性encoding和standalone。我们需要知道约束，但它是很容易去允许任何属性名字，然后在语法分析后检查语法分析树，以确保所有这些限制都满足的。
归根结底，XML只是嵌在文本中的一对标签，因此它的语法结构是相当直白的。唯一的挑战是如何分别对待什么在标签内以及什么在标签外。</p>

<p>识别语法规则并用伪代码表示它们的右侧部分最初是个挑战，但当你为更多的语言构建语法后它会变得越来越容易。一旦我们有了伪代码，我们就需要把它转换成ANTLR表示法，以便能得到一个可工作的语法。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reading-notes-the-definitive-antlr4-reference-part14/">ANTLR 4权威参考读书笔记（14）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-16T20:26:22+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>对于大多数语法，注释和空格都是语法分析器可以忽略的东西。如果我们不想让注释和空格在语法中到处都是，那么就需要让词法分析器把它们扔掉。不幸的是，这意味着任何后续处理步骤都不能再访问注释和空格。安全地忽略掉注释和空格的方法是把这些发送给语法分析器的记号放到一个“隐藏通道”中，语法分析器仅需要调协到单个通道即可。我们可以把任何我们想要的东西传递到其它通道中。这里是如何实现的语法：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>COMMENT
</span><span class='line'>    : '/*' .*? '*/' -&gt; channel(HIDDEN)    // match anything between /* and */
</span><span class='line'>    ;
</span><span class='line'>
</span><span class='line'>WS  : [ \r\t\n]+    -&gt; channel(HIDDEN)
</span><span class='line'>    ;</span></code></pre></td></tr></table></div></figure>

<p>就像我们前面讨论过的<code>-&gt; skip</code>那样，<code>-&gt; channel(HIDDEN)</code>也是一个的词法分析器指令。在这里，它设置那些记号的通道号码以便这些记号可以被语法分析器忽略。记号流仍然维护着原始的记号序列，但在喂食给语法分析器时则略过离线通道中的记号。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/logic-problems-who-owns-the-fish/">逻辑题-谁养鱼</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-12T18:06:58+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:06 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li>在一条街上，有5座房子，喷了5种颜色。</li>
<li>每座房子里住着不同国籍的人。</li>
<li>每个人喝不同的饮料，抽不同品牌的香烟，养不同的宠物。</li>
</ol>

<p>问题是：谁养鱼？</p>

<p>提示：</p>

<ol>
<li>英国人住红色房子。</li>
<li>瑞典人养狗。</li>
<li>丹麦人喝茶。</li>
<li>绿色房子在白色房子左面。</li>
<li>绿色房子主人喝咖啡。</li>
<li>抽Pall Mall香烟的人养鸟。</li>
<li>黄色房子主人抽Dunhill香烟。</li>
<li>住在中间房子的人喝牛奶。</li>
<li>挪威人住第一间房子。</li>
<li>抽Blends香烟的人住在养猫的人隔壁。</li>
<li>养马的人住抽Dunhill香烟的人隔壁。</li>
<li>抽Blue Master的人喝啤酒。</li>
<li>德国人抽Prince香烟。</li>
<li>挪威人住蓝色房子隔壁。</li>
<li>抽Blends香烟的人有一个喝水的邻居。</li>
</ol>

<p>在回答上述问题前先画一个6行5列的表格，从上到下的每一行分别代表房子的顺序（A表示左边第一间房子）、哪国人、房子颜色、饮料、香烟、宠物。下表是问题的初始状态：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>根据提示8、9和14可以得到：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>由提示4和5可以判定房子D的颜色是绿色，房子主人喝咖啡，房子E的颜色是白色。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">?</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>结合提示1、7和11可以知道房子C是红色的，住的是英国人，房子A是黄色的。挪威人抽Dunhill香烟。住房子B的人养马。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>依据上表可知，挪威人喝的饮料是水、茶或者啤酒。结合提示3和12可以断定挪威人喝的是水。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>通过提示15可以得出住房子B的人抽Blends香烟。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">?</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>结合提示12可以推断住房子E的人抽Blue Master香烟、喝啤酒。住房子B的人喝茶。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>由提示3、13得到房子B住的是丹麦人。房子D住的是德国人，抽Prince香烟。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">丹麦人</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">德国人</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">?</td>
<td style="text-align: center">Prince</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">?</td>
<td style="text-align: center">马</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>再由提示6和10确定住房子C的人抽Pall Mall香烟、养鸟。挪威人养猫。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">丹麦人</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">德国人</td>
<td style="text-align: center">?</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">Pall Mall</td>
<td style="text-align: center">Prince</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">猫</td>
<td style="text-align: center">马</td>
<td style="text-align: center">鸟</td>
<td style="text-align: center">?</td>
<td style="text-align: center">?</td>
</tr>
</tbody></table>

<p>最后结合提示2推断得到房子E住的是瑞典人，养狗。如下表所示：</p>

<table><thead>
<tr>
<th style="text-align: center">A</th>
<th style="text-align: center">B</th>
<th style="text-align: center">C</th>
<th style="text-align: center">D</th>
<th style="text-align: center">E</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">挪威人</td>
<td style="text-align: center">丹麦人</td>
<td style="text-align: center">英国人</td>
<td style="text-align: center">德国人</td>
<td style="text-align: center">瑞典人</td>
</tr>
<tr>
<td style="text-align: center">黄色</td>
<td style="text-align: center">蓝色</td>
<td style="text-align: center">红色</td>
<td style="text-align: center">绿色</td>
<td style="text-align: center">白色</td>
</tr>
<tr>
<td style="text-align: center">水</td>
<td style="text-align: center">茶</td>
<td style="text-align: center">牛奶</td>
<td style="text-align: center">咖啡</td>
<td style="text-align: center">啤酒</td>
</tr>
<tr>
<td style="text-align: center">Dunhill</td>
<td style="text-align: center">Blends</td>
<td style="text-align: center">Pall Mall</td>
<td style="text-align: center">Prince</td>
<td style="text-align: center">Blue Master</td>
</tr>
<tr>
<td style="text-align: center">猫</td>
<td style="text-align: center">马</td>
<td style="text-align: center">鸟</td>
<td style="text-align: center">?</td>
<td style="text-align: center">狗</td>
</tr>
</tbody></table>

<p>现在，结果已经出来了：德国人养鱼。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reading-notes-the-definitive-antlr4-reference-part13/">ANTLR 4权威参考读书笔记（13）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-06T18:24:18+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:24 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>现在准备要构建一个工具，用来把<a href="/blog/reading-notes-the-definitive-antlr4-reference-part7/">ANTLR 4权威参考读书笔记（7）</a>中idata.txt里的数据按group分行显示，就像这样：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>2 9 10
</span><span class='line'>3 1 2 3</span></code></pre></td></tr></table></div></figure>

<p>我们可以借助语法分析树的Listener机制来对词法分析结束后生成的记号流进行改写，我们不需要实现每一个Listener接口方法，只需要在捕获到group的时候把换行符插到它末尾就行。实现改写的代码如下所示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import org.antlr.v4.runtime.TokenStream;
</span><span class='line'>import org.antlr.v4.runtime.TokenStreamRewriter;
</span><span class='line'>
</span><span class='line'>public class RewriteListener extends IDataBaseListener {
</span><span class='line'>    TokenStreamRewriter rewriter;
</span><span class='line'>
</span><span class='line'>    public RewriteListener(TokenStream tokens) {
</span><span class='line'>        rewriter = new TokenStreamRewriter(tokens);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void enterGroup(IDataParser.GroupContext ctx) {
</span><span class='line'>        rewriter.insertAfter(ctx.stop, '\n');
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>接着就是写一个小程序来调用我们上面的改写类：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import org.antlr.v4.runtime.*;
</span><span class='line'>import org.antlr.v4.runtime.tree.*;
</span><span class='line'>import java.io.FileInputStream;
</span><span class='line'>import java.io.InputStream;
</span><span class='line'>
</span><span class='line'>public class IData {
</span><span class='line'>
</span><span class='line'>    public static void main(String[] args) throws Exception {
</span><span class='line'>        InputStream is = args.length &gt; 0 ? new FileInputStream(args[0]) : System.in;
</span><span class='line'>
</span><span class='line'>        ANTLRInputStream input = new ANTLRInputStream(is);
</span><span class='line'>        IDataLexer lexer = new IDataLexer(input);
</span><span class='line'>        CommonTokenStream tokens = new CommonTokenStream(lexer);
</span><span class='line'>        IDataParser parser = new IDataParser(tokens);
</span><span class='line'>        ParseTree tree = parser.file();
</span><span class='line'>
</span><span class='line'>        RewriteListener listener = new RewriteListener(tokens);
</span><span class='line'>
</span><span class='line'>        System.out.println("Before Rewriting");
</span><span class='line'>        System.out.println(listener.rewriter.getText());
</span><span class='line'>
</span><span class='line'>        ParseTreeWalker walker = new ParseTreeWalker();
</span><span class='line'>        walker.walk(listener, tree);
</span><span class='line'>
</span><span class='line'>        System.out.println("After Rewriting");
</span><span class='line'>        System.out.println(listener.rewriter.getText());
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

<p>这里的关键是TokenStreamRewriter对象知道如何在不修改流的情况下提供一个记号流的修改过的视图。它把所有的操作方法当作指令并把它们排进队列，等到在遍历记号流把它作为文本渲染回去的时候延迟执行。每次我们调用getText()时rewriter就会执行那些指令。</p>

<p>最后就是构建和测试应用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>antlr IData.g
</span><span class='line'>compile *.java
</span><span class='line'>run IData idata.txt</span></code></pre></td></tr></table></div></figure>

<p>以下是输出结果：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Before Rewriting
</span><span class='line'>29103123
</span><span class='line'>After Rewriting
</span><span class='line'>2910
</span><span class='line'>3123</span></code></pre></td></tr></table></div></figure>

<p>仅用几行代码，我们就能够没有任何烦恼地对某些内容做轻微的调整。这种策略对于源代码检测或重构这类一般性的问题是非常有效的。TokenStreamRewriter是一个非常强大且有效的操作记号流的方法。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/the-power-of-protocol-analyzers/">协议分析器的威力</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part19/">ANTLR 4权威参考读书笔记（19）</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part18/">ANTLR 4权威参考读书笔记（18）</a>
      </li>
    
      <li class="post">
        <a href="/blog/how-to-build-a-news-website-layout-with-flexbox/">如何使用Flexbox构建新闻站点布局</a>
      </li>
    
      <li class="post">
        <a href="/blog/reading-notes-the-definitive-antlr4-reference-part17/">ANTLR 4权威参考读书笔记（17）</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Recent Comments</h1>
  <div class="dsq-widget">
    <script type="text/javascript" src="http://codemany.disqus.com/recent_comments_widget.js"></script>
  </div>
</section>
<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 135%" href="/tags/antlr/">ANTLR</a>
<a style="font-size: 107%" href="/tags/algorithm/">Algorithm</a>
<a style="font-size: 131%" href="/tags/android/">Android</a>
<a style="font-size: 104%" href="/tags/c-plus-plus/">C++</a>
<a style="font-size: 107%" href="/tags/css/">CSS</a>
<a style="font-size: 110%" href="/tags/crack/">Crack</a>
<a style="font-size: 107%" href="/tags/database/">Database</a>
<a style="font-size: 97%" href="/tags/eclipse/">Eclipse</a>
<a style="font-size: 115%" href="/tags/git/">Git</a>
<a style="font-size: 97%" href="/tags/html/">HTML</a>
<a style="font-size: 104%" href="/tags/jbookshelf/">JBookShelf</a>
<a style="font-size: 148%" href="/tags/java/">Java</a>
<a style="font-size: 101%" href="/tags/javascript/">JavaScript</a>
<a style="font-size: 97%" href="/tags/listview/">ListView</a>
<a style="font-size: 104%" href="/tags/mysql/">MySQL</a>
<a style="font-size: 97%" href="/tags/paperclip/">Paperclip</a>
<a style="font-size: 119%" href="/tags/powerbuilder/">PowerBuilder</a>
<a style="font-size: 101%" href="/tags/powerscript/">PowerScript</a>
<a style="font-size: 117%" href="/tags/qianbao/">Qianbao</a>
<a style="font-size: 150%" href="/tags/rails/">Rails</a>
<a style="font-size: 119%" href="/tags/ruby/">Ruby</a>
<a style="font-size: 97%" href="/tags/spring/">Spring</a>
<a style="font-size: 101%" href="/tags/struts/">Struts</a>
<a style="font-size: 134%" href="/tags/translation/">Translation</a>
<a style="font-size: 97%" href="/tags/ubuntu/">Ubuntu</a>
<a style="font-size: 107%" href="/tags/windows-server-2008/">Windows Server 2008</a>
<a style="font-size: 107%" href="/tags/wxwidgets/">wxWidgets</a>

  </ul>
</section>
<section>
  <h1>Blogroll</h1>
  <ul>
    <li><a href="http://mindhacks.cn/">刘未鹏MIND HACKS</a></li>
    <li><a href="http://www.importnew.com/">ImportNew</a></li>
    <li><a href="http://ifeve.com/">并发编程网</a></li>
    <li><a href="http://codingnow.com/">云风的 BLOG</a></li>
    <li><a href="http://dbanotes.net/">DBA Notes</a></li>
    <li><a href="http://www.ruanyifeng.com/blog/">阮一峰的网络日志</a></li>
    <li><a href="http://advdbg.org/">高端调试</a></li>
    <li><a href="http://www.cs.usfca.edu/~galles/visualization/Algorithms.html">Data Structure Visualization</a></li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/dohkoos">@dohkoos</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dohkoos',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  <div>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</div>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - dohkoos -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codemany';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
